!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).firebase=e()}(this,function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,a="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),r="FormData"in t,i="ArrayBuffer"in t;if(i)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<o.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=f(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var n=[];return this.forEach(function(t,e){n.push(e)}),p(n)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),p(e)},d.prototype.entries=function(){var n=[];return this.forEach(function(t,e){n.push([e,t])}),p(n)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(T.prototype),T.prototype.clone=function(){return new T(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},T.error=function(){var t=new T(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];T.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new T(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=w,t.Response=T,t.fetch=function(i,o){return new Promise(function(n,t){var e=new w(i,o),r=new XMLHttpRequest;r.onload=function(){var t={status:r.status,statusText:r.statusText,headers:function(t){var i=new d;return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),n=e.shift().trim();if(n){var r=e.join(":").trim();i.append(n,r)}}),i}(r.getAllResponseHeaders()||"")};t.url="responseURL"in r?r.responseURL:t.headers.get("X-Request-URL");var e="response"in r?r.response:r.responseText;n(new T(e,t))},r.onerror=function(){t(new TypeError("Network request failed"))},r.ontimeout=function(){t(new TypeError("Network request failed"))},r.open(e.method,e.url,!0),"include"===e.credentials?r.withCredentials=!0:"omit"===e.credentials&&(r.withCredentials=!1),"responseType"in r&&a&&(r.responseType="blob"),e.headers.forEach(function(t,e){r.setRequestHeader(e,t)}),r.send(void 0===e._bodyInit?null:e._bodyInit)})},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function m(n){return new Promise(function(t,e){n.onload=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function g(t){var e=new FileReader,n=m(e);return e.readAsArrayBuffer(t),n}function v(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(a&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(r&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(i&&a&&s(t))this._bodyArrayBuffer=v(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=v(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,n=m(e);return e.readAsText(t),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(t,e){var n=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=function(t){var e=t.toUpperCase();return-1<c.indexOf(e)?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function _(t){var i=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),n=e.shift().replace(/\+/g," "),r=e.join("=").replace(/\+/g," ");i.append(decodeURIComponent(n),decodeURIComponent(r))}}),i}function T(t,e){e=e||{},this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}function n(t){return t&&t.Math==Math&&t}function m(t){try{return!!t()}catch(t){return!0}}function g(t){return"object"==typeof t?null!==t:"function"==typeof t}function i(t){return w?y.createElement(t):{}}function d(t){if(!g(t))throw TypeError(String(t)+" is not an object");return t}function o(t,e){if(!g(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!g(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}function v(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function h(e,n){try{S(b,e,n)}catch(t){b[e]=n}return n}function c(t,e){return A.call(t,e)}function s(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++O+P).toString(36)}function r(t){return M[t]||(M[t]=s(t))}var a,u,l,b=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||Function("return this")(),f=!1,p=!m(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),y=b.document,w=g(y)&&g(y.createElement),_=!p&&!m(function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}),T=Object.defineProperty,E={f:p?T:function(t,e,n){if(d(t),e=o(e,!0),d(n),_)try{return T(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},S=p?function(t,e,n){return E.f(t,e,v(1,n))}:function(t,e,n){return t[e]=n,t},I="__core-js_shared__",C=b[I]||h(I,{}),N=e(function(t){(t.exports=function(t,e){return C[t]||(C[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.3.6",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),A={}.hasOwnProperty,k=N("native-function-to-string",Function.toString),D=b.WeakMap,R="function"==typeof D&&/native code/.test(k.call(D)),O=0,P=Math.random(),M=N("keys"),L={},x=b.WeakMap;if(R){var F=new x,U=F.get,V=F.has,q=F.set;a=function(t,e){return q.call(F,t,e),e},u=function(t){return U.call(F,t)||{}},l=function(t){return V.call(F,t)}}else{var B=r("state");L[B]=!0,a=function(t,e){return S(t,B,e),e},u=function(t){return c(t,B)?t[B]:{}},l=function(t){return c(t,B)}}function j(t){return G.call(t).slice(8,-1)}function W(t){return X[t]||(X[t]=z&&Y[t]||(z?Y:s)("Symbol."+t))}function K(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),J))?n:$?j(e):"Object"==(r=j(e))&&"function"==typeof e.callee?"Arguments":r}var Q={set:a,get:u,has:l,enforce:function(t){return l(t)?u(t):a(t,{})},getterFor:function(n){return function(t){var e;if(!g(t)||(e=u(t)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return e}}},H=e(function(t){var e=Q.get,s=Q.enforce,u=String(k).split("toString");N("inspectSource",function(t){return k.call(t)}),(t.exports=function(t,e,n,r){var i=!!r&&!!r.unsafe,o=!!r&&!!r.enumerable,a=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof e||c(n,"name")||S(n,"name",e),s(n).source=u.join("string"==typeof e?e:"")),t!==b?(i?!a&&t[e]&&(o=!0):delete t[e],o?t[e]=n:S(t,e,n)):o?t[e]=n:h(e,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||k.call(this)})}),G={}.toString,z=!!Object.getOwnPropertySymbols&&!m(function(){return!String(Symbol())}),Y=b.Symbol,X=N("wks"),J=W("toStringTag"),$="Arguments"==j(function(){return arguments}()),Z={};Z[W("toStringTag")]="z";var tt="[object z]"!==String(Z)?function(){return"[object "+K(this)+"]"}:Z.toString,et=Object.prototype;tt!==et.toString&&H(et,"toString",tt,{unsafe:!0});function nt(t){return isNaN(t=+t)?0:(0<t?bt:vt)(t)}function rt(t){if(null==t)throw TypeError("Can't call method on "+t);return t}function it(s){return function(t,e){var n,r,i=String(rt(t)),o=nt(e),a=i.length;return o<0||a<=o?s?"":void 0:(n=i.charCodeAt(o))<55296||56319<n||o+1===a||(r=i.charCodeAt(o+1))<56320||57343<r?s?i.charAt(o):n:s?i.slice(o,o+2):r-56320+(n-55296<<10)+65536}}function ot(t){return It(rt(t))}function at(t){return"function"==typeof t?t:void 0}function st(t,e){return arguments.length<2?at(At[t])||at(b[t]):At[t]&&At[t][e]||b[t]&&b[t][e]}function ut(t){return 0<t?kt(nt(t),9007199254740991):0}function ct(s){return function(t,e,n){var r,i=ot(t),o=ut(i.length),a=function(t,e){var n=nt(t);return n<0?Dt(n+e,0):Rt(n,e)}(n,o);if(s&&e!=e){for(;a<o;)if((r=i[a++])!=r)return!0}else for(;a<o;a++)if((s||a in i)&&i[a]===e)return s||a||0;return!s&&-1}}function ht(t,e){var n,r=ot(t),i=0,o=[];for(n in r)!c(L,n)&&c(r,n)&&o.push(n);for(;e.length>i;)c(r,n=e[i++])&&(~Ot(o,n)||o.push(n));return o}function lt(t,e){for(var n=Ft(e),r=E.f,i=Nt.f,o=0;o<n.length;o++){var a=n[o];c(t,a)||r(t,a,i(e,a))}}function ft(t,e){var n=qt[Vt(t)];return n==jt||n!=Bt&&("function"==typeof e?m(e):!!e)}function pt(t,e){var n,r,i,o,a,s=t.target,u=t.global,c=t.stat;if(n=u?b:c?b[s]||h(s,{}):(b[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(a=Kt(n,r))&&a.value:n[r],!Wt(u?r:s+(c?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;lt(o,i)}(t.sham||i&&i.sham)&&S(o,"sham",!0),H(n,r,o,t)}}function dt(t){return Object(rt(t))}var yt,mt,gt,vt=Math.ceil,bt=Math.floor,wt={codeAt:it(!1),charAt:it(!0)},_t={}.propertyIsEnumerable,Tt=Object.getOwnPropertyDescriptor,Et={f:Tt&&!_t.call({1:2},1)?function(t){var e=Tt(this,t);return!!e&&e.enumerable}:_t},St="".split,It=m(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==j(t)?St.call(t,""):Object(t)}:Object,Ct=Object.getOwnPropertyDescriptor,Nt={f:p?Ct:function(t,e){if(t=ot(t),e=o(e,!0),_)try{return Ct(t,e)}catch(t){}if(c(t,e))return v(!Et.f.call(t,e),t[e])}},At=b,kt=Math.min,Dt=Math.max,Rt=Math.min,Ot={includes:ct(!0),indexOf:ct(!1)}.indexOf,Pt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Mt=Pt.concat("length","prototype"),Lt={f:Object.getOwnPropertyNames||function(t){return ht(t,Mt)}},xt={f:Object.getOwnPropertySymbols},Ft=st("Reflect","ownKeys")||function(t){var e=Lt.f(d(t)),n=xt.f;return n?e.concat(n(t)):e},Ut=/#|\.prototype\./,Vt=ft.normalize=function(t){return String(t).replace(Ut,".").toLowerCase()},qt=ft.data={},Bt=ft.NATIVE="N",jt=ft.POLYFILL="P",Wt=ft,Kt=Nt.f,Qt=!m(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Ht=r("IE_PROTO"),Gt=Object.prototype,zt=Qt?Object.getPrototypeOf:function(t){return t=dt(t),c(t,Ht)?t[Ht]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Gt:null},Yt=W("iterator"),Xt=!1;[].keys&&("next"in(gt=[].keys())?(mt=zt(zt(gt)))!==Object.prototype&&(yt=mt):Xt=!0),null==yt&&(yt={}),c(yt,Yt)||S(yt,Yt,function(){return this});function Jt(){}var $t={IteratorPrototype:yt,BUGGY_SAFARI_ITERATORS:Xt},Zt=Object.keys||function(t){return ht(t,Pt)},te=p?Object.defineProperties:function(t,e){d(t);for(var n,r=Zt(e),i=r.length,o=0;o<i;)E.f(t,n=r[o++],e[n]);return t},ee=st("document","documentElement"),ne=r("IE_PROTO"),re="prototype",ie=function(){var t,e=i("iframe"),n=Pt.length,r="script";for(e.style.display="none",ee.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object</"+r+">"),t.close(),ie=t.F;n--;)delete ie[re][Pt[n]];return ie()},oe=Object.create||function(t,e){var n;return null!==t?(Jt[re]=d(t),n=new Jt,Jt[re]=null,n[ne]=t):n=ie(),void 0===e?n:te(n,e)};L[ne]=!0;function ae(t,e,n){t&&!c(t=n?t:t.prototype,le)&&he(t,le,{configurable:!0,value:e})}function se(){return this}function ue(){return this}function ce(t,e,n,r,i,o,a){function s(t){if(t===i&&y)return y;if(!me&&t in p)return p[t];switch(t){case"keys":case ve:case be:return function(){return new n(this,t)}}return function(){return new n(this)}}!function(t,e,n){var r=e+" Iterator";t.prototype=oe(pe,{next:v(1,n)}),ae(t,r,!1),fe[r]=se}(n,e,r);var u,c,h,l=e+" Iterator",f=!1,p=t.prototype,d=p[ge]||p["@@iterator"]||i&&p[i],y=!me&&d||s(i),m="Array"==e&&p.entries||d;if(m&&(u=zt(m.call(new t)),ye!==Object.prototype&&u.next&&(zt(u)!==ye&&(de?de(u,ye):"function"!=typeof u[ge]&&S(u,ge,ue)),ae(u,l,!0))),i==ve&&d&&d.name!==ve&&(f=!0,y=function(){return d.call(this)}),p[ge]!==y&&S(p,ge,y),fe[e]=y,i)if(c={values:s(ve),keys:o?y:s("keys"),entries:s(be)},a)for(h in c)!me&&!f&&h in p||H(p,h,c[h]);else pt({target:e,proto:!0,forced:me||f},c);return c}var he=E.f,le=W("toStringTag"),fe={},pe=$t.IteratorPrototype,de=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,t={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(t,[]),r=t instanceof Array}catch(t){}return function(t,e){return d(t),function(t){if(!g(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(e),r?n.call(t,e):t.__proto__=e,t}}():void 0),ye=$t.IteratorPrototype,me=$t.BUGGY_SAFARI_ITERATORS,ge=W("iterator"),ve="values",be="entries",we=wt.charAt,_e="String Iterator",Te=Q.set,Ee=Q.getterFor(_e);ce(String,"String",function(t){Te(this,{type:_e,string:String(t),index:0})},function(){var t,e=Ee(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=we(n,r),e.index+=t.length,{value:t,done:!1})});var Se={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Ie=W("unscopables"),Ce=Array.prototype;null==Ce[Ie]&&S(Ce,Ie,oe(null));function Ne(t){Ce[Ie][t]=!0}var Ae="Array Iterator",ke=Q.set,De=Q.getterFor(Ae),Re=ce(Array,"Array",function(t,e){ke(this,{type:Ae,target:ot(t),index:0,kind:e})},function(){var t=De(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?{value:t.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values");fe.Arguments=fe.Array,Ne("keys"),Ne("values"),Ne("entries");var Oe=W("iterator"),Pe=W("toStringTag"),Me=Re.values;for(var Le in Se){var xe=b[Le],Fe=xe&&xe.prototype;if(Fe){if(Fe[Oe]!==Me)try{S(Fe,Oe,Me)}catch(Ss){Fe[Oe]=Me}if(Fe[Pe]||S(Fe,Pe,Le),Se[Le])for(var Ue in Re)if(Fe[Ue]!==Re[Ue])try{S(Fe,Ue,Re[Ue])}catch(Ss){Fe[Ue]=Re[Ue]}}}function Ve(t,e,n){for(var r in e)H(t,r,e[r],n);return t}function qe(t){var e=st(t),n=E.f;p&&e&&!e[ze]&&n(e,ze,{configurable:!0,get:function(){return this}})}function Be(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}function je(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t}function We(t){return void 0!==t&&(fe.Array===t||Xe[Ye]===t)}function Ke(r,i,t){if(Be(r),void 0===i)return r;switch(t){case 0:return function(){return r.call(i)};case 1:return function(t){return r.call(i,t)};case 2:return function(t,e){return r.call(i,t,e)};case 3:return function(t,e,n){return r.call(i,t,e,n)}}return function(){return r.apply(i,arguments)}}function Qe(t){if(null!=t)return t[Je]||t["@@iterator"]||fe[K(t)]}function He(e,t,n,r){try{return r?t(d(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&d(i.call(e)),t}}var Ge=b.Promise,ze=W("species"),Ye=W("iterator"),Xe=Array.prototype,Je=W("iterator"),$e=e(function(t){function p(t,e){this.stopped=t,this.result=e}(t.exports=function(t,e,n,r,i){var o,a,s,u,c,h,l,f=Ke(e,n,r?2:1);if(i)o=t;else{if("function"!=typeof(a=Qe(t)))throw TypeError("Target is not iterable");if(We(a)){for(s=0,u=ut(t.length);s<u;s++)if((c=r?f(d(l=t[s])[0],l[1]):f(t[s]))&&c instanceof p)return c;return new p(!1)}o=a.call(t)}for(h=o.next;!(l=h.call(o)).done;)if("object"==typeof(c=He(o,f,l.value,r))&&c&&c instanceof p)return c;return new p(!1)}).stop=function(t){return new p(!0,t)}}),Ze=W("iterator"),tn=!1;try{var en=0,nn={next:function(){return{done:!!en++}},return:function(){tn=!0}};nn[Ze]=function(){return this},Array.from(nn,function(){throw 2})}catch(Ss){}function rn(t,e){if(!e&&!tn)return!1;var n=!1;try{var r={};r[Ze]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}function on(t,e){var n,r=d(t).constructor;return void 0===r||null==(n=d(r)[pn])?e:Be(n)}function an(t){if(Tn.hasOwnProperty(t)){var e=Tn[t];delete Tn[t],e()}}function sn(t){return function(){an(t)}}function un(t){an(t.data)}function cn(t){b.postMessage(t+"",yn.protocol+"//"+yn.host)}var hn,ln,fn,pn=W("species"),dn=st("navigator","userAgent")||"",yn=b.location,mn=b.setImmediate,gn=b.clearImmediate,vn=b.process,bn=b.MessageChannel,wn=b.Dispatch,_n=0,Tn={},En="onreadystatechange";mn&&gn||(mn=function(t){for(var e=[],n=1;n<arguments.length;)e.push(arguments[n++]);return Tn[++_n]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},hn(_n),_n},gn=function(t){delete Tn[t]},"process"==j(vn)?hn=function(t){vn.nextTick(sn(t))}:wn&&wn.now?hn=function(t){wn.now(sn(t))}:bn&&!/(iphone|ipod|ipad).*applewebkit/i.test(dn)?(fn=(ln=new bn).port2,ln.port1.onmessage=un,hn=Ke(fn.postMessage,fn,1)):!b.addEventListener||"function"!=typeof postMessage||b.importScripts||m(cn)?hn=En in i("script")?function(t){ee.appendChild(i("script"))[En]=function(){ee.removeChild(this),an(t)}}:function(t){setTimeout(sn(t),0)}:(hn=cn,b.addEventListener("message",un,!1)));var Sn,In,Cn,Nn,An,kn,Dn,Rn,On={set:mn,clear:gn},Pn=Nt.f,Mn=On.set,Ln=b.MutationObserver||b.WebKitMutationObserver,xn=b.process,Fn=b.Promise,Un="process"==j(xn),Vn=Pn(b,"queueMicrotask"),qn=Vn&&Vn.value;qn||(Sn=function(){var t,e;for(Un&&(t=xn.domain)&&t.exit();In;){e=In.fn,In=In.next;try{e()}catch(t){throw In?Nn():Cn=void 0,t}}Cn=void 0,t&&t.enter()},Nn=Un?function(){xn.nextTick(Sn)}:Ln&&!/(iphone|ipod|ipad).*applewebkit/i.test(dn)?(An=!0,kn=document.createTextNode(""),new Ln(Sn).observe(kn,{characterData:!0}),function(){kn.data=An=!An}):Fn&&Fn.resolve?(Dn=Fn.resolve(void 0),Rn=Dn.then,function(){Rn.call(Dn,Sn)}):function(){Mn.call(b,Sn)});function Bn(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=t,r=e}),this.resolve=Be(n),this.reject=Be(r)}function jn(t,e){if(d(t),g(e)&&e.constructor===t)return e;var n=Gn.f(t);return(0,n.resolve)(e),n.promise}function Wn(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}var Kn,Qn,Hn=qn||function(t){var e={fn:t,next:void 0};Cn&&(Cn.next=e),In||(In=e,Nn()),Cn=e},Gn={f:function(t){return new Bn(t)}},zn=b.process,Yn=zn&&zn.versions,Xn=Yn&&Yn.v8;Xn?Qn=(Kn=Xn.split("."))[0]+Kn[1]:dn&&(!(Kn=dn.match(/Edge\/(\d+)/))||74<=Kn[1])&&(Kn=dn.match(/Chrome\/(\d+)/))&&(Qn=Kn[1]);function Jn(t){var e;return!(!g(t)||"function"!=typeof(e=t.then))&&e}function $n(l,f,p){if(!f.notified){f.notified=!0;var d=f.reactions;Hn(function(){for(var t=f.value,e=1==f.state,n=0;d.length>n;){var r,i,o,a=d[n++],s=e?a.ok:a.fail,u=a.resolve,c=a.reject,h=a.domain;try{s?(e||(2===f.rejection&&Nr(l,f),f.rejection=1),!0===s?r=t:(h&&h.enter(),r=s(t),h&&(h.exit(),o=!0)),r===a.promise?c(dr("Promise-chain cycle")):(i=Jn(r))?i.call(r,u,c):u(r)):c(t)}catch(t){h&&!o&&h.exit(),c(t)}}f.reactions=[],f.notified=!1,p&&!f.rejection&&Ir(l,f)})}}function Zn(t,e,n){var r,i;_r?((r=yr.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),b.dispatchEvent(r)):r={promise:e,reason:n},(i=b["on"+t])?i(r):t===Tr&&function(t,e){var n=b.console;n&&n.error&&(1===arguments.length?n.error(t):n.error(t,e))}("Unhandled promise rejection",n)}function tr(e,n,r,i){return function(t){e(n,r,t,i)}}function er(t,e,n,r){e.done||(e.done=!0,r&&(e=r),e.value=n,e.state=2,$n(t,e,!0))}var nr,rr,ir,or,ar=Qn&&+Qn,sr=On.set,ur=W("species"),cr="Promise",hr=Q.get,lr=Q.set,fr=Q.getterFor(cr),pr=Ge,dr=b.TypeError,yr=b.document,mr=b.process,gr=st("fetch"),vr=Gn.f,br=vr,wr="process"==j(mr),_r=!!(yr&&yr.createEvent&&b.dispatchEvent),Tr="unhandledrejection",Er=Wt(cr,function(){if(66===ar)return!0;if(!wr&&"function"!=typeof PromiseRejectionEvent)return!0;if(51<=ar&&/native code/.test(pr))return!1;function t(t){t(function(){},function(){})}var e=pr.resolve(1);return(e.constructor={})[ur]=t,!(e.then(function(){})instanceof t)}),Sr=Er||!rn(function(t){pr.all(t).catch(function(){})}),Ir=function(n,r){sr.call(b,function(){var t,e=r.value;if(Cr(r)&&(t=Wn(function(){wr?mr.emit("unhandledRejection",e,n):Zn(Tr,n,e)}),r.rejection=wr||Cr(r)?2:1,t.error))throw t.value})},Cr=function(t){return 1!==t.rejection&&!t.parent},Nr=function(t,e){sr.call(b,function(){wr?mr.emit("rejectionHandled",t):Zn("rejectionhandled",t,e.value)})},Ar=function(n,r,t,e){if(!r.done){r.done=!0,e&&(r=e);try{if(n===t)throw dr("Promise can't be resolved itself");var i=Jn(t);i?Hn(function(){var e={done:!1};try{i.call(t,tr(Ar,n,e,r),tr(er,n,e,r))}catch(t){er(n,e,t,r)}}):(r.value=t,r.state=1,$n(n,r,!1))}catch(t){er(n,{done:!1},t,r)}}};Er&&(pr=function(t){je(this,pr,cr),Be(t),nr.call(this);var e=hr(this);try{t(tr(Ar,this,e),tr(er,this,e))}catch(t){er(this,e,t)}},(nr=function(t){lr(this,{type:cr,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=Ve(pr.prototype,{then:function(t,e){var n=fr(this),r=vr(on(this,pr));return r.ok="function"!=typeof t||t,r.fail="function"==typeof e&&e,r.domain=wr?mr.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&$n(this,n,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),rr=function(){var t=new nr,e=hr(t);this.promise=t,this.resolve=tr(Ar,t,e),this.reject=tr(er,t,e)},Gn.f=vr=function(t){return t===pr||t===ir?new rr(t):br(t)},"function"==typeof Ge&&(or=Ge.prototype.then,H(Ge.prototype,"then",function(t,e){var n=this;return new pr(function(t,e){or.call(n,t,e)}).then(t,e)},{unsafe:!0}),"function"==typeof gr&&pt({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return jn(pr,gr.apply(b,arguments))}}))),pt({global:!0,wrap:!0,forced:Er},{Promise:pr}),ae(pr,cr,!1),qe(cr),ir=st(cr),pt({target:cr,stat:!0,forced:Er},{reject:function(t){var e=vr(this);return e.reject.call(void 0,t),e.promise}}),pt({target:cr,stat:!0,forced:Er},{resolve:function(t){return jn(this,t)}}),pt({target:cr,stat:!0,forced:Sr},{all:function(t){var s=this,e=vr(s),u=e.resolve,c=e.reject,n=Wn(function(){var r=Be(s.resolve),i=[],o=0,a=1;$e(t,function(t){var e=o++,n=!1;i.push(void 0),a++,r.call(s,t).then(function(t){n||(n=!0,i[e]=t,--a||u(i))},c)}),--a||u(i)});return n.error&&c(n.value),e.promise},race:function(t){var n=this,r=vr(n),i=r.reject,e=Wn(function(){var e=Be(n.resolve);$e(t,function(t){e.call(n,t).then(r.resolve,i)})});return e.error&&i(e.value),r.promise}}),pt({target:"Promise",stat:!0},{allSettled:function(t){var s=this,e=Gn.f(s),u=e.resolve,n=e.reject,r=Wn(function(){var r=Be(s.resolve),i=[],o=0,a=1;$e(t,function(t){var e=o++,n=!1;i.push(void 0),a++,r.call(s,t).then(function(t){n||(n=!0,i[e]={status:"fulfilled",value:t},--a||u(i))},function(t){n||(n=!0,i[e]={status:"rejected",reason:t},--a||u(i))})}),--a||u(i)});return r.error&&n(r.value),e.promise}}),pt({target:"Promise",proto:!0,real:!0},{finally:function(e){var n=on(this,st("Promise")),t="function"==typeof e;return this.then(t?function(t){return jn(n,e()).then(function(){return t})}:e,t?function(t){return jn(n,e()).then(function(){throw t})}:e)}}),"function"!=typeof Ge||Ge.prototype.finally||H(Ge.prototype,"finally",st("Promise").prototype.finally);At.Promise;var kr=Q.set,Dr=Q.getterFor("AggregateError"),Rr=function(t,e){var n=this;if(!(n instanceof Rr))return new Rr(t,e);de&&(n=de(new Error(e),zt(n)));var r=[];return $e(t,r.push,r),p?kr(n,{errors:r,type:"AggregateError"}):n.errors=r,void 0!==e&&S(n,"message",String(e)),n};Rr.prototype=oe(Error.prototype,{constructor:v(5,Rr),message:v(5,""),name:v(5,"AggregateError"),toString:v(5,function(){var t=d(this).name;t=void 0===t?"AggregateError":String(t);var e=this.message;return t+": "+(e=void 0===e?"":String(e))})}),p&&E.f(Rr.prototype,"errors",{get:function(){return Dr(this).errors},configurable:!0}),pt({global:!0},{AggregateError:Rr}),pt({target:"Promise",stat:!0},{try:function(t){var e=Gn.f(this),n=Wn(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var Or="No one promise resolved";pt({target:"Promise",stat:!0},{any:function(t){var u=this,e=Gn.f(u),c=e.resolve,h=e.reject,n=Wn(function(){var r=Be(u.resolve),i=[],o=0,a=1,s=!1;$e(t,function(t){var e=o++,n=!1;i.push(void 0),a++,r.call(u,t).then(function(t){n||s||(s=!0,c(t))},function(t){n||s||(n=!0,i[e]=t,--a||h(new(st("AggregateError"))(i,Or)))})}),--a||h(new(st("AggregateError"))(i,Or))});return n.error&&h(n.value),e.promise}});function Pr(t,e){var n;return Lr(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Lr(n.prototype)?g(n)&&null===(n=n[xr])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}function Mr(p){var d=1==p,y=2==p,m=3==p,g=4==p,v=6==p,b=5==p||v;return function(t,e,n,r){for(var i,o,a=dt(t),s=It(a),u=Ke(e,n,3),c=ut(s.length),h=0,l=r||Pr,f=d?l(t,c):y?l(t,0):void 0;h<c;h++)if((b||h in s)&&(o=u(i=s[h],h,a),p))if(d)f[h]=o;else if(o)switch(p){case 3:return!0;case 5:return i;case 6:return h;case 2:Fr.call(f,i)}else if(g)return!1;return v?-1:m||g?g:f}}var Lr=Array.isArray||function(t){return"Array"==j(t)},xr=W("species"),Fr=[].push,Ur={forEach:Mr(0),map:Mr(1),filter:Mr(2),some:Mr(3),every:Mr(4),find:Mr(5),findIndex:Mr(6)},Vr=Ur.find,qr="find",Br=!0;qr in[]&&Array(1)[qr](function(){Br=!1}),pt({target:"Array",proto:!0,forced:Br},{find:function(t,e){return Vr(this,t,1<arguments.length?e:void 0)}}),Ne(qr);function jr(t,e,n){return Ke(Wr,b[t].prototype[e],n)}var Wr=Function.call,Kr=(jr("Array","find"),Ur.findIndex),Qr="findIndex",Hr=!0;Qr in[]&&Array(1)[Qr](function(){Hr=!1}),pt({target:"Array",proto:!0,forced:Hr},{findIndex:function(t,e){return Kr(this,t,1<arguments.length?e:void 0)}}),Ne(Qr);function Gr(t,e,n){var r=o(e);r in t?E.f(t,r,v(0,n)):t[r]=n}jr("Array","findIndex");var zr=!rn(function(t){Array.from(t)});pt({target:"Array",stat:!0,forced:zr},{from:function(t,e,n){var r,i,o,a,s,u=dt(t),c="function"==typeof this?this:Array,h=arguments.length,l=1<h?e:void 0,f=void 0!==l,p=0,d=Qe(u);if(f&&(l=Ke(l,2<h?n:void 0,2)),null==d||c==Array&&We(d))for(i=new c(r=ut(u.length));p<r;p++)Gr(i,p,f?l(u[p],p):u[p]);else for(s=(a=d.call(u)).next,i=new c;!(o=s.call(a)).done;p++)Gr(i,p,f?He(a,l,[o.value,p],!0):o.value);return i.length=p,i}});At.Array.from;var Yr,Xr,Jr,$r=Ur.some;pt({target:"Array",proto:!0,forced:(Yr="some",Jr=[][Yr],!Jr||!m(function(){Jr.call(null,Xr||function(){throw 1},1)}))},{some:function(t,e){return $r(this,t,1<arguments.length?e:void 0)}});jr("Array","some");function Zr(t){return g(t)&&c(yi,K(t))}var ti,ei=E.f,ni=b.DataView,ri=ni&&ni.prototype,ii=b.Int8Array,oi=ii&&ii.prototype,ai=b.Uint8ClampedArray,si=ai&&ai.prototype,ui=ii&&zt(ii),ci=oi&&zt(oi),hi=Object.prototype,li=(hi.isPrototypeOf,W("toStringTag")),fi=s("TYPED_ARRAY_TAG"),pi=!(!b.ArrayBuffer||!ni),di=pi&&!!de&&"Opera"!==K(b.opera),yi={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8};for(ti in yi)b[ti]||(di=!1);if((!di||"function"!=typeof ui||ui===Function.prototype)&&(ui=function(){throw TypeError("Incorrect invocation")},di))for(ti in yi)b[ti]&&de(b[ti],ui);if((!di||!ci||ci===hi)&&(ci=ui.prototype,di))for(ti in yi)b[ti]&&de(b[ti].prototype,ci);if(di&&zt(si)!==ci&&de(si,ci),p&&!c(ci,li))for(ti in!0,ei(ci,li,{get:function(){return g(this)?this[fi]:void 0}}),yi)b[ti]&&S(b[ti],fi,ti);pi&&de&&zt(ri)!==hi&&de(ri,hi);function mi(){return _i.call(Si(this))}var gi=function(t){if(Zr(t))return t;throw TypeError("Target is not a typed array")},vi=function(t,e,n){if(p){if(n)for(var r in yi){var i=b[r];i&&c(i.prototype,t)&&delete i.prototype[t]}ci[t]&&!n||H(ci,t,n?e:di&&oi[t]||e)}},bi=W("iterator"),wi=b.Uint8Array,_i=Re.values,Ti=Re.keys,Ei=Re.entries,Si=gi,Ii=vi,Ci=wi&&wi.prototype[bi],Ni=!!Ci&&("values"==Ci.name||null==Ci.name);Ii("entries",function(){return Ei.call(Si(this))}),Ii("keys",function(){return Ti.call(Si(this))}),Ii("values",mi,!Ni),Ii(bi,mi,!Ni);var Ai=Object.assign,ki=!Ai||m(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=Ai({},t)[n]||Zt(Ai({},e)).join("")!=r})?function(t,e){for(var n=dt(t),r=arguments.length,i=1,o=xt.f,a=Et.f;i<r;)for(var s,u=It(arguments[i++]),c=o?Zt(u).concat(o(u)):Zt(u),h=c.length,l=0;l<h;)s=c[l++],p&&!a.call(u,s)||(n[s]=u[s]);return n}:Ai;pt({target:"Object",stat:!0,forced:Object.assign!==ki},{assign:ki});At.Object.assign;function Di(s){return function(t){for(var e,n=ot(t),r=Zt(n),i=r.length,o=0,a=[];o<i;)e=r[o++],p&&!Ri.call(n,e)||a.push(s?[e,n[e]]:n[e]);return a}}var Ri=Et.f,Oi={entries:Di(!0),values:Di(!1)},Pi=Oi.entries;pt({target:"Object",stat:!0},{entries:function(t){return Pi(t)}});At.Object.entries;var Mi=Oi.values;pt({target:"Object",stat:!0},{values:function(t){return Mi(t)}});At.Object.values;function Li(t){if(function(t){var e;return g(t)&&(void 0!==(e=t[Fi])?!!e:"RegExp"==j(t))}(t))throw TypeError("The method doesn't accept regular expressions");return t}function xi(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[Ui]=!1,"/./"[e](n)}catch(t){}}return!1}var Fi=W("match"),Ui=W("match");pt({target:"String",proto:!0,forced:!xi("includes")},{includes:function(t,e){return!!~String(rt(this)).indexOf(Li(t),1<arguments.length?e:void 0)}});jr("String","includes");var Vi="".startsWith,qi=Math.min;pt({target:"String",proto:!0,forced:!xi("startsWith")},{startsWith:function(t,e){var n=String(rt(this));Li(t);var r=ut(qi(1<arguments.length?e:void 0,n.length)),i=String(t);return Vi?Vi.call(n,i,r):n.slice(r,r+i.length)===i}});jr("String","startsWith");pt({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(rt(this)),n="",r=nt(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}});jr("String","repeat");function Bi(t){if(!g(t))return!1;var e=t[Ki];return void 0!==e?!!e:Lr(t)}var ji,Wi=W("species"),Ki=W("isConcatSpreadable"),Qi=9007199254740991,Hi="Maximum allowed index exceeded",Gi=51<=ar||!m(function(){var t=[];return t[Ki]=!1,t.concat()[0]!==t}),zi=(ji="concat",51<=ar||!m(function(){var t=[];return(t.constructor={})[Wi]=function(){return{foo:1}},1!==t[ji](Boolean).foo}));pt({target:"Array",proto:!0,forced:!Gi||!zi},{concat:function(t){var e,n,r,i,o,a=dt(this),s=Pr(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(Bi(o=-1===e?a:arguments[e])){if(i=ut(o.length),Qi<u+i)throw TypeError(Hi);for(n=0;n<i;n++,u++)n in o&&Gr(s,u,o[n])}else{if(Qi<=u)throw TypeError(Hi);Gr(s,u++,o)}return s.length=u,s}});function Yi(t){var e=At.Symbol||(At.Symbol={});c(e,t)||oo(e,t,{value:io.f(t)})}function Xi(t,e){var n=To[t]=oe(yo[co]);return lo(n,{type:uo,tag:t,description:e}),p||(n.description=e),n}function Ji(e,t){d(e);var n=ot(t),r=Zt(n).concat(Po(n));return ao(r,function(t){p&&!Oo.call(n,t)||Ro(e,t,n[t])}),e}function $i(t,e){var n=ot(t),r=o(e,!0);if(n!==po||!c(To,r)||c(Eo,r)){var i=vo(n,r);return!i||!c(To,r)||c(n,so)&&n[so][r]||(i.enumerable=!0),i}}function Zi(t){var e=wo(ot(t)),n=[];return ao(e,function(t){c(To,t)||c(L,t)||n.push(t)}),n}var to=Lt.f,eo={}.toString,no="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ro={f:function(t){return no&&"[object Window]"==eo.call(t)?function(t){try{return to(t)}catch(t){return no.slice()}}(t):to(ot(t))}},io={f:W},oo=E.f,ao=Ur.forEach,so=r("hidden"),uo="Symbol",co="prototype",ho=W("toPrimitive"),lo=Q.set,fo=Q.getterFor(uo),po=Object[co],yo=b.Symbol,mo=b.JSON,go=mo&&mo.stringify,vo=Nt.f,bo=E.f,wo=ro.f,_o=Et.f,To=N("symbols"),Eo=N("op-symbols"),So=N("string-to-symbol-registry"),Io=N("symbol-to-string-registry"),Co=N("wks"),No=b.QObject,Ao=!No||!No[co]||!No[co].findChild,ko=p&&m(function(){return 7!=oe(bo({},"a",{get:function(){return bo(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=vo(po,e);r&&delete po[e],bo(t,e,n),r&&t!==po&&bo(po,e,r)}:bo,Do=z&&"symbol"==typeof yo.iterator?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof yo},Ro=function(t,e,n){t===po&&Ro(Eo,e,n),d(t);var r=o(e,!0);return d(n),c(To,r)?(n.enumerable?(c(t,so)&&t[so][r]&&(t[so][r]=!1),n=oe(n,{enumerable:v(0,!1)})):(c(t,so)||bo(t,so,v(1,{})),t[so][r]=!0),ko(t,r,n)):bo(t,r,n)},Oo=function(t){var e=o(t,!0),n=_o.call(this,e);return!(this===po&&c(To,e)&&!c(Eo,e))&&(!(n||!c(this,e)||!c(To,e)||c(this,so)&&this[so][e])||n)},Po=function(t){var e=t===po,n=wo(e?Eo:ot(t)),r=[];return ao(n,function(t){!c(To,t)||e&&!c(po,t)||r.push(To[t])}),r};z||(H((yo=function(t){if(this instanceof yo)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==t?String(t):void 0,n=s(e),r=function(t){this===po&&r.call(Eo,t),c(this,so)&&c(this[so],n)&&(this[so][n]=!1),ko(this,n,v(1,t))};return p&&Ao&&ko(po,n,{configurable:!0,set:r}),Xi(n,e)})[co],"toString",function(){return fo(this).tag}),Et.f=Oo,E.f=Ro,Nt.f=$i,Lt.f=ro.f=Zi,xt.f=Po,p&&(bo(yo[co],"description",{configurable:!0,get:function(){return fo(this).description}}),H(po,"propertyIsEnumerable",Oo,{unsafe:!0})),io.f=function(t){return Xi(W(t),t)}),pt({global:!0,wrap:!0,forced:!z,sham:!z},{Symbol:yo}),ao(Zt(Co),function(t){Yi(t)}),pt({target:uo,stat:!0,forced:!z},{for:function(t){var e=String(t);if(c(So,e))return So[e];var n=yo(e);return So[e]=n,Io[n]=e,n},keyFor:function(t){if(!Do(t))throw TypeError(t+" is not a symbol");if(c(Io,t))return Io[t]},useSetter:function(){Ao=!0},useSimple:function(){Ao=!1}}),pt({target:"Object",stat:!0,forced:!z,sham:!p},{create:function(t,e){return void 0===e?oe(t):Ji(oe(t),e)},defineProperty:Ro,defineProperties:Ji,getOwnPropertyDescriptor:$i}),pt({target:"Object",stat:!0,forced:!z},{getOwnPropertyNames:Zi,getOwnPropertySymbols:Po}),pt({target:"Object",stat:!0,forced:m(function(){xt.f(1)})},{getOwnPropertySymbols:function(t){return xt.f(dt(t))}}),mo&&pt({target:"JSON",stat:!0,forced:!z||m(function(){var t=yo();return"[null]"!=go([t])||"{}"!=go({a:t})||"{}"!=go(Object(t))})},{stringify:function(t){for(var e,n,r=[t],i=1;i<arguments.length;)r.push(arguments[i++]);if(n=e=r[1],(g(e)||void 0!==t)&&!Do(t))return Lr(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!Do(e))return e}),r[1]=e,go.apply(mo,r)}}),yo[co][ho]||S(yo[co],ho,yo[co].valueOf),ae(yo,uo),L[so]=!0,Yi("asyncIterator");var Mo=E.f,Lo=b.Symbol;if(!(!p||"function"!=typeof Lo||"description"in Lo.prototype&&void 0===Lo().description)){var xo={},Fo=function(t){var e=arguments.length<1||void 0===t?void 0:String(t),n=this instanceof Fo?new Lo(e):void 0===e?Lo():Lo(e);return""===e&&(xo[n]=!0),n};lt(Fo,Lo);var Uo=Fo.prototype=Lo.prototype;Uo.constructor=Fo;var Vo=Uo.toString,qo="Symbol(test)"==String(Lo("test")),Bo=/^Symbol\((.*)\)[^)]+$/;Mo(Uo,"description",{configurable:!0,get:function(){var t=g(this)?this.valueOf():this,e=Vo.call(t);if(c(xo,t))return"";var n=qo?e.slice(7,-1):e.replace(Bo,"$1");return""===n?void 0:n}}),pt({global:!0,forced:!0},{Symbol:Fo})}Yi("hasInstance"),Yi("isConcatSpreadable"),Yi("iterator"),Yi("match"),Yi("matchAll"),Yi("replace"),Yi("search"),Yi("species"),Yi("split"),Yi("toPrimitive"),Yi("toStringTag"),Yi("unscopables"),ae(Math,"Math",!0),ae(b.JSON,"JSON",!0);At.Symbol;Yi("asyncDispose"),Yi("dispose"),Yi("observable"),Yi("patternMatch"),Yi("replaceAll");io.f("iterator");function jo(r,t,e,i,o){function n(t){var n=s[t];H(s,t,"add"==t?function(t){return n.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!g(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return o&&!g(t)?void 0:n.call(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!g(t))&&n.call(this,0===t?0:t)}:function(t,e){return n.call(this,0===t?0:t,e),this})}var a=b[r],s=a&&a.prototype,u=a,c=i?"set":"add",h={};if(Wt(r,"function"!=typeof a||!(o||s.forEach&&!m(function(){(new a).entries().next()}))))u=e.getConstructor(t,r,i,c),Qo.REQUIRED=!0;else if(Wt(r,!0)){var l=new u,f=l[c](o?{}:-0,1)!=l,p=m(function(){l.has(1)}),d=rn(function(t){new a(t)}),y=!o&&m(function(){for(var t=new a,e=5;e--;)t[c](e,e);return!t.has(-0)});d||(((u=t(function(t,e){je(t,u,r);var n=function(t,e,n){var r,i;return de&&"function"==typeof(r=e.constructor)&&r!==n&&g(i=r.prototype)&&i!==n.prototype&&de(t,i),t}(new a,t,u);return null!=e&&$e(e,n[c],n,i),n})).prototype=s).constructor=u),(p||y)&&(n("delete"),n("has"),i&&n("get")),(y||f)&&n(c),o&&s.clear&&delete s.clear}return h[r]=u,pt({global:!0,forced:u!=a},h),ae(u,r),o||e.setStrong(u,r,i),u}function Wo(t,e,n){var r,i,o,a,s=arguments.length,u=1<s?e:void 0;return Be(this),(r=void 0!==u)&&Be(u),null==t?new this:(i=[],r?(o=0,a=Ke(u,2<s?n:void 0,2),$e(t,function(t){i.push(a(t,o++))})):$e(t,i.push,i),new this(i))}var Ko=!m(function(){return Object.isExtensible(Object.preventExtensions({}))}),Qo=e(function(t){function n(t){e(t,r,{value:{objectID:"O"+ ++i,weakData:{}}})}var e=E.f,r=s("meta"),i=0,o=Object.isExtensible||function(){return!0},a=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!g(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!c(t,r)){if(!o(t))return"F";if(!e)return"E";n(t)}return t[r].objectID},getWeakData:function(t,e){if(!c(t,r)){if(!o(t))return!0;if(!e)return!1;n(t)}return t[r].weakData},onFreeze:function(t){return Ko&&a.REQUIRED&&o(t)&&!c(t,r)&&n(t),t}};L[r]=!0}),Ho=(Qo.REQUIRED,Qo.fastKey,Qo.getWeakData,Qo.onFreeze,E.f),Go=Qo.fastKey,zo=Q.set,Yo=Q.getterFor,Xo={getConstructor:function(t,n,r,i){function o(t,e,n){var r,i,o=s(t),a=u(t,e);return a?a.value=n:(o.last=a={index:i=Go(e,!0),key:e,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=a),r&&(r.next=a),p?o.size++:t.size++,"F"!==i&&(o.index[i]=a)),t}var a=t(function(t,e){je(t,a,n),zo(t,{type:n,index:oe(null),first:void 0,last:void 0,size:0}),p||(t.size=0),null!=e&&$e(e,t[i],t,r)}),s=Yo(n),u=function(t,e){var n,r=s(t),i=Go(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return Ve(a.prototype,{clear:function(){for(var t=s(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,p?t.size=0:this.size=0},delete:function(t){var e=s(this),n=u(this,t);if(n){var r=n.next,i=n.previous;delete e.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),e.first==n&&(e.first=r),e.last==n&&(e.last=i),p?e.size--:this.size--}return!!n},forEach:function(t,e){for(var n,r=s(this),i=Ke(t,1<arguments.length?e:void 0,3);n=n?n.next:r.first;)for(i(n.value,n.key,this);n&&n.removed;)n=n.previous},has:function(t){return!!u(this,t)}}),Ve(a.prototype,r?{get:function(t){var e=u(this,t);return e&&e.value},set:function(t,e){return o(this,0===t?0:t,e)}}:{add:function(t){return o(this,t=0===t?0:t,t)}}),p&&Ho(a.prototype,"size",{get:function(){return s(this).size}}),a},setStrong:function(t,e,n){var r=e+" Iterator",i=Yo(e),o=Yo(r);ce(t,e,function(t,e){zo(this,{type:r,target:t,state:i(t),kind:e,last:void 0})},function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:t.target=void 0,done:!0}},n?"entries":"values",!n,!0),qe(e)}};jo("Map",function(e){return function(t){return e(this,arguments.length?t:void 0)}},Xo,!0),At.Map;pt({target:"Map",stat:!0},{from:Wo});function Jo(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}pt({target:"Map",stat:!0},{of:Jo});function $o(){for(var t,e=d(this),n=Be(e.delete),r=!0,i=0,o=arguments.length;i<o;i++)t=n.call(e,arguments[i]),r=r&&t;return!!r}pt({target:"Map",proto:!0,real:!0,forced:f},{deleteAll:function(){return $o.apply(this,arguments)}});function Zo(t){return Map.prototype.entries.call(t)}pt({target:"Map",proto:!0,real:!0,forced:f},{every:function(t,e){var n=d(this),r=Zo(n),i=Ke(t,1<arguments.length?e:void 0,3);return!$e(r,function(t,e){if(!i(e,t,n))return $e.stop()},void 0,!0,!0).stopped}}),pt({target:"Map",proto:!0,real:!0,forced:f},{filter:function(t,e){var n=d(this),r=Zo(n),i=Ke(t,1<arguments.length?e:void 0,3),o=new(on(n,st("Map"))),a=Be(o.set);return $e(r,function(t,e){i(e,t,n)&&a.call(o,t,e)},void 0,!0,!0),o}}),pt({target:"Map",proto:!0,real:!0,forced:f},{find:function(t,e){var n=d(this),r=Zo(n),i=Ke(t,1<arguments.length?e:void 0,3);return $e(r,function(t,e){if(i(e,t,n))return $e.stop(e)},void 0,!0,!0).result}}),pt({target:"Map",proto:!0,real:!0,forced:f},{findKey:function(t,e){var n=d(this),r=Zo(n),i=Ke(t,1<arguments.length?e:void 0,3);return $e(r,function(t,e){if(i(e,t,n))return $e.stop(t)},void 0,!0,!0).result}}),pt({target:"Map",stat:!0},{groupBy:function(t,n){var r=new this;Be(n);var i=Be(r.has),o=Be(r.get),a=Be(r.set);return $e(t,function(t){var e=n(t);i.call(r,e)?o.call(r,e).push(t):a.call(r,e,[t])}),r}});pt({target:"Map",proto:!0,real:!0,forced:f},{includes:function(n){return $e(Zo(d(this)),function(t,e){if(function(t,e){return t===e||t!=t&&e!=e}(e,n))return $e.stop()},void 0,!0,!0).stopped}}),pt({target:"Map",stat:!0},{keyBy:function(t,e){var n=new this;Be(e);var r=Be(n.set);return $e(t,function(t){r.call(n,e(t),t)}),n}}),pt({target:"Map",proto:!0,real:!0,forced:f},{keyOf:function(n){return $e(Zo(d(this)),function(t,e){if(e===n)return $e.stop(t)},void 0,!0,!0).result}}),pt({target:"Map",proto:!0,real:!0,forced:f},{mapKeys:function(t,e){var n=d(this),r=Zo(n),i=Ke(t,1<arguments.length?e:void 0,3),o=new(on(n,st("Map"))),a=Be(o.set);return $e(r,function(t,e){a.call(o,i(e,t,n),e)},void 0,!0,!0),o}}),pt({target:"Map",proto:!0,real:!0,forced:f},{mapValues:function(t,e){var n=d(this),r=Zo(n),i=Ke(t,1<arguments.length?e:void 0,3),o=new(on(n,st("Map"))),a=Be(o.set);return $e(r,function(t,e){a.call(o,t,i(e,t,n))},void 0,!0,!0),o}}),pt({target:"Map",proto:!0,real:!0,forced:f},{merge:function(t){for(var e=d(this),n=Be(e.set),r=0;r<arguments.length;)$e(arguments[r++],n,e,!0);return e}}),pt({target:"Map",proto:!0,real:!0,forced:f},{reduce:function(n,t){var r=d(this),e=Zo(r),i=arguments.length<2,o=i?void 0:t;if(Be(n),$e(e,function(t,e){o=i?(i=!1,e):n(o,e,t,r)},void 0,!0,!0),i)throw TypeError("Reduce of empty map with no initial value");return o}}),pt({target:"Map",proto:!0,real:!0,forced:f},{some:function(t,e){var n=d(this),r=Zo(n),i=Ke(t,1<arguments.length?e:void 0,3);return $e(r,function(t,e){if(i(e,t,n))return $e.stop()},void 0,!0,!0).stopped}}),pt({target:"Map",proto:!0,real:!0,forced:f},{update:function(t,e,n){var r=d(this),i=arguments.length;Be(e);var o=r.has(t);if(!o&&i<3)throw TypeError("Updating absent value");var a=o?r.get(t):Be(2<i?n:void 0)(t,r);return r.set(t,e(a,t,r)),r}});function ta(t,e,n){var r,i=d(this),o=2<arguments.length?n:void 0;if("function"!=typeof e&&"function"!=typeof o)throw TypeError("At least one callback required");return i.has(t)?(r=i.get(t),"function"==typeof e&&(r=e(r),i.set(t,r))):"function"==typeof o&&(r=o(),i.set(t,r)),r}pt({target:"Map",proto:!0,real:!0,forced:f},{upsert:ta}),pt({target:"Map",proto:!0,real:!0,forced:f},{updateOrInsert:ta});jo("Set",function(e){return function(t){return e(this,arguments.length?t:void 0)}},Xo),At.Set;pt({target:"Set",stat:!0},{from:Wo}),pt({target:"Set",stat:!0},{of:Jo});pt({target:"Set",proto:!0,real:!0,forced:f},{addAll:function(){return function(){for(var t=d(this),e=Be(t.add),n=0,r=arguments.length;n<r;n++)e.call(t,arguments[n]);return t}.apply(this,arguments)}}),pt({target:"Set",proto:!0,real:!0,forced:f},{deleteAll:function(){return $o.apply(this,arguments)}});function ea(t){return Set.prototype.values.call(t)}pt({target:"Set",proto:!0,real:!0,forced:f},{every:function(t,e){var n=d(this),r=ea(n),i=Ke(t,1<arguments.length?e:void 0,3);return!$e(r,function(t){if(!i(t,t,n))return $e.stop()},void 0,!1,!0).stopped}}),pt({target:"Set",proto:!0,real:!0,forced:f},{difference:function(t){var e=d(this),n=new(on(e,st("Set")))(e),r=Be(n.delete);return $e(t,function(t){r.call(n,t)}),n}}),pt({target:"Set",proto:!0,real:!0,forced:f},{filter:function(t,e){var n=d(this),r=ea(n),i=Ke(t,1<arguments.length?e:void 0,3),o=new(on(n,st("Set"))),a=Be(o.add);return $e(r,function(t){i(t,t,n)&&a.call(o,t)},void 0,!1,!0),o}}),pt({target:"Set",proto:!0,real:!0,forced:f},{find:function(t,e){var n=d(this),r=ea(n),i=Ke(t,1<arguments.length?e:void 0,3);return $e(r,function(t){if(i(t,t,n))return $e.stop(t)},void 0,!1,!0).result}}),pt({target:"Set",proto:!0,real:!0,forced:f},{intersection:function(t){var e=d(this),n=new(on(e,st("Set"))),r=Be(e.has),i=Be(n.add);return $e(t,function(t){r.call(e,t)&&i.call(n,t)}),n}}),pt({target:"Set",proto:!0,real:!0,forced:f},{isDisjointFrom:function(t){var e=d(this),n=Be(e.has);return!$e(t,function(t){if(!0===n.call(e,t))return $e.stop()}).stopped}}),pt({target:"Set",proto:!0,real:!0,forced:f},{isSubsetOf:function(t){var e=function(t){var e=Qe(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return d(e.call(t))}(this),n=d(t),r=n.has;return"function"!=typeof r&&(n=new(st("Set"))(t),r=Be(n.has)),!$e(e,function(t){if(!1===r.call(n,t))return $e.stop()},void 0,!1,!0).stopped}}),pt({target:"Set",proto:!0,real:!0,forced:f},{isSupersetOf:function(t){var e=d(this),n=Be(e.has);return!$e(t,function(t){if(!1===n.call(e,t))return $e.stop()}).stopped}}),pt({target:"Set",proto:!0,real:!0,forced:f},{join:function(t){var e=d(this),n=ea(e),r=void 0===t?",":String(t),i=[];return $e(n,i.push,i,!1,!0),i.join(r)}}),pt({target:"Set",proto:!0,real:!0,forced:f},{map:function(t,e){var n=d(this),r=ea(n),i=Ke(t,1<arguments.length?e:void 0,3),o=new(on(n,st("Set"))),a=Be(o.add);return $e(r,function(t){a.call(o,i(t,t,n))},void 0,!1,!0),o}}),pt({target:"Set",proto:!0,real:!0,forced:f},{reduce:function(e,t){var n=d(this),r=ea(n),i=arguments.length<2,o=i?void 0:t;if(Be(e),$e(r,function(t){o=i?(i=!1,t):e(o,t,t,n)},void 0,!1,!0),i)throw TypeError("Reduce of empty set with no initial value");return o}}),pt({target:"Set",proto:!0,real:!0,forced:f},{some:function(t,e){var n=d(this),r=ea(n),i=Ke(t,1<arguments.length?e:void 0,3);return $e(r,function(t){if(i(t,t,n))return $e.stop()},void 0,!1,!0).stopped}}),pt({target:"Set",proto:!0,real:!0,forced:f},{symmetricDifference:function(t){var e=d(this),n=new(on(e,st("Set")))(e),r=Be(n.delete),i=Be(n.add);return $e(t,function(t){r.call(n,t)||i.call(n,t)}),n}}),pt({target:"Set",proto:!0,real:!0,forced:f},{union:function(t){var e=d(this),n=new(on(e,st("Set")))(e);return $e(t,Be(n.add),n),n}});var na=Math.floor;pt({target:"Number",stat:!0},{isInteger:function(t){return!g(t)&&isFinite(t)&&na(t)===t}});At.Number.isInteger;var ra=function(t,e){return(ra=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function ia(t,e){function n(){this.constructor=t}ra(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var oa=function(){return(oa=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function aa(o,a,s,u){return new(s=s||Promise)(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})}function sa(n,r){var i,o,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=r.call(n,s)}catch(t){e=[6,t],o=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function ua(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function ca(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function ha(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ca(arguments[e]));return t}function la(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function fa(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}function pa(t){try{return ga.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}var da={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},ya=function(t,e){if(!t)throw ma(e)},ma=function(t){return new Error("Firebase Database ("+da.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},ga={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(fa(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!==s){var h=a<<4&240|s>>2;if(r.push(h),64!==u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function va(t){return ba(void 0,t)}function ba(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=ba(t[n],e[n]));return t}var wa=(_a.prototype.wrapCallback=function(n){var r=this;return function(t,e){t?r.reject(t):r.resolve(e),"function"==typeof n&&(r.promise.catch(function(){}),1===n.length?n(t):n(t,e))}},_a);function _a(){var n=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}function Ta(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Ea(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ta())}function Sa(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Ia(){return!0===da.NODE_ADMIN}var Ca,Na=(ia(Aa,Ca=Error),Aa);function Aa(t,e){var n=Ca.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,Aa.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,ka.prototype.create),n}var ka=(Da.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,r){return t.replace(Ra,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new Na(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},Da);function Da(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var Ra=/\{\$([^}]+)}/g;function Oa(t){return JSON.parse(t)}function Pa(t){return JSON.stringify(t)}function Ma(t){var e={},n={},r={},i="";try{var o=t.split(".");e=Oa(pa(o[0])||""),n=Oa(pa(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}}function La(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function xa(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function Fa(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ua(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}var Va=(qa.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},qa.prototype.compress_=function(t,e){e=e||0;var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782),i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i;this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},qa.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},qa.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},qa);function qa(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}function Ba(t,e){var n=new ja(t,e);return n.subscribe.bind(n)}var ja=(Wa.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})},Wa.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)},Wa.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},Wa.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=Ka),void 0===r.error&&(r.error=Ka),void 0===r.complete&&(r.complete=Ka);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},Wa.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},Wa.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},Wa.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},Wa.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},Wa);function Wa(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}function Ka(){}function Qa(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function Ha(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}function Ga(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Ha(t,e,r)+"must be a valid function.")}function za(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Ha(t,e,r)+"must be a valid context object.")}function Ya(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e}var Xa,Ja;function $a(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}(Ja=Xa=Xa||{})[Ja.DEBUG=0]="DEBUG",Ja[Ja.VERBOSE=1]="VERBOSE",Ja[Ja.INFO=2]="INFO",Ja[Ja.WARN=3]="WARN",Ja[Ja.ERROR=4]="ERROR",Ja[Ja.SILENT=5]="SILENT";function Za(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case Xa.DEBUG:case Xa.VERBOSE:console.log.apply(console,$a(["["+i+"]  "+t.name+":"],n));break;case Xa.INFO:console.info.apply(console,$a(["["+i+"]  "+t.name+":"],n));break;case Xa.WARN:console.warn.apply(console,$a(["["+i+"]  "+t.name+":"],n));break;case Xa.ERROR:console.error.apply(console,$a(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}var ts,es=Xa.INFO,ns=(Object.defineProperty(rs.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in Xa))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(rs.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),rs.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,$a([this,Xa.DEBUG],t))},rs.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,$a([this,Xa.VERBOSE],t))},rs.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,$a([this,Xa.INFO],t))},rs.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,$a([this,Xa.WARN],t))},rs.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,$a([this,Xa.ERROR],t))},rs);function rs(t){this.name=t,this._logLevel=es,this._logHandler=Za}var is=((ts={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",ts["bad-app-name"]="Illegal App name: '{$appName}",ts["duplicate-app"]="Firebase App named '{$appName}' already exists",ts["app-deleted"]="Firebase App named '{$appName}' already deleted",ts["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",ts),os=new ka("app","Firebase",is),as="[DEFAULT]",ss=(Object.defineProperty(us.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(us.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(us.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),us.prototype.delete=function(){var s=this;return new Promise(function(t){s.checkDestroyed_(),t()}).then(function(){s.firebase_.INTERNAL.removeApp(s.name_);for(var t=[],e=0,n=Object.keys(s.services_);e<n.length;e++)for(var r=n[e],i=0,o=Object.keys(s.services_[r]);i<o.length;i++){var a=o[i];t.push(s.services_[r][a])}return Promise.all(t.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))}).then(function(){s.isDeleted_=!0,s.services_={}})},us.prototype._getService=function(t,e){if(void 0===e&&(e=as),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==as?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},us.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=as),this.services_[t]&&this.services_[t][e]&&delete this.services_[t][e]},us.prototype.extendApp=function(t){if(ba(this,t),t.INTERNAL){if(t.INTERNAL.addAuthTokenListener){for(var e=0,n=this.tokenListeners_;e<n.length;e++){var r=n[e];this.INTERNAL.addAuthTokenListener(r)}this.tokenListeners_=[]}if(t.INTERNAL.analytics){for(var i=0,o=this.analyticsEventRequests_;i<o.length;i++){var a=o[i];this.INTERNAL.analytics.logEvent.apply(void 0,a)}this.analyticsEventRequests_=[]}}},us.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw os.create("app-deleted",{appName:this.name_})},us);function us(t,e,n){var r=this;this.firebase_=n,this.isDeleted_=!1,this.services_={},this.tokenListeners_=[],this.analyticsEventRequests_=[],this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=va(t);var i=this;this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){r.tokenListeners_.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(e){r.tokenListeners_=r.tokenListeners_.filter(function(t){return t!==e})},analytics:{logEvent:function(){i.analyticsEventRequests_.push(arguments)}}}}ss.prototype.name&&ss.prototype.options||ss.prototype.delete||console.log("dc");var cs="7.3.0",hs=new ns("@firebase/app");function ls(a){var o={},s={},u={},c={__esModule:!0,initializeApp:function(t,e){void 0===e&&(e={});if("object"!=typeof e||null===e){e={name:e}}var n=e;void 0===n.name&&(n.name=as);var r=n.name;if("string"!=typeof r||!r)throw os.create("bad-app-name",{appName:String(r)});if(La(o,r))throw os.create("duplicate-app",{appName:r});var i=new a(t,n,c);return f(o[r]=i,"create"),i},app:h,apps:null,SDK_VERSION:cs,INTERNAL:{registerService:function(n,t,e,r,i){void 0===i&&(i=!1);if(s[n])return hs.debug("There were multiple attempts to register service "+n+"."),c[n];s[n]=t,r&&(u[n]=r,l().forEach(function(t){r("create",t)}));function o(t){if(void 0===t&&(t=h()),"function"!=typeof t[n])throw os.create("invalid-app-argument",{appName:n});return t[n]()}void 0!==e&&ba(o,e);return c[n]=o,a.prototype[n]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,n).apply(this,i?t:[])},o},removeApp:function(t){f(o[t],"delete"),delete o[t]},factories:s,useAsService:p}};function h(t){if(!La(o,t=t||as))throw os.create("no-app",{appName:t});return o[t]}function l(){return Object.keys(o).map(function(t){return o[t]})}function f(t,e){for(var n=0,r=Object.keys(s);n<r.length;n++){var i=p(t,r[n]);if(null===i)return;u[i]&&u[i](e,t)}}function p(t,e){return"serverAuth"===e?null:e}return c.default=c,Object.defineProperty(c,"apps",{get:l}),h.App=a,c}if("object"==typeof self&&self.self===self&&void 0!==self.firebase){hs.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var fs=self.firebase.SDK_VERSION;fs&&0<=fs.indexOf("LITE")&&hs.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var ps=function t(){var e=ls(ss);return e.INTERNAL=oa(oa({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){ba(e,t)},createSubscribe:Ba,ErrorFactory:ka,deepExtend:ba}),e}(),ds=ps.initializeApp;ps.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&hs.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),ds.apply(void 0,t)};var fl=ps;(function(){var t,o="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},a="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function c(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:function(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}(t)}}!function(t,e){if(e){var n=a;t=t.split(".");for(var r=0;r<t.length-1;r++){var i=t[r];i in n||(n[i]={}),n=n[i]}(e=e(r=n[t=t[t.length-1]]))!=r&&null!=e&&o(n,t,{configurable:!0,writable:!0,value:e})}}("Promise",function(t){function s(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function e(){this.a=null}function u(e){return e instanceof s?e:new s(function(t){t(e)})}if(t)return t;e.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var n=a.setTimeout;e.prototype.c=function(t){n(t,0)},e.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},e.prototype.f=function(t){this.c(function(){throw t})},s.prototype.f=function(){function t(e){return function(t){r||(r=!0,e.call(n,t))}}var n=this,r=!1;return{resolve:t(this.m),reject:t(this.g)}},s.prototype.m=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof s)this.o(t);else{t:switch(typeof t){case"object":var e=null!=t;break t;case"function":e=!0;break t;default:e=!1}e?this.u(t):this.h(t)}},s.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},s.prototype.g=function(t){this.i(2,t)},s.prototype.h=function(t){this.i(1,t)},s.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.l()},s.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)i.b(this.a[t]);this.a=null}};var i=new e;return s.prototype.o=function(t){var e=this.f();t.Ja(e.resolve,e.reject)},s.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},s.prototype.then=function(t,e){function n(e,t){return"function"==typeof e?function(t){try{r(e(t))}catch(t){i(t)}}:t}var r,i,o=new s(function(t,e){r=t,i=e});return this.Ja(n(t,r),n(e,i)),o},s.prototype.catch=function(t){return this.then(void 0,t)},s.prototype.Ja=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?i.b(n):this.a.push(n)},s.resolve=u,s.reject=function(n){return new s(function(t,e){e(n)})},s.race=function(i){return new s(function(t,e){for(var n=c(i),r=n.next();!r.done;r=n.next())u(r.value).Ja(t,e)})},s.all=function(t){var o=c(t),a=o.next();return a.done?u([]):new s(function(n,t){function e(e){return function(t){r[e]=t,0==--i&&n(r)}}for(var r=[],i=0;r.push(void 0),i++,u(a.value).Ja(e(r.length-1),t),!(a=o.next()).done;);})},s});var u=u||{},l=this||self;function h(t){return"string"==typeof t}function n(t){return"boolean"==typeof t}var s=/^[\w+/_-]+[=]{0,2}$/,f=null;function p(){}function r(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function i(t){return null===t}function d(t){return"array"==r(t)}function y(t){var e=r(t);return"array"==e||"object"==e&&"number"==typeof t.length}function m(t){return"function"==r(t)}function g(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var e="closure_uid_"+(1e9*Math.random()>>>0),v=0;function b(t,e,n){return t.call.apply(t.bind,arguments)}function w(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function _(t,e,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?b:w).apply(null,arguments)}function T(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var E=Date.now||function(){return+new Date};function S(t,o){function e(){}e.prototype=o.prototype,t.qb=o.prototype,t.prototype=new e,(t.prototype.constructor=t).fd=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function I(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function C(t){if(Error.captureStackTrace)Error.captureStackTrace(this,C);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function N(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");C.call(this,n+t[r])}function A(t,e){throw new N("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function k(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function D(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function R(){this.b=this.a=null}S(C,Error),C.prototype.name="CustomError",S(N,C),N.prototype.name="AssertionError",k.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var O=new k(function(){return new P},function(t){t.reset()});function P(){this.next=this.b=this.a=null}function M(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||l).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(g(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;A("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}R.prototype.add=function(t,e){var n=O.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},P.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},P.prototype.reset=function(){this.next=this.b=this.a=null};var L=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(h(t))return h(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},x=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=h(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};var F=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=h(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},U=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=h(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function V(t,e){return 0<=L(t,e)}function q(t,e){var n;return(n=0<=(e=L(t,e)))&&Array.prototype.splice.call(t,e,1),n}function B(n,r){!function(t,e){for(var n=h(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(n,function(t,e){r.call(void 0,t,e,n)&&1==Array.prototype.splice.call(n,e,1).length&&0})}function j(t){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function Q(t){for(var e in t)return!1;return!0}function H(t){var e,n={};for(e in t)n[e]=t[e];return n}var G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function z(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<G.length;o++)n=G[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Y(t,e){this.a=t===$&&e||"",this.b=J}function X(t){return t instanceof Y&&t.constructor===Y&&t.b===J?t.a:(A("expected object of type Const, got '"+t+"'"),"type_error:Const")}Y.prototype.qa=!0,Y.prototype.pa=function(){return this.a},Y.prototype.toString=function(){return"Const{"+this.a+"}"};var J={},$={},Z=new Y($,"");function tt(){this.a="",this.b=ot}function et(t){return t instanceof tt&&t.constructor===tt&&t.b===ot?t.a:(A("expected object of type TrustedResourceUrl, got '"+t+"' of type "+r(t)),"type_error:TrustedResourceUrl")}function nt(t,n){var r=X(t);if(!it.test(r))throw Error("Invalid TrustedResourceUrl format: "+r);return at(t=r.replace(rt,function(t,e){if(!Object.prototype.hasOwnProperty.call(n,e))throw Error('Found marker, "'+e+'", in format string, "'+r+'", but no valid label mapping found in args: '+JSON.stringify(n));return(t=n[e])instanceof Y?X(t):encodeURIComponent(String(t))}))}tt.prototype.qa=!0,tt.prototype.pa=function(){return this.a.toString()},tt.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var rt=/%{(\w+)}/g,it=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,ot={};function at(t){var e=new tt;return e.a=t,e}var st=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},ut=/&/g,ct=/</g,ht=/>/g,lt=/"/g,ft=/'/g,pt=/\x00/g,dt=/[\x00&<>"']/;function yt(t,e){return-1!=t.indexOf(e)}function mt(t,e){return t<e?-1:e<t?1:0}function gt(){this.a="",this.b=Tt}function vt(t){return t instanceof gt&&t.constructor===gt&&t.b===Tt?t.a:(A("expected object of type SafeUrl, got '"+t+"' of type "+r(t)),"type_error:SafeUrl")}gt.prototype.qa=!0,gt.prototype.pa=function(){return this.a.toString()},gt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var bt=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function wt(t){return t instanceof gt?t:(t="object"==typeof t&&t.qa?t.pa():String(t),bt.test(t)||(t="about:invalid#zClosurez"),Et(t))}var _t,Tt={};function Et(t){var e=new gt;return e.a=t,e}Et("about:blank");t:{var St=l.navigator;if(St){var It=St.userAgent;if(It){_t=It;break t}}_t=""}function Ct(t){return yt(_t,t)}function Nt(){this.a="",this.b=kt}function At(t){return t instanceof Nt&&t.constructor===Nt&&t.b===kt?t.a:(A("expected object of type SafeHtml, got '"+t+"' of type "+r(t)),"type_error:SafeHtml")}Nt.prototype.qa=!0,Nt.prototype.pa=function(){return this.a.toString()},Nt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var kt={};function Dt(t){var e=new Nt;return e.a=t,e}Dt("<!DOCTYPE html>");var Rt,Ot,Pt=Dt("");function Mt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function Lt(t){return dt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(ut,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ct,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(ht,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(lt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(ft,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(pt,"&#0;"))),t}function xt(t){l.setTimeout(function(){throw t},0)}function Ft(){var t=l.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Ct("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",function(t){var e=at(X(Z));M(t,"HTMLIFrameElement"),t.src=et(e).toString()}(t),document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(At(Pt)),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=_(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0===t||Ct("Trident")||Ct("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){l.setTimeout(t,0)};var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).yb;n.yb=null,t()}},function(t){r.next={yb:t},r=r.next,e.port2.postMessage(0)}}function Ut(t,e){Ot||function(){if(l.Promise&&l.Promise.resolve){var t=l.Promise.resolve(void 0);Ot=function(){t.then(Bt)}}else Ot=function(){var t=Bt;!m(l.setImmediate)||l.Window&&l.Window.prototype&&!Ct("Edge")&&l.Window.prototype.setImmediate==l.setImmediate?(Rt=Rt||Ft())(t):l.setImmediate(t)}}(),Vt||(Ot(),Vt=!0),qt.add(t,e)}Dt("<br>");var Vt=!1,qt=new R;function Bt(){for(var t;n=e=void 0,n=null,(e=qt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){xt(t)}D(O,t)}var e,n;Vt=!1}function jt(t,e){if(this.a=Wt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=p)try{var n=this;t.call(e,function(t){ee(n,Kt,t)},function(t){if(!(t instanceof ue))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}ee(n,Qt,t)})}catch(t){ee(this,Qt,t)}}var Wt=0,Kt=2,Qt=3;function Ht(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Ht.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Gt=new k(function(){return new Ht},function(t){t.reset()});function zt(t,e,n){var r=Gt.get();return r.g=t,r.b=e,r.f=n,r}function Yt(t){if(t instanceof jt)return t;var e=new jt(p);return ee(e,Kt,t),e}function Xt(n){return new jt(function(t,e){e(n)})}function Jt(t,e,n){ne(t,e,n,null)||Ut(T(e,t))}function $t(n){return new jt(function(r){var i=n.length,o=[];if(i)for(var t=function(t,e,n){i--,o[t]=e?{Gb:!0,value:n}:{Gb:!1,reason:n},0==i&&r(o)},e=0;e<n.length;e++)Jt(n[e],T(t,e,!0),T(t,e,!1));else r(o)})}function Zt(t,e){t.b||t.a!=Kt&&t.a!=Qt||re(t),t.f?t.f.next=e:t.b=e,t.f=e}function te(t,i,o,a){var e=zt(null,null,null);return e.a=new jt(function(n,r){e.g=i?function(t){try{var e=i.call(a,t);n(e)}catch(t){r(t)}}:n,e.b=o?function(t){try{var e=o.call(a,t);void 0===e&&t instanceof ue?r(t):n(e)}catch(t){r(t)}}:r}),Zt(e.a.c=t,e),e.a}function ee(t,e,n){t.a==Wt&&(t===n&&(e=Qt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,ne(n,t.Oc,t.Pc,t)||(t.i=n,t.a=e,t.c=null,re(t),e!=Qt||n instanceof ue||function(t,e){t.g=!0,Ut(function(){t.g&&se.call(null,e)})}(t,n)))}function ne(t,e,n,r){if(t instanceof jt)return Zt(t,zt(e||p,n||null,r)),!0;if(I(t))return t.then(e,n,r),!0;if(g(t))try{var i=t.then;if(m(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function re(t){t.h||(t.h=!0,Ut(t.Zb,t))}function ie(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function oe(t,e,n,r){if(n==Qt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,ae(e,n,r);else try{e.c?e.g.call(e.f):ae(e,n,r)}catch(t){se.call(null,t)}D(Gt,e)}function ae(t,e,n){e==Kt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}jt.prototype.then=function(t,e,n){return te(this,m(t)?t:null,m(e)?e:null,n)},jt.prototype.$goog_Thenable=!0,(t=jt.prototype).ka=function(t,e){return(t=zt(t,t,e)).c=!0,Zt(this,t),this},t.s=function(t,e){return te(this,null,t,e)},t.cancel=function(t){this.a==Wt&&Ut(function(){!function t(e,n){if(e.a==Wt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==Wt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):ie(r),oe(r,o,Qt,n)))}e.c=null}else ee(e,Qt,n)}(this,new ue(t))},this)},t.Oc=function(t){this.a=Wt,ee(this,Kt,t)},t.Pc=function(t){this.a=Wt,ee(this,Qt,t)},t.Zb=function(){for(var t;t=ie(this);)oe(this,t,this.a,this.i);this.h=!1};var se=xt;function ue(t){C.call(this,t)}function ce(){this.ta=this.ta,this.la=this.la}S(ue,C);var he=0;function le(t){if(!t.ta&&(t.ta=!0,t.xa(),0!=he))t[e]||(t[e]=++v)}function fe(t){return fe[" "](t),t}ce.prototype.ta=!(ue.prototype.name="cancel"),ce.prototype.xa=function(){if(this.la)for(;this.la.length;)this.la.shift()()},fe[" "]=p;var pe,de,ye=Ct("Opera"),me=Ct("Trident")||Ct("MSIE"),ge=Ct("Edge"),ve=ge||me,be=Ct("Gecko")&&!(yt(_t.toLowerCase(),"webkit")&&!Ct("Edge"))&&!(Ct("Trident")||Ct("MSIE"))&&!Ct("Edge"),we=yt(_t.toLowerCase(),"webkit")&&!Ct("Edge");function _e(){var t=l.document;return t?t.documentMode:void 0}t:{var Te="",Ee=(de=_t,be?/rv:([^\);]+)(\)|;)/.exec(de):ge?/Edge\/([\d\.]+)/.exec(de):me?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(de):we?/WebKit\/(\S+)/.exec(de):ye?/(?:Version)[ \/]?(\S+)/.exec(de):void 0);if(Ee&&(Te=Ee?Ee[1]:""),me){var Se=_e();if(null!=Se&&Se>parseFloat(Te)){pe=String(Se);break t}}pe=Te}var Ie,Ce={};function Ne(s){return function(t,e){var n=Ce;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=st(String(pe)).split("."),n=st(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=mt(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||mt(0==o[2].length,0==a[2].length)||mt(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}Ie=l.document&&me?_e():void 0;var Ae=Object.freeze||function(t){return t},ke=!me||9<=Number(Ie),De=me&&!Ne("9"),Re=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",p,e),l.removeEventListener("test",p,e)}catch(t){}return t}();function Oe(t,e){this.type=t,this.b=this.target=e,this.Mb=!0}function Pe(t,e){if(Oe.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(be){t:{try{fe(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=h(t.pointerType)?t.pointerType:Me[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}Oe.prototype.preventDefault=function(){this.Mb=!1},S(Pe,Oe);var Me=Ae({2:"touch",3:"pen",4:"mouse"});Pe.prototype.preventDefault=function(){Pe.qb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,De)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},Pe.prototype.f=function(){return this.a};var Le="closure_listenable_"+(1e6*Math.random()|0),xe=0;function Fe(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Na=i,this.key=++xe,this.ra=this.Ia=!1}function Ue(t){t.ra=!0,t.listener=null,t.proxy=null,t.src=null,t.Na=null}function Ve(t){this.src=t,this.a={},this.b=0}function qe(t,e){var n=e.type;n in t.a&&q(t.a[n],e)&&(Ue(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Be(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ra&&o.listener==e&&o.capture==!!n&&o.Na==r)return i}return-1}Ve.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Be(t,e,r,i);return-1<a?(e=t[a],n||(e.Ia=!1)):((e=new Fe(e,this.src,o,!!r,i)).Ia=n,t.push(e)),e};var je="closure_lm_"+(1e6*Math.random()|0),We={};function Ke(t,e,n,r,i){if(r&&r.once)He(t,e,n,r,i);else if(d(e))for(var o=0;o<e.length;o++)Ke(t,e[o],n,r,i);else n=en(n),t&&t[Le]?rn(t,e,n,g(r)?!!r.capture:!!r,i):Qe(t,e,n,!1,r,i)}function Qe(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=g(i)?!!i.capture:!!i,s=Ze(t);if(s||(t[je]=s=new Ve(t)),!(n=s.add(e,n,r,a,o)).proxy)if(r=function(){var e=$e,n=ke?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Re||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ye(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function He(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)He(t,e[o],n,r,i);else n=en(n),t&&t[Le]?on(t,e,n,g(r)?!!r.capture:!!r,i):Qe(t,e,n,!0,r,i)}function Ge(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)Ge(t,e[o],n,r,i);else r=g(r)?!!r.capture:!!r,n=en(n),t&&t[Le]?(t=t.u,(e=String(e).toString())in t.a&&(-1<(n=Be(o=t.a[e],n,r,i))&&(Ue(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):(t=t&&Ze(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Be(e,n,r,i)),(n=-1<t?e[t]:null)&&ze(n))}function ze(t){if("number"!=typeof t&&t&&!t.ra){var e=t.src;if(e&&e[Le])qe(e.u,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ye(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ze(e))?(qe(n,t),0==n.b&&(n.src=null,e[je]=null)):Ue(t)}}}function Ye(t){return t in We?We[t]:We[t]="on"+t}function Xe(t,e,n,r){var i=!0;if((t=Ze(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.ra&&(o=Je(o,r),i=i&&!1!==o)}return i}function Je(t,e){var n=t.listener,r=t.Na||t.src;return t.Ia&&ze(t),n.call(r,e)}function $e(t,e){if(t.ra)return!0;if(ke)return Je(t,new Pe(e,this));if(!e)t:{e=["window","event"];for(var n=l,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new Pe(r=e,this),n=!0,!(r.keyCode<0||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}!i&&null!=r.returnValue||(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Xe(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Xe(r[i],t,!1,e),n=n&&o}return n}function Ze(t){return(t=t[je])instanceof Ve?t:null}var tn="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(e){return m(e)?e:(e[tn]||(e[tn]=function(t){return e.handleEvent(t)}),e[tn])}function nn(){ce.call(this),this.u=new Ve(this),(this.Sb=this).Wa=null}function rn(t,e,n,r,i){t.u.add(String(e),n,!1,r,i)}function on(t,e,n,r,i){t.u.add(String(e),n,!0,r,i)}function an(t,e,n,r){if(!(e=t.u.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.ra&&a.capture==n){var s=a.listener,u=a.Na||a.src;a.Ia&&qe(t.u,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Mb}function sn(t,e,n){if(m(t))n&&(t=_(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function un(n){var r=null;return new jt(function(t,e){-1==(r=sn(function(){t(void 0)},n))&&e(Error("Failed to schedule timer."))}).s(function(t){throw l.clearTimeout(r),t})}function cn(t){if(t.U&&"function"==typeof t.U)return t.U();if(h(t))return t.split("");if(y(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function hn(t){if(t.X&&"function"==typeof t.X)return t.X();if(!t.U||"function"!=typeof t.U){if(y(t)||h(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function ln(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ln)for(n=t.X(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function fn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];pn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)pn(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function pn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}S(nn,ce),nn.prototype[Le]=!0,nn.prototype.addEventListener=function(t,e,n,r){Ke(this,t,e,n,r)},nn.prototype.removeEventListener=function(t,e,n,r){Ge(this,t,e,n,r)},nn.prototype.dispatchEvent=function(t){var e,n=this.Wa;if(n)for(e=[];n;n=n.Wa)e.push(n);n=this.Sb;var r=t.type||t;if(h(t))t=new Oe(t,n);else if(t instanceof Oe)t.target=t.target||n;else{var i=t;z(t=new Oe(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=an(a,r,!0,t)&&i}if(i=an(a=t.b=n,r,!0,t)&&i,i=an(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=an(a=t.b=e[o],r,!1,t)&&i;return i},nn.prototype.xa=function(){if(nn.qb.xa.call(this),this.u){var t,e=this.u;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ue(n[r]);delete e.a[t],e.b--}}this.Wa=null},(t=ln.prototype).U=function(){fn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.X=function(){return fn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return pn(this.b,t)?this.b[t]:e},t.set=function(t,e){pn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.X(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var dn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function yn(t,e){var n;this.b=this.i=this.f="",this.l=null,this.g=this.c="",this.h=!1,t instanceof yn?(this.h=void 0!==e?e:t.h,mn(this,t.f),this.i=t.i,this.b=t.b,gn(this,t.l),this.c=t.c,vn(this,Fn(t.a)),this.g=t.g):t&&(n=String(t).match(dn))?(this.h=!!e,mn(this,n[1]||"",!0),this.i=En(n[2]||""),this.b=En(n[3]||"",!0),gn(this,n[4]),this.c=En(n[5]||"",!0),vn(this,n[6]||"",!0),this.g=En(n[7]||"")):(this.h=!!e,this.a=new Rn(null,this.h))}function mn(t,e,n){t.f=n?En(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function gn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.l=e}else t.l=null}function vn(t,e,n){e instanceof Rn?(t.a=e,function(t,e){e&&!t.f&&(On(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Mn(this,e),xn(this,n,t))},t)),t.f=e}(t.a,t.h)):(n||(e=Sn(e,kn)),t.a=new Rn(e,t.h))}function bn(t,e,n){t.a.set(e,n)}function wn(t,e){return t.a.get(e)}function _n(t){return t instanceof yn?new yn(t):new yn(t,void 0)}function Tn(t,e){var n=new yn(null,void 0);return mn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function En(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Sn(t,e,n){return h(t)?(t=encodeURI(t).replace(e,In),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function In(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}yn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Sn(e,Cn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.i)&&t.push(Sn(e,Cn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.l)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Sn(n,"/"==n.charAt(0)?An:Nn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Sn(n,Dn)),t.join("")},yn.prototype.resolve=function(t){var e=new yn(this),n=!!t.f;n?mn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.l;var r=t.c;if(n)gn(e,t.l);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(yt(i,"./")||yt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?vn(e,Fn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Cn=/[#\/\?@]/g,Nn=/[#\?:]/g,An=/[#\?]/g,kn=/[#\?@]/g,Dn=/#/g;function Rn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function On(n){n.a||(n.a=new ln,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function Pn(t){var e=hn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Rn(null,void 0);t=cn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];d(o)?xn(n,i,o):n.add(i,o)}return n}function Mn(t,e){On(t),e=Un(t,e),pn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,pn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&fn(t)))}function Ln(t,e){return On(t),e=Un(t,e),pn(t.a.b,e)}function xn(t,e,n){Mn(t,e),0<n.length&&(t.c=null,t.a.set(Un(t,e),W(n)),t.b+=n.length)}function Fn(t){var e=new Rn;return e.c=t.c,t.a&&(e.a=new ln(t.a),e.b=t.b),e}function Un(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Rn.prototype).add=function(t,e){On(this),this.c=null,t=Un(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(n,r){On(this),this.a.forEach(function(t,e){x(t,function(t){n.call(r,t,e,this)},this)},this)},t.X=function(){On(this);for(var t=this.a.U(),e=this.a.X(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.U=function(t){On(this);var e=[];if(h(t))Ln(this,t)&&(e=j(e,this.a.get(Un(this,t))));else{t=this.a.U();for(var n=0;n<t.length;n++)e=j(e,t[n])}return e},t.set=function(t,e){return On(this),this.c=null,Ln(this,t=Un(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.U(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.X(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.U(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var Vn=!me||9<=Number(Ie);function qn(t){var e=document;return h(t)?e.getElementById(t):t}function Bn(n,t){K(t,function(t,e){t&&"object"==typeof t&&t.qa&&(t=t.pa()),"style"==e?n.style.cssText=t:"class"==e?n.className=t:"for"==e?n.htmlFor=t:jn.hasOwnProperty(e)?n.setAttribute(jn[e],t):0==e.lastIndexOf("aria-",0)||0==e.lastIndexOf("data-",0)?n.setAttribute(e,t):n[e]=t})}var jn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Wn(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!Vn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',Lt(a.name),'"'),a.type){o.push(' type="',Lt(a.type),'"');var s={};z(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(h(a)?o.className=a:d(a)?o.className=a.join(" "):Bn(o,a)),2<r.length&&function(e,n,t){function r(t){t&&n.appendChild(h(t)?e.createTextNode(t):t)}for(var i=2;i<t.length;i++){var o=t[i];!y(o)||g(o)&&0<o.nodeType?r(o):x(Kn(o)?W(o):o,r)}}(i,o,r),o}function Kn(t){if(t&&"number"==typeof t.length){if(g(t))return"function"==typeof t.item||"string"==typeof t.item;if(m(t))return"function"==typeof t.item}return!1}function Qn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(d(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(a=n[i])&&(r.push(o),Yn(i,r),r.push(":"),t(e,a,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":Yn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Hn,t,e),e.join("")}function Hn(){}var Gn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},zn=/\uffff/.test("ï¿¿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Yn(t,e){e.push('"',t.replace(zn,function(t){var e=Gn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Gn[t]=e),e}),'"')}function Xn(){var t=yr();return me&&!!Ie&&11==Ie||/Edge\/\d+/.test(t)}function Jn(){return l.window&&l.window.location.href||self&&self.location&&self.location.href||""}function $n(t,e){e=e||l.window;var n="about:blank";t&&(n=vt(wt(t)).toString()),e.location.href=n}function Zn(t){return!!((t=(t||yr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function tr(t){t=t||l.window;try{t.close()}catch(t){}}function er(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=yr().toLowerCase(),r&&(e.target=r,yt(n,"crios/")&&(e.target="_blank")),fr(yr())==hr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof gt?n:wt(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((Ct("iPhone")&&!Ct("iPod")&&!Ct("iPad")||Ct("iPad")||Ct("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(M(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof gt||e instanceof gt||(e="object"==typeof e&&e.qa?e.pa():String(e),bt.test(e)||(e="about:invalid#zClosurez"),e=Et(e)),a.href=vt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=vt(e).toString(),a&&(ve&&yt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Dt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+Lt(t)+'">'),a.document.write(At(t)),a.document.close())):(a=r.open(vt(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var nr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rr=/^[^@]+@[^@]+$/;function ir(){var e=null;return new jt(function(t){"complete"==l.document.readyState?t():(e=function(){t()},He(window,"load",e))}).s(function(t){throw Ge(window,"load",e),t})}function or(t){return t=t||yr(),!("file:"!==wr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function ar(){var t=l.window;try{return!(!t||t==t.top)}catch(t){return!1}}function sr(){return void 0!==l.WorkerGlobalScope&&"function"==typeof l.importScripts}function ur(){return fl.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":fl.INTERNAL.hasOwnProperty("node")?"Node":sr()?"Worker":"Browser"}function cr(){var t=ur();return"ReactNative"===t||"Node"===t}var hr="Firefox",lr="Chrome";function fr(t){var e=t.toLowerCase();return yt(e,"opera/")||yt(e,"opr/")||yt(e,"opios/")?"Opera":yt(e,"iemobile")?"IEMobile":yt(e,"msie")||yt(e,"trident/")?"IE":yt(e,"edge/")?"Edge":yt(e,"firefox/")?hr:yt(e,"silk/")?"Silk":yt(e,"blackberry")?"Blackberry":yt(e,"webos")?"Webos":!yt(e,"safari/")||yt(e,"chrome/")||yt(e,"crios/")||yt(e,"android")?!yt(e,"chrome/")&&!yt(e,"crios/")||yt(e,"edge/")?yt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":lr:"Safari"}var pr={Vc:"FirebaseCore-web",Xc:"FirebaseUI-web"};function dr(t,e){e=e||[];var n,r=[],i={};for(n in pr)i[pr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=ur())?r=fr(i=yr()):"Worker"===r&&(r=fr(i=yr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function yr(){return l.navigator&&l.navigator.userAgent||""}function mr(t,e){t=t.split("."),e=e||l;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function gr(){try{var t=l.localStorage,e=Ir();if(t)return t.setItem(e,"1"),t.removeItem(e),!Xn()||!!l.indexedDB}catch(t){return sr()&&!!l.indexedDB}return!1}function vr(){return(br()||"chrome-extension:"===wr()||or())&&!cr()&&gr()&&!sr()}function br(){return"http:"===wr()||"https:"===wr()}function wr(){return l.location&&l.location.protocol||null}function _r(t){return!Zn(t=t||yr())&&fr(t)!=hr}function Tr(t){return void 0===t?null:Qn(t)}function Er(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Sr(t){if(null!==t)return JSON.parse(t)}function Ir(t){return t||Math.floor(1e9*Math.random()).toString()}function Cr(t){return"Safari"!=fr(t=t||yr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Nr(){var t=l.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Ar(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=yr(),e=ur(),this.b=Zn(t)||"ReactNative"===e}function kr(){var t=l.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Dr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Rr(){return!(!mr("fireauth.oauthhelper",l)&&!mr("fireauth.iframe",l))}Ar.prototype.get=function(){var t=l.navigator;return!t||"boolean"!=typeof t.onLine||!br()&&"chrome-extension:"!==wr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Or,Pr={};function Mr(t){Pr[t]||(Pr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Lr={};Object.defineProperty(Lr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Lr,"abcd",{configurable:!0,enumerable:!0,value:2}),Or=2==Lr.abcd}catch(t){Or=!1}function xr(t,e,n){Or?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Fr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&xr(t,n,e[n])}function Ur(t){var e={};return Fr(e,t),e}function Vr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)xr(e,n,Vr(t[n]));return e}function qr(t){var e={},n=t[jr],r=t[Wr];if(!(t=t[Kr])||t!=Br&&!n)throw Error("Invalid provider user info!");e[Hr]=r||null,e[Qr]=n||null,xr(this,zr,t),xr(this,Gr,Vr(e))}var Br="EMAIL_SIGNIN",jr="email",Wr="newEmail",Kr="requestType",Qr="email",Hr="fromEmail",Gr="data",zr="operation";function Yr(t,e){this.code=Jr+t,this.message=e||$r[t]||""}function Xr(t){var e=t&&t.code;return e?new Yr(e.substring(Jr.length),t.message):null}S(Yr,Error),Yr.prototype.A=function(){return{code:this.code,message:this.message}},Yr.prototype.toJSON=function(){return this.A()};var Jr="auth/",$r={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function Zr(t){var e=wn(t=_n(t),ti)||null,n=wn(t,ei)||null,r=wn(t,ii)||null;if(r=r&&ai[r]||null,!e||!n||!r)throw new Yr("argument-error",ti+", "+ei+"and "+ii+" are required in a valid action code URL.");Fr(this,{apiKey:e,operation:r,code:n,continueUrl:wn(t,ni)||null,languageCode:wn(t,ri)||null,tenantId:wn(t,oi)||null})}var ti="apiKey",ei="oobCode",ni="continueUrl",ri="languageCode",ii="mode",oi="tenantId",ai={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",signIn:Br,verifyEmail:"VERIFY_EMAIL"};function si(t){try{return new Zr(t)}catch(t){return null}}function ui(t){var e=t[pi];if(void 0===e)throw new Yr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new Yr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[ci];if(n&&"object"==typeof n){e=n[mi];var r=n[di];if(n=n[yi],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new Yr("argument-error",di+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new Yr("argument-error",yi+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new Yr("argument-error",mi+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new Yr("missing-android-pkg-name")}}else if(void 0!==n)throw new Yr("argument-error",ci+" property must be a non null object when specified.");if(this.f=null,(e=t[fi])&&"object"==typeof e){if("string"==typeof(e=e[gi])&&e.length)this.f=e;else if(void 0!==e)throw new Yr("argument-error",gi+" property must be a non empty string when specified.")}else if(void 0!==e)throw new Yr("argument-error",fi+" property must be a non null object when specified.");if(void 0!==(e=t[li])&&"boolean"!=typeof e)throw new Yr("argument-error",li+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[hi])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new Yr("argument-error",hi+" property must be a non empty string when specified.");this.i=t||null}var ci="android",hi="dynamicLinkDomain",li="handleCodeInApp",fi="iOS",pi="url",di="installApp",yi="minimumVersion",mi="packageName",gi="bundleId";function vi(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var bi=null,wi=null;function _i(t){var e="";return function(r,t){function e(t){for(;i<r.length;){var e=r.charAt(i++),n=wi[e];if(null!=n)return n;if(!/^[\s\xa0]*$/.test(e))throw Error("Unknown base64 encoding at char: "+e)}return t}!function(){if(!bi){bi={},wi={};for(var t=0;t<65;t++)bi[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(wi[bi[t]]=t)&&(wi["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var i=0;;){var n=e(-1),o=e(0),a=e(64),s=e(64);if(64===s&&-1===n)break;t(n<<2|o>>4),64!=a&&(t(o<<4&240|a>>2),64!=s&&t(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function Ti(t){this.f=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.c=t.firebase&&t.firebase.tenant||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function Ei(t){return(t=Si(t))&&t.sub&&t.iss&&t.aud&&t.exp?new Ti(t):null}function Si(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(_i(t))}catch(t){}return null}Ti.prototype.R=function(){return this.c},Ti.prototype.g=function(){return this.b};var Ii,Ci={ad:{bb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://securetoken.googleapis.com/v1/token",id:"p"},cd:{bb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},dd:{bb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",ib:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function Ni(t){for(var e in Ci)if(Ci[e].id===t)return{firebaseEndpoint:(t=Ci[e]).bb,secureTokenEndpoint:t.ib};return null}Ii=Ni("__EID__")?"__EID__":void 0;var Ai="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),ki=["client_id","response_type","scope","redirect_uri","state"],Di={Wc:{Oa:"locale",Da:500,Ca:600,Pa:"facebook.com",hb:ki},Yc:{Oa:null,Da:500,Ca:620,Pa:"github.com",hb:ki},Zc:{Oa:"hl",Da:515,Ca:680,Pa:"google.com",hb:ki},ed:{Oa:"lang",Da:485,Ca:705,Pa:"twitter.com",hb:Ai}};function Ri(t){for(var e in Di)if(Di[e].Pa==t)return Di[e];return null}function Oi(t){var e={};e["facebook.com"]=Fi,e["google.com"]=Vi,e["github.com"]=Ui,e["twitter.com"]=qi;var n=t&&t[Mi];try{if(n)return e[n]?new e[n](t):new xi(t);if(void 0!==t[Pi])return new Li(t)}catch(t){}return null}var Pi="idToken",Mi="providerId";function Li(t){var e=t[Mi];if(!e&&t[Pi]){var n=Ei(t[Pi]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),xr(this,"providerId",e),xr(this,"isNewUser",n)}function xi(t){Li.call(this,t),xr(this,"profile",Vr((t=Sr(t.rawUserInfo||"{}"))||{}))}function Fi(t){if(xi.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ui(t){if(xi.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");xr(this,"username",this.profile&&this.profile.login||null)}function Vi(t){if(xi.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function qi(t){if(xi.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");xr(this,"username",t.screenName||null)}function Bi(t){var e=_n(t),n=wn(e,"link"),r=wn(_n(n),"link");return wn(_n(e=wn(e,"deep_link_id")),"link")||e||r||n||t}function ji(){}function Wi(t,n){return t.then(function(t){if(t[Oa]){var e=Ei(t[Oa]);if(!e||n!=e.f)throw new Yr("user-mismatch");return t}throw new Yr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Jr+"user-not-found"?new Yr("user-mismatch"):t})}function Ki(t,e){if(!e)throw new Yr("internal-error","failed to construct a credential");this.a=e,xr(this,"providerId",t),xr(this,"signInMethod",t)}function Qi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Hi(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Ki(t.providerId,t.pendingToken)}catch(t){}return null}function Gi(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&xr(this,"idToken",e.idToken),e.accessToken&&xr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&xr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new Yr("internal-error","failed to construct a credential");xr(this,"accessToken",e.oauthToken),xr(this,"secret",e.oauthTokenSecret)}xr(this,"providerId",t),xr(this,"signInMethod",n)}function zi(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Pn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Yi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new Gi(t.providerId,e,t.signInMethod)}catch(t){}}return null}function Xi(t,e){this.Fc=e||[],Fr(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.cb=(Ri(t)||{}).Oa||null,this.ab=null}function Ji(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new Yr("argument-error",'SAML provider IDs must be prefixed with "saml."');Xi.call(this,t,[])}function $i(t){Xi.call(this,t,ki),this.a=[]}function Zi(){$i.call(this,"facebook.com")}function to(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new Zi).credential({accessToken:e})}function eo(){$i.call(this,"github.com")}function no(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new eo).credential({accessToken:e})}function ro(){$i.call(this,"google.com"),this.wa("profile")}function io(t,e){var n=t;return g(t)&&(n=t.idToken,e=t.accessToken),(new ro).credential({idToken:n,accessToken:e})}function oo(){Xi.call(this,"twitter.com",Ai)}function ao(t,e){var n=t;if(g(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new Yr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Gi("twitter.com",n,"twitter.com")}function so(t,e,n){this.a=t,this.c=e,xr(this,"providerId","password"),xr(this,"signInMethod",n===co.EMAIL_LINK_SIGN_IN_METHOD?co.EMAIL_LINK_SIGN_IN_METHOD:co.EMAIL_PASSWORD_SIGN_IN_METHOD)}function uo(t){return t&&t.email&&t.password?new so(t.email,t.password,t.signInMethod):null}function co(){Fr(this,{providerId:"password",isOAuthProvider:!1})}function ho(t,e){if(!(e=lo(e)))throw new Yr("argument-error","Invalid email link!");return new so(t,e.code,co.EMAIL_LINK_SIGN_IN_METHOD)}function lo(t){return(t=si(t=Bi(t)))&&t.operation===Br?t:null}function fo(t){if(!(t.Ua&&t.Ta||t.Fa&&t.ba))throw new Yr("internal-error");this.a=t,xr(this,"providerId","phone"),xr(this,"signInMethod","phone")}function po(e){if(e&&"phone"===e.providerId&&(e.verificationId&&e.verificationCode||e.temporaryProof&&e.phoneNumber)){var n={};return x(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(t){e[t]&&(n[t]=e[t])}),new fo(n)}return null}function yo(t){return t.a.Fa&&t.a.ba?{temporaryProof:t.a.Fa,phoneNumber:t.a.ba}:{sessionInfo:t.a.Ua,code:t.a.Ta}}function mo(t){try{this.a=t||fl.auth()}catch(t){throw new Yr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Fr(this,{providerId:"phone",isOAuthProvider:!1})}function go(t,e){if(!t)throw new Yr("missing-verification-id");if(!e)throw new Yr("missing-verification-code");return new fo({Ua:t,Ta:e})}function vo(t){if(t.temporaryProof&&t.phoneNumber)return new fo({Fa:t.temporaryProof,ba:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return io(o,n);case"facebook.com":return to(n);case"github.com":return no(n);case"twitter.com":return ao(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Ki(e,a):new Gi(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new $i(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function bo(t){if(!t.isOAuthProvider)throw new Yr("invalid-oauth-provider")}function wo(t,e,n,r,i,o,a){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.i=o||null,this.h=a||null,this.a=i||null,!this.g&&!this.a)throw new Yr("invalid-auth-event");if(this.g&&this.a)throw new Yr("invalid-auth-event");if(this.g&&!this.f)throw new Yr("invalid-auth-event")}function _o(t){return(t=t||{}).type?new wo(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Xr(t.error),t.postBody,t.tenantId):null}function To(){this.b=null,this.a=[]}S(xi,Li),S(Fi,xi),S(Ui,xi),S(Vi,xi),S(qi,xi),Ki.prototype.na=function(t){return Xa(t,Qi(this))},Ki.prototype.b=function(t,e){var n=Qi(this);return n.idToken=e,Ja(t,n)},Ki.prototype.f=function(t,e){return Wi($a(t,Qi(this)),e)},Ki.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Gi.prototype.na=function(t){return Xa(t,zi(this))},Gi.prototype.b=function(t,e){var n=zi(this);return n.idToken=e,Ja(t,n)},Gi.prototype.f=function(t,e){return Wi($a(t,zi(this)),e)},Gi.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},Xi.prototype.Ea=function(t){return this.zb=H(t),this},S(Ji,Xi),S($i,Xi),$i.prototype.wa=function(t){return V(this.a,t)||this.a.push(t),this},$i.prototype.Hb=function(){return W(this.a)},$i.prototype.credential=function(t,e){var n;if(!(n=g(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new Yr("argument-error","credential failed: must provide the ID token and/or the access token.");return new Gi(this.providerId,n,this.providerId)},S(Zi,$i),xr(Zi,"PROVIDER_ID","facebook.com"),xr(Zi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),S(eo,$i),xr(eo,"PROVIDER_ID","github.com"),xr(eo,"GITHUB_SIGN_IN_METHOD","github.com"),S(ro,$i),xr(ro,"PROVIDER_ID","google.com"),xr(ro,"GOOGLE_SIGN_IN_METHOD","google.com"),S(oo,Xi),xr(oo,"PROVIDER_ID","twitter.com"),xr(oo,"TWITTER_SIGN_IN_METHOD","twitter.com"),so.prototype.na=function(t){return this.signInMethod==co.EMAIL_LINK_SIGN_IN_METHOD?Ns(t,as,{email:this.a,oobCode:this.c}):Ns(t,Es,{email:this.a,password:this.c})},so.prototype.b=function(t,e){return this.signInMethod==co.EMAIL_LINK_SIGN_IN_METHOD?Ns(t,ss,{idToken:e,email:this.a,oobCode:this.c}):Ns(t,gs,{idToken:e,email:this.a,password:this.c})},so.prototype.f=function(t,e){return Wi(this.na(t),e)},so.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Fr(co,{PROVIDER_ID:"password"}),Fr(co,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Fr(co,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),fo.prototype.na=function(t){return t.Va(yo(this))},fo.prototype.b=function(t,e){var n=yo(this);return n.idToken=e,Ns(t,Is,n)},fo.prototype.f=function(t,e){var n=yo(this);return n.operation="REAUTH",Wi(t=Ns(t,Cs,n),e)},fo.prototype.A=function(){var t={providerId:"phone"};return this.a.Ua&&(t.verificationId=this.a.Ua),this.a.Ta&&(t.verificationCode=this.a.Ta),this.a.Fa&&(t.temporaryProof=this.a.Fa),this.a.ba&&(t.phoneNumber=this.a.ba),t},mo.prototype.Va=function(e,n){var r=this.a.b;return Yt(n.verify()).then(function(t){if(!h(t))throw new Yr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(n.type){case"recaptcha":return function(t,e){return Ns(t,ys,e)}(r,{phoneNumber:e,recaptchaToken:t}).then(function(t){return"function"==typeof n.reset&&n.reset(),t},function(t){throw"function"==typeof n.reset&&n.reset(),t});default:throw new Yr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},Fr(mo,{PROVIDER_ID:"phone"}),Fr(mo,{PHONE_SIGN_IN_METHOD:"phone"}),wo.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.h&&t.push(this.h),t.join("-")},wo.prototype.R=function(){return this.h},wo.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.A()}};var Eo,So=null;function Io(t){var e="unauthorized-domain",n=void 0,r=_n(t);t=r.b,"chrome-extension"==(r=r.f)?n=Mt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=Mt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",Yr.call(this,e,n)}function Co(t,e,n){Yr.call(this,t,n),(t=e||{}).Ab&&xr(this,"email",t.Ab),t.ba&&xr(this,"phoneNumber",t.ba),t.credential&&xr(this,"credential",t.credential),t.Qb&&xr(this,"tenantId",t.Qb)}function No(t){if(t.code){var e=t.code||"";0==e.indexOf(Jr)&&(e=e.substring(Jr.length));var n={credential:vo(t),Qb:t.tenantId};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.ba=t.phoneNumber;else if(!n.credential)return new Yr(e,t.message||void 0);return new Co(e,n,t.message)}return null}function Ao(){}function ko(t){return t.c||(t.c=t.b())}function Do(){}function Ro(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function Oo(){}function Po(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=_(this.fc,this),this.a.onerror=_(this.Ib,this),this.a.onprogress=_(this.gc,this),this.a.ontimeout=_(this.kc,this)}function Mo(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function Lo(t,e,n){this.reset(t,e,n,void 0,void 0)}function xo(t){this.f=t,this.b=this.c=this.a=null}function Fo(t,e){this.name=t,this.value=e}S(Io,Yr),S(Co,Yr),Co.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber),this.tenantId&&(t.tenantId=this.tenantId);var e=this.credential&&this.credential.A();return e&&z(t,e),t},Co.prototype.toJSON=function(){return this.A()},Ao.prototype.c=null,S(Do,Ao),Do.prototype.a=function(){var t=Ro(this);return t?new ActiveXObject(t):new XMLHttpRequest},Do.prototype.b=function(){var t={};return Ro(this)&&(t[0]=!0,t[1]=!0),t},Eo=new Do,S(Oo,Ao),Oo.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new Po;throw Error("Unsupported browser")},Oo.prototype.b=function(){return{}},(t=Po.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,Mo(this,4)},t.Ib=function(){this.status=500,this.response=this.responseText="",Mo(this,4)},t.kc=function(){this.Ib()},t.gc=function(){this.status=200,Mo(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},Lo.prototype.a=null,Lo.prototype.reset=function(t,e,n,r,i){delete this.a},Fo.prototype.toString=function(){return this.name};var Uo=new Fo("SEVERE",1e3),Vo=new Fo("WARNING",900),qo=new Fo("CONFIG",700),Bo=new Fo("FINE",500);xo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(A("Root logger has no level set."),null)}(this).value)for(m(e)&&(e=e()),t=new Lo(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var jo,Wo={},Ko=null;function Qo(t){var e;if(Ko||(Ko=new xo(""),(Wo[""]=Ko).c=qo),!(e=Wo[t])){e=new xo(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Qo(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,Wo[t]=e}return e}function Ho(t,e){t&&t.log(Bo,e,void 0)}function Go(t){this.f=t}function zo(t){nn.call(this),this.o=t,this.readyState=Yo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=Qo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}S(Go,Ao),Go.prototype.a=function(){return new zo(this.f)},Go.prototype.b=(jo={},function(){return jo}),S(zo,nn);var Yo=0;function Xo(t){t.c.read().then(t.ec.bind(t)).catch(t.Ma.bind(t))}function Jo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,$o(t)}function $o(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Zo(t){nn.call(this),this.headers=new ln,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.O=this.l="",this.f=this.J=this.i=this.I=!1,this.g=0,this.o=null,this.m=ta,this.v=this.P=!1}(t=zo.prototype).open=function(t,e){if(this.readyState!=Yo)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,$o(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.o.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.Ma.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Jo(this,!1)),this.readyState=Yo},t.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,$o(this)),this.a&&(this.readyState=3,$o(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.Ma.bind(this)):void 0!==l.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,Xo(this)):t.text().then(this.ic.bind(this),this.Ma.bind(this)))))},t.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Jo(this,!0):$o(this),3==this.readyState&&Xo(this)}},t.ic=function(t){this.a&&(this.response=this.responseText=t,Jo(this,!0))},t.hc=function(t){this.a&&(this.response=t,Jo(this,!0))},t.Ma=function(t){var e=this.h;e&&e.log(Vo,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Jo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Vo,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Vo,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},S(Zo,nn);var ta="";Zo.prototype.b=Qo("goog.net.XhrIo");var ea=/^https?$/i,na=["POST","PUT"];function ra(e,t,n,r,i){if(e.a)throw Error("[goog.net.XhrIo] Object is active with another request="+e.l+"; newUri="+t);n=n?n.toUpperCase():"GET",e.l=t,e.h="",e.O=n,e.I=!1,e.c=!0,e.a=e.B?e.B.a():Eo.a(),e.w=e.B?ko(e.B):ko(Eo),e.a.onreadystatechange=_(e.Lb,e);try{Ho(e.b,fa(e,"Opening Xhr")),e.J=!0,e.a.open(n,String(t),!0),e.J=!1}catch(t){return Ho(e.b,fa(e,"Error opening Xhr: "+t.message)),void oa(e,t)}t=r||"";var o=new ln(e.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(y(t)||h(t))x(t,e,void 0);else for(var n=hn(t),r=cn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,function(t,e){o.set(e,t)}),i=function(t){t:{for(var e=ia,n=t.length,r=h(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:h(t)?t.charAt(e):t[e]}(o.X()),r=l.FormData&&t instanceof l.FormData,!V(na,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},e),e.m&&(e.a.responseType=e.m),"withCredentials"in e.a&&e.a.withCredentials!==e.P&&(e.a.withCredentials=e.P);try{ca(e),0<e.g&&(e.v=function(t){return me&&Ne(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(e.a),Ho(e.b,fa(e,"Will abort after "+e.g+"ms if incomplete, xhr2 "+e.v)),e.v?(e.a.timeout=e.g,e.a.ontimeout=_(e.Ga,e)):e.o=sn(e.Ga,e.g,e)),Ho(e.b,fa(e,"Sending request")),e.i=!0,e.a.send(t),e.i=!1}catch(t){Ho(e.b,fa(e,"Send error: "+t.message)),oa(e,t)}}function ia(t){return"content-type"==t.toLowerCase()}function oa(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,aa(t),ua(t)}function aa(t){t.I||(t.I=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function sa(e){if(e.c&&void 0!==u)if(e.w[1]&&4==ha(e)&&2==la(e))Ho(e.b,fa(e,"Local request error detected and ignored"));else if(e.i&&4==ha(e))sn(e.Lb,0,e);else if(e.dispatchEvent("readystatechange"),4==ha(e)){Ho(e.b,fa(e,"Request complete")),e.c=!1;try{var t,n=la(e);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(t=r)){var i;if(i=0===n){var o=String(e.l).match(dn)[1]||null;if(!o&&l.self&&l.self.location){var a=l.self.location.protocol;o=a.substr(0,a.length-1)}i=!ea.test(o?o.toLowerCase():"")}t=i}if(t)e.dispatchEvent("complete"),e.dispatchEvent("success");else{try{var s=2<ha(e)?e.a.statusText:""}catch(t){Ho(e.b,"Can not get status: "+t.message),s=""}e.h=s+" ["+la(e)+"]",aa(e)}}finally{ua(e)}}}function ua(e,t){if(e.a){ca(e);var n=e.a,r=e.w[0]?p:null;e.a=null,e.w=null,t||e.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){(e=e.b)&&e.log(Uo,"Problem encountered resetting onreadystatechange: "+t.message,void 0)}}}function ca(t){t.a&&t.v&&(t.a.ontimeout=null),t.o&&(l.clearTimeout(t.o),t.o=null)}function ha(t){return t.a?t.a.readyState:0}function la(t){try{return 2<ha(t)?t.a.status:-1}catch(t){return-1}}function fa(t,e){return e+" ["+t.O+" "+t.l+" "+la(t)+"]"}function pa(t){var e=Sa;this.g=[],this.v=e,this.o=t||null,this.f=this.a=!1,this.c=void 0,this.u=this.w=this.i=!1,this.h=0,this.b=null,this.l=0}function da(t,e,n){t.a=!0,t.c=n,t.f=!e,va(t)}function ya(t){if(t.a){if(!t.u)throw new ba(t);t.u=!1}}function ma(t,e,n,r){t.g.push([e,n,r]),t.a&&va(t)}function ga(t){return U(t.g,function(t){return m(t[1])})}function va(e){if(e.h&&e.a&&ga(e)){var n=e.h,r=Ta[n];r&&(l.clearTimeout(r.a),delete Ta[n]),e.h=0}e.b&&(e.b.l--,delete e.b),n=e.c;for(var t=r=!1;e.g.length&&!e.i;){var i=e.g.shift(),o=i[0],a=i[1];if(i=i[2],o=e.f?a:o)try{var s=o.call(i||e.o,n);void 0!==s&&(e.f=e.f&&(s==n||s instanceof Error),e.c=n=s),(I(n)||"function"==typeof l.Promise&&n instanceof l.Promise)&&(t=!0,e.i=!0)}catch(t){n=t,e.f=!0,ga(e)||(r=!0)}}e.c=n,t&&(s=_(e.m,e,!0),t=_(e.m,e,!1),n instanceof pa?(ma(n,s,t),n.w=!0):n.then(s,t)),r&&(n=new _a(n),Ta[n.a]=n,e.h=n.a)}function ba(){C.call(this)}function wa(){C.call(this)}function _a(t){this.a=l.setTimeout(_(this.c,this),0),this.b=t}(t=Zo.prototype).Ga=function(){void 0!==u&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Ho(this.b,fa(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Ho(this.b,fa(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),ua(this))},t.xa=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),ua(this,!0)),Zo.qb.xa.call(this)},t.Lb=function(){this.ta||(this.J||this.i||this.f?sa(this):this.yc())},t.yc=function(){sa(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case ta:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Uo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return Ho(this.b,"Can not get response: "+t.message),null}},pa.prototype.cancel=function(t){if(this.a)this.c instanceof pa&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,e.l<=0&&e.cancel())}this.v?this.v.call(this.o,this):this.u=!0,this.a||(t=new wa(this),ya(this),da(this,!1,t))}},pa.prototype.m=function(t,e){this.i=!1,da(this,t,e)},pa.prototype.then=function(t,e,n){var r,i,o=new jt(function(t,e){r=t,i=e});return ma(this,r,function(t){t instanceof wa?o.cancel():i(t)}),o.then(t,e,n)},pa.prototype.$goog_Thenable=!0,S(ba,C),ba.prototype.message="Deferred has already fired",ba.prototype.name="AlreadyCalledError",S(wa,C),wa.prototype.message="Deferred was canceled",wa.prototype.name="CanceledError",_a.prototype.c=function(){throw delete Ta[this.a],this.b};var Ta={};function Ea(t){var e,n=document,r=et(t).toString(),i=document.createElement("SCRIPT"),o={Nb:i,Ga:void 0},a=new pa(o);return e=window.setTimeout(function(){Ia(i,!0);var t=new Aa(Na,"Timeout reached for loading script "+r);ya(a),da(a,!1,t)},5e3),o.Ga=e,i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(Ia(i,!1,e),ya(a),da(a,!0,null))},i.onerror=function(){Ia(i,!0,e);var t=new Aa(Ca,"Error while loading script "+r);ya(a),da(a,!1,t)},z(o={},{type:"text/javascript",charset:"UTF-8"}),Bn(i,o),function(t,e){M(t,"HTMLScriptElement"),t.src=et(e),null===f&&(f=(e=(e=l.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&s.test(e)?e:""),(e=f)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),a}function Sa(){if(this&&this.Nb){var t=this.Nb;t&&"SCRIPT"==t.tagName&&Ia(t,!0,this.Ga)}}function Ia(t,e,n){null!=n&&l.clearTimeout(n),t.onload=p,t.onerror=p,t.onreadystatechange=p,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var Ca=0,Na=1;function Aa(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),C.call(this,n),this.code=t}function ka(t){this.f=t}function Da(t,e,n){if(this.c=t,t=e||{},this.l=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.u=t.secureTokenTimeout||Pa,this.g=H(t.secureTokenHeaders||Ma),this.h=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=t.firebaseTimeout||La,this.a=H(t.firebaseHeaders||xa),n&&(this.a["X-Client-Version"]=n,this.g["X-Client-Version"]=n),n="Node"==ur(),!(n=l.XMLHttpRequest||n&&fl.INTERNAL.node&&fl.INTERNAL.node.XMLHttpRequest)&&!sr())throw new Yr("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,sr()?this.f=new Go(self):cr()?this.f=new ka(n):this.f=new Oo,this.b=null}S(Aa,C),S(ka,Ao),ka.prototype.a=function(){return new this.f},ka.prototype.b=function(){return{}};var Ra,Oa="idToken",Pa=new Ar(3e4,6e4),Ma={"Content-Type":"application/x-www-form-urlencoded"},La=new Ar(3e4,6e4),xa={"Content-Type":"application/json"};function Fa(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Ua(t,e){e?(t.a["X-Client-Version"]=e,t.g["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.g["X-Client-Version"])}function Va(t,e,n,r,i,o,a){(t=function(){var t=yr();return!((t=fr(t)!=lr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&t<30)&&(!me||!Ie||9<Ie)}()||sr()?_(t.o,t):(Ra=Ra||new jt(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{l[Ba]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},function(t,e){ma(t,null,e,void 0)}(Ea(nt(qa,{onload:Ba})),function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)}),_(t.m,t)))(e,n,r,i,o,a)}Da.prototype.R=function(){return this.b},Da.prototype.o=function(t,n,e,r,i,o){if(sr()&&(void 0===l.fetch||void 0===l.Headers||void 0===l.Request))throw new Yr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new Zo(this.f);if(o){a.g=Math.max(0,o);var s=setTimeout(function(){a.dispatchEvent("timeout")},o)}rn(a,"complete",function(){s&&clearTimeout(s);var e=null;try{e=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return Ho(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(t){e=null}n&&n(e)}),on(a,"ready",function(){s&&clearTimeout(s),le(this)}),on(a,"timeout",function(){s&&clearTimeout(s),le(this),n&&n(null)}),ra(a,t,e,r,i)};var qa=new Y($,"https://apis.google.com/js/client.js?onload=%{onload}"),Ba="__fcb"+Math.floor(1e6*Math.random()).toString();function ja(t){if(!h(t=t.email)||!rr.test(t))throw new Yr("invalid-email")}function Wa(t){"email"in t&&ja(t)}function Ka(t){if(!t[Oa])throw new Yr("internal-error")}function Qa(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new Yr("internal-error")}else{if(!t.sessionInfo)throw new Yr("missing-verification-id");if(!t.code)throw new Yr("missing-verification-code")}}Da.prototype.m=function(t,n,r,i,o){var a=this;Ra.then(function(){window.gapi.client.setApiKey(a.c);var e=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:r,body:i,headers:o,authType:"none",callback:function(t){window.gapi.auth.setToken(e),n&&n(t)}})}).s(function(t){n&&n({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},Da.prototype.ob=function(){return Ns(this,vs,{})},Da.prototype.rb=function(t,e){return Ns(this,ms,{idToken:t,email:e})},Da.prototype.sb=function(t,e){return Ns(this,gs,{idToken:t,password:e})};var Ha={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Ga(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new Yr("internal-error")}function za(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(Ln(t=new Rn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function Ya(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=No(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=No(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=No(t)):t.errorMessage&&(e=As(t.errorMessage)),e)throw e;if(!t[Oa])throw new Yr("internal-error")}function Xa(t,e){return e.returnIdpCredential=!0,Ns(t,bs,e)}function Ja(t,e){return e.returnIdpCredential=!0,Ns(t,_s,e)}function $a(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,Ns(t,ws,e)}function Za(t){if(!t.oobCode)throw new Yr("invalid-action-code")}(t=Da.prototype).tb=function(t,r){var i={idToken:t},o=[];return K(Ha,function(t,e){var n=r[e];null===n?o.push(t):e in r&&(i[e]=n)}),o.length&&(i.deleteAttribute=o),Ns(this,ms,i)},t.kb=function(t,e){return z(t={requestType:"PASSWORD_RESET",email:t},e),Ns(this,ls,t)},t.lb=function(t,e){return z(t={requestType:"EMAIL_SIGNIN",email:t},e),Ns(this,cs,t)},t.jb=function(t,e){return z(t={requestType:"VERIFY_EMAIL",idToken:t},e),Ns(this,hs,t)},t.Va=function(t){return Ns(this,Ss,t)},t.$a=function(t,e){return Ns(this,ds,{oobCode:t,newPassword:e})},t.Ka=function(t){return Ns(this,es,{oobCode:t})},t.Xa=function(t){return Ns(this,ts,{oobCode:t})};var ts={endpoint:"setAccountInfo",D:Za,fa:"email",F:!0},es={endpoint:"resetPassword",D:Za,K:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new Yr("internal-error")},F:!0},ns={endpoint:"signupNewUser",D:function(t){if(ja(t),!t.password)throw new Yr("weak-password")},K:Ka,T:!0,F:!0},rs={endpoint:"createAuthUri",F:!0},is={endpoint:"deleteAccount",V:["idToken"]},os={endpoint:"setAccountInfo",V:["idToken","deleteProvider"],D:function(t){if(!d(t.deleteProvider))throw new Yr("internal-error")}},as={endpoint:"emailLinkSignin",V:["email","oobCode"],D:ja,K:Ka,T:!0,F:!0},ss={endpoint:"emailLinkSignin",V:["idToken","email","oobCode"],D:ja,K:Ka,T:!0},us={endpoint:"getAccountInfo"},cs={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new Yr("internal-error");ja(t)},fa:"email",F:!0},hs={endpoint:"getOobConfirmationCode",V:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new Yr("internal-error")},fa:"email",F:!0},ls={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new Yr("internal-error");ja(t)},fa:"email",F:!0},fs={wb:!0,endpoint:"getProjectConfig",Kb:"GET"},ps={wb:!0,endpoint:"getRecaptchaParam",Kb:"GET",K:function(t){if(!t.recaptchaSiteKey)throw new Yr("internal-error")}},ds={endpoint:"resetPassword",D:Za,fa:"email",F:!0},ys={endpoint:"sendVerificationCode",V:["phoneNumber","recaptchaToken"],fa:"sessionInfo",F:!0},ms={endpoint:"setAccountInfo",V:["idToken"],D:Wa,T:!0},gs={endpoint:"setAccountInfo",V:["idToken"],D:function(t){if(Wa(t),!t.password)throw new Yr("weak-password")},K:Ka,T:!0},vs={endpoint:"signupNewUser",K:Ka,T:!0,F:!0},bs={endpoint:"verifyAssertion",D:Ga,Qa:za,K:Ya,T:!0,F:!0},ws={endpoint:"verifyAssertion",D:Ga,Qa:za,K:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new Yr("user-not-found");if(t.errorMessage)throw As(t.errorMessage);if(!t[Oa])throw new Yr("internal-error")},T:!0,F:!0},_s={endpoint:"verifyAssertion",D:function(t){if(Ga(t),!t.idToken)throw new Yr("internal-error")},Qa:za,K:Ya,T:!0},Ts={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new Yr("invalid-custom-token")},K:Ka,T:!0,F:!0},Es={endpoint:"verifyPassword",D:function(t){if(ja(t),!t.password)throw new Yr("wrong-password")},K:Ka,T:!0,F:!0},Ss={endpoint:"verifyPhoneNumber",D:Qa,K:Ka,F:!0},Is={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new Yr("internal-error");Qa(t)},K:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",No(t);Ka(t)}},Cs={Yb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:Qa,K:Ka,F:!0};function Ns(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.V))return Xt(new Yr("internal-error"));var r,i=e.Kb||"POST";return Yt(n).then(e.D).then(function(){return e.T&&(n.returnSecureToken=!0),e.F&&t.b&&void 0===n.tenantId&&(n.tenantId=t.b),function(t,e,r,i,o,n){var a=_n(t.h+e);bn(a,"key",t.c),n&&bn(a,"cb",E().toString());var s="GET"==r;if(s)for(var u in i)i.hasOwnProperty(u)&&bn(a,u,i[u]);return new jt(function(e,n){Va(t,a.toString(),function(t){t?t.error?n(ks(t,o||{})):e(t):n(new Yr("network-request-failed"))},r,s?void 0:Qn(Er(i)),t.a,t.i.get())})}(t,e.endpoint,i,n,e.Yb,e.wb||!1)}).then(function(t){return r=t,e.Qa?e.Qa(n,r):r}).then(e.K).then(function(){if(!e.fa)return r;if(!(e.fa in r))throw new Yr("internal-error");return r[e.fa]})}function As(t){return ks({error:{errors:[{message:t}],code:400,message:t}})}function ks(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new Yr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",z(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new Yr(r[i],e);return!e&&t&&(e=Tr(t)),new Yr("internal-error",e)}function Ds(t){this.b=t,this.a=null,this.fb=function(o){return(Ms=Ms||new jt(function(t,e){function n(){Nr(),mr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Nr(),e(Error("Network Error"))},timeout:Os.get()})}if(mr("gapi.iframes.Iframe"))t();else if(mr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();l[r]=function(){mr("gapi.load")?n():e(Error("Network Error"))},Yt(Ea(r=nt(Rs,{onload:r}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw Ms=null,t})).then(function(){return new jt(function(r,i){mr("gapi.iframes.getContext")().open({where:document.body,url:o.b,messageHandlersFilter:mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(t){function e(){clearTimeout(n),r()}o.a=t,o.a.restyle({setHideOnLeave:!1});var n=setTimeout(function(){i(Error("Network Error"))},Ps.get());t.ping(e).then(e,function(){i(Error("Network Error"))})})})})}(this)}var Rs=new Y($,"https://apis.google.com/js/api.js?onload=%{onload}"),Os=new Ar(3e4,6e4),Ps=new Ar(5e3,15e3),Ms=null;function Ls(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=Tn(this.i,"/__/auth/iframe"),bn(this.a,"apiKey",this.g),bn(this.a,"appName",this.h),this.b=null,this.c=[]}function xs(t,e,n,r,i){this.o=t,this.m=e,this.c=n,this.u=r,this.i=this.g=this.l=null,this.a=i,this.h=this.f=null}function Fs(t){try{return fl.app(t).auth().Aa()}catch(t){return[]}}function Us(t,e,n,r,i){this.u=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.o=this.v=null,this.g=[],this.l=this.a=null}function Vs(t){var s=Jn();return function(t){return Ns(t,fs,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var e=_n(s),n=e.f;e=e.b;for(var r=0;r<t.length;r++){var i=t[r],o=e,a=n;if(o=0==i.indexOf("chrome-extension://")?_n(i).b==o&&"chrome-extension"==a:("http"==a||"https"==a)&&(nr.test(i)?o==i:(i=i.split(".").join("\\."),new RegExp("^(.+\\."+i+"|"+i+")$","i").test(o)))){t=!0;break t}}t=!1}if(!t)throw new Io(Jn())})}function qs(i){return i.l||(i.l=ir().then(function(){if(!i.o){var t=i.c,e=i.h,n=Fs(i.b),r=new Ls(i.u,i.f,i.b);r.f=t,r.b=e,r.c=W(n||[]),i.o=r.toString()}i.i=new Ds(i.o),function(r){if(!r.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.fb.then(function(){t.a.register("authEvent",e,mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(r.i,function(t){var e={};if(t&&t.authEvent){var n=!1;for(t=_o(t.authEvent),e=0;e<r.g.length;e++)n=r.g[e](t)||n;return(e={}).status=n?"ACK":"ERROR",Yt(e)}return e.status="ERROR",Yt(e)})}(i)})),i.l}function Bs(t){return t.m||(t.v=t.c?dr(t.c,Fs(t.b)):null,t.m=new Da(t.f,Ni(t.h),t.v)),t.m}function js(t,e,n,r,i,o,a,s,u,c,h){return(t=new xs(t,e,n,r,i)).l=o,t.g=a,t.i=s,t.b=H(u||null),t.f=c,t.nb(h).toString()}function Ws(t){if(this.a=t||fl.INTERNAL.reactNative&&fl.INTERNAL.reactNative.AsyncStorage,!this.a)throw new Yr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Ks(t){this.b=t,this.a={},this.f=_(this.c,this)}Ls.prototype.toString=function(){return this.f?bn(this.a,"v",this.f):Mn(this.a.a,"v"),this.b?bn(this.a,"eid",this.b):Mn(this.a.a,"eid"),this.c.length?bn(this.a,"fw",this.c.join(",")):Mn(this.a.a,"fw"),this.a.toString()},xs.prototype.nb=function(t){return this.h=t,this},xs.prototype.toString=function(){var t=Tn(this.o,"/__/auth/handler");if(bn(t,"apiKey",this.m),bn(t,"appName",this.c),bn(t,"authType",this.u),this.a.isOAuthProvider){var e=this.a;try{var n=fl.app(this.c).auth().ha()}catch(t){n=null}for(var r in e.ab=n,bn(t,"providerId",this.a.providerId),n=Er((e=this.a).zb))n[r]=n[r].toString();r=e.Fc,n=H(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.cb&&e.ab&&!n[e.cb]&&(n[e.cb]=e.ab),Q(n)||bn(t,"customParameters",Tr(n))}if("function"==typeof this.a.Hb&&((e=this.a.Hb()).length&&bn(t,"scopes",e.join(","))),this.l?bn(t,"redirectUrl",this.l):Mn(t.a,"redirectUrl"),this.g?bn(t,"eventId",this.g):Mn(t.a,"eventId"),this.i?bn(t,"v",this.i):Mn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!wn(t,a)&&bn(t,a,this.b[a]);return this.h?bn(t,"tid",this.h):Mn(t.a,"tid"),this.f?bn(t,"eid",this.f):Mn(t.a,"eid"),(a=Fs(this.c)).length&&bn(t,"fw",a.join(",")),t.toString()},(t=Us.prototype).Fb=function(e,n,t){var r=new Yr("popup-closed-by-user"),i=new Yr("web-storage-unsupported"),o=this,a=!1;return this.ia().then(function(){(function(t){var e={type:"webStorageSupport"};return qs(t).then(function(){return function(e,n){return e.fb.then(function(){return new jt(function(t){e.a.send(n.type,n,t,mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(t){t||(e&&tr(e),n(i),a=!0)})}).s(function(){}).then(function(){if(!a)return function(n){return new jt(function(e){return function t(){un(2e3).then(function(){if(n&&!n.closed)return t();e()})}()})}(e)}).then(function(){if(!a)return un(t).then(function(){n(r)})})},t.Ob=function(){var t=yr();return!_r(t)&&!Cr(t)},t.Jb=function(){return!1},t.Db=function(e,t,n,r,i,o,a,s){if(!e)return Xt(new Yr("popup-blocked"));if(a&&!_r())return this.ia().s(function(t){tr(e),i(t)}),r(),Yt();this.a||(this.a=Vs(Bs(this)));var u=this;return this.a.then(function(){var t=u.ia().s(function(t){throw tr(e),i(t),t});return r(),t}).then(function(){bo(n),a||$n(js(u.u,u.f,u.b,t,n,null,o,u.c,void 0,u.h,s),e)}).s(function(t){throw"auth/network-request-failed"==t.code&&(u.a=null),t})},t.Eb=function(t,e,n,r){this.a||(this.a=Vs(Bs(this)));var i=this;return this.a.then(function(){bo(e),$n(js(i.u,i.f,i.b,t,e,Jn(),n,i.c,void 0,i.h,r))}).s(function(t){throw"auth/network-request-failed"==t.code&&(i.a=null),t})},t.ia=function(){var t=this;return qs(this).then(function(){return t.i.fb}).s(function(){throw t.a=null,new Yr("network-request-failed")})},t.Rb=function(){return!0},t.ya=function(t){this.g.push(t)},t.La=function(e){B(this.g,function(t){return t==e})},(t=Ws.prototype).get=function(t){return Yt(this.a.getItem(t)).then(function(t){return t&&Sr(t)})},t.set=function(t,e){return Yt(this.a.setItem(t,Tr(e)))},t.S=function(t){return Yt(this.a.removeItem(t))},t.$=function(){},t.ea=function(){};var Qs,Hs=[];function Gs(t,e,n){Q(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function zs(t){this.a=t}function Ys(t){this.c=t,this.b=!1,this.a=[]}function Xs(r,t,e,n){var i,o,a,s,u=e||{},c=null;if(r.b)return Xt(Error("connection_unavailable"));var h=n?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new jt(function(e,n){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){n(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){n(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?e(t.data.response):n(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),n(Error("invalid_response"))))}},r.a.push(c),l.port1.addEventListener("message",o),r.c.postMessage({eventType:t,eventId:i,data:u},[l.port2])):n(Error("connection_unavailable"))}).then(function(t){return Js(r,c),t}).s(function(t){throw Js(r,c),t})}function Js(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),B(t.a,function(t){return t==e})}}function $s(){if(!eu())throw new Yr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.u=l.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.o=!1,this.h=null;var r=this;sr()&&self?(this.l=function(){var e=sr()?self:null;if(x(Hs,function(t){t.b==e&&(n=t)}),!n){var n=new Ks(e);Hs.push(n)}return n}(),Gs(this.l,"keyChanged",function(t,n){return au(r).then(function(e){return 0<e.length&&x(r.a,function(t){t(e)}),{keyProcessed:V(e,n.key)}})}),Gs(this.l,"ping",function(){return Yt(["keyChanged"])})):function(){var t=l.navigator;return t&&t.serviceWorker?Yt().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Yt(null)}().then(function(t){(r.h=t)&&(r.g=new Ys(new zs(t)),Xs(r.g,"ping",null,!0).then(function(t){t[0].fulfilled&&V(t[0].value,"keyChanged")&&(r.o=!0)}).s(function(){}))})}function Zs(r){return new jt(function(e,n){var t=r.u.open("firebaseLocalStorageDb",1);t.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},t.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},t.onsuccess=function(t){(t=t.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(t):function(r){return new jt(function(t,e){var n=r.u.deleteDatabase("firebaseLocalStorageDb");n.onsuccess=function(){t()},n.onerror=function(t){e(Error(t.target.error))}})}(r).then(function(){return Zs(r)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function tu(t){return t.m||(t.m=Zs(t)),t.m}function eu(){try{return!!l.indexedDB}catch(t){return!1}}function nu(t){return t.objectStore("firebaseLocalStorage")}function ru(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function iu(t){return new jt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function ou(t,e){return t.g&&t.h&&function(){var t=l.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Xs(t.g,"keyChanged",{key:e},t.o).then(function(){}).s(function(){}):Yt()}function au(r){return tu(r).then(function(t){var i=nu(ru(t,!1));return i.getAll?iu(i.getAll()):new jt(function(e,n){var r=[],t=i.openCursor();t.onsuccess=function(t){(t=t.target.result)?(r.push(t.value),t.continue()):e(r)},t.onerror=function(t){n(t.target.error)}})}).then(function(t){var e={},n=[];if(0==r.b){for(n=0;n<t.length;n++)e[t[n].fbase_key]=t[n].value;n=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(r.c,e),r.c=e}return n})}function su(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function uu(t){var r=this,i=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Yt().then(function(){if(eu()){var e=Ir(),n="__sak"+e;return Qs=Qs||new $s,(i=Qs).set(n,e).then(function(){return i.get(n)}).then(function(t){if(t!==e)throw Error("indexedDB not supported!");return i.S(n)}).then(function(){return i}).s(function(){return r.c})}return r.c}).then(function(t){return r.type=t.type,t.$(function(e){x(r.a,function(t){t(e)})}),t})}function cu(){this.a={},this.type="inMemory"}function hu(){if(!function(){var t="Node"==ur();if(!(t=lu()||t&&fl.INTERNAL.node&&fl.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The LocalStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=lu()||fl.INTERNAL.node.localStorage,this.type="localStorage"}function lu(){try{var t=l.localStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function fu(){this.type="nullStorage"}function pu(){if(!function(){var t="Node"==ur();if(!(t=du()||t&&fl.INTERNAL.node&&fl.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The SessionStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=du()||fl.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function du(){try{var t=l.sessionStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function yu(){var t={};t.Browser=vu,t.Node=bu,t.ReactNative=wu,t.Worker=_u,this.a=t[ur()]}Ks.prototype.c=function(n){var r=n.data.eventType,i=n.data.eventId,t=this.a[r];if(t&&0<t.length){n.ports[0].postMessage({status:"ack",eventId:i,eventType:r,response:null});var e=[];x(t,function(t){e.push(Yt().then(function(){return t(n.origin,n.data.data)}))}),$t(e).then(function(t){var e=[];x(t,function(t){e.push({fulfilled:t.Gb,value:t.value,reason:t.reason?t.reason.message:void 0})}),x(e,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),n.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:e})})}},zs.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Ys.prototype.close=function(){for(;0<this.a.length;)Js(this,this.a[0]);this.b=!0},(t=$s.prototype).set=function(n,r){var i,o=!1,a=this;return tu(this).then(function(t){return iu((t=nu(ru(i=t,!0))).get(n))}).then(function(t){var e=nu(ru(i,!0));return t?(t.value=r,iu(e.put(t))):(a.b++,o=!0,(t={}).fbase_key=n,t.value=r,iu(e.add(t)))}).then(function(){return a.c[n]=r,ou(a,n)}).ka(function(){o&&a.b--})},t.get=function(e){return tu(this).then(function(t){return iu(nu(ru(t,!1)).get(e))}).then(function(t){return t&&t.value})},t.S=function(e){var n=!1,r=this;return tu(this).then(function(t){return n=!0,r.b++,iu(nu(ru(t,!0)).delete(e))}).then(function(){return delete r.c[e],ou(r,e)}).ka(function(){n&&r.b--})},t.$=function(t){0==this.a.length&&function(t){su(t),function e(){t.f=setTimeout(function(){t.i=au(t).then(function(e){0<e.length&&x(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ea=function(e){B(this.a,function(t){return t==e}),0==this.a.length&&su(this)},(t=uu.prototype).get=function(e){return this.b.then(function(t){return t.get(e)})},t.set=function(e,n){return this.b.then(function(t){return t.set(e,n)})},t.S=function(e){return this.b.then(function(t){return t.S(e)})},t.$=function(t){this.a.push(t)},t.ea=function(e){B(this.a,function(t){return t==e})},(t=cu.prototype).get=function(t){return Yt(this.a[t])},t.set=function(t,e){return this.a[t]=e,Yt()},t.S=function(t){return delete this.a[t],Yt()},t.$=function(){},t.ea=function(){},(t=hu.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Tr(n);null===t?r.S(e):r.a.setItem(e,t)})},t.S=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.$=function(t){l.window&&Ke(l.window,"storage",t)},t.ea=function(t){l.window&&Ge(l.window,"storage",t)},(t=fu.prototype).get=function(){return Yt(null)},t.set=function(){return Yt()},t.S=function(){return Yt()},t.$=function(){},t.ea=function(){},(t=pu.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Tr(n);null===t?r.S(e):r.a.setItem(e,t)})},t.S=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.$=function(){},t.ea=function(){};var mu,gu,vu={C:hu,Sa:pu},bu={C:hu,Sa:pu},wu={C:Ws,Sa:fu},_u={C:hu,Sa:fu},Tu={$c:"local",NONE:"none",bd:"session"};function Eu(){var t=!(Cr(yr())||!ar()),e=_r(),n=gr();this.m=t,this.h=e,this.l=n,this.a={},t=mu=mu||new yu;try{this.g=!Xn()&&Rr()||!l.indexedDB?new t.a.C:new uu(sr()?new cu:new t.a.C)}catch(t){this.g=new cu,this.h=!0}try{this.i=new t.a.Sa}catch(t){this.i=new cu}this.u=new cu,this.f=_(this.Pb,this),this.b={}}function Su(){return gu=gu||new Eu}function Iu(t,e){switch(e){case"session":return t.i;case"none":return t.u;default:return t.g}}function Cu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function Nu(t,e,n){return n=Cu(e,n),"local"==e.C&&(t.b[n]=null),Iu(t,e.C).S(n)}function Au(t){t.c&&(clearInterval(t.c),t.c=null)}function ku(t){this.a=t,this.b=Su()}(t=Eu.prototype).get=function(t,e){return Iu(this,t.C).get(Cu(t,e))},t.set=function(e,t,n){var r=Cu(e,n),i=this,o=Iu(this,e.C);return o.set(r,t).then(function(){return o.get(r)}).then(function(t){"local"==e.C&&(i.b[r]=t)})},t.addListener=function(t,e,n){t=Cu(t,e),this.l&&(this.b[t]=l.localStorage.getItem(t)),Q(this.a)&&(Iu(this,"local").$(this.f),this.h||(Xn()||!Rr())&&l.indexedDB||!this.l||function(r){Au(r),r.c=setInterval(function(){for(var t in r.a){var e=l.localStorage.getItem(t),n=r.b[t];e!=n&&(r.b[t]=e,e=new Pe({type:"storage",key:t,target:window,oldValue:n,newValue:e,a:!0}),r.Pb(e))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=Cu(t,e),this.a[t]&&(B(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),Q(this.a)&&(Iu(this,"local").ea(this.f),Au(this))},t.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=l.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.Za(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?Iu(this,"local").ea(this.f):Au(this),this.m)if(n=l.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?l.localStorage.setItem(e,r):l.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===l.localStorage.getItem(e)||(o.b[e]=l.localStorage.getItem(e),o.Za(e))},me&&Ie&&10==Ie&&l.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else x(t,_(this.Za,this))},t.Za=function(t){this.a[t]&&x(this.a[t],function(t){t()})};var Du,Ru={name:"authEvent",C:"local"};function Ou(){this.a=Su()}function Pu(t,e){this.b=Mu,this.f=l.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=l.Int32Array?new Int32Array(64):Array(64),void 0!==Du||(Du=l.Int32Array?new Int32Array(Bu):Bu),this.reset()}S(Pu,function(){this.b=-1});for(var Mu=64,Lu=Mu-1,xu=[],Fu=0;Fu<Lu;Fu++)xu[Fu]=0;var Uu=j(128,xu);function Vu(t){for(var e=t.f,n=t.l,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|Du[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function qu(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(h(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(Vu(t),i=0);else{if(!y(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&o<=255&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(Vu(t),i=0)}}t.c=i,t.g+=n}Pu.prototype.reset=function(){this.g=this.c=0,this.a=l.Int32Array?new Int32Array(this.h):W(this.h)};var Bu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function ju(){Pu.call(this,8,Wu)}S(ju,Pu);var Wu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Ku(t,e,n,r,i){this.u=t,this.i=e,this.l=n,this.m=r||null,this.o=i||null,this.h=e+":"+n,this.v=new Ou,this.g=new ku(this.h),this.f=null,this.b=[],this.a=this.c=null}function Qu(t){return new Yr("invalid-cordova-configuration",t)}function Hu(t){var e=new ju;qu(e,t),t=[];var n=8*e.g;e.c<56?qu(e,Uu,56-e.c):qu(e,Uu,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(Vu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return F(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}function Gu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function zu(r){return r.f||(r.f=r.ia().then(function(){return new jt(function(n){r.ya(function t(e){return n(e),r.La(t),!1}),function(i){function e(r){t=!0,n&&n.cancel(),Yu(i).then(function(t){var e=o;if(t&&r&&r.url){var n=null;-1!=(e=Bi(r.url)).indexOf("/__/auth/callback")&&(n=(n="object"==typeof(n=Sr(wn(n=_n(e),"firebaseError")||null))?Xr(n):null)?new wo(t.c,t.b,null,null,n,null,t.R()):new wo(t.c,t.b,e,t.f,null,null,t.R())),e=n||o}Gu(i,e)})}var o=new wo("unknown",null,null,null,new Yr("no-auth-event")),t=!1,n=un(500).then(function(){return Yu(i).then(function(){t||Gu(i,o)})}),r=l.handleOpenURL;l.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(mr("BuildInfo.packageName",l).toLowerCase()+"://")&&e({url:t}),"function"==typeof r)try{r(t)}catch(t){console.error(t)}},So=So||new To,function(t){var n=So;n.a.push(t),n.b||(n.b=function(t){for(var e=0;e<n.a.length;e++)n.a[e](t)},"function"==typeof(t=mr("universalLinks.subscribe",l))&&t(null,n.b))}(e)}(r)})})),r.f}function Yu(e){var n=null;return function(t){return t.b.get(Ru,t.a).then(function(t){return _o(t)})}(e.g).then(function(t){return n=t,Nu((t=e.g).b,Ru,t.a)}).then(function(){return n})}function Xu(t){this.a=t,this.b=Su()}(t=Ku.prototype).ia=function(){return this.Ba?this.Ba:this.Ba=(or(void 0)?ir().then(function(){return new jt(function(t,e){var n=l.document,r=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(r),t()},!1)})}):Xt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof mr("universalLinks.subscribe",l))throw Qu("cordova-universal-links-plugin-fix is not installed");if(void 0===mr("BuildInfo.packageName",l))throw Qu("cordova-plugin-buildinfo is not installed");if("function"!=typeof mr("cordova.plugins.browsertab.openUrl",l))throw Qu("cordova-plugin-browsertab is not installed");if("function"!=typeof mr("cordova.InAppBrowser.open",l))throw Qu("cordova-plugin-inappbrowser is not installed")},function(){throw new Yr("cordova-not-ready")})},t.Fb=function(t,e){return e(new Yr("operation-not-supported-in-this-environment")),Yt()},t.Db=function(){return Xt(new Yr("operation-not-supported-in-this-environment"))},t.Rb=function(){return!1},t.Ob=function(){return!0},t.Jb=function(){return!0},t.Eb=function(t,e,n,r){if(this.c)return Xt(new Yr("redirect-operation-pending"));var i=this,o=l.document,a=null,s=null,u=null,c=null;return this.c=Yt().then(function(){return bo(e),zu(i)}).then(function(){return function(n,t,e,r,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),a=new wo(t,r,null,o,new Yr("no-auth-event"),null,i),s=mr("BuildInfo.packageName",l);if("string"!=typeof s)throw new Yr("invalid-cordova-configuration");var u=mr("BuildInfo.displayName",l),c={};if(yr().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=s;else{if(!yr().toLowerCase().match(/android/))return Xt(new Yr("operation-not-supported-in-this-environment"));c.apn=s}u&&(c.appDisplayName=u),o=Hu(o),c.sessionId=o;var h=js(n.u,n.i,n.l,t,e,null,r,n.m,c,n.o,i);return n.ia().then(function(){var t=n.h;return n.v.a.set(Ru,a.A(),t)}).then(function(){var t=mr("cordova.plugins.browsertab.isAvailable",l);if("function"!=typeof t)throw new Yr("invalid-cordova-configuration");var e=null;t(function(t){if(t){if("function"!=typeof(e=mr("cordova.plugins.browsertab.openUrl",l)))throw new Yr("invalid-cordova-configuration");e(h)}else{if("function"!=typeof(e=mr("cordova.InAppBrowser.open",l)))throw new Yr("invalid-cordova-configuration");t=yr(),n.a=e(h,t.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||t.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(i,t,e,n,r)}).then(function(){return new jt(function(e,t){s=function(){var t=mr("cordova.plugins.browsertab.close",l);return e(),"function"==typeof t&&t(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.ya(s),u=function(){a=a||un(2e3).then(function(){t(new Yr("redirect-cancelled-by-user"))})},c=function(){kr()&&u()},o.addEventListener("resume",u,!1),yr().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",c,!1)}).s(function(t){return Yu(i).then(function(){throw t})})}).ka(function(){u&&o.removeEventListener("resume",u,!1),c&&o.removeEventListener("visibilitychange",c,!1),a&&a.cancel(),s&&i.La(s),i.c=null})},t.ya=function(e){this.b.push(e),zu(this).s(function(t){"auth/invalid-cordova-configuration"===t.code&&(t=new wo("unknown",null,null,null,new Yr("no-auth-event")),e(t))})},t.La=function(e){B(this.b,function(t){return t==e})};var Ju={name:"pendingRedirect",C:"session"};function $u(t){return Nu(t.b,Ju,t.a)}function Zu(t,e,n){this.i={},this.v=0,this.B=t,this.u=e,this.m=n,this.h=[],this.f=!1,this.l=_(this.o,this),this.b=new pc,this.w=new vc,this.g=new Xu(this.u+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=tc(this.B,this.u,this.m,Ii)}function tc(t,e,n,r){var i=fl.SDK_VERSION||null;return or()?new Ku(t,e,n,i,r):new Us(t,e,n,i,r)}function ec(e){e.f||(e.f=!0,e.a.ya(e.l));var n=e.a;return e.a.ia().s(function(t){throw e.a==n&&e.reset(),t})}function nc(n){n.a.Ob()&&ec(n).s(function(t){var e=new wo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));uc(t)&&n.o(e)}),n.a.Jb()||dc(n.b)}function rc(n,t){V(n.h,t)||n.h.push(t),n.f||function(t){return t.b.get(Ju,t.a).then(function(t){return"pending"==t})}(n.g).then(function(t){t?$u(n.g).then(function(){ec(n).s(function(t){var e=new wo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));uc(t)&&n.o(e)})}):nc(n)}).s(function(){nc(n)})}function ic(t,e){B(t.h,function(t){return t==e})}Zu.prototype.reset=function(){this.f=!1,this.a.La(this.l),this.a=tc(this.B,this.u,this.m),this.i={}},Zu.prototype.o=function(t){if(!t)throw new Yr("invalid-auth-event");if(6e5<=E()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.xb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=E())),e=!0;break}}return dc(this.b),e};var oc=new Ar(2e3,1e4),ac=new Ar(3e4,6e4);function sc(t,e,n,r,i,o,a){return t.a.Db(e,n,r,function(){t.f||(t.f=!0,t.a.ya(t.l))},function(){t.reset()},i,o,a)}function uc(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function cc(e,t,n,r,i){var o;return function(t){return t.b.set(Ju,"pending",t.a)}(e.g).then(function(){return e.a.Eb(t,n,r,i).s(function(t){if(uc(t))throw new Yr("operation-not-supported-in-this-environment");return o=t,$u(e.g).then(function(){throw o})}).then(function(){return e.a.Rb()?new jt(function(){}):$u(e.g).then(function(){return e.oa()}).then(function(){}).s(function(){})})})}function hc(t,e,n,r,i){return t.a.Fb(r,function(t){e.ja(n,null,t,i)},oc.get())}Zu.prototype.oa=function(){return this.b.oa()};var lc={};function fc(t,e,n){var r=e+":"+n;return lc[r]||(lc[r]=new Zu(t,e,n)),lc[r]}function pc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function dc(t){t.g||(t.g=!0,gc(t,!1,null,null))}function yc(t){t.g&&!t.i&&gc(t,!1,null,null)}function mc(t,e){if(t.b=function(){return Yt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function gc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Xt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):mc(t,n):mc(t,{user:null}),t.f=[],t.c=[]}function vc(){}function bc(){this.vb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.vb},set:function(t){this.vb=t},enumerable:!1})}function wc(t,e){this.a=e,xr(this,"verificationId",t)}function _c(t,e,n,r){return new mo(t).Va(e,n).then(function(t){return new wc(t,r)})}function Tc(t){var e=Si(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new Yr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Fr(this,{token:t,expirationTime:Dr(1e3*e.exp),authTime:Dr(1e3*e.auth_time),issuedAtTime:Dr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function Ec(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function Sc(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}function Ic(t){this.f=t,this.b=this.a=null,this.c=0}function Cc(t,e){var n=e[Oa],r=e.refreshToken;e=Nc(e.expiresIn),t.b=n,t.c=e,t.a=r}function Nc(t){return E()+1e3*parseInt(t,10)}function Ac(e,t){return function(t,r){return new jt(function(e,n){"refresh_token"==r.grant_type&&r.refresh_token||"authorization_code"==r.grant_type&&r.code?Va(t,t.l+"?key="+encodeURIComponent(t.c),function(t){t?t.error?n(ks(t)):t.access_token&&t.refresh_token?e(t):n(new Yr("internal-error")):n(new Yr("network-request-failed"))},"POST",Pn(r).toString(),t.g,t.u.get()):n(new Yr("internal-error"))})}(e.f,t).then(function(t){return e.b=t.access_token,e.c=Nc(t.expires_in),e.a=t.refresh_token,{accessToken:e.b,expirationTime:e.c,refreshToken:e.a}}).s(function(t){throw"auth/user-token-expired"==t.code&&(e.a=null),t})}function kc(t,e){this.a=t||null,this.b=e||null,Fr(this,{lastSignInTime:Dr(e||null),creationTime:Dr(t||null)})}function Dc(t,e,n,r,i,o){Fr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function Rc(t,e){for(var n in Oe.call(this,t),e)this[n]=e[n]}function Oc(t,e,n){this.I=[],this.l=t.apiKey,this.m=t.appName,this.o=t.authDomain||null,t=fl.SDK_VERSION?dr(fl.SDK_VERSION):null,this.a=new Da(this.l,Ni(Ii),t),this.b=new Ic(this.a),Vc(this,e[Oa]),Cc(this.b,e),xr(this,"refreshToken",this.b.a),jc(this,n||{}),nn.call(this),this.J=!1,this.o&&vr()&&(this.i=fc(this.o,this.l,this.m)),this.O=[],this.h=null,this.w=function(e){return new Ec(function(){return e.G(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var t=e.b.c-E()-3e5;return 0<t?t:0})}(this),this.W=_(this.Ha,this);var r=this;this.ga=null,this.va=function(t){r.sa(t.g)},this.Z=null,this.P=[],this.ua=function(t){Mc(r,t.c)},this.Y=null}function Pc(t,e){t.Z&&Ge(t.Z,"languageCodeChanged",t.va),(t.Z=e)&&Ke(e,"languageCodeChanged",t.va)}function Mc(t,e){t.P=e,Ua(t.a,fl.SDK_VERSION?dr(fl.SDK_VERSION,t.P):null)}function Lc(t,e){t.Y&&Ge(t.Y,"frameworkChanged",t.ua),(t.Y=e)&&Ke(e,"frameworkChanged",t.ua)}function xc(e){try{return fl.app(e.m).auth()}catch(t){throw new Yr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.m+"'!")}}function Fc(t){t.B||t.w.b||(t.w.start(),Ge(t,"tokenChanged",t.W),Ke(t,"tokenChanged",t.W))}function Uc(t){Ge(t,"tokenChanged",t.W),t.w.stop()}function Vc(t,e){t.ma=e,xr(t,"_lat",e)}function qc(t){for(var e=[],n=0;n<t.O.length;n++)e.push(t.O[n](t));return $t(e).then(function(){return t})}function Bc(t){t.i&&!t.J&&(t.J=!0,rc(t.i,t))}function jc(t,e){Fr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,tenantId:e.tenantId||null,metadata:new kc(e.createdAt,e.lastLoginAt),providerData:[]}),t.a.b=t.tenantId}function Wc(){}function Kc(t){return Yt().then(function(){if(t.B)throw new Yr("app-deleted")})}function Qc(t){return F(t.providerData,function(t){return t.providerId})}function Hc(t,e){e&&(Gc(t,e.providerId),t.providerData.push(e))}function Gc(t,e){B(t.providerData,function(t){return t.providerId==e})}function zc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&xr(t,e,n)}function Yc(e,t){e!=t&&(Fr(e,{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,email:t.email,emailVerified:t.emailVerified,phoneNumber:t.phoneNumber,isAnonymous:t.isAnonymous,tenantId:t.tenantId,providerData:[]}),t.metadata?xr(e,"metadata",function(t){return new kc(t.a,t.b)}(t.metadata)):xr(e,"metadata",new kc),x(t.providerData,function(t){Hc(e,t)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(e.b,t.b),xr(e,"refreshToken",e.b.a))}function Xc(n){return n.G().then(function(t){var e=n.isAnonymous;return function(t,e){return Ns(t.a,us,{idToken:e}).then(_(t.zc,t))}(n,t).then(function(){return e||zc(n,"isAnonymous",!1),t})})}function Jc(t,e){e[Oa]&&t.ma!=e[Oa]&&(Cc(t.b,e),t.dispatchEvent(new Rc("tokenChanged")),Vc(t,e[Oa]),zc(t,"refreshToken",t.b.a))}function $c(t,e){return Xc(t).then(function(){if(V(Qc(t),e))return qc(t).then(function(){throw new Yr("provider-already-linked")})})}function Zc(t,e,n){return Ur({user:t,credential:vo(e),additionalUserInfo:e=Oi(e),operationType:n})}function th(t,e){return Jc(t,e),t.reload().then(function(){return t})}function eh(n,r,t,e,i){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(n.h&&!i)return Xt(n.h);var o=Ri(t.providerId),a=Ir(n.uid+":::"),s=null;(!_r()||ar())&&n.o&&t.isOAuthProvider&&(s=js(n.o,n.l,n.m,r,t,null,a,fl.SDK_VERSION||null,null,null,n.tenantId));var u=er(s,o&&o.Da,o&&o.Ca);return e=e().then(function(){if(rh(n),!i)return n.G().then(function(){})}).then(function(){return sc(n.i,u,r,t,a,!!s,n.tenantId)}).then(function(){return new jt(function(t,e){n.ja(r,null,new Yr("cancelled-popup-request"),n.g||null),n.f=t,n.v=e,n.g=a,n.c=hc(n.i,n,r,u,a)})}).then(function(t){return u&&tr(u),t?Ur(t):null}).s(function(t){throw u&&tr(u),t}),ih(n,e,i)}function nh(e,t,n,r,i){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(e.h&&!i)return Xt(e.h);var o=null,a=Ir(e.uid+":::");return r=r().then(function(){if(rh(e),!i)return e.G().then(function(){})}).then(function(){return e.ca=a,qc(e)}).then(function(t){return e.da&&(t=(t=e.da).b.set(sh,e.A(),t.a)),t}).then(function(){return cc(e.i,t,n,a,e.tenantId)}).s(function(t){if(o=t,e.da)return uh(e.da);throw o}).then(function(){if(o)throw o}),ih(e,r,i)}function rh(t){if(!t.i||!t.J){if(t.i&&!t.J)throw new Yr("internal-error");throw new Yr("auth-domain-config-required")}}function ih(t,e,n){var r=function(e,t,n){return e.h&&!n?(t.cancel(),Xt(e.h)):t.s(function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(e.h||e.dispatchEvent(new Rc("userInvalidated")),e.h=t),t})}(t,e,n);return t.I.push(r),r.ka(function(){q(t.I,r)}),r}function oh(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Oa]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-E())/1e3;var r=new Oc(e,n,t);return t.providerData&&x(t.providerData,function(t){t&&Hc(r,Ur(t))}),t.redirectEventId&&(r.ca=t.redirectEventId),r}function ah(t){this.a=t,this.b=Su()}pc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},pc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(gc(this,!0,null,t.a),Yt()):e.za(n,r)?function(e,t,n){n=n.za(t.c,t.b);var r=t.g,i=t.f,o=t.i,a=t.R(),s=!!t.c.match(/Redirect$/);n(r,i,a,o).then(function(t){gc(e,s,t,null)}).s(function(t){gc(e,s,null,t)})}(this,t,e):Xt(new Yr("invalid-auth-event")):(gc(this,!1,null,null),Yt())}else Xt(new Yr("invalid-auth-event"))},pc.prototype.oa=function(){var n=this;return new jt(function(t,e){n.b?n.b().then(t,e):(n.f.push(t),n.c.push(e),function(t){var e=new Yr("timeout");t.a&&t.a.cancel(),t.a=un(ac.get()).then(function(){t.b||(t.g=!0,gc(t,!0,null,e))})}(n))})},vc.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ja(t.c,null,t.a,t.b),Yt()):e.za(n,r)?function(t,e){var n=t.b,r=t.c;e.za(r,n)(t.g,t.f,t.R(),t.i).then(function(t){e.ja(r,t,null,n)}).s(function(t){e.ja(r,null,t,n)})}(t,e):Xt(new Yr("invalid-auth-event"))}else Xt(new Yr("invalid-auth-event"))},wc.prototype.confirm=function(t){return t=go(this.verificationId,t),this.a(t)},Ec.prototype.start=function(){this.a=this.c,function e(n,t){n.stop();n.b=un(Sc(n,t)).then(function(){return e=l.document,n=null,kr()||!e?Yt():new jt(function(t){n=function(){kr()&&(e.removeEventListener("visibilitychange",n,!1),t())},e.addEventListener("visibilitychange",n,!1)}).s(function(t){throw e.removeEventListener("visibilitychange",n,!1),t});var e,n}).then(function(){return n.h()}).then(function(){e(n,!0)}).s(function(t){n.i(t)&&e(n,!1)})}(this,!0)},Ec.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},Ic.prototype.A=function(){return{apiKey:this.f.c,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},Ic.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Xt(new Yr("user-token-expired")):t||!this.b||E()>this.c-3e4?this.a?Ac(this,{grant_type:"refresh_token",refresh_token:this.a}):Yt(null):Yt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},kc.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},S(Rc,Oe),S(Oc,nn),Oc.prototype.sa=function(t){this.ga=t,Fa(this.a,t)},Oc.prototype.ha=function(){return this.ga},Oc.prototype.Aa=function(){return W(this.P)},Oc.prototype.Ha=function(){this.w.b&&(this.w.stop(),this.w.start())},xr(Oc.prototype,"providerId","firebase"),(t=Oc.prototype).reload=function(){var t=this;return ih(this,Kc(this).then(function(){return Xc(t).then(function(){return qc(t)}).then(Wc)}))},t.dc=function(t){return this.G(t).then(function(t){return new Tc(t)})},t.G=function(t){var e=this;return ih(this,Kc(this).then(function(){return e.b.getToken(t)}).then(function(t){if(!t)throw new Yr("internal-error");return t.accessToken!=e.ma&&(Vc(e,t.accessToken),e.dispatchEvent(new Rc("tokenChanged"))),zc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.zc=function(t){if(!(t=t.users)||!t.length)throw new Yr("internal-error");jc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt,tenantId:t.tenantId});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?F(t,function(t){return new Dc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)Hc(this,e[n]);zc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.Ac=function(t){return Mr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.gb(t)},t.gb=function(t){var e=this,n=null;return ih(this,t.f(this.a,this.uid).then(function(t){return Jc(e,t),n=Zc(e,t,"reauthenticate"),e.h=null,e.reload()}).then(function(){return n}),!0)},t.rc=function(t){return Mr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.eb(t)},t.eb=function(e){var n=this,r=null;return ih(this,$c(this,e.providerId).then(function(){return n.G()}).then(function(t){return e.b(n.a,t)}).then(function(t){return r=Zc(n,t,"link"),th(n,t)}).then(function(){return r}))},t.sc=function(t,e){var n=this;return ih(this,$c(this,"phone").then(function(){return _c(xc(n),t,e,_(n.eb,n))}))},t.Bc=function(t,e){var n=this;return ih(this,Yt().then(function(){return _c(xc(n),t,e,_(n.gb,n))}),!0)},t.rb=function(e){var n=this;return ih(this,this.G().then(function(t){return n.a.rb(t,e)}).then(function(t){return Jc(n,t),n.reload()}))},t.Sc=function(e){var n=this;return ih(this,this.G().then(function(t){return e.b(n.a,t)}).then(function(t){return Jc(n,t),n.reload()}))},t.sb=function(e){var n=this;return ih(this,this.G().then(function(t){return n.a.sb(t,e)}).then(function(t){return Jc(n,t),n.reload()}))},t.tb=function(e){if(void 0===e.displayName&&void 0===e.photoURL)return Kc(this);var n=this;return ih(this,this.G().then(function(t){return n.a.tb(t,{displayName:e.displayName,photoUrl:e.photoURL})}).then(function(t){return Jc(n,t),zc(n,"displayName",t.displayName||null),zc(n,"photoURL",t.photoUrl||null),x(n.providerData,function(t){"password"===t.providerId&&(xr(t,"displayName",n.displayName),xr(t,"photoURL",n.photoURL))}),qc(n)}).then(Wc))},t.Qc=function(e){var n=this;return ih(this,Xc(this).then(function(t){return V(Qc(n),e)?function(t,e,n){return Ns(t,os,{idToken:e,deleteProvider:n})}(n.a,t,[e]).then(function(t){var e={};return x(t.providerUserInfo||[],function(t){e[t.providerId]=!0}),x(Qc(n),function(t){e[t]||Gc(n,t)}),e[mo.PROVIDER_ID]||xr(n,"phoneNumber",null),qc(n)}):qc(n).then(function(){throw new Yr("no-such-provider")})}))},t.delete=function(){var e=this;return ih(this,this.G().then(function(t){return Ns(e.a,is,{idToken:t})}).then(function(){e.dispatchEvent(new Rc("userDeleted"))})).then(function(){for(var t=0;t<e.I.length;t++)e.I[t].cancel("app-deleted");Pc(e,null),Lc(e,null),e.I=[],e.B=!0,Uc(e),xr(e,"refreshToken",null),e.i&&ic(e.i,e)})},t.xb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.ca||null)==e||"reauthViaRedirect"==t&&(this.ca||null)==e)},t.ja=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.za=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?_(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?_(this.Cb,this):"linkViaRedirect"==t&&(this.ca||null)==e?_(this.Bb,this):"reauthViaRedirect"==t&&(this.ca||null)==e?_(this.Cb,this):null},t.tc=function(t){var e=this;return eh(this,"linkViaPopup",t,function(){return $c(e,t.providerId).then(function(){return qc(e)})},!1)},t.Cc=function(t){return eh(this,"reauthViaPopup",t,function(){return Yt()},!0)},t.uc=function(t){var e=this;return nh(this,"linkViaRedirect",t,function(){return $c(e,t.providerId)},!1)},t.Dc=function(t){return nh(this,"reauthViaRedirect",t,function(){return Yt()},!0)},t.Bb=function(e,n,t,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return t=this.G().then(function(t){return Ja(i.a,{requestUri:e,postBody:r,sessionId:n,idToken:t})}).then(function(t){return o=Zc(i,t,"link"),th(i,t)}).then(function(){return o}),ih(this,t)},t.Cb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return ih(this,Yt().then(function(){return Wi($a(i.a,{requestUri:t,sessionId:e,postBody:r,tenantId:n}),i.uid)}).then(function(t){return o=Zc(i,t,"reauthenticate"),Jc(i,t),i.h=null,i.reload()}).then(function(){return o}),!0)},t.jb=function(e){var n=this,r=null;return ih(this,this.G().then(function(t){return r=t,void 0===e||Q(e)?{}:vi(new ui(e))}).then(function(t){return n.a.jb(r,t)}).then(function(t){if(n.email!=t)return n.reload()}).then(function(){}))},t.toJSON=function(){return this.A()},t.A=function(){var e={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.o,stsTokenManager:this.b.A(),redirectEventId:this.ca||null};return this.metadata&&z(e,this.metadata.A()),x(this.providerData,function(t){e.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(t))}),e};var sh={name:"redirectUser",C:"session"};function uh(t){return Nu(t.b,sh,t.a)}function ch(t){this.a=t,this.b=Su(),this.c=null,this.f=function(e){var n=fh("local"),r=fh("session"),i=fh("none");return function(n,r,i){var o=Cu(r,i),a=Iu(n,r.C);return n.get(r,i).then(function(t){var e=null;try{e=Sr(l.localStorage.getItem(o))}catch(t){}if(e&&!t)return l.localStorage.removeItem(o),n.set(r,e,i);e&&t&&"localStorage"!=a.type&&l.localStorage.removeItem(o)})}(e.b,n,e.a).then(function(){return e.b.get(r,e.a)}).then(function(t){return t?r:e.b.get(i,e.a).then(function(t){return t?i:e.b.get(n,e.a).then(function(t){return t?n:e.b.get(lh,e.a).then(function(t){return t?fh(t):n})})})}).then(function(t){return e.c=t,hh(e,t.C)}).s(function(){e.c||(e.c=n)})}(this),this.b.addListener(fh("local"),this.a,_(this.g,this))}function hh(t,e){var n,r=[];for(n in Tu)Tu[n]!==e&&r.push(Nu(t.b,fh(Tu[n]),t.a));return r.push(Nu(t.b,lh,t.a)),function(s){return new jt(function(n,e){var r=s.length,i=[];if(r)for(var t=function(t,e){r--,i[t]=e,0==r&&n(i)},o=function(t){e(t)},a=0;a<s.length;a++)Jt(s[a],T(t,a),o);else n(i)})}(r)}ch.prototype.g=function(){var e=this,n=fh("local");mh(this,function(){return Yt().then(function(){return e.c&&"local"!=e.c.C?e.b.get(n,e.a):null}).then(function(t){if(t)return hh(e,"local").then(function(){e.c=n})})})};var lh={name:"persistence",C:"session"};function fh(t){return{name:"authUser",C:t}}function ph(t,e){return mh(t,function(){return t.b.set(t.c,e.A(),t.a)})}function dh(t){return mh(t,function(){return Nu(t.b,t.c,t.a)})}function yh(t,e){return mh(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),oh(t||{})})})}function mh(t,e){return t.f=t.f.then(e,e),t.f}function gh(t){if(this.l=!1,xr(this,"settings",new bc),xr(this,"app",t),!Ih(this).options||!Ih(this).options.apiKey)throw new Yr("invalid-api-key");t=fl.SDK_VERSION?dr(fl.SDK_VERSION):null,this.b=new Da(Ih(this).options&&Ih(this).options.apiKey,Ni(Ii),t),this.O=[],this.m=[],this.J=[],this.Ub=fl.INTERNAL.createSubscribe(_(this.oc,this)),this.W=void 0,this.Vb=fl.INTERNAL.createSubscribe(_(this.pc,this)),Eh(this,null),this.h=new ch(Ih(this).options.apiKey+":"+Ih(this).name),this.w=new ah(Ih(this).options.apiKey+":"+Ih(this).name),this.Y=kh(this,function(n){var t=Ih(n).options.authDomain,e=function(e){var t=function(t,e){return t.b.get(sh,t.a).then(function(t){return t&&e&&(t.authDomain=e),oh(t||{})})}(e.w,Ih(e).options.authDomain).then(function(t){return(e.B=t)&&(t.da=e.w),uh(e.w)});return kh(e,t)}(n).then(function(){return yh(n.h,t)}).then(function(e){return e?(e.da=n.w,n.B&&(n.B.ca||null)==(e.ca||null)?e:e.reload().then(function(){return ph(n.h,e).then(function(){return e})}).s(function(t){return"auth/network-request-failed"==t.code?e:dh(n.h)})):null}).then(function(t){Eh(n,t||null)});return kh(n,e)}(this)),this.i=kh(this,function(e){return e.Y.then(function(){return _h(e)}).s(function(){}).then(function(){if(!e.l)return e.ma()}).s(function(){}).then(function(){if(!e.l){e.ga=!0;var t=e.h;t.b.addListener(fh("local"),t.a,e.ma)}})}(this)),this.ga=!1,this.ma=_(this.Nc,this),this.ub=_(this.aa,this),this.ua=_(this.bc,this),this.va=_(this.mc,this),this.Ha=_(this.nc,this),this.a=null,function(e){var n=Ih(e).options.authDomain,r=Ih(e).options.apiKey;n&&vr()&&(e.Tb=e.Y.then(function(){if(!e.l){if(e.a=fc(n,r,Ih(e).name),rc(e.a,e),Ch(e)&&Bc(Ch(e)),e.B){Bc(e.B);var t=e.B;t.sa(e.ha()),Pc(t,e),Mc(t=e.B,e.I),Lc(t,e),e.B=null}return e.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=_(this.delete,this),this.INTERNAL.logFramework=_(this.vc,this),this.o=0,nn.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ha()},set:function(t){this.sa(t)},enumerable:!1}),t.Z=null,Object.defineProperty(t,"ti",{get:function(){return this.R()},set:function(t){this.nb(t)},enumerable:!1}),t.P=null}(this),this.I=[]}function vh(t){Oe.call(this,"languageCodeChanged"),this.g=t}function bh(t){Oe.call(this,"frameworkChanged"),this.c=t}function wh(t){return t.Tb||Xt(new Yr("auth-domain-config-required"))}function _h(t){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));var e=wh(t).then(function(){return t.a.oa()}).then(function(t){return t?Ur(t):null});return kh(t,e)}function Th(e,t){var n={};return n.apiKey=Ih(e).options.apiKey,n.authDomain=Ih(e).options.authDomain,n.appName=Ih(e).name,e.Y.then(function(){return function(t,e,n,r){var i=new Oc(t,e);return n&&(i.da=n),r&&Mc(i,r),i.reload().then(function(){return i})}(n,t,e.w,e.Aa())}).then(function(t){return Ch(e)&&t.uid==Ch(e).uid?Yc(Ch(e),t):(Eh(e,t),Bc(t)),e.aa(t)}).then(function(){Ah(e)})}function Eh(t,e){Ch(t)&&(function(t,e){B(t.O,function(t){return t==e})}(Ch(t),t.ub),Ge(Ch(t),"tokenChanged",t.ua),Ge(Ch(t),"userDeleted",t.va),Ge(Ch(t),"userInvalidated",t.Ha),Uc(Ch(t))),e&&(e.O.push(t.ub),Ke(e,"tokenChanged",t.ua),Ke(e,"userDeleted",t.va),Ke(e,"userInvalidated",t.Ha),0<t.o&&Fc(e)),xr(t,"currentUser",e),e&&(e.sa(t.ha()),Pc(e,t),Mc(e,t.I),Lc(e,t))}function Sh(e,t){var n=null,r=null;return kh(e,t.then(function(t){return n=vo(t),r=Oi(t),Th(e,t)}).then(function(){return Ur({user:Ch(e),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function Ih(t){return t.app}function Ch(t){return t.currentUser}function Nh(t){return Ch(t)&&Ch(t)._lat||null}function Ah(t){if(t.ga){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](Nh(t));if(t.W!==t.getUid()&&t.J.length)for(t.W=t.getUid(),e=0;e<t.J.length;e++)t.J[e]&&t.J[e](Nh(t))}}function kh(t,e){return t.O.push(e),e.ka(function(){q(t.O,e)}),e}function Dh(){}function Rh(){this.a={},this.b=1e12}ch.prototype.mb=function(e){var n=null,r=this;return function(t){var e=new Yr("invalid-persistence-type"),n=new Yr("unsupported-persistence-type");t:{for(r in Tu)if(Tu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(ur()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!gr()&&"none"!==t)throw n}}(e),mh(this,function(){return e!=r.c.C?r.b.get(r.c,r.a).then(function(t){return n=t,hh(r,e)}).then(function(){if(r.c=fh(e),n)return r.b.set(r.c,n,r.a)}):Yt()})},S(gh,nn),S(vh,Oe),S(bh,Oe),(t=gh.prototype).mb=function(t){return t=this.h.mb(t),kh(this,t)},t.sa=function(t){this.Z===t||this.l||(this.Z=t,Fa(this.b,this.Z),this.dispatchEvent(new vh(this.ha())))},t.ha=function(){return this.Z},t.Tc=function(){var t=l.navigator;this.sa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.vc=function(t){this.I.push(t),Ua(this.b,fl.SDK_VERSION?dr(fl.SDK_VERSION,this.I):null),this.dispatchEvent(new bh(this.I))},t.Aa=function(){return W(this.I)},t.nb=function(t){this.P===t||this.l||(this.P=t,this.b.b=this.P)},t.R=function(){return this.P},t.toJSON=function(){return{apiKey:Ih(this).options.apiKey,authDomain:Ih(this).options.authDomain,appName:Ih(this).name,currentUser:Ch(this)&&Ch(this).A()}},t.xb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ja=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.za=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?_(this.ac,this):null},t.ac=function(t,e,n,r){var i=this;t={requestUri:t,postBody:r,sessionId:e,tenantId:n},this.c&&(this.c.cancel(),this.c=null);var o=null,a=null,s=Xa(i.b,t).then(function(t){return o=vo(t),a=Oi(t),t});return kh(this,t=i.Y.then(function(){return s}).then(function(t){return Th(i,t)}).then(function(){return Ur({user:Ch(i),credential:o,additionalUserInfo:a,operationType:"signIn"})}))},t.Lc=function(e){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));var n=this,t=Ri(e.providerId),r=Ir(),i=null;(!_r()||ar())&&Ih(this).options.authDomain&&e.isOAuthProvider&&(i=js(Ih(this).options.authDomain,Ih(this).options.apiKey,Ih(this).name,"signInViaPopup",e,null,r,fl.SDK_VERSION||null,null,null,this.R()));var o=er(i,t&&t.Da,t&&t.Ca);return kh(this,t=wh(this).then(function(t){return sc(t,o,"signInViaPopup",e,r,!!i,n.R())}).then(function(){return new jt(function(t,e){n.ja("signInViaPopup",null,new Yr("cancelled-popup-request"),n.g),n.f=t,n.v=e,n.g=r,n.c=hc(n.a,n,"signInViaPopup",o,r)})}).then(function(t){return o&&tr(o),t?Ur(t):null}).s(function(t){throw o&&tr(o),t}))},t.Mc=function(t){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));var e=this;return kh(this,wh(this).then(function(){return function(t){return mh(t,function(){return t.b.set(lh,t.c.C,t.a)})}(e.h)}).then(function(){return cc(e.a,"signInViaRedirect",t,void 0,e.R())}))},t.oa=function(){var e=this;return _h(this).then(function(t){return e.a&&yc(e.a.b),t}).s(function(t){throw e.a&&yc(e.a.b),t})},t.Rc=function(t){if(!t)return Xt(new Yr("null-user"));if(this.P!=t.tenantId)return Xt(new Yr("tenant-id-mismatch"));var e=this,n={};n.apiKey=Ih(this).options.apiKey,n.authDomain=Ih(this).options.authDomain,n.appName=Ih(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.o,appName:t.m};var i=t.b,o={};return o[Oa]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-E())/1e3,e=new Oc(e,o),n&&(e.da=n),r&&Mc(e,r),Yc(e,t),e}(t,n,e.w,e.Aa());return kh(this,this.i.then(function(){if(Ih(e).options.apiKey!=t.l)return r.reload()}).then(function(){return Ch(e)&&t.uid==Ch(e).uid?(Yc(Ch(e),t),e.aa(t)):(Eh(e,r),Bc(r),e.aa(r))}).then(function(){Ah(e)}))},t.pb=function(){var t=this,e=this.i.then(function(){return t.a&&yc(t.a.b),Ch(t)?(Eh(t,null),dh(t.h).then(function(){Ah(t)})):Yt()});return kh(this,e)},t.Nc=function(){var r=this;return yh(this.h,Ih(this).options.authDomain).then(function(t){if(!r.l){var e;if(e=Ch(r)&&t){e=Ch(r).uid;var n=t.uid;e=null!=e&&""!==e&&null!=n&&""!==n&&e==n}if(e)return Yc(Ch(r),t),Ch(r).G();(Ch(r)||t)&&(Eh(r,t),t&&(Bc(t),t.da=r.w),r.a&&rc(r.a,r),Ah(r))}})},t.aa=function(t){return ph(this.h,t)},t.bc=function(){Ah(this),this.aa(Ch(this))},t.mc=function(){this.pb()},t.nc=function(){this.pb()},t.oc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(Ch(e))})},t.pc=function(t){var e=this;!function(t,e){t.J.push(e),kh(t,t.i.then(function(){!t.l&&V(t.J,e)&&t.W!==t.getUid()&&(t.W=t.getUid(),e(Nh(t)))}))}(this,function(){t.next(Ch(e))})},t.xc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then(function(){m(t)?t(Ch(r)):m(t.next)&&t.next(Ch(r))}),this.Ub(t,e,n)},t.wc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then(function(){r.W=r.getUid(),m(t)?t(Ch(r)):m(t.next)&&t.next(Ch(r))}),this.Vb(t,e,n)},t.cc=function(t){var e=this,n=this.i.then(function(){return Ch(e)?Ch(e).G(t).then(function(t){return{accessToken:t}}):null});return kh(this,n)},t.Hc=function(t){var n=this;return this.i.then(function(){return Sh(n,Ns(n.b,Ts,{token:t}))}).then(function(t){var e=t.user;return zc(e,"isAnonymous",!1),n.aa(e),t})},t.Ic=function(t,e){var n=this;return this.i.then(function(){return Sh(n,Ns(n.b,Es,{email:t,password:e}))})},t.Xb=function(t,e){var n=this;return this.i.then(function(){return Sh(n,Ns(n.b,ns,{email:t,password:e}))})},t.Ra=function(t){var e=this;return this.i.then(function(){return Sh(e,t.na(e.b))})},t.Gc=function(t){return Mr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Ra(t)},t.ob=function(){var n=this;return this.i.then(function(){var t=Ch(n);return t&&t.isAnonymous?Ur({user:t,credential:null,additionalUserInfo:Ur({providerId:null,isNewUser:!1}),operationType:"signIn"}):Sh(n,n.b.ob()).then(function(t){var e=t.user;return zc(e,"isAnonymous",!0),n.aa(e),t})})},t.getUid=function(){return Ch(this)&&Ch(this).uid||null},t.Wb=function(t){this.addAuthTokenListener(t),this.o++,0<this.o&&Ch(this)&&Fc(Ch(this))},t.Ec=function(e){var n=this;x(this.m,function(t){t==e&&n.o--}),this.o<0&&(this.o=0),0==this.o&&Ch(this)&&Uc(Ch(this)),this.removeAuthTokenListener(e)},t.addAuthTokenListener=function(t){var e=this;this.m.push(t),kh(this,this.i.then(function(){e.l||V(e.m,t)&&t(Nh(e))}))},t.removeAuthTokenListener=function(e){B(this.m,function(t){return t==e})},t.delete=function(){this.l=!0;for(var t=0;t<this.O.length;t++)this.O[t].cancel("app-deleted");return this.O=[],this.h&&(t=this.h).b.removeListener(fh("local"),t.a,this.ma),this.a&&(ic(this.a,this),yc(this.a.b)),Promise.resolve()},t.$b=function(t){return kh(this,function(t,e){return Ns(t,rs,{identifier:e,continueUri:br()?Jn():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.b,t))},t.qc=function(t){return!!lo(t)},t.lb=function(e,n){var r=this;return kh(this,Yt().then(function(){var t=new ui(n);if(!t.c)throw new Yr("argument-error",li+" must be true when sending sign in link to email");return vi(t)}).then(function(t){return r.b.lb(e,t)}).then(function(){}))},t.Uc=function(t){return this.Ka(t).then(function(t){return t.data.email})},t.$a=function(t,e){return kh(this,this.b.$a(t,e).then(function(){}))},t.Ka=function(t){return kh(this,this.b.Ka(t).then(function(t){return new qr(t)}))},t.Xa=function(t){return kh(this,this.b.Xa(t).then(function(){}))},t.kb=function(e,t){var n=this;return kh(this,Yt().then(function(){return void 0===t||Q(t)?{}:vi(new ui(t))}).then(function(t){return n.b.kb(e,t)}).then(function(){}))},t.Kc=function(t,e){return kh(this,_c(this,t,e,_(this.Ra,this)))},t.Jc=function(n,r){var i=this;return kh(this,Yt().then(function(){var t=r||Jn(),e=ho(n,t);if(!(t=lo(t)))throw new Yr("argument-error","Invalid email link!");if(t.tenantId!==i.R())throw new Yr("tenant-id-mismatch");return i.Ra(e)}))},Dh.prototype.render=function(){},Dh.prototype.reset=function(){},Dh.prototype.getResponse=function(){},Dh.prototype.execute=function(){};var Oh=null;function Ph(t,e){return(e=Mh(e))&&t.a[e]||null}function Mh(t){return(t=void 0===t?1e12:t)?t.toString():null}function Lh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=qn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():Ke(this.f,"click",this.i)}function xh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Fh(){}Rh.prototype.render=function(t,e){return this.a[this.b.toString()]=new Lh(t,e),this.b++},Rh.prototype.reset=function(t){var e=Ph(this,t);t=Mh(t),e&&t&&(e.delete(),delete this.a[t])},Rh.prototype.getResponse=function(t){return(t=Ph(this,t))?t.getResponse():null},Rh.prototype.execute=function(t){(t=Ph(this,t))&&t.execute()},Lh.prototype.getResponse=function(){return xh(this),this.b},Lh.prototype.execute=function(){xh(this);var n=this;this.a||(this.a=setTimeout(function(){n.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var t=n.c.callback,e=n.c["expired-callback"];if(t)try{t(n.b)}catch(t){}n.a=setTimeout(function(){if(n.a=null,n.b=null,e)try{e()}catch(t){}n.h&&n.execute()},6e4)},500))},Lh.prototype.delete=function(){xh(this),this.g=!0,clearTimeout(this.a),this.a=null,Ge(this.f,"click",this.i)},Fh.prototype.g=function(){return Yt(Oh=Oh||new Rh)},Fh.prototype.c=function(){};var Uh=null;function Vh(){this.b=l.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var qh=new Y($,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Bh=new Ar(3e4,6e4);Vh.prototype.g=function(i){var o=this;return new jt(function(t,e){var r=setTimeout(function(){e(new Yr("network-request-failed"))},Bh.get());!l.grecaptcha||i!==o.f&&!o.b?(l[o.a]=function(){if(l.grecaptcha){o.f=i;var n=l.grecaptcha.render;l.grecaptcha.render=function(t,e){return t=n(t,e),o.b++,t},clearTimeout(r),t(l.grecaptcha)}else clearTimeout(r),e(new Yr("internal-error"));delete l[o.a]},Yt(Ea(nt(qh,{onload:o.a,hl:i||""}))).s(function(){clearTimeout(r),e(new Yr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(r),t(l.grecaptcha))})},Vh.prototype.c=function(){this.b--};var jh=null;function Wh(t,e,n,r,i,o,a){if(xr(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.u=e,this.g=null,a=a?Uh=Uh||new Fh:jh=jh||new Vh,this.m=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Hh])throw new Yr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Gh],!l.document)throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!qn(e)||!this.i&&qn(e).hasChildNodes())throw new Yr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.o=new Da(t,o||null,i||null),this.v=r||function(){return null};var s=this;this.l=[];var u=this.a[Kh];this.a[Kh]=function(t){if(zh(s,t),"function"==typeof u)u(t);else if("string"==typeof u){var e=mr(u,l);"function"==typeof e&&e(t)}};var c=this.a[Qh];this.a[Qh]=function(){if(zh(s,null),"function"==typeof c)c();else if("string"==typeof c){var t=mr(c,l);"function"==typeof t&&t()}}}var Kh="callback",Qh="expired-callback",Hh="sitekey",Gh="size";function zh(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(t){}}function Yh(t,e){return t.h.push(e),e.ka(function(){q(t.h,e)}),e}function Xh(t){if(t.B)throw new Yr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Jh(t,e,n){var r=!1;try{this.b=n||fl.app()}catch(t){throw new Yr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new Yr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().Aa()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=fl.SDK_VERSION?dr(fl.SDK_VERSION,o):null,Wh.call(this,n,t,e,function(){try{var e=i.b.auth().ha()}catch(t){e=null}return e},o,Ni(Ii),r)}function $h(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new Yr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].N(n[i])&&!o){if(e=e[i],i<0||i>=Zh.length)throw new Yr("internal-error","Argument validator received an unsupported number of arguments.");n=Zh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.M+".";break t}r=null}}if(r)throw new Yr("argument-error",t+" failed: "+r)}(t=Wh.prototype).Ba=function(){var e=this;return this.f?this.f:this.f=Yh(this,Yt().then(function(){if(br()&&!sr())return ir();throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return e.m.g(e.v())}).then(function(t){return e.g=t,Ns(e.o,ps,{})}).then(function(t){e.a[Hh]=t.recaptchaSiteKey}).s(function(t){throw e.f=null,t}))},t.render=function(){Xh(this);var n=this;return Yh(this,this.Ba().then(function(){if(null===n.c){var t=n.u;if(!n.i){var e=qn(t);t=Wn("DIV"),e.appendChild(t)}n.c=n.g.render(t,n.a)}return n.c}))},t.verify=function(){Xh(this);var i=this;return Yh(this,this.render().then(function(r){return new jt(function(e){var t=i.g.getResponse(r);if(t)e(t);else{var n=function(t){t&&(function(t,e){B(t.l,function(t){return t==e})}(i,n),e(t))};i.l.push(n),i.i&&i.g.execute(i.c)}})}))},t.reset=function(){Xh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){Xh(this),this.B=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=qn(this.u);for(var e;e=t.firstChild;)t.removeChild(e)}},S(Jh,Wh);var Zh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function tl(t,e){return{name:t||"",M:"a valid string",optional:!!e,N:h}}function el(t,e){return{name:t||"",M:"a boolean",optional:!!e,N:n}}function nl(t,e){return{name:t||"",M:"a valid object",optional:!!e,N:g}}function rl(t,e){return{name:t||"",M:"a function",optional:!!e,N:m}}function il(t,e){return{name:t||"",M:"null",optional:!!e,N:i}}function ol(n){return{name:n?n+"Credential":"credential",M:n?"a valid "+n+" credential":"a valid credential",optional:!1,N:function(t){if(!t)return!1;var e=!n||t.providerId===n;return!(!t.na||!e)}}}function al(){return{name:"applicationVerifier",M:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,N:function(t){return!!(t&&h(t.type)&&m(t.verify))}}}function sl(e,n,t,r){return{name:t||"",M:e.M+" or "+n.M,optional:!!r,N:function(t){return e.N(t)||n.N(t)}}}function ul(t,e){for(var n in e){var r=e[n].name;t[r]=ll(r,t[n],e[n].j)}}function cl(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:T(function(t){return this[t]},n),set:T(function(t,e,n,r){$h(t,[n],[r],!0),this[e]=r},r,n,e[n].Ya),enumerable:!0})}}function hl(t,e,n,r){t[e]=ll(e,n,r)}function ll(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return $h(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}ul(gh.prototype,{Xa:{name:"applyActionCode",j:[tl("code")]},Ka:{name:"checkActionCode",j:[tl("code")]},$a:{name:"confirmPasswordReset",j:[tl("code"),tl("newPassword")]},Xb:{name:"createUserWithEmailAndPassword",j:[tl("email"),tl("password")]},$b:{name:"fetchSignInMethodsForEmail",j:[tl("email")]},oa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[tl("emailLink")]},wc:{name:"onAuthStateChanged",j:[sl(nl(),rl(),"nextOrObserver"),rl("opt_error",!0),rl("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[sl(nl(),rl(),"nextOrObserver"),rl("opt_error",!0),rl("opt_completed",!0)]},kb:{name:"sendPasswordResetEmail",j:[tl("email"),sl(nl("opt_actionCodeSettings",!0),il(null,!0),"opt_actionCodeSettings",!0)]},lb:{name:"sendSignInLinkToEmail",j:[tl("email"),nl("actionCodeSettings")]},mb:{name:"setPersistence",j:[tl("persistence")]},Gc:{name:"signInAndRetrieveDataWithCredential",j:[ol()]},ob:{name:"signInAnonymously",j:[]},Ra:{name:"signInWithCredential",j:[ol()]},Hc:{name:"signInWithCustomToken",j:[tl("token")]},Ic:{name:"signInWithEmailAndPassword",j:[tl("email"),tl("password")]},Jc:{name:"signInWithEmailLink",j:[tl("email"),tl("emailLink",!0)]},Kc:{name:"signInWithPhoneNumber",j:[tl("phoneNumber"),al()]},Lc:{name:"signInWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"signInWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Rc:{name:"updateCurrentUser",j:[sl({name:"user",M:"an instance of Firebase User",optional:!1,N:function(t){return!!(t&&t instanceof Oc)}},il(),"user")]},pb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[tl(null,!0)]},Tc:{name:"useDeviceLanguage",j:[]},Uc:{name:"verifyPasswordResetCode",j:[tl("code")]}}),cl(gh.prototype,{lc:{name:"languageCode",Ya:sl(tl(),il(),"languageCode")},ti:{name:"tenantId",Ya:sl(tl(),il(),"tenantId")}}),(gh.Persistence=Tu).LOCAL="local",gh.Persistence.SESSION="session",gh.Persistence.NONE="none",ul(Oc.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[el("opt_forceRefresh",!0)]},G:{name:"getIdToken",j:[el("opt_forceRefresh",!0)]},rc:{name:"linkAndRetrieveDataWithCredential",j:[ol()]},eb:{name:"linkWithCredential",j:[ol()]},sc:{name:"linkWithPhoneNumber",j:[tl("phoneNumber"),al()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateAndRetrieveDataWithCredential",j:[ol()]},gb:{name:"reauthenticateWithCredential",j:[ol()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[tl("phoneNumber"),al()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},jb:{name:"sendEmailVerification",j:[sl(nl("opt_actionCodeSettings",!0),il(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[tl(null,!0)]},Qc:{name:"unlink",j:[tl("provider")]},rb:{name:"updateEmail",j:[tl("email")]},sb:{name:"updatePassword",j:[tl("password")]},Sc:{name:"updatePhoneNumber",j:[ol("phone")]},tb:{name:"updateProfile",j:[nl("profile")]}}),ul(Rh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ul(Dh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ul(jt.prototype,{ka:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),cl(bc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",Ya:el("appVerificationDisabledForTesting")}}),ul(wc.prototype,{confirm:{name:"confirm",j:[tl("verificationCode")]}}),hl(ji,"fromJSON",function(t){t=h(t)?JSON.parse(t):t;for(var e,n=[Yi,uo,po,Hi],r=0;r<n.length;r++)if(e=n[r](t))return e;return null},[sl(tl(),nl(),"json")]),hl(co,"credential",function(t,e){return new so(t,e)},[tl("email"),tl("password")]),ul(so.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Zi.prototype,{wa:{name:"addScope",j:[tl("scope")]},Ea:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(Zi,"credential",to,[sl(tl(),nl(),"token")]),hl(co,"credentialWithLink",ho,[tl("email"),tl("emailLink")]),ul(eo.prototype,{wa:{name:"addScope",j:[tl("scope")]},Ea:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(eo,"credential",no,[sl(tl(),nl(),"token")]),ul(ro.prototype,{wa:{name:"addScope",j:[tl("scope")]},Ea:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(ro,"credential",io,[sl(tl(),sl(nl(),il()),"idToken"),sl(tl(),il(),"accessToken",!0)]),ul(oo.prototype,{Ea:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(oo,"credential",ao,[sl(tl(),nl(),"token"),tl("secret",!0)]),ul($i.prototype,{wa:{name:"addScope",j:[tl("scope")]},credential:{name:"credential",j:[sl(tl(),sl(nl(),il()),"optionsOrIdToken"),sl(tl(),il(),"accessToken",!0)]},Ea:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),ul(Gi.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Ki.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),hl(mo,"credential",go,[tl("verificationId"),tl("verificationCode")]),ul(mo.prototype,{Va:{name:"verifyPhoneNumber",j:[tl("phoneNumber"),al()]}}),ul(fo.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Yr.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Co.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Io.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Jh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),hl(Zr,"parseLink",si,[tl("link")]),function(){if(void 0===fl||!fl.INTERNAL||!fl.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Br,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:gh,AuthCredential:ji,Error:Yr};hl(t,"EmailAuthProvider",co,[]),hl(t,"FacebookAuthProvider",Zi,[]),hl(t,"GithubAuthProvider",eo,[]),hl(t,"GoogleAuthProvider",ro,[]),hl(t,"TwitterAuthProvider",oo,[]),hl(t,"OAuthProvider",$i,[tl("providerId")]),hl(t,"SAMLAuthProvider",Ji,[tl("providerId")]),hl(t,"PhoneAuthProvider",mo,[{name:"auth",M:"an instance of Firebase Auth",optional:!0,N:function(t){return!!(t&&t instanceof gh)}}]),hl(t,"RecaptchaVerifier",Jh,[sl(tl(),{name:"",M:"an HTML element",optional:!1,N:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),nl("recaptchaParameters",!0),{name:"app",M:"an instance of Firebase App",optional:!0,N:function(t){return!!(t&&t instanceof fl.app.App)}}]),hl(t,"ActionCodeURL",Zr,[]),fl.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:_((t=new gh(t)).getUid,t),getToken:_(t.cc,t),addAuthTokenListener:_(t.Wb,t),removeAuthTokenListener:_(t.Ec,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),fl.INTERNAL.extendNamespace({User:Oc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var ys=(ms.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Pa(e))},ms.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Oa(e)},ms.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},ms.prototype.prefixedName_=function(t){return this.prefix_+t},ms.prototype.toString=function(){return this.domStorage_.toString()},ms);function ms(t){this.domStorage_=t,this.prefix_="firebase:"}var gs=(vs.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},vs.prototype.get=function(t){return La(this.cache_,t)?this.cache_[t]:null},vs.prototype.remove=function(t){delete this.cache_[t]},vs);function vs(){this.cache_={},this.isInMemoryStorage=!0}function bs(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new ys(e)}}catch(t){}return new gs}function ws(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;ya(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),n=new Va;n.update(e);var r=n.digest();return ga.encodeByteArray(r)}function _s(t,e){ya(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(Ms.logLevel=Xa.VERBOSE,Fs=Ms.log.bind(Ms),e&&Ps.set("logging_enabled",!0)):"function"==typeof t?Fs=t:(Fs=null,Ps.remove("logging_enabled"))}function Ts(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===Us&&(Us=!1,null===Fs&&!0===Ps.get("logging_enabled")&&_s(!0)),Fs){var n=xs.apply(null,t);Fs(n)}}function Es(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ts.apply(void 0,ha([n],t))}}function Ss(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+xs.apply(void 0,ha(t));Ms.error(n)}function Is(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+xs.apply(void 0,ha(t));throw Ms.error(n),new Error(n)}function Cs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+xs.apply(void 0,ha(t));Ms.warn(n)}function Ns(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)}function As(t,e){return t===e?0:t<e?-1:1}function ks(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Pa(e))}function Ds(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)n<i+e?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r}var Rs,Os=bs("localStorage"),Ps=bs("sessionStorage"),Ms=new ns("@firebase/database"),Ls=(Rs=1,function(){return Rs++}),xs=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=xs.apply(null,t[r]):"object"==typeof t[r]?n+=Pa(t[r]):n+=t[r],n+=" ";return n},Fs=null,Us=!0,Vs="[MIN_NAME]",qs="[MAX_NAME]",Bs=function(t,e){if(t===e)return 0;if(t===Vs||e===qs)return-1;if(e===Vs||t===qs)return 1;var n=zs(t),r=zs(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},js=function(t){if("object"!=typeof t||null===t)return Pa(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=Pa(e[i]),r+=":",r+=js(t[e[i]]);return r+="}"};function Ws(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}function Ks(t){var e,n,r,i,o,a,s;for(ya(!Ns(t),"Invalid JSON number"),0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse(),s=a.join("");var u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()}function Qs(t){try{t()}catch(e){setTimeout(function(){var t=e.stack||"";throw Cs("Exception was thrown by user callback.",t),e},Math.floor(0))}}function Hs(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n}var Gs=new RegExp("^-?(0*)\\d{1,10}$"),zs=function(t){if(Gs.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},Ys=(Object.defineProperty(Xs,"Empty",{get:function(){return new Xs("")},enumerable:!0,configurable:!0}),Xs.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},Xs.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},Xs.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new Xs(this.pieces_,t)},Xs.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},Xs.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},Xs.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},Xs.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},Xs.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],e=this.pieceNum_;e<this.pieces_.length-1;e++)t.push(this.pieces_[e]);return new Xs(t,0)},Xs.prototype.child=function(t){for(var e=[],n=this.pieceNum_;n<this.pieces_.length;n++)e.push(this.pieces_[n]);if(t instanceof Xs)for(n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{var r=t.split("/");for(n=0;n<r.length;n++)0<r[n].length&&e.push(r[n])}return new Xs(e,0)},Xs.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},Xs.relativePath=function(t,e){var n=t.getFront(),r=e.getFront();if(null===n)return e;if(n===r)return Xs.relativePath(t.popFront(),e.popFront());throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")},Xs.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=Bs(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},Xs.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},Xs.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},Xs);function Xs(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}var Js=(Object.defineProperty($s,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty($s,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),$s.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=Ya(t),this.checkValid_()},$s.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=Ya(t),0<this.parts_.length&&(this.byteLength_-=1)},$s.prototype.checkValid_=function(){if(this.byteLength_>$s.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+$s.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>$s.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+$s.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},$s.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},$s);function $s(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Ya(this.parts_[n]);this.checkValid_()}var Zs="firebaseio.com",tu="websocket",eu="long_polling",nu=(ru.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},ru.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},ru.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},ru.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},ru.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Os.set("host:"+this.host,this.internalHost))},ru.prototype.connectionURL=function(t,e){var n;if(ya("string"==typeof t,"typeof type must == string"),ya("object"==typeof e,"typeof params must == object"),t===tu)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==eu)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return Ws(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},ru.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},ru.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},ru);function ru(t,e,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=Os.get("host:"+t)||this.host}function iu(t){var e=mu(t),n=e.namespace;"firebase"===e.domain&&Is(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||Is("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Cs("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new nu(e.host,e.secure,n,r,"",n!=e.subdomain),path:new Ys(e.pathString)}}function ou(t){return"string"==typeof t&&0!==t.length&&!gu.test(t)}function au(t){return"string"==typeof t&&0!==t.length&&!vu.test(t)}function su(t){return null===t||"string"==typeof t||"number"==typeof t&&!Ns(t)||t&&"object"==typeof t&&La(t,".sv")}function uu(t,e,n,r,i){i&&void 0===n||wu(Ha(t,e,i),n,r)}function cu(t,e,n,r,i){if(!i||void 0!==n){var o=Ha(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];Ws(n,function(t,e){var n=new Ys(t);if(wu(o,e,r.child(n)),".priority"===n.getBack()&&!su(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!ou(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(Ys.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}}function hu(t,e,n,r){if(!r||void 0!==n){if(Ns(n))throw new Error(Ha(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!su(n))throw new Error(Ha(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function lu(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Ha(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}function fu(t,e,n,r){if(!(r&&void 0===n||ou(n)))throw new Error(Ha(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function pu(t,e,n,r){if(!(r&&void 0===n||au(n)))throw new Error(Ha(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')}function du(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")}function yu(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!ou(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return t=t&&t.replace(/^\/*\.info(\/|$)/,"/"),au(t)}(r))throw new Error(Ha(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}var mu=function(t){var e="",n="",r="",i="",o="",a=!0,s="https",u=443;if("string"==typeof t){var c=t.indexOf("//");0<=c&&(s=t.substring(0,c-1),t=t.substring(c+2));var h=t.indexOf("/");-1===h&&(h=t.length);var l=t.indexOf("?");-1===l&&(l=t.length),e=t.substring(0,Math.min(h,l)),h<l&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(h,l)));var f=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=ua(t.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var s=a.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Cs("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,l)));0<=(c=e.indexOf(":"))?(a="https"===s||"wss"===s,u=parseInt(e.substring(c+1),10)):c=t.length;var p=e.split(".");3===p.length?(n=p[1],o=r=p[0].toLowerCase()):2===p.length?n=p[0]:"localhost"===p[0].slice(0,c).toLowerCase()&&(n="localhost"),"ns"in f&&(o=f.ns)}return{host:e,port:u,domain:n,subdomain:r,secure:a,scheme:s,pathString:i,namespace:o}},gu=/[\[\].#$\/\u0000-\u001F\u007F]/,vu=/[\[\].#$\u0000-\u001F\u007F]/,bu=10485760,wu=function(n,t,e){var r=e instanceof Ys?new Js(e,n):e;if(void 0===t)throw new Error(n+"contains undefined "+r.toErrorString());if("function"==typeof t)throw new Error(n+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(Ns(t))throw new Error(n+"contains "+t.toString()+" "+r.toErrorString());if("string"==typeof t&&t.length>bu/3&&Ya(t)>bu)throw new Error(n+"contains a string greater than "+bu+" utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(Ws(t,function(t,e){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!ou(t)))throw new Error(n+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),wu(n,e,r),r.pop()}),i&&o)throw new Error(n+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},_u=(Tu.prototype.cancel=function(t){Qa("OnDisconnect.cancel",0,1,arguments.length),Ga("OnDisconnect.cancel",1,t,!0);var e=new wa;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},Tu.prototype.remove=function(t){Qa("OnDisconnect.remove",0,1,arguments.length),du("OnDisconnect.remove",this.path_),Ga("OnDisconnect.remove",1,t,!0);var e=new wa;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},Tu.prototype.set=function(t,e){Qa("OnDisconnect.set",1,2,arguments.length),du("OnDisconnect.set",this.path_),uu("OnDisconnect.set",1,t,this.path_,!1),Ga("OnDisconnect.set",2,e,!0);var n=new wa;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},Tu.prototype.setWithPriority=function(t,e,n){Qa("OnDisconnect.setWithPriority",2,3,arguments.length),du("OnDisconnect.setWithPriority",this.path_),uu("OnDisconnect.setWithPriority",1,t,this.path_,!1),hu("OnDisconnect.setWithPriority",2,e,!1),Ga("OnDisconnect.setWithPriority",3,n,!0);var r=new wa;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},Tu.prototype.update=function(t,e){if(Qa("OnDisconnect.update",1,2,arguments.length),du("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Cs("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}cu("OnDisconnect.update",1,t,this.path_,!1),Ga("OnDisconnect.update",2,e,!0);var i=new wa;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},Tu);function Tu(t,e){this.repo_=t,this.path_=e}var Eu=(Su.prototype.toJSON=function(){return Qa("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},Su);function Su(t,e){this.committed=t,this.snapshot=e}var Iu,Cu,Nu,Au=(Iu="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Cu=0,Nu=[],function(t){var e,n=t===Cu;Cu=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=Iu.charAt(t%64),t=Math.floor(t/64);ya(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===Nu[e];e--)Nu[e]=0;Nu[e]++}else for(e=0;e<12;e++)Nu[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=Iu.charAt(Nu[e]);return ya(20===i.length,"nextPushId: Length should be 20."),i}),ku=(Du.Wrap=function(t,e){return new Du(t,e)},Du);function Du(t,e){this.name=t,this.node=e}var Ru,Ou=(Pu.prototype.getCompare=function(){return this.compare.bind(this)},Pu.prototype.indexedValueChanged=function(t,e){var n=new ku(Vs,t),r=new ku(Vs,e);return 0!==this.compare(n,r)},Pu.prototype.minPost=function(){return ku.MIN},Pu);function Pu(){}var Mu,Lu=(ia(xu,Mu=Ou),Object.defineProperty(xu,"__EMPTY_NODE",{get:function(){return Ru},set:function(t){Ru=t},enumerable:!0,configurable:!0}),xu.prototype.compare=function(t,e){return Bs(t.name,e.name)},xu.prototype.isDefinedOn=function(t){throw ma("KeyIndex.isDefinedOn not expected to be called.")},xu.prototype.indexedValueChanged=function(t,e){return!1},xu.prototype.minPost=function(){return ku.MIN},xu.prototype.maxPost=function(){return new ku(qs,Ru)},xu.prototype.makePost=function(t,e){return ya("string"==typeof t,"KeyIndex indexValue must always be a string."),new ku(t,Ru)},xu.prototype.toString=function(){return".key"},xu);function xu(){return null!==Mu&&Mu.apply(this,arguments)||this}var Fu,Uu=new Lu;function Vu(t){return"number"==typeof t?"number:"+Ks(t):"string:"+t}function qu(t){if(t.isLeafNode()){var e=t.val();ya("string"==typeof e||"number"==typeof e||"object"==typeof e&&La(e,".sv"),"Priority must be a string or number.")}else ya(t===Fu||t.isEmpty(),"priority of unexpected type.");ya(t===Fu||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}var Bu,ju,Wu,Ku,Qu=(Object.defineProperty(Hu,"__childrenNodeConstructor",{get:function(){return Bu},set:function(t){Bu=t},enumerable:!0,configurable:!0}),Hu.prototype.isLeafNode=function(){return!0},Hu.prototype.getPriority=function(){return this.priorityNode_},Hu.prototype.updatePriority=function(t){return new Hu(this.value_,t)},Hu.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:Hu.__childrenNodeConstructor.EMPTY_NODE},Hu.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:Hu.__childrenNodeConstructor.EMPTY_NODE},Hu.prototype.hasChild=function(){return!1},Hu.prototype.getPredecessorChildName=function(t,e){return null},Hu.prototype.updateImmediateChild=function(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:Hu.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)},Hu.prototype.updateChild=function(t,e){var n=t.getFront();return null===n?e:e.isEmpty()&&".priority"!==n?this:(ya(".priority"!==n||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,Hu.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),e)))},Hu.prototype.isEmpty=function(){return!1},Hu.prototype.numChildren=function(){return 0},Hu.prototype.forEachChild=function(t,e){return!1},Hu.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},Hu.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+Vu(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"==e?Ks(this.value_):this.value_,this.lazyHash_=ws(t)}return this.lazyHash_},Hu.prototype.getValue=function(){return this.value_},Hu.prototype.compareTo=function(t){return t===Hu.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Hu.__childrenNodeConstructor?-1:(ya(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},Hu.prototype.compareToLeafNode_=function(t){var e=typeof t.value_,n=typeof this.value_,r=Hu.VALUE_TYPE_ORDER.indexOf(e),i=Hu.VALUE_TYPE_ORDER.indexOf(n);return ya(0<=r,"Unknown leaf type: "+e),ya(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r},Hu.prototype.withIndex=function(){return this},Hu.prototype.isIndexed=function(){return!0},Hu.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},Hu.VALUE_TYPE_ORDER=["object","boolean","number","string"],Hu);function Hu(t,e){void 0===e&&(e=Hu.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=e,this.lazyHash_=null,ya(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),qu(this.priorityNode_)}function Gu(){return null!==Ku&&Ku.apply(this,arguments)||this}var zu=new(ia(Gu,Ku=Ou),Gu.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?Bs(t.name,e.name):i},Gu.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},Gu.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},Gu.prototype.minPost=function(){return ku.MIN},Gu.prototype.maxPost=function(){return new ku(qs,new Qu("[PRIORITY-POST]",Wu))},Gu.prototype.makePost=function(t,e){var n=ju(t);return new ku(e,new Qu("[PRIORITY-POST]",n))},Gu.prototype.toString=function(){return".priority"},Gu),Yu=(Xu.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},Xu.prototype.hasNext=function(){return 0<this.nodeStack_.length},Xu.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},Xu);function Xu(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}var Ju=($u.prototype.copy=function(t,e,n,r,i){return new $u(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},$u.prototype.count=function(){return this.left.count()+1+this.right.count()},$u.prototype.isEmpty=function(){return!1},$u.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},$u.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},$u.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},$u.prototype.minKey=function(){return this.min_().key},$u.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},$u.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},$u.prototype.removeMin_=function(){if(this.left.isEmpty())return ec.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},$u.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return ec.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},$u.prototype.isRed_=function(){return this.color},$u.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},$u.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},$u.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},$u.prototype.rotateLeft_=function(){var t=this.copy(null,null,$u.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},$u.prototype.rotateRight_=function(){var t=this.copy(null,null,$u.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},$u.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},$u.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},$u.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},$u.RED=!0,$u.BLACK=!1,$u);function $u(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:$u.RED,this.left=null!=r?r:ec.EMPTY_NODE,this.right=null!=i?i:ec.EMPTY_NODE}var Zu=(tc.prototype.copy=function(t,e,n,r,i){return this},tc.prototype.insert=function(t,e,n){return new Ju(t,e,null)},tc.prototype.remove=function(t,e){return this},tc.prototype.count=function(){return 0},tc.prototype.isEmpty=function(){return!0},tc.prototype.inorderTraversal=function(t){return!1},tc.prototype.reverseTraversal=function(t){return!1},tc.prototype.minKey=function(){return null},tc.prototype.maxKey=function(){return null},tc.prototype.check_=function(){return 0},tc.prototype.isRed_=function(){return!1},tc);function tc(){}var ec=(nc.prototype.insert=function(t,e){return new nc(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Ju.BLACK,null,null))},nc.prototype.remove=function(t){return new nc(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Ju.BLACK,null,null))},nc.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},nc.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},nc.prototype.isEmpty=function(){return this.root_.isEmpty()},nc.prototype.count=function(){return this.root_.count()},nc.prototype.minKey=function(){return this.root_.minKey()},nc.prototype.maxKey=function(){return this.root_.maxKey()},nc.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},nc.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},nc.prototype.getIterator=function(t){return new Yu(this.root_,null,this.comparator_,!1,t)},nc.prototype.getIteratorFrom=function(t,e){return new Yu(this.root_,t,this.comparator_,!1,e)},nc.prototype.getReverseIteratorFrom=function(t,e){return new Yu(this.root_,t,this.comparator_,!0,e)},nc.prototype.getReverseIterator=function(t){return new Yu(this.root_,null,this.comparator_,!0,t)},nc.EMPTY_NODE=new Zu,nc);function nc(t,e){void 0===e&&(e=nc.EMPTY_NODE),this.comparator_=t,this.root_=e}var rc=Math.log(2),ic=(oc.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},oc);function oc(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/rc,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}var ac,sc,uc=function(c,t,h,e){c.sort(t);var l=function(t,e){var n,r,i=e-t;if(0==i)return null;if(1==i)return n=c[t],r=h?h(n):n,new Ju(r,n.node,Ju.BLACK,null,null);var o=parseInt(i/2,10)+t,a=l(t,o),s=l(o+1,e);return n=c[o],r=h?h(n):n,new Ju(r,n.node,Ju.BLACK,a,s)},n=function(t){for(var e=null,n=null,s=c.length,r=function(t,e){var n=s-t,r=s;s-=t;var i=l(1+n,r),o=c[n],a=h?h(o):o;u(new Ju(a,o.node,e,null,i))},u=function(t){e=e?e.left=t:n=t},i=0;i<t.count;++i){var o=t.nextBitIsOne(),a=Math.pow(2,t.count-(i+1));o?r(a,Ju.BLACK):(r(a,Ju.BLACK),r(a,Ju.RED))}return n}(new ic(c.length));return new ec(e||t,n)},cc={},hc=(Object.defineProperty(lc,"Default",{get:function(){return ya(zu,"ChildrenNode.ts has not been loaded"),ac=ac||new lc({".priority":cc},{".priority":zu})},enumerable:!0,configurable:!0}),lc.prototype.get=function(t){var e=xa(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof ec?e:null},lc.prototype.hasIndex=function(t){return La(this.indexSet_,t.toString())},lc.prototype.addIndex=function(t,e){ya(t!==Uu,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,r=[],i=!1,o=e.getIterator(ku.Wrap),a=o.getNext();a;)i=i||t.isDefinedOn(a.node),r.push(a),a=o.getNext();n=i?uc(r,t.getCompare()):cc;var s=t.toString(),u=oa({},this.indexSet_);u[s]=t;var c=oa({},this.indexes_);return c[s]=n,new lc(c,u)},lc.prototype.addToIndexes=function(u,c){var h=this;return new lc(Ua(this.indexes_,function(t,e){var n=xa(h.indexSet_,e);if(ya(n,"Missing index implementation for "+e),t===cc){if(n.isDefinedOn(u.node)){for(var r=[],i=c.getIterator(ku.Wrap),o=i.getNext();o;)o.name!=u.name&&r.push(o),o=i.getNext();return r.push(u),uc(r,n.getCompare())}return cc}var a=c.get(u.name),s=t;return a&&(s=s.remove(new ku(u.name,a))),s.insert(u,u.node)}),this.indexSet_)},lc.prototype.removeFromIndexes=function(n,r){return new lc(Ua(this.indexes_,function(t){if(t===cc)return t;var e=r.get(n.name);return e?t.remove(new ku(n.name,e)):t}),this.indexSet_)},lc);function lc(t,e){this.indexes_=t,this.indexSet_=e}function fc(t,e){return Bs(t.name,e.name)}function pc(t,e){return Bs(t,e)}var dc,yc=(Object.defineProperty(mc,"EMPTY_NODE",{get:function(){return sc=sc||new mc(new ec(pc),null,hc.Default)},enumerable:!0,configurable:!0}),mc.prototype.isLeafNode=function(){return!1},mc.prototype.getPriority=function(){return this.priorityNode_||sc},mc.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new mc(this.children_,t,this.indexMap_)},mc.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?sc:e},mc.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},mc.prototype.hasChild=function(t){return null!==this.children_.get(t)},mc.prototype.updateImmediateChild=function(t,e){if(ya(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);var n,r=new ku(t,e),i=void 0,o=void 0;return o=e.isEmpty()?(i=this.children_.remove(t),this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,e),this.indexMap_.addToIndexes(r,this.children_)),n=i.isEmpty()?sc:this.priorityNode_,new mc(i,n,o)},mc.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;ya(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},mc.prototype.isEmpty=function(){return this.children_.isEmpty()},mc.prototype.numChildren=function(){return this.children_.count()},mc.prototype.val=function(n){if(this.isEmpty())return null;var r={},i=0,o=0,a=!0;if(this.forEachChild(zu,function(t,e){r[t]=e.val(n),i++,a&&mc.INTEGER_REGEXP_.test(t)?o=Math.max(o,Number(t)):a=!1}),!n&&a&&o<2*i){var t=[];for(var e in r)t[e]=r[e];return t}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r},mc.prototype.hash=function(){if(null===this.lazyHash_){var r="";this.getPriority().isEmpty()||(r+="priority:"+Vu(this.getPriority().val())+":"),this.forEachChild(zu,function(t,e){var n=e.hash();""!==n&&(r+=":"+t+":"+n)}),this.lazyHash_=""===r?"":ws(r)}return this.lazyHash_},mc.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new ku(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},mc.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},mc.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new ku(e,this.children_.get(e)):null},mc.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},mc.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new ku(e,this.children_.get(e)):null},mc.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},mc.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},mc.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,ku.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},mc.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},mc.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,ku.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},mc.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===vc?-1:0},mc.prototype.withIndex=function(t){if(t===Uu||this.indexMap_.hasIndex(t))return this;var e=this.indexMap_.addIndex(t,this.children_);return new mc(this.children_,this.priorityNode_,e)},mc.prototype.isIndexed=function(t){return t===Uu||this.indexMap_.hasIndex(t)},mc.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(zu),r=e.getIterator(zu),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},mc.prototype.resolveIndex_=function(t){return t===Uu?null:this.indexMap_.get(t.toString())},mc.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,mc);function mc(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&qu(this.priorityNode_),this.children_.isEmpty()&&ya(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}function gc(){return dc.call(this,new ec(pc),yc.EMPTY_NODE,hc.Default)||this}var vc=new(ia(gc,dc=yc),gc.prototype.compareTo=function(t){return t===this?0:1},gc.prototype.equals=function(t){return t===this},gc.prototype.getPriority=function(){return this},gc.prototype.getImmediateChild=function(t){return yc.EMPTY_NODE},gc.prototype.isEmpty=function(){return!1},gc);Object.defineProperties(ku,{MIN:{value:new ku(Vs,yc.EMPTY_NODE)},MAX:{value:new ku(qs,vc)}}),Lu.__EMPTY_NODE=yc.EMPTY_NODE,Qu.__childrenNodeConstructor=yc,Fu=vc,Wu=vc;var bc,wc=!0;function _c(r,t){if(void 0===t&&(t=null),null===r)return yc.EMPTY_NODE;if("object"==typeof r&&".priority"in r&&(t=r[".priority"]),ya(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof r&&".value"in r&&null!==r[".value"]&&(r=r[".value"]),"object"!=typeof r||".sv"in r)return new Qu(r,_c(t));if(r instanceof Array||!wc){var i=yc.EMPTY_NODE;return Ws(r,function(t,e){if(La(r,t)&&"."!==t.substring(0,1)){var n=_c(e);!n.isLeafNode()&&n.isEmpty()||(i=i.updateImmediateChild(t,n))}}),i.updatePriority(_c(t))}var o=[],a=!1;if(Ws(r,function(t,e){if("."!==t.substring(0,1)){var n=_c(e);n.isEmpty()||(a=a||!n.getPriority().isEmpty(),o.push(new ku(t,n)))}}),0==o.length)return yc.EMPTY_NODE;var e=uc(o,fc,function(t){return t.name},pc);if(a){var n=uc(o,zu.getCompare());return new yc(e,_c(t),new hc({".priority":n},{".priority":zu}))}return new yc(e,_c(t),hc.Default)}function Tc(){return null!==bc&&bc.apply(this,arguments)||this}ju=_c;var Ec,Sc=new(ia(Tc,bc=Ou),Tc.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?Bs(t.name,e.name):n},Tc.prototype.isDefinedOn=function(t){return!0},Tc.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},Tc.prototype.minPost=function(){return ku.MIN},Tc.prototype.maxPost=function(){return ku.MAX},Tc.prototype.makePost=function(t,e){var n=_c(t);return new ku(e,n)},Tc.prototype.toString=function(){return".value"},Tc),Ic=(ia(Cc,Ec=Ou),Cc.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},Cc.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},Cc.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?Bs(t.name,e.name):i},Cc.prototype.makePost=function(t,e){var n=_c(t),r=yc.EMPTY_NODE.updateChild(this.indexPath_,n);return new ku(e,r)},Cc.prototype.maxPost=function(){var t=yc.EMPTY_NODE.updateChild(this.indexPath_,vc);return new ku(qs,t)},Cc.prototype.toString=function(){return this.indexPath_.slice().join("/")},Cc);function Cc(t){var e=Ec.call(this)||this;return e.indexPath_=t,ya(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),e}var Nc=(Ac.prototype.val=function(){return Qa("DataSnapshot.val",0,0,arguments.length),this.node_.val()},Ac.prototype.exportVal=function(){return Qa("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},Ac.prototype.toJSON=function(){return Qa("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},Ac.prototype.exists=function(){return Qa("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},Ac.prototype.child=function(t){Qa("DataSnapshot.child",0,1,arguments.length),t=String(t),pu("DataSnapshot.child",1,t,!1);var e=new Ys(t),n=this.ref_.child(e);return new Ac(this.node_.getChild(e),n,zu)},Ac.prototype.hasChild=function(t){Qa("DataSnapshot.hasChild",1,1,arguments.length),pu("DataSnapshot.hasChild",1,t,!1);var e=new Ys(t);return!this.node_.getChild(e).isEmpty()},Ac.prototype.getPriority=function(){return Qa("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},Ac.prototype.forEach=function(n){var r=this;return Qa("DataSnapshot.forEach",1,1,arguments.length),Ga("DataSnapshot.forEach",1,n,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(t,e){return n(new Ac(e,r.ref_.child(t),zu))})},Ac.prototype.hasChildren=function(){return Qa("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(Ac.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),Ac.prototype.numChildren=function(){return Qa("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},Ac.prototype.getRef=function(){return Qa("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(Ac.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),Ac);function Ac(t,e,n){this.node_=t,this.ref_=e,this.index_=n}var kc=(Dc.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},Dc.prototype.getEventType=function(){return this.eventType},Dc.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Dc.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Pa(this.snapshot.exportVal())},Dc);function Dc(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}var Rc=(Oc.prototype.getPath=function(){return this.path},Oc.prototype.getEventType=function(){return"cancel"},Oc.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Oc.prototype.toString=function(){return this.path.toString()+":cancel"},Oc);function Oc(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}var Pc=(Mc.prototype.respondsTo=function(t){return"value"===t},Mc.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new kc("value",this,new Nc(t.snapshotNode,e.getRef(),n))},Mc.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){ya(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},Mc.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Rc(this,t,e):null},Mc.prototype.matches=function(t){return t instanceof Mc&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},Mc.prototype.hasAnyCallback=function(){return null!==this.callback_},Mc);function Mc(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}var Lc,xc=(Fc.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,La(this.callbacks_,e)},Fc.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Rc(this,t,e):null},Fc.prototype.createEvent=function(t,e){ya(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new kc(t.type,this,new Nc(t.snapshotNode,n,r),t.prevName)},Fc.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){ya(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},Fc.prototype.matches=function(e){var n=this;if(e instanceof Fc){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var t=Object.keys(e.callbacks_),r=Object.keys(this.callbacks_),i=t.length;if(i===r.length){if(1!==i)return r.every(function(t){return e.callbacks_[t]===n.callbacks_[t]});var o=t[0],a=r[0];return!(a!==o||e.callbacks_[o]&&this.callbacks_[a]&&e.callbacks_[o]!==this.callbacks_[a])}}}return!1},Fc.prototype.hasAnyCallback=function(){return null!==this.callbacks_},Fc);function Fc(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}var Uc=(Object.defineProperty(Vc,"__referenceConstructor",{get:function(){return ya(Lc,"Reference.ts has not been loaded"),Lc},set:function(t){Lc=t},enumerable:!0,configurable:!0}),Vc.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===Uu){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=Vs)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=qs)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===zu){if(null!=e&&!su(e)||null!=n&&!su(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(ya(t.getIndex()instanceof Ic||t.getIndex()===Sc,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},Vc.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},Vc.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},Vc.prototype.getQueryParams=function(){return this.queryParams_},Vc.prototype.getRef=function(){return Qa("Query.ref",0,0,arguments.length),new Vc.__referenceConstructor(this.repo,this.path)},Vc.prototype.on=function(t,e,n,r){Qa("Query.on",2,4,arguments.length),lu("Query.on",1,t,!1),Ga("Query.on",2,e,!1);var i=Vc.getCancelAndContextArgs_("Query.on",n,r);if("value"===t)this.onValueEvent(e,i.cancel,i.context);else{var o={};o[t]=e,this.onChildEvent(o,i.cancel,i.context)}return e},Vc.prototype.onValueEvent=function(t,e,n){var r=new Pc(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},Vc.prototype.onChildEvent=function(t,e,n){var r=new xc(t,e,n);this.repo.addEventCallbackForQuery(this,r)},Vc.prototype.off=function(t,e,n){Qa("Query.off",0,3,arguments.length),lu("Query.off",1,t,!0),Ga("Query.off",2,e,!0),za("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new Pc(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new xc(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},Vc.prototype.once=function(e,n,t,r){var i=this;Qa("Query.once",1,4,arguments.length),lu("Query.once",1,e,!1),Ga("Query.once",2,n,!0);var o=Vc.getCancelAndContextArgs_("Query.once",t,r),a=!0,s=new wa;s.promise.catch(function(){});var u=function(t){a&&(a=!1,i.off(e,u),n&&n.bind(o.context)(t),s.resolve(t))};return this.on(e,u,function(t){i.off(e,u),o.cancel&&o.cancel.bind(o.context)(t),s.reject(t)}),s.promise},Vc.prototype.limitToFirst=function(t){if(Qa("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new Vc(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},Vc.prototype.limitToLast=function(t){if(Qa("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new Vc(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},Vc.prototype.orderByChild=function(t){if(Qa("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');pu("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var e=new Ys(t);if(e.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new Ic(e),r=this.queryParams_.orderBy(n);return Vc.validateQueryEndpoints_(r),new Vc(this.repo,this.path,r,!0)},Vc.prototype.orderByKey=function(){Qa("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(Uu);return Vc.validateQueryEndpoints_(t),new Vc(this.repo,this.path,t,!0)},Vc.prototype.orderByPriority=function(){Qa("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(zu);return Vc.validateQueryEndpoints_(t),new Vc(this.repo,this.path,t,!0)},Vc.prototype.orderByValue=function(){Qa("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(Sc);return Vc.validateQueryEndpoints_(t),new Vc(this.repo,this.path,t,!0)},Vc.prototype.startAt=function(t,e){void 0===t&&(t=null),Qa("Query.startAt",0,2,arguments.length),uu("Query.startAt",1,t,this.path,!0),fu("Query.startAt",2,e,!0);var n=this.queryParams_.startAt(t,e);if(Vc.validateLimit_(n),Vc.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(e=t=null),new Vc(this.repo,this.path,n,this.orderByCalled_)},Vc.prototype.endAt=function(t,e){void 0===t&&(t=null),Qa("Query.endAt",0,2,arguments.length),uu("Query.endAt",1,t,this.path,!0),fu("Query.endAt",2,e,!0);var n=this.queryParams_.endAt(t,e);if(Vc.validateLimit_(n),Vc.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new Vc(this.repo,this.path,n,this.orderByCalled_)},Vc.prototype.equalTo=function(t,e){if(Qa("Query.equalTo",1,2,arguments.length),uu("Query.equalTo",1,t,this.path,!1),fu("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},Vc.prototype.toString=function(){return Qa("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},Vc.prototype.toJSON=function(){return Qa("Query.toJSON",0,1,arguments.length),this.toString()},Vc.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},Vc.prototype.queryIdentifier=function(){var t=this.queryObject(),e=js(t);return"{}"===e?"default":e},Vc.prototype.isEqual=function(t){if(Qa("Query.isEqual",1,1,arguments.length),!(t instanceof Vc))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var e=this.repo===t.repo,n=this.path.equals(t.path),r=this.queryIdentifier()===t.queryIdentifier();return e&&n&&r},Vc.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Ga(t,3,r.cancel,!0),r.context=n,za(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(Ha(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(Vc.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),Vc);function Vc(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}var qc=(Bc.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&0<this.children.size){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},Bc.prototype.remember=function(t,e){if(t.isEmpty())this.value=e,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,e);else{var n=t.getFront();this.children.has(n)||this.children.set(n,new Bc);var r=this.children.get(n);t=t.popFront(),r.remember(t,e)}},Bc.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(zu,function(t,e){n.remember(new Ys(t),e)}),this.forget(t)}if(0<this.children.size){var r=t.getFront();return t=t.popFront(),!this.children.has(r)||this.children.get(r).forget(t)&&this.children.delete(r),0===this.children.size}return!0},Bc.prototype.forEachTree=function(r,i){null!==this.value?i(r,this.value):this.forEachChild(function(t,e){var n=new Ys(r.toString()+"/"+t);e.forEachTree(n,i)})},Bc.prototype.forEachChild=function(n){this.children.forEach(function(t,e){n(e,t)})},Bc);function Bc(){this.value=null,this.children=new Map}function jc(t,e){return t&&"object"==typeof t?(ya(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t}var Wc,Kc,Qc=function(t,r){var i,e=t.getPriority().val(),n=jc(e,r);if(t.isLeafNode()){var o=t,a=jc(o.getValue(),r);return a!==o.getValue()||n!==o.getPriority().val()?new Qu(a,_c(n)):t}var s=t;return n!==(i=s).getPriority().val()&&(i=i.updatePriority(new Qu(n))),s.forEachChild(zu,function(t,e){var n=Qc(e,r);n!==e&&(i=i.updateImmediateChild(t,n))}),i};(Kc=Wc=Wc||{})[Kc.OVERWRITE=0]="OVERWRITE",Kc[Kc.MERGE=1]="MERGE",Kc[Kc.ACK_USER_WRITE=2]="ACK_USER_WRITE",Kc[Kc.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var Hc=(Gc.User=new Gc(!0,!1,null,!1),Gc.Server=new Gc(!1,!0,null,!1),Gc.forServerTaggedQuery=function(t){return new Gc(!1,!0,t,!0)},Gc);function Gc(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,ya(!r||e,"Tagged queries must be from server.")}var zc,Yc=(Xc.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return ya(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var e=this.affectedTree.subtree(new Ys(t));return new Xc(Ys.Empty,e,this.revert)}return ya(this.path.getFront()===t,"operationForChild called for unrelated child."),new Xc(this.path.popFront(),this.affectedTree,this.revert)},Xc);function Xc(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Wc.ACK_USER_WRITE,this.source=Hc.User}var Jc=($c.fromObject=function(t){var n=$c.Empty;return Ws(t,function(t,e){n=n.set(new Ys(t),e)}),n},$c.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},$c.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:Ys.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new Ys(n).child(i.path),value:i.value}},$c.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},$c.prototype.subtree=function(t){if(t.isEmpty())return this;var e=t.getFront(),n=this.children.get(e);return null!==n?n.subtree(t.popFront()):$c.Empty},$c.prototype.set=function(t,e){if(t.isEmpty())return new $c(e,this.children);var n=t.getFront(),r=(this.children.get(n)||$c.Empty).set(t.popFront(),e),i=this.children.insert(n,r);return new $c(this.value,i)},$c.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?$c.Empty:new $c(null,this.children);var e=t.getFront(),n=this.children.get(e);if(n){var r=n.remove(t.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?$c.Empty:new $c(this.value,i)}return this},$c.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},$c.prototype.setTree=function(t,e){if(t.isEmpty())return e;var n=t.getFront(),r=(this.children.get(n)||$c.Empty).setTree(t.popFront(),e),i=void 0;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new $c(this.value,i)},$c.prototype.fold=function(t){return this.fold_(Ys.Empty,t)},$c.prototype.fold_=function(n,r){var i={};return this.children.inorderTraversal(function(t,e){i[t]=e.fold_(n.child(t),r)}),r(n,this.value,i)},$c.prototype.findOnPath=function(t,e){return this.findOnPath_(t,Ys.Empty,e)},$c.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},$c.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,Ys.Empty,e)},$c.prototype.foreachOnPath_=function(t,e,n){if(t.isEmpty())return this;this.value&&n(e,this.value);var r=t.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(t.popFront(),e.child(r),n):$c.Empty},$c.prototype.foreach=function(t){this.foreach_(Ys.Empty,t)},$c.prototype.foreach_=function(n,r){this.children.inorderTraversal(function(t,e){e.foreach_(n.child(t),r)}),this.value&&r(n,this.value)},$c.prototype.foreachChild=function(n){this.children.inorderTraversal(function(t,e){e.value&&n(t,e.value)})},$c.Empty=new $c(null),$c);function $c(t,e){void 0===e&&(e=zc=zc||new ec(As)),this.value=t,this.children=e}var Zc=(th.prototype.operationForChild=function(t){return this.path.isEmpty()?new th(this.source,Ys.Empty):new th(this.source,this.path.popFront())},th);function th(t,e){this.source=t,this.path=e,this.type=Wc.LISTEN_COMPLETE}var eh=(nh.prototype.operationForChild=function(t){return this.path.isEmpty()?new nh(this.source,Ys.Empty,this.snap.getImmediateChild(t)):new nh(this.source,this.path.popFront(),this.snap)},nh);function nh(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Wc.OVERWRITE}var rh=(ih.prototype.operationForChild=function(t){if(this.path.isEmpty()){var e=this.children.subtree(new Ys(t));return e.isEmpty()?null:e.value?new eh(this.source,Ys.Empty,e.value):new ih(this.source,Ys.Empty,e)}return ya(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new ih(this.source,this.path.popFront(),this.children)},ih.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},ih);function ih(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Wc.MERGE}var oh=(ah.prototype.isFullyInitialized=function(){return this.fullyInitialized_},ah.prototype.isFiltered=function(){return this.filtered_},ah.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},ah.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},ah.prototype.getNode=function(){return this.node_},ah);function ah(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}var sh=(uh.prototype.updateEventSnap=function(t,e,n){return new uh(new oh(t,e,n),this.serverCache_)},uh.prototype.updateServerSnap=function(t,e,n){return new uh(this.eventCache_,new oh(t,e,n))},uh.prototype.getEventCache=function(){return this.eventCache_},uh.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},uh.prototype.getServerCache=function(){return this.serverCache_},uh.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},uh.Empty=new uh(new oh(yc.EMPTY_NODE,!1,!1),new oh(yc.EMPTY_NODE,!1,!1)),uh);function uh(t,e){this.eventCache_=t,this.serverCache_=e}var ch=(hh.valueChange=function(t){return new hh(hh.VALUE,t)},hh.childAddedChange=function(t,e){return new hh(hh.CHILD_ADDED,e,t)},hh.childRemovedChange=function(t,e){return new hh(hh.CHILD_REMOVED,e,t)},hh.childChangedChange=function(t,e,n){return new hh(hh.CHILD_CHANGED,e,t,n)},hh.childMovedChange=function(t,e){return new hh(hh.CHILD_MOVED,e,t)},hh.CHILD_ADDED="child_added",hh.CHILD_REMOVED="child_removed",hh.CHILD_CHANGED="child_changed",hh.CHILD_MOVED="child_moved",hh.VALUE="value",hh);function hh(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}var lh=(fh.prototype.updateChild=function(t,e,n,r,i,o){ya(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(ch.childRemovedChange(e,a)):ya(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(ch.childAddedChange(e,n)):o.trackChildChange(ch.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},fh.prototype.updateFullNode=function(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(zu,function(t,e){n.hasChild(t)||i.trackChildChange(ch.childRemovedChange(t,e))}),n.isLeafNode()||n.forEachChild(zu,function(t,e){if(r.hasChild(t)){var n=r.getImmediateChild(t);n.equals(e)||i.trackChildChange(ch.childChangedChange(t,e,n))}else i.trackChildChange(ch.childAddedChange(t,e))})),n.withIndex(this.index_)},fh.prototype.updatePriority=function(t,e){return t.isEmpty()?yc.EMPTY_NODE:t.updatePriority(e)},fh.prototype.filtersNodes=function(){return!1},fh.prototype.getIndexedFilter=function(){return this},fh.prototype.getIndex=function(){return this.index_},fh);function fh(t){this.index_=t}var ph=(dh.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;ya(e==ch.CHILD_ADDED||e==ch.CHILD_CHANGED||e==ch.CHILD_REMOVED,"Only child changes supported for tracking"),ya(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e==ch.CHILD_ADDED&&i==ch.CHILD_REMOVED)this.changeMap.set(n,ch.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e==ch.CHILD_REMOVED&&i==ch.CHILD_ADDED)this.changeMap.delete(n);else if(e==ch.CHILD_REMOVED&&i==ch.CHILD_CHANGED)this.changeMap.set(n,ch.childRemovedChange(n,r.oldSnap));else if(e==ch.CHILD_CHANGED&&i==ch.CHILD_ADDED)this.changeMap.set(n,ch.childAddedChange(n,t.snapshotNode));else{if(e!=ch.CHILD_CHANGED||i!=ch.CHILD_CHANGED)throw ma("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,ch.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},dh.prototype.getChanges=function(){return Array.from(this.changeMap.values())},dh);function dh(){this.changeMap=new Map}function yh(){}var mh=new(yh.prototype.getCompleteChild=function(t){return null},yh.prototype.getChildAfterChild=function(t,e,n){return null},yh),gh=(vh.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new oh(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},vh.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},vh);function vh(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}var bh=function(t,e){this.viewCache=t,this.changes=e},wh=(_h.prototype.assertIndexed=function(t){ya(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),ya(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},_h.prototype.applyOperation=function(t,e,n,r){var i,o,a=new ph;if(e.type===Wc.OVERWRITE){var s=e;i=s.source.fromUser?this.applyUserOverwrite_(t,s.path,s.snap,n,r,a):(ya(s.source.fromServer,"Unknown source."),o=s.source.tagged||t.getServerCache().isFiltered()&&!s.path.isEmpty(),this.applyServerOverwrite_(t,s.path,s.snap,n,r,o,a))}else if(e.type===Wc.MERGE){var u=e;i=u.source.fromUser?this.applyUserMerge_(t,u.path,u.children,n,r,a):(ya(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.getServerCache().isFiltered(),this.applyServerMerge_(t,u.path,u.children,n,r,o,a))}else if(e.type===Wc.ACK_USER_WRITE){var c=e;i=c.revert?this.revertUserWrite_(t,c.path,n,r,a):this.ackUserWrite_(t,c.path,c.affectedTree,n,r,a)}else{if(e.type!==Wc.LISTEN_COMPLETE)throw ma("Unknown operation type: "+e.type);i=this.listenComplete_(t,e.path,n,a)}var h=a.getChanges();return _h.maybeAddValueEvent_(t,i,h),new bh(i,h)},_h.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(ch.valueChange(e.getCompleteEventSnap()))}},_h.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(ya(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof yc?u:yc.EMPTY_NODE,h=n.calcCompleteEventChildren(c);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"==f){ya(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var y=e.popFront(),m=void 0;if(o.isCompleteForChild(f)){s=t.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);m=null!=g?o.getNode().getImmediateChild(f).updateChild(y,g):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,t.getServerCache());a=null!=m?this.filter_.updateChild(o.getNode(),f,m,y,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},_h.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,mh,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new gh(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},_h.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new gh(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):yc.EMPTY_NODE}if(f.equals(p))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},_h.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},_h.prototype.applyUserMerge_=function(r,i,t,o,a,s){var u=this,c=r;return t.foreach(function(t,e){var n=i.child(t);_h.cacheHasChild_(r,n.getFront())&&(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),t.foreach(function(t,e){var n=i.child(t);_h.cacheHasChild_(r,n.getFront())||(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),c},_h.prototype.applyMerge_=function(n,t){return t.foreach(function(t,e){n=n.updateChild(t,e)}),n},_h.prototype.applyServerMerge_=function(o,t,e,a,s,u,c){var h=this;if(o.getServerCache().getNode().isEmpty()&&!o.getServerCache().isFullyInitialized())return o;var n,l=o;n=t.isEmpty()?e:Jc.Empty.setTree(t,e);var f=o.getServerCache().getNode();return n.children.inorderTraversal(function(t,e){if(f.hasChild(t)){var n=o.getServerCache().getNode().getImmediateChild(t),r=h.applyMerge_(n,e);l=h.applyServerOverwrite_(l,new Ys(t),r,a,s,u,c)}}),n.children.inorderTraversal(function(t,e){var n=!o.getServerCache().isCompleteForChild(t)&&null==e.value;if(!f.hasChild(t)&&!n){var r=o.getServerCache().getNode().getImmediateChild(t),i=h.applyMerge_(r,e);l=h.applyServerOverwrite_(l,new Ys(t),i,a,s,u,c)}}),l},_h.prototype.ackUserWrite_=function(t,r,e,n,i,o){if(null!=n.shadowingWrite(r))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=e.value){if(r.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(r))return this.applyServerOverwrite_(t,r,s.getNode().getChild(r),n,i,a,o);if(r.isEmpty()){var u=Jc.Empty;return s.getNode().forEachChild(Uu,function(t,e){u=u.set(new Ys(t),e)}),this.applyServerMerge_(t,r,u,n,i,a,o)}return t}var c=Jc.Empty;return e.foreach(function(t,e){var n=r.child(t);s.isCompleteForPath(n)&&(c=c.set(t,s.getNode().getChild(n)))}),this.applyServerMerge_(t,r,c,n,i,a,o)},_h.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,mh,r)},_h.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new gh(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();ya(h instanceof yc,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(s,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=s.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(s,l,f,e.popFront(),a,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(s,l,yc.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(Ys.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},_h);function _h(t){this.filter_=t}var Th=(Eh.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===ch.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(ch.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,ch.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,ch.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,ch.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,ch.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,ch.VALUE,t,n,e),i},Eh.prototype.generateEventsForType_=function(r,e,t,i,o){var a=this,n=t.filter(function(t){return t.type===e});n.sort(this.compareChanges_.bind(this)),n.forEach(function(e){var n=a.materializeSingleChange_(e,o);i.forEach(function(t){t.respondsTo(e.type)&&r.push(t.createEvent(n,a.query_))})})},Eh.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},Eh.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw ma("Should only compare child_ events.");var n=new ku(t.childName,t.snapshotNode),r=new ku(e.childName,e.snapshotNode);return this.index_.compare(n,r)},Eh);function Eh(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}var Sh,Ih=(Ch.prototype.getQuery=function(){return this.query_},Ch.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},Ch.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},Ch.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},Ch.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},Ch.prototype.removeEventRegistration=function(t,n){var r=[];if(n){ya(null==t,"A cancel should cancel all event registrations.");var i=this.query_.path;this.eventRegistrations_.forEach(function(t){n=n;var e=t.createCancelEvent(n,i);e&&r.push(e)})}if(t){for(var e=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){e=e.concat(this.eventRegistrations_.slice(o+1));break}}else e.push(a)}this.eventRegistrations_=e}else this.eventRegistrations_=[];return r},Ch.prototype.applyOperation=function(t,e,n){t.type===Wc.MERGE&&null!==t.source.queryId&&(ya(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),ya(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),ya(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},Ch.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(zu,function(t,e){n.push(ch.childAddedChange(t,e))}),e.isFullyInitialized()&&n.push(ch.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},Ch.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},Ch);function Ch(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new lh(n.getIndex()),i=n.getNodeFilter();this.processor_=new wh(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(yc.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(yc.EMPTY_NODE,a.getNode(),null),c=new oh(s,o.isFullyInitialized(),r.filtersNodes()),h=new oh(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new sh(h,c),this.eventGenerator_=new Th(this.query_)}var Nh=(Object.defineProperty(Ah,"__referenceConstructor",{get:function(){return ya(Sh,"Reference.ts has not been loaded"),Sh},set:function(t){ya(!Sh,"__referenceConstructor has already been defined"),Sh=t},enumerable:!0,configurable:!0}),Ah.prototype.isEmpty=function(){return 0===this.views.size},Ah.prototype.applyOperation=function(t,e,n){var r,i,o=t.source.queryId;if(null!==o){var a=this.views.get(o);return ya(null!=a,"SyncTree gave us an op for an invalid query."),a.applyOperation(t,e,n)}var s=[];try{for(var u=ua(this.views.values()),c=u.next();!c.done;c=u.next())a=c.value,s=s.concat(a.applyOperation(t,e,n))}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s},Ah.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s=n.calcCompleteEventCache(i?r:null),u=!1;u=!!s||(s=r instanceof yc?n.calcCompleteEventChildren(r):yc.EMPTY_NODE,!1);var c=new sh(new oh(s,u,!1),new oh(r,i,!1));a=new Ih(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},Ah.prototype.removeEventRegistration=function(t,e,n){var r,i,o=t.queryIdentifier(),a=[],s=[],u=this.hasCompleteView();if("default"===o)try{for(var c=ua(this.views.entries()),h=c.next();!h.done;h=c.next()){var l=ca(h.value,2),f=l[0],p=l[1];s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(f),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery()))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}else(p=this.views.get(o))&&(s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(o),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery())));return u&&!this.hasCompleteView()&&a.push(new Ah.__referenceConstructor(t.repo,t.path)),{removed:a,events:s}},Ah.prototype.getQueryViews=function(){var e,t,n=[];try{for(var r=ua(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},Ah.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var i=ua(this.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;r=r||a.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},Ah.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},Ah.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},Ah.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},Ah.prototype.getCompleteView=function(){var e,t;try{for(var n=ua(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},Ah);function Ah(){this.views=new Map}var kh=(Dh.prototype.addWrite=function(t,e){if(t.isEmpty())return new Dh(new Jc(e));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var r=n.path,i=n.value,o=Ys.relativePath(r,t);return i=i.updateChild(o,e),new Dh(this.writeTree_.set(r,i))}var a=new Jc(e);return new Dh(this.writeTree_.setTree(t,a))},Dh.prototype.addWrites=function(n,t){var r=this;return Ws(t,function(t,e){r=r.addWrite(n.child(t),e)}),r},Dh.prototype.removeWrite=function(t){return t.isEmpty()?Dh.Empty:new Dh(this.writeTree_.setTree(t,Jc.Empty))},Dh.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},Dh.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(Ys.relativePath(e.path,t)):null},Dh.prototype.getCompleteChildren=function(){var n=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(zu,function(t,e){n.push(new ku(t,e))}):this.writeTree_.children.inorderTraversal(function(t,e){null!=e.value&&n.push(new ku(t,e.value))}),n},Dh.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var e=this.getCompleteNode(t);return new Dh(null!=e?new Jc(e):this.writeTree_.subtree(t))},Dh.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},Dh.prototype.apply=function(t){return function n(r,t,i){if(null!=t.value)return i.updateChild(r,t.value);var o=null;return t.children.inorderTraversal(function(t,e){".priority"===t?(ya(null!==e.value,"Priority writes must always be leaf nodes"),o=e.value):i=n(r.child(t),e,i)}),i.getChild(r).isEmpty()||null===o||(i=i.updateChild(r.child(".priority"),o)),i}(Ys.Empty,this.writeTree_,t)},Dh.Empty=new Dh(new Jc(null)),Dh);function Dh(t){this.writeTree_=t}var Rh=(Oh.prototype.childWrites=function(t){return new Ph(t,this)},Oh.prototype.addOverwrite=function(t,e,n,r){ya(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},Oh.prototype.addMerge=function(t,e,n){ya(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},Oh.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},Oh.prototype.removeWrite=function(e){var n=this,t=this.allWrites_.findIndex(function(t){return t.writeId===e});ya(0<=t,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[t];this.allWrites_.splice(t,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(t<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}return!!i&&(o?this.resetTree_():r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):Ws(r.children,function(t){n.visibleWrites_=n.visibleWrites_.removeWrite(r.path.child(t))}),!0)},Oh.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},Oh.prototype.calcCompleteEventCache=function(e,t,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(e);if(!r&&i.isEmpty())return t;if(r||null!=t||i.hasCompleteWrite(Ys.Empty)){var o=Oh.layerTree_(this.allWrites_,function(t){return(t.visible||r)&&(!n||!~n.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);return u=t||yc.EMPTY_NODE,o.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var s=this.visibleWrites_.childCompoundWrite(e);if(s.isEmpty())return t;if(null!=t||s.hasCompleteWrite(Ys.Empty)){var u=t||yc.EMPTY_NODE;return s.apply(u)}return null},Oh.prototype.calcCompleteEventChildren=function(t,e){var r=yc.EMPTY_NODE,n=this.visibleWrites_.getCompleteNode(t);if(n)return n.isLeafNode()||n.forEachChild(zu,function(t,e){r=r.updateImmediateChild(t,e)}),r;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(zu,function(t,e){var n=i.childCompoundWrite(new Ys(t)).apply(e);r=r.updateImmediateChild(t,n)}),i.getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r},Oh.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){ya(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},Oh.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},Oh.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},Oh.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(Ys.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},Oh.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},Oh.prototype.resetTree_=function(){this.visibleWrites_=Oh.layerTree_(this.allWrites_,Oh.DefaultFilter_,Ys.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},Oh.DefaultFilter_=function(t){return t.visible},Oh.layerTree_=function(t,e,n){for(var r=kh.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=Ys.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=Ys.relativePath(a,n),r=r.addWrite(Ys.Empty,o.snap.getChild(s)));else{if(!o.children)throw ma("WriteRecord should have .snap or .children");if(n.contains(a))s=Ys.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=Ys.relativePath(a,n)).isEmpty())r=r.addWrites(Ys.Empty,o.children);else{var u=xa(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite(Ys.Empty,c)}}}}}return r},Oh);function Oh(){this.visibleWrites_=kh.Empty,this.allWrites_=[],this.lastWriteId_=-1}var Ph=(Mh.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},Mh.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},Mh.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},Mh.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},Mh.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},Mh.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},Mh.prototype.child=function(t){return new Mh(this.treePath_.child(t),this.writeTree_)},Mh);function Mh(t,e){this.treePath_=t,this.writeTree_=e}var Lh=(xh.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new eh(Hc.User,t,e)):[]},xh.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=Jc.fromObject(e);return this.applyOperationToSyncPoints_(new rh(Hc.User,t,r))},xh.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=Jc.Empty;return null!=n.snap?r=r.set(Ys.Empty,!0):Ws(n.children,function(t,e){r=r.set(new Ys(t),e)}),this.applyOperationToSyncPoints_(new Yc(n.path,r,e))}return[]},xh.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new eh(Hc.Server,t,e))},xh.prototype.applyServerMerge=function(t,e){var n=Jc.fromObject(e);return this.applyOperationToSyncPoints_(new rh(Hc.Server,t,n))},xh.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new Zc(Hc.Server,t))},xh.prototype.applyTaggedQueryOverwrite=function(t,e,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=xh.parseQueryKey_(r),o=i.path,a=i.queryId,s=Ys.relativePath(o,t),u=new eh(Hc.forServerTaggedQuery(a),s,e);return this.applyTaggedOperation_(o,u)},xh.prototype.applyTaggedQueryMerge=function(t,e,n){var r=this.queryKeyForTag_(n);if(r){var i=xh.parseQueryKey_(r),o=i.path,a=i.queryId,s=Ys.relativePath(o,t),u=Jc.fromObject(e),c=new rh(Hc.forServerTaggedQuery(a),s,u);return this.applyTaggedOperation_(o,c)}return[]},xh.prototype.applyTaggedListenComplete=function(t,e){var n=this.queryKeyForTag_(e);if(n){var r=xh.parseQueryKey_(n),i=r.path,o=r.queryId,a=Ys.relativePath(i,t),s=new Zc(Hc.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(i,s)}return[]},xh.prototype.addEventRegistration=function(t,e){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=Ys.relativePath(t,r);i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView()});var n,a=this.syncPointTree_.get(r);a?(o=o||a.hasCompleteView(),i=i||a.getCompleteServerCache(Ys.Empty)):(a=new Nh,this.syncPointTree_=this.syncPointTree_.set(r,a)),null!=i?n=!0:(n=!1,i=yc.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(Ys.Empty);n&&(i=i.updateImmediateChild(t,n))}));var s=a.viewExistsForQuery(t);if(!s&&!t.getQueryParams().loadsAllData()){var u=xh.makeQueryKey_(t);ya(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var c=xh.getNextQueryTag_();this.queryToTagMap.set(u,c),this.tagToQueryMap.set(c,u)}var h=this.pendingWriteTree_.childWrites(r),l=a.addEventRegistration(t,e,h,i,n);if(!s&&!o){var f=a.viewForQuery(t);l=l.concat(this.setupListener_(t,f))}return l},xh.prototype.removeEventRegistration=function(t,e,n){var r=this,i=t.path,o=this.syncPointTree_.get(i),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var s=o.removeEventRegistration(t,e,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var u=s.removed;a=s.events;var c=-1!==u.findIndex(function(t){return t.getQueryParams().loadsAllData()}),h=this.syncPointTree_.findOnPath(i,function(t,e){return e.hasCompleteView()});if(c&&!h){var l=this.syncPointTree_.subtree(i);if(!l.isEmpty())for(var f=this.collectDistinctViewsForSubTree_(l),p=0;p<f.length;++p){var d=f[p],y=d.getQuery(),m=this.createListenerForView_(d);this.listenProvider_.startListening(xh.queryForListening_(y),this.tagForQuery_(y),m.hashFn,m.onComplete)}}!h&&0<u.length&&!n&&(c?this.listenProvider_.stopListening(xh.queryForListening_(t),null):u.forEach(function(t){var e=r.queryToTagMap.get(xh.makeQueryKey_(t));r.listenProvider_.stopListening(xh.queryForListening_(t),e)})),this.removeTags_(u)}return a},xh.prototype.calcCompleteEventCache=function(i,t){var e=this.pendingWriteTree_,n=this.syncPointTree_.findOnPath(i,function(t,e){var n=Ys.relativePath(t,i),r=e.getCompleteServerCache(n);if(r)return r});return e.calcCompleteEventCache(i,n,t,!0)},xh.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),Ws(n,function(t,e){r=r.concat(e)}),r})},xh.prototype.removeTags_=function(t){for(var e=0;e<t.length;++e){var n=t[e];if(!n.getQueryParams().loadsAllData()){var r=xh.makeQueryKey_(n),i=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(i)}}},xh.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},xh.prototype.setupListener_=function(t,e){var n=t.path,r=this.tagForQuery_(t),i=this.createListenerForView_(e),o=this.listenProvider_.startListening(xh.queryForListening_(t),r,i.hashFn,i.onComplete),a=this.syncPointTree_.subtree(n);if(r)ya(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),Ws(n,function(t,e){r=r.concat(e)}),r}),u=0;u<s.length;++u){var c=s[u];this.listenProvider_.stopListening(xh.queryForListening_(c),this.tagForQuery_(c))}return o},xh.prototype.createListenerForView_=function(t){var n=this,r=t.getQuery(),i=this.tagForQuery_(r);return{hashFn:function(){return(t.getServerCache()||yc.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return i?n.applyTaggedListenComplete(r.path,i):n.applyListenComplete(r.path);var e=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,r);return n.removeEventRegistration(r,null,e)}}},xh.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},xh.parseQueryKey_=function(t){var e=t.indexOf("$");return ya(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Ys(t.substr(0,e))}},xh.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},xh.prototype.tagForQuery_=function(t){var e=xh.makeQueryKey_(t);return this.queryToTagMap.get(e)},xh.getNextQueryTag_=function(){return xh.nextQueryTag_++},xh.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);ya(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},xh.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Ys.Empty))},xh.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(Ys.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(Ys.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},xh.prototype.applyOperationDescendantsHelper_=function(o,t,a,s){var u=this,e=t.get(Ys.Empty);null==a&&null!=e&&(a=e.getCompleteServerCache(Ys.Empty));var c=[];return t.children.inorderTraversal(function(t,e){var n=a?a.getImmediateChild(t):null,r=s.child(t),i=o.operationForChild(t);i&&(c=c.concat(u.applyOperationDescendantsHelper_(i,e,n,r)))}),e&&(c=c.concat(e.applyOperation(o,s,a))),c},xh.nextQueryTag_=1,xh);function xh(t){this.listenProvider_=t,this.syncPointTree_=Jc.Empty,this.pendingWriteTree_=new Rh,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}var Fh=(Uh.prototype.getNode=function(t){return this.rootNode_.getChild(t)},Uh.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},Uh);function Uh(){this.rootNode_=yc.EMPTY_NODE}var Vh=(qh.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(Ts("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},qh.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},qh.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},qh.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Cs(t)},qh);function qh(t){this.app_=t}var Bh=(jh.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),La(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},jh.prototype.get=function(){return va(this.counters_)},jh);function jh(){this.counters_={}}var Wh=(Kh.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Bh),this.collections_[e]},Kh.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},Kh.collections_={},Kh.reporters_={},Kh);function Kh(){}var Qh=(Hh.prototype.get=function(){var t=this.collection_.get(),n=oa({},t);return this.last_&&Ws(this.last_,function(t,e){n[t]=n[t]-e}),this.last_=t,n},Hh);function Hh(t){this.collection_=t,this.last_=null}var Gh=(zh.prototype.includeStat=function(t){this.statsToReport_[t]=!0},zh.prototype.reportStats_=function(){var n=this,t=this.statsListener_.get(),r={},i=!1;Ws(t,function(t,e){0<e&&La(n.statsToReport_,t)&&(r[t]=e,i=!0)}),i&&this.server_.reportStats(r),Hs(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},zh);function zh(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Qh(t);var n=1e4+2e4*Math.random();Hs(this.reportStats_.bind(this),Math.floor(n))}var Yh=(Xh.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new Jh(i)),e.add(r)}e&&this.eventLists_.push(e)},Xh.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})},Xh.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})},Xh.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},Xh);function Xh(){this.eventLists_=[],this.recursionDepth_=0}var Jh=($h.prototype.add=function(t){this.events_.push(t)},$h.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();Fs&&Ts("event: "+e.toString()),Qs(n)}}},$h.prototype.getPath=function(){return this.path_},$h);function $h(t){this.path_=t,this.events_=[]}var Zh=(tl.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=ha(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},tl.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},tl.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},tl.prototype.validateEventType_=function(e){ya(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},tl);function tl(t){this.allowedEvents_=t,this.listeners_={},ya(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}var el,nl=(ia(rl,el=Zh),rl.getInstance=function(){return new rl},rl.prototype.getInitialEvent=function(t){return ya("visible"===t,"Unknown event type: "+t),[this.visible_]},rl);function rl(){var e,t,n=el.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),n.visible_=!0,t&&document.addEventListener(t,function(){var t=!document[e];t!==n.visible_&&(n.visible_=t,n.trigger("visible",t))},!1),n}var il,ol=(ia(al,il=Zh),al.getInstance=function(){return new al},al.prototype.getInitialEvent=function(t){return ya("online"===t,"Unknown event type: "+t),[this.online_]},al.prototype.currentlyOnline=function(){return this.online_},al);function al(){var t=il.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Ea()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}var sl=(ul.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},ul.prototype.handleResponse=function(t,e){var r=this;this.pendingResponses[t]=e;for(var n=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&Qs(function(){r.onMessage_(e[t])})},n=0;n<e.length;++n)t(n);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==n(););},ul);function ul(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}var cl=(hl.prototype.open=function(t,e){var a=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new sl(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){a.log_("Timed out trying to connect."),a.onClosed_(),a.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!a.isClosed_){a.scriptTagHolder=new ll(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ca(t,5),r=n[0],i=n[1],o=n[2];if(n[3],n[4],a.incrementIncomingBytes_(t),a.scriptTagHolder)if(a.connectTimeoutTimer_&&(clearTimeout(a.connectTimeoutTimer_),a.connectTimeoutTimer_=null),a.everConnected_=!0,"start"==r)a.id=i,a.password=o;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(a.scriptTagHolder.sendNewPolls=!1,a.myPacketOrderer.closeAfter(i,function(){a.onClosed_()})):a.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ca(t,2),r=n[0],i=n[1];a.incrementIncomingBytes_(t),a.myPacketOrderer.handleResponse(r,i)},function(){a.onClosed_()},a.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),a.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=a.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",a.transportSessionId&&(t.s=a.transportSessionId),a.lastSessionId&&(t.ls=a.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Zs)&&(t.r="f");var e=a.urlFn(t);a.log_("Connecting via long-poll to "+e),a.scriptTagHolder.addTag(e,function(){})}})},hl.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},hl.forceAllow=function(){hl.forceAllow_=!0},hl.forceDisallow=function(){hl.forceDisallow_=!0},hl.isAvailable=function(){return!!hl.forceAllow_||!(hl.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)},hl.prototype.markConnectionHealthy=function(){},hl.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},hl.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},hl.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},hl.prototype.send=function(t){var e=Pa(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=function(t){var e=fa(t);return ga.encodeByteArray(e,!0)}(e),r=Ds(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},hl.prototype.addDisconnectPingFrame=function(t,e){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},hl.prototype.incrementIncomingBytes_=function(t){var e=Pa(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},hl);function hl(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Es(t),this.stats_=Wh.getCollection(e),this.urlFn=function(t){return e.connectionURL(eu,t)}}var ll=(pl.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Ts("No IE domain setting required")}catch(t){var n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},pl.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},pl.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},pl.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},pl.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},pl.prototype.addLongPollTag_=function(t,e){var n=this;function r(){n.outstandingRequests.delete(e),n.newRequest_()}this.outstandingRequests.add(e);var i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},pl.prototype.addTag=function(t,n){var r=this;setTimeout(function(){try{if(!r.sendNewPolls)return;var e=r.myIFrame.doc.createElement("script");e.type="text/javascript",e.async=!0,e.src=t,e.onload=e.onreadystatechange=function(){var t=e.readyState;t&&"loaded"!==t&&"complete"!==t||(e.onload=e.onreadystatechange=null,e.parentNode&&e.parentNode.removeChild(e),n())},e.onerror=function(){Ts("Long-poll script failed to load: "+t),r.sendNewPolls=!1,r.close()},r.myIFrame.doc.body.appendChild(e)}catch(t){}},Math.floor(1))},pl);function pl(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=Ls(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=pl.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){Ts("frame writing exception"),t.stack&&Ts(t.stack),Ts(t)}}var dl="";var yl=null;"undefined"!=typeof MozWebSocket?yl=MozWebSocket:"undefined"!=typeof WebSocket&&(yl=WebSocket);var ml=(gl.connectionURL_=function(t,e,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Zs)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(tu,r)},gl.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Os.set("previous_websocket_failure",!0);try{if(Ia()){var r=da.NODE_ADMIN?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+dl+"/"+process.platform+"/"+r}},o=process.env,a=0==this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a}),this.mySock=new yl(this.connURL,[],i)}else this.mySock=new yl(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var s=t.message||t.data;return s&&this.log_(s),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},gl.prototype.start=function(){},gl.forceDisallow=function(){gl.forceDisallow_=!0},gl.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==yl&&!gl.forceDisallow_},gl.previouslyFailed=function(){return Os.isInMemoryStorage||!0===Os.get("previous_websocket_failure")},gl.prototype.markConnectionHealthy=function(){Os.remove("previous_websocket_failure")},gl.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Oa(e);this.onMessage(n)}},gl.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},gl.prototype.extractFrameCount_=function(t){if(ya(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},gl.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},gl.prototype.send=function(t){this.resetKeepAlive();var e=Pa(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=Ds(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},gl.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},gl.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},gl.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},gl.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},gl.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},gl.responsesRequiredToBeHealthy=2,gl.healthyTimeout=3e4,gl);function gl(t,e,n,r){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Es(this.connId),this.stats_=Wh.getCollection(e),this.connURL=gl.connectionURL_(e,n,r)}var vl=(Object.defineProperty(bl,"ALL_TRANSPORTS",{get:function(){return[cl,ml]},enumerable:!0,configurable:!0}),bl.prototype.initTransports_=function(t){var e,n,r=ml&&ml.isAvailable(),i=r&&!ml.previouslyFailed();if(t.webSocketOnly&&(r||Cs("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[ml];else{var o=this.transports_=[];try{for(var a=ua(bl.ALL_TRANSPORTS),s=a.next();!s.done;s=a.next()){var u=s.value;u&&u.isAvailable()&&o.push(u)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}},bl.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},bl.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},bl);function bl(t){this.initTransports_(t)}var wl=(_l.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=Hs(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},_l.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},_l.prototype.disconnReceiver_=function(e){var n=this;return function(t){e===n.conn_?n.onConnectionLost_(t):e===n.secondaryConn_?(n.log_("Secondary connection lost."),n.onSecondaryConnectionLost_()):n.log_("closing an old connection")}},_l.prototype.connReceiver_=function(e){var n=this;return function(t){2!=n.state_&&(e===n.rx_?n.onPrimaryMessageReceived_(t):e===n.secondaryConn_?n.onSecondaryMessageReceived_(t):n.log_("message on old connection"))}},_l.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},_l.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},_l.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},_l.prototype.onSecondaryMessageReceived_=function(t){var e=ks("t",t),n=ks("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},_l.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},_l.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},_l.prototype.onPrimaryMessageReceived_=function(t){var e=ks("t",t),n=ks("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},_l.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},_l.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},_l.prototype.onControl_=function(t){var e=ks("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?Ss("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ss("Unknown control packet command: "+e)}},_l.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&Cs("Protocol version mismatch detected"),this.tryStartUpgrade_())},_l.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},_l.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Hs(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},_l.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},_l.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Hs(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},_l.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},_l.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},_l.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Os.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},_l.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},_l.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},_l.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},_l.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},_l);function _l(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Es("c:"+this.id+":"),this.transportManager_=new vl(e),this.log_("Connection created"),this.start_()}var Tl=(El.prototype.put=function(t,e,n,r){},El.prototype.merge=function(t,e,n,r){},El.prototype.refreshAuthToken=function(t){},El.prototype.onDisconnectPut=function(t,e,n){},El.prototype.onDisconnectMerge=function(t,e,n){},El.prototype.onDisconnectCancel=function(t,e){},El.prototype.reportStats=function(t){},El);function El(){}var Sl,Il=(ia(Cl,Sl=Tl),Cl.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(Pa(i)),ya(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},Cl.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),ya(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),ya(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},Cl.prototype.sendListen_=function(r){var i=this,o=r.query,a=o.path.toString(),s=o.queryIdentifier();this.log_("Listen on "+a+" for "+s);var t={p:a};r.tag&&(t.q=o.queryObject(),t.t=r.tag),t.h=r.hashFn(),this.sendRequest("q",t,function(t){var e=t.d,n=t.s;Cl.warnOnListenWarnings_(e,o),(i.listens.get(a)&&i.listens.get(a).get(s))===r&&(i.log_("listen response",t),"ok"!==n&&i.removeListen_(a,s),r.onComplete&&r.onComplete(n,e))})},Cl.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&La(t,"w")){var n=xa(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();Cs("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},Cl.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},Cl.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||function(t){var e=Ma(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},Cl.prototype.tryAuth=function(){var r=this;if(this.connected_&&this.authToken_){var i=this.authToken_,t=function(t){var e=Ma(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(i)?"auth":"gauth",e={cred:i};null===this.authOverride_?e.noauth=!0:"object"==typeof this.authOverride_&&(e.authvar=this.authOverride_),this.sendRequest(t,e,function(t){var e=t.s,n=t.d||"error";r.authToken_===i&&("ok"===e?r.invalidAuthTokenCount_=0:r.onAuthRevoked_(e,n))})}},Cl.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),ya(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},Cl.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},Cl.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},Cl.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},Cl.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},Cl.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},Cl.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},Cl.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},Cl.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},Cl.prototype.sendPut_=function(e){var n=this,r=this.outstandingPuts_[e].action,t=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(r,t,function(t){n.log_(r+" response",t),delete n.outstandingPuts_[e],n.outstandingPutCount_--,0===n.outstandingPutCount_&&(n.outstandingPuts_=[]),i&&i(t.s,t.d)})},Cl.prototype.reportStats=function(t){var n=this;if(this.connected_){var e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,function(t){if("ok"!==t.s){var e=t.d;n.log_("reportStats","Error sending stats: "+e)}})}},Cl.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+Pa(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},Cl.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):Ss("Unrecognized action received from server: "+Pa(t)+"\nAre you using the latest client?")},Cl.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},Cl.prototype.scheduleConnect_=function(t){var e=this;ya(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},Cl.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},Cl.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},Cl.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},Cl.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Cl.nextConnectionId_++,o=this,a=this.lastSessionId,s=!1,u=null,c=function(){u?u.close():(s=!0,r())};this.realtime_={close:c,sendRequest:function(t){ya(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(t)}};var t=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(t).then(function(t){s?Ts("getToken() completed but was canceled"):(Ts("getToken() completed. Creating connection."),o.authToken_=t&&t.accessToken,u=new wl(i,o.repoInfo_,e,n,r,function(t){Cs(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},a))}).then(null,function(t){o.log_("Failed to get token: "+t),s||c()})}},Cl.prototype.interrupt=function(t){Ts("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},Cl.prototype.resume=function(t){Ts("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Fa(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},Cl.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},Cl.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},Cl.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return js(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},Cl.prototype.removeListen_=function(t,e){var n,r=new Ys(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},Cl.prototype.onAuthRevoked_=function(t,e){Ts("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},Cl.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},Cl.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var i=ua(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,ua(a.values())),u=s.next();!u.done;u=s.next()){var c=u.value;this.sendListen_(c)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var l=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(l.action,l.pathString,l.data,l.onComplete)}},Cl.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+dl.replace(/\./g,"-")]=1,Ea()?t["framework.cordova"]=1:Sa()&&(t["framework.reactnative"]=1),this.reportStats(t)},Cl.prototype.shouldReconnect_=function(){var t=ol.getInstance().currentlyOnline();return Fa(this.interruptReasons_)&&t},Cl.nextPersistentConnectionId_=0,Cl.nextConnectionId_=0,Cl);function Cl(t,e,n,r,i,o){var a=Sl.call(this)||this;if(a.repoInfo_=t,a.onDataUpdate_=e,a.onConnectStatus_=n,a.onServerInfoUpdate_=r,a.authTokenProvider_=i,a.authOverride_=o,a.id=Cl.nextPersistentConnectionId_++,a.log_=Es("p:"+a.id+":"),a.interruptReasons_={},a.listens=new Map,a.outstandingPuts_=[],a.outstandingPutCount_=0,a.onDisconnectRequestQueue_=[],a.connected_=!1,a.reconnectDelay_=1e3,a.maxReconnectDelay_=3e5,a.securityDebugCallback_=null,a.lastSessionId=null,a.establishConnectionTimer_=null,a.visible_=!1,a.requestCBHash_={},a.requestNumber_=0,a.realtime_=null,a.authToken_=null,a.forceTokenRefresh_=!1,a.invalidAuthTokenCount_=0,a.firstConnection_=!0,a.lastConnectionAttemptTime_=null,a.lastConnectionEstablishedTime_=null,o&&!Ia())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return a.scheduleConnect_(0),nl.getInstance().on("visible",a.onVisible_,a),-1===t.host.indexOf("fblocal")&&ol.getInstance().on("online",a.onOnline_,a),a}var Nl,Al=(ia(kl,Nl=Tl),kl.prototype.reportStats=function(t){throw new Error("Method not implemented.")},kl.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(ya(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},kl.prototype.listen=function(t,e,r,i){var o=this,a=t.path.toString();this.log_("Listen called for "+a+" "+t.queryIdentifier());var s=kl.getListenId_(t,r),u={};this.listens_[s]=u;var n=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",n,function(t,e){var n=e;404===t&&(t=n=null),null===t&&o.onDataUpdate_(a,n,!1,r),xa(o.listens_,s)===u&&i(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},kl.prototype.unlisten=function(t,e){var n=kl.getListenId_(t,e);delete this.listens_[n]},kl.prototype.refreshAuthToken=function(t){},kl.prototype.restRequest_=function(i,o,a){var s=this;void 0===o&&(o={}),o.format="export",this.authTokenProvider_.getToken(!1).then(function(t){var e=t&&t.accessToken;e&&(o.auth=e);var n=(s.repoInfo_.secure?"https://":"http://")+s.repoInfo_.host+i+"?ns="+s.repoInfo_.namespace+function(t){for(var n=[],e=function(e,t){Array.isArray(t)?t.forEach(function(t){n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}):n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];e(o[0],o[1])}return n.length?"&"+n.join("&"):""}(o);s.log_("Sending REST request for "+n);var r=new XMLHttpRequest;r.onreadystatechange=function(){if(a&&4===r.readyState){s.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);var t=null;if(200<=r.status&&r.status<300){try{t=Oa(r.responseText)}catch(t){Cs("Failed to parse JSON response for "+n+": "+r.responseText)}a(null,t)}else 401!==r.status&&404!==r.status&&Cs("Got unsuccessful REST response for "+n+" Status: "+r.status),a(r.status);a=null}},r.open("GET",n,!0),r.send()})},kl);function kl(t,e,n){var r=Nl.call(this)||this;return r.repoInfo_=t,r.onDataUpdate_=e,r.authTokenProvider_=n,r.log_=Es("p:rest:"),r.listens_={},r}var Dl="repo_interrupt",Rl=(Ol.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},Ol.prototype.name=function(){return this.repoInfo_.namespace},Ol.prototype.serverTime=function(){var t=this.infoData_.getNode(new Ys(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},Ol.prototype.generateServerValues=function(){return function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t}({timestamp:this.serverTime()})},Ol.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new Ys(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=Ua(e,function(t){return _c(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=_c(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=Ua(e,function(t){return _c(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=_c(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},Ol.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},Ol.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},Ol.prototype.onServerInfoUpdate_=function(t){var n=this;Ws(t,function(t,e){n.updateInfo_(t,e)})},Ol.prototype.updateInfo_=function(t,e){var n=new Ys("/.info/"+t),r=_c(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},Ol.prototype.getNextWriteId_=function(){return this.nextWriteId_++},Ol.prototype.setWithPriority=function(i,t,e,o){var a=this;this.log_("set",{path:i.toString(),value:t,priority:e});var n=this.generateServerValues(),r=_c(t,e),s=Qc(r,n),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(i,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(i.toString(),r.val(!0),function(t,e){var n="ok"===t;n||Cs("set at "+i+" failed: "+t);var r=a.serverSyncTree_.ackUserWrite(u,!n);a.eventQueue_.raiseEventsForChangedPath(i,r),a.callOnCompleteCallback(o,t,e)});var h=this.abortTransactions_(i);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},Ol.prototype.update=function(o,t,a){var s=this;this.log_("update",{path:o.toString(),value:t});var r=!0,i=this.generateServerValues(),u={};if(Ws(t,function(t,e){r=!1;var n=_c(e);u[t]=Qc(n,i)}),r)Ts("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(a,"ok");else{var c=this.getNextWriteId_(),e=this.serverSyncTree_.applyUserMerge(o,u,c);this.eventQueue_.queueEvents(e),this.server_.merge(o.toString(),t,function(t,e){var n="ok"===t;n||Cs("update at "+o+" failed: "+t);var r=s.serverSyncTree_.ackUserWrite(c,!n),i=0<r.length?s.rerunTransactions_(o):o;s.eventQueue_.raiseEventsForChangedPath(i,r),s.callOnCompleteCallback(a,t,e)}),Ws(t,function(t){var e=s.abortTransactions_(o.child(t));s.rerunTransactions_(e)}),this.eventQueue_.raiseEventsForChangedPath(o,[])}},Ol.prototype.runOnDisconnectEvents_=function(){var r=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),e=function(t,n){var r=new qc;return t.forEachTree(new Ys(""),function(t,e){r.remember(t,Qc(e,n))}),r}(this.onDisconnect_,t),i=[];e.forEachTree(Ys.Empty,function(t,e){i=i.concat(r.serverSyncTree_.applyServerOverwrite(t,e));var n=r.abortTransactions_(t);r.rerunTransactions_(n)}),this.onDisconnect_=new qc,this.eventQueue_.raiseEventsForChangedPath(Ys.Empty,i)},Ol.prototype.onDisconnectCancel=function(n,r){var i=this;this.server_.onDisconnectCancel(n.toString(),function(t,e){"ok"===t&&i.onDisconnect_.forget(n),i.callOnCompleteCallback(r,t,e)})},Ol.prototype.onDisconnectSet=function(n,t,r){var i=this,o=_c(t);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},Ol.prototype.onDisconnectSetWithPriority=function(n,t,e,r){var i=this,o=_c(t,e);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},Ol.prototype.onDisconnectUpdate=function(r,n,i){var o=this;if(Fa(n))return Ts("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(i,"ok");this.server_.onDisconnectMerge(r.toString(),n,function(t,e){"ok"===t&&Ws(n,function(t,e){var n=_c(e);o.onDisconnect_.remember(r.child(t),n)}),o.callOnCompleteCallback(i,t,e)})},Ol.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},Ol.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},Ol.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(Dl)},Ol.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(Dl)},Ol.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new Qh(this.stats_)),this.statsListener_.get()):this.stats_.get();var i=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);Ws(e,function(t,e){for(var n=t,r=t.length;r<i+2;r++)n+=" ";console.log(n+e)})}},Ol.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},Ol.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),Ts.apply(void 0,ha([n],t))},Ol.prototype.callOnCompleteCallback=function(r,i,o){r&&Qs(function(){if("ok"==i)r(null);else{var t=(i||"error").toUpperCase(),e=t;o&&(e+=": "+o);var n=new Error(e);n.code=t,r(n)}})},Object.defineProperty(Ol.prototype,"database",{get:function(){return this.__database||(this.__database=new Jl(this))},enumerable:!0,configurable:!0}),Ol);function Ol(t,e,n){var a=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Yh,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new qc,this.persistentConnection_=null;var r=new Vh(n);if(this.stats_=Wh.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new Al(this.repoInfo_,this.onDataUpdate_.bind(this),r),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var i=n.options.databaseAuthVariableOverride;if(null!=i){if("object"!=typeof i)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Pa(i)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Il(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),r,i),this.server_=this.persistentConnection_}r.addTokenChangeListener(function(t){a.server_.refreshAuthToken(t)}),this.statsReporter_=Wh.getOrCreateReporter(t,function(){return new Gh(a.stats_,a.server_)}),this.transactions_init_(),this.infoData_=new Fh,this.infoSyncTree_=new Lh({startListening:function(t,e,n,r){var i=[],o=a.infoData_.getNode(t.path);return o.isEmpty()||(i=a.infoSyncTree_.applyServerOverwrite(t.path,o),setTimeout(function(){r("ok")},0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Lh({startListening:function(r,t,e,i){return a.server_.listen(r,e,t,function(t,e){var n=i(t,e);a.eventQueue_.raiseEventsForChangedPath(r.path,n)}),[]},stopListening:function(t,e){a.server_.unlisten(t,e)}})}var Pl=(Ml.prototype.getStartPost=function(){return this.startPost_},Ml.prototype.getEndPost=function(){return this.endPost_},Ml.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},Ml.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new ku(e,n))||(n=yc.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},Ml.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=yc.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(yc.EMPTY_NODE);var i=this;return e.forEachChild(zu,function(t,e){i.matches(new ku(t,e))||(r=r.updateImmediateChild(t,yc.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},Ml.prototype.updatePriority=function(t,e){return t},Ml.prototype.filtersNodes=function(){return!0},Ml.prototype.getIndexedFilter=function(){return this.indexedFilter_},Ml.prototype.getIndex=function(){return this.index_},Ml.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},Ml.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},Ml);function Ml(t){this.indexedFilter_=new lh(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Ml.getStartPost_(t),this.endPost_=Ml.getEndPost_(t)}var Ll=(xl.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new ku(e,n))||(n=yc.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},xl.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=yc.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=yc.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(yc.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)a=i.getNext(),!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,yc.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},xl.prototype.updatePriority=function(t,e){return t},xl.prototype.filtersNodes=function(){return!0},xl.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},xl.prototype.getIndex=function(){return this.index_},xl.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;ya(s.numChildren()==this.limit_,"");var u=new ku(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var l=s.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name==e||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&0<=p)return null!=i&&i.trackChildChange(ch.childChangedChange(e,n,l)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(ch.childRemovedChange(e,l));var d=s.updateImmediateChild(e,yc.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(ch.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&0<=o(c,u)?(null!=i&&(i.trackChildChange(ch.childRemovedChange(c.name,c.node)),i.trackChildChange(ch.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,yc.EMPTY_NODE)):t},xl);function xl(t){this.rangedFilter_=new Pl(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}var Fl=(Ul.prototype.hasStart=function(){return this.startSet_},Ul.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===Ul.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},Ul.prototype.getIndexStartValue=function(){return ya(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},Ul.prototype.getIndexStartName=function(){return ya(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Vs},Ul.prototype.hasEnd=function(){return this.endSet_},Ul.prototype.getIndexEndValue=function(){return ya(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},Ul.prototype.getIndexEndName=function(){return ya(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:qs},Ul.prototype.hasLimit=function(){return this.limitSet_},Ul.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},Ul.prototype.getLimit=function(){return ya(this.limitSet_,"Only valid if limit has been set"),this.limit_},Ul.prototype.getIndex=function(){return this.index_},Ul.prototype.copy_=function(){var t=new Ul;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},Ul.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},Ul.prototype.limitToFirst=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=Ul.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,e},Ul.prototype.limitToLast=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=Ul.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,e},Ul.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},Ul.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},Ul.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},Ul.prototype.getQueryObject=function(){var t=Ul.WIRE_PROTOCOL_CONSTANTS_,e={};if(this.startSet_&&(e[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(e[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(e[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(e[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){e[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),e[t.VIEW_FROM]=n}return this.index_!==zu&&(e[t.INDEX]=this.index_.toString()),e},Ul.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},Ul.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==zu},Ul.prototype.getNodeFilter=function(){return this.loadsAllData()?new lh(this.getIndex()):this.hasLimit()?new Ll(this):new Pl(this)},Ul.prototype.toRestQueryStringParameters=function(){var t,e=Ul.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(t=this.index_===zu?e.PRIORITY_INDEX:this.index_===Sc?e.VALUE_INDEX:this.index_===Uu?e.KEY_INDEX:(ya(this.index_ instanceof Ic,"Unrecognized index type!"),this.index_.toString()),n[e.ORDER_BY]=Pa(t),this.startSet_&&(n[e.START_AT]=Pa(this.indexStartValue_),this.startNameSet_&&(n[e.START_AT]+=","+Pa(this.indexStartName_))),this.endSet_&&(n[e.END_AT]=Pa(this.indexEndValue_),this.endNameSet_&&(n[e.END_AT]+=","+Pa(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[e.LIMIT_TO_FIRST]=this.limit_:n[e.LIMIT_TO_LAST]=this.limit_)),n},Ul.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},Ul.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},Ul.DEFAULT=new Ul,Ul);function Ul(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=zu}var Vl,ql=(ia(Bl,Vl=Uc),Bl.prototype.getKey=function(){return Qa("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},Bl.prototype.child=function(t){return Qa("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof Ys||(null===this.path.getFront()?function(t,e,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),pu(t,e,n,r)}("Reference.child",1,t,!1):pu("Reference.child",1,t,!1)),new Bl(this.repo,this.path.child(t))},Bl.prototype.getParent=function(){Qa("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new Bl(this.repo,t)},Bl.prototype.getRoot=function(){Qa("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},Bl.prototype.databaseProp=function(){return this.repo.database},Bl.prototype.set=function(t,e){Qa("Reference.set",1,2,arguments.length),du("Reference.set",this.path),uu("Reference.set",1,t,this.path,!1),Ga("Reference.set",2,e,!0);var n=new wa;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},Bl.prototype.update=function(t,e){if(Qa("Reference.update",1,2,arguments.length),du("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Cs("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}cu("Reference.update",1,t,this.path,!1),Ga("Reference.update",2,e,!0);var i=new wa;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},Bl.prototype.setWithPriority=function(t,e,n){if(Qa("Reference.setWithPriority",2,3,arguments.length),du("Reference.setWithPriority",this.path),uu("Reference.setWithPriority",1,t,this.path,!1),hu("Reference.setWithPriority",2,e,!1),Ga("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new wa;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},Bl.prototype.remove=function(t){return Qa("Reference.remove",0,1,arguments.length),du("Reference.remove",this.path),Ga("Reference.remove",1,t,!0),this.set(null,t)},Bl.prototype.transaction=function(t,r,e){if(Qa("Reference.transaction",1,3,arguments.length),du("Reference.transaction",this.path),Ga("Reference.transaction",1,t,!1),Ga("Reference.transaction",2,r,!0),function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Ha(t,e,r)+"must be a boolean.")}("Reference.transaction",3,e,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===e&&(e=!0);var i=new wa;return"function"==typeof r&&i.promise.catch(function(){}),this.repo.startTransaction(this.path,t,function(t,e,n){t?i.reject(t):i.resolve(new Eu(e,n)),"function"==typeof r&&r(t,e,n)},e),i.promise},Bl.prototype.setPriority=function(t,e){Qa("Reference.setPriority",1,2,arguments.length),du("Reference.setPriority",this.path),hu("Reference.setPriority",1,t,!1),Ga("Reference.setPriority",2,e,!0);var n=new wa;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},Bl.prototype.push=function(t,e){Qa("Reference.push",0,2,arguments.length),du("Reference.push",this.path),uu("Reference.push",1,t,this.path,!0),Ga("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=Au(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},Bl.prototype.onDisconnect=function(){return du("Reference.onDisconnect",this.path),new _u(this.repo,this.path)},Object.defineProperty(Bl.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(Bl.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(Bl.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(Bl.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),Bl);function Bl(t,e){if(!(t instanceof Rl))throw new Error("new Reference() no longer supported - use app.database().");return Vl.call(this,t,e,Fl.DEFAULT,!1)||this}Uc.__referenceConstructor=ql,Nh.__referenceConstructor=ql;var jl,Wl,Kl=function(){this.children={},this.childCount=0,this.value=null},Ql=(Hl.prototype.subTree=function(t){for(var e,n=t instanceof Ys?t:new Ys(t),r=this;null!==(e=n.getFront());)r=new Hl(e,r,xa(r.node_.children,e)||new Kl),n=n.popFront();return r},Hl.prototype.getValue=function(){return this.node_.value},Hl.prototype.setValue=function(t){ya(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},Hl.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},Hl.prototype.hasChildren=function(){return 0<this.node_.childCount},Hl.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},Hl.prototype.forEachChild=function(n){var r=this;Ws(this.node_.children,function(t,e){n(new Hl(t,r,e))})},Hl.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild(function(t){t.forEachDescendant(e,!0,n)}),t&&n&&e(this)},Hl.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},Hl.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},Hl.prototype.path=function(){return new Ys(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},Hl.prototype.name=function(){return this.name_},Hl.prototype.parent=function(){return this.parent_},Hl.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},Hl.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=La(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},Hl);function Hl(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new Kl),this.name_=t,this.parent_=e,this.node_=n}(Wl=jl=jl||{})[Wl.RUN=0]="RUN",Wl[Wl.SENT=1]="SENT",Wl[Wl.COMPLETED=2]="COMPLETED",Wl[Wl.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",Wl[Wl.NEEDS_ABORT=4]="NEEDS_ABORT",Rl.MAX_TRANSACTION_RETRIES_=25,Rl.prototype.transactions_init_=function(){this.transactionQueueTree_=new Ql},Rl.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);function i(){}var o=new ql(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:Ls(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new Nc(a.currentInputSnapshot,new ql(this,a.path),zu);a.onComplete(null,!1,c)}}else{wu("transaction failed: Data returned ",u,a.path),a.status=jl.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(a),h.setValue(l);var f=void 0;if("object"==typeof u&&null!==u&&La(u,".priority"))f=xa(u,".priority"),ya(su(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else f=(this.serverSyncTree_.calcCompleteEventCache(t)||yc.EMPTY_NODE).getPriority().val();f=f;var p=this.generateServerValues(),d=_c(u,f),y=Qc(d,p);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,y,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},Rl.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||yc.EMPTY_NODE},Rl.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);ya(0<n.length,"Sending zero length transaction queue"),n.every(function(t){return t.status===jl.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},Rl.prototype.sendTransactionQueue_=function(s,u){for(var c=this,t=u.map(function(t){return t.currentWriteId}),e=this.getLatestState_(s,t),n=e,r=e.hash(),i=0;i<u.length;i++){var o=u[i];ya(o.status===jl.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),o.status=jl.SENT,o.retryCount++;var a=Ys.relativePath(s,o.path);n=n.updateChild(a,o.currentOutputSnapshotRaw)}var h=n.val(!0),l=s;this.server_.put(l.toString(),h,function(t){c.log_("transaction put response",{path:l.toString(),status:t});var e=[];if("ok"===t){for(var n=[],r=0;r<u.length;r++){if(u[r].status=jl.COMPLETED,e=e.concat(c.serverSyncTree_.ackUserWrite(u[r].currentWriteId)),u[r].onComplete){var i=u[r].currentOutputSnapshotResolved,o=new ql(c,u[r].path),a=new Nc(i,o,zu);n.push(u[r].onComplete.bind(null,null,!0,a))}u[r].unwatcher()}c.pruneCompletedTransactionsBelowNode_(c.transactionQueueTree_.subTree(s)),c.sendReadyTransactions_(),c.eventQueue_.raiseEventsForChangedPath(s,e);for(r=0;r<n.length;r++)Qs(n[r])}else{if("datastale"===t)for(r=0;r<u.length;r++)u[r].status===jl.SENT_NEEDS_ABORT?u[r].status=jl.NEEDS_ABORT:u[r].status=jl.RUN;else{Cs("transaction at "+l.toString()+" failed: "+t);for(r=0;r<u.length;r++)u[r].status=jl.NEEDS_ABORT,u[r].abortReason=t}c.rerunTransactions_(s)}},r)},Rl.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Rl.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter(function(t){return t.status===jl.RUN}).map(function(t){return t.currentWriteId}),a=0;a<t.length;a++){var s=t[a],u=Ys.relativePath(e,s.path),c=!1,h=void 0;if(ya(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===jl.NEEDS_ABORT)c=!0,h=s.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===jl.RUN)if(s.retryCount>=Rl.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var l=this.getLatestState_(s.path,o);s.currentInputSnapshot=l;var f=t[a].update(l.val());if(void 0!==f){wu("transaction failed: Data returned ",f,s.path);var p=_c(f);"object"==typeof f&&null!=f&&La(f,".priority")||(p=p.updatePriority(l.getPriority()));var d=s.currentWriteId,y=this.generateServerValues(),m=Qc(p,y);s.currentOutputSnapshotRaw=p,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(d),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(s.path,m,s.currentWriteId,s.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],c&&(t[a].status=jl.COMPLETED,n=t[a].unwatcher,setTimeout(n,Math.floor(0)),t[a].onComplete))if("nodata"===h){var g=new ql(this,t[a].path),v=t[a].currentInputSnapshot,b=new Nc(v,g,zu);r.push(t[a].onComplete.bind(null,null,!1,b))}else r.push(t[a].onComplete.bind(null,new Error(h),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<r.length;a++)Qs(r[a]);this.sendReadyTransactions_()}},Rl.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},Rl.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},Rl.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},Rl.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==jl.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},Rl.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},Rl.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)if(e[o].status===jl.SENT_NEEDS_ABORT);else if(e[o].status===jl.SENT)ya(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=jl.SENT_NEEDS_ABORT,e[o].abortReason="set";else if(ya(e[o].status===jl.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete){n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(o=0;o<n.length;o++)Qs(n[o])}};var Gl,zl="databaseURL",Yl=(Xl.getInstance=function(){return Gl=Gl||new Xl},Xl.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},Xl.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},Xl.prototype.databaseFromApp=function(t,e){var n=e||t.options[zl];void 0===n&&Is("Can't determine Firebase Database URL.  Be sure to include "+zl+" option when calling firebase.initializeApp().");var r=iu(n),i=r.repoInfo,o=void 0;return"undefined"!=typeof process&&(o=process.env.FIREBASE_DATABASE_EMULATOR_HOST),o&&(n="http://"+o+"?ns="+i.namespace,i=(r=iu(n)).repoInfo),yu("Invalid Firebase Database URL",1,r),r.path.isEmpty()||Is("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,t).database},Xl.prototype.deleteRepo=function(t){var e=xa(this.repos_,t.app.name);e&&xa(e,t.repoInfo_.toURLString())===t||Is("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},Xl.prototype.createRepo=function(t,e){var n=xa(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=xa(n,t.toURLString());return r&&Is("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Rl(t,this.useRestClient_,e),n[t.toURLString()]=r},Xl.prototype.forceRestClient=function(t){this.useRestClient_=t},Xl);function Xl(){this.repos_={},this.useRestClient_=!1}var Jl=(Object.defineProperty($l.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),$l.prototype.ref=function(t){return this.checkDeleted_("ref"),Qa("database.ref",0,1,arguments.length),t instanceof ql?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},$l.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),Qa(e,1,1,arguments.length);var n=iu(t);yu(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&Is(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},$l.prototype.checkDeleted_=function(t){null===this.repo_&&Is("Cannot call "+t+" on a deleted database.")},$l.prototype.goOffline=function(){Qa("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},$l.prototype.goOnline=function(){Qa("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},$l.ServerValue={TIMESTAMP:{".sv":"timestamp"}},$l);function $l(t){(this.repo_=t)instanceof Rl||Is("Don't call new Database() directly - please use firebase.database()."),this.root_=new ql(t,Ys.Empty),this.INTERNAL=new Zl(this)}var Zl=(tf.prototype.delete=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){return this.database.checkDeleted_("delete"),Yl.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},tf);function tf(t){this.database=t}var ef=Object.freeze({__proto__:null,forceLongPolling:function(){ml.forceDisallow(),cl.forceAllow()},forceWebSockets:function(){cl.forceDisallow()},isWebSocketsAvailable:function(){return ml.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),nf=Il;Il.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Il.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var rf,of,af=wl,sf=nu,uf=Object.freeze({__proto__:null,DataConnection:nf,RealTimeConnection:af,hijackHash:function(i){var o=Il.prototype.put;return Il.prototype.put=function(t,e,n,r){void 0!==r&&(r=i()),o.call(this,t,e,n,r)},function(){Il.prototype.put=o}},ConnectionTarget:sf,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){Yl.getInstance().forceRestClient(t)}}),cf=Jl.ServerValue;rf=(of=fl).SDK_VERSION,dl=rf,of.INTERNAL.registerService("database",function(t,e,n){return Yl.getInstance().databaseFromApp(t,n)},{Reference:ql,Query:Uc,Database:Jl,DataSnapshot:Nc,enableLogging:_s,INTERNAL:ef,ServerValue:cf,TEST_ACCESS:uf},null,!0);var hf,lf="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ff=ff||{},pf=lf;function df(t){return"string"==typeof t}function yf(t){return"number"==typeof t}function mf(t,e){t=t.split("."),e=e||pf;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function gf(){}function vf(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function bf(t){return"array"==vf(t)}function wf(t){var e=vf(t);return"array"==e||"object"==e&&"number"==typeof t.length}function _f(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Tf="closure_uid_"+(1e9*Math.random()>>>0),Ef=0;function Sf(t,e,n){return t.call.apply(t.bind,arguments)}function If(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function Cf(t,e,n){return(Cf=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Sf:If).apply(null,arguments)}function Nf(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var Af=Date.now||function(){return+new Date};function kf(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).yb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function Df(){this.j=this.j,this.i=this.i}Df.prototype.j=!1,Df.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[Tf]||(this[Tf]=++Ef)},Df.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var Rf=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(df(t))return df(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Of=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=df(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Pf(){return Array.prototype.concat.apply([],arguments)}function Mf(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Lf(t){return/^[\s\xa0]*$/.test(t)}var xf,Ff=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Uf(t,e){return-1!=t.indexOf(e)}function Vf(t,e){return t<e?-1:e<t?1:0}t:{var qf=pf.navigator;if(qf){var Bf=qf.userAgent;if(Bf){xf=Bf;break t}}xf=""}function jf(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Wf(t){var e,n={};for(e in t)n[e]=t[e];return n}var Kf="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Qf(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<Kf.length;i++)e=Kf[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function Hf(t){return Hf[" "](t),t}Hf[" "]=gf;var Gf,zf,Yf=Uf(xf,"Opera"),Xf=Uf(xf,"Trident")||Uf(xf,"MSIE"),Jf=Uf(xf,"Edge"),$f=Jf||Xf,Zf=Uf(xf,"Gecko")&&!(Uf(xf.toLowerCase(),"webkit")&&!Uf(xf,"Edge"))&&!(Uf(xf,"Trident")||Uf(xf,"MSIE"))&&!Uf(xf,"Edge"),tp=Uf(xf.toLowerCase(),"webkit")&&!Uf(xf,"Edge");function ep(){var t=pf.document;return t?t.documentMode:void 0}t:{var np="",rp=(zf=xf,Zf?/rv:([^\);]+)(\)|;)/.exec(zf):Jf?/Edge\/([\d\.]+)/.exec(zf):Xf?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(zf):tp?/WebKit\/(\S+)/.exec(zf):Yf?/(?:Version)[ \/]?(\S+)/.exec(zf):void 0);if(rp&&(np=rp?rp[1]:""),Xf){var ip=ep();if(null!=ip&&ip>parseFloat(np)){Gf=String(ip);break t}}Gf=np}var op,ap={};function sp(s){return function(t,e){var n=ap;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=Ff(String(Gf)).split("."),n=Ff(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=Vf(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||Vf(0==o[2].length,0==a[2].length)||Vf(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}var up=pf.document;op=up&&Xf?ep()||("CSS1Compat"==up.compatMode?parseInt(Gf,10):5):void 0;var cp=!Xf||9<=Number(op),hp=Xf&&!sp("9"),lp=function(){if(!pf.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{pf.addEventListener("test",gf,e),pf.removeEventListener("test",gf,e)}catch(t){}return t}();function fp(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function pp(t,e){if(fp.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(Zf){t:{try{Hf(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=df(t.pointerType)?t.pointerType:dp[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}fp.prototype.b=function(){this.Ja=!1},kf(pp,fp);var dp={2:"touch",3:"pen",4:"mouse"};pp.prototype.b=function(){pp.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,hp)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var yp="closure_listenable_"+(1e6*Math.random()|0),mp=0;function gp(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++mp,this.X=this.Z=!1}function vp(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function bp(t){this.src=t,this.a={},this.b=0}function wp(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=Rf(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(vp(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function _p(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}bp.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=_p(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new gp(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Tp="closure_lm_"+(1e6*Math.random()|0),Ep={};function Sp(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(bf(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=Op(r);return e&&e[yp]?e.Ba(n,r,_f(i)?!!i.capture:!!i,o):Ip(e,n,r,!0,i,o)}(t,e,n,r,i);if(bf(e)){for(var o=0;o<e.length;o++)Sp(t,e[o],n,r,i);return null}return n=Op(n),t&&t[yp]?t.Aa(e,n,_f(r)?!!r.capture:!!r,i):Ip(t,e,n,!1,r,i)}function Ip(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=_f(i)?!!i.capture:!!i;if(a&&!cp)return null;var s=Dp(t);if(s||(t[Tp]=s=new bp(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var e=kp,n=cp?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)lp||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Np(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Cp(t){if(!yf(t)&&t&&!t.X){var e=t.src;if(e&&e[yp])wp(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Np(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Dp(e))?(wp(n,t),0==n.b&&(n.src=null,e[Tp]=null)):vp(t)}}}function Np(t){return t in Ep?Ep[t]:Ep[t]="on"+t}function Ap(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Cp(t),n.call(r,e)}function kp(t,e){return!!t.X||(cp?Ap(t,new pp(e,this)):Ap(t,e=new pp(e||mf("window.event"),this)))}function Dp(t){return(t=t[Tp])instanceof bp?t:null}var Rp="__closure_events_fn_"+(1e9*Math.random()>>>0);function Op(e){return"function"==vf(e)?e:(e[Rp]||(e[Rp]=function(t){return e.handleEvent(t)}),e[Rp])}function Pp(){Df.call(this),this.c=new bp(this),(this.J=this).B=null}function Mp(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&wp(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}kf(Pp,Df),Pp.prototype[yp]=!0,(hf=Pp.prototype).addEventListener=function(t,e,n,r){Sp(this,t,e,n,r)},hf.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(bf(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=_f(i)?!!i.capture:!!i,r=Op(r),e&&e[yp]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=_p(a=e.a[n],r,i,o))&&(vp(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):(e=e&&Dp(e))&&(n=e.a[n.toString()],e=-1,n&&(e=_p(n,r,i,o)),(r=-1<e?n[e]:null)&&Cp(r))}(this,t,e,n,r)},hf.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(df(t))t=new fp(t,n);else if(t instanceof fp)t.target=t.target||n;else{var i=t;Qf(t=new fp(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=Mp(a,r,!0,t)&&i}if(i=Mp(a=t.a=n,r,!0,t)&&i,i=Mp(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Mp(a=t.a=e[o],r,!1,t)&&i;return i},hf.G=function(){if(Pp.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)vp(n[r]);delete e.a[t],e.b--}}this.B=null},hf.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},hf.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Lp=pf.JSON.stringify;function xp(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Fp(){this.b=this.a=null}xp.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Up,Vp=new xp(function(){return new qp},function(t){t.reset()});function qp(){this.next=this.b=this.a=null}function Bp(t){pf.setTimeout(function(){throw t},0)}function jp(t,e){Up||function(){var t=pf.Promise.resolve(void 0);Up=function(){t.then(Qp)}}(),Wp||(Up(),Wp=!0),Kp.add(t,e)}Fp.prototype.add=function(t,e){var n=Vp.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},qp.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Wp=!(qp.prototype.reset=function(){this.next=this.b=this.a=null}),Kp=new Fp;function Qp(){for(var t;r=n=void 0,r=null,(n=Kp).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Bp(t)}var e=Vp;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;Wp=!1}function Hp(t,e){Pp.call(this),this.b=t||1,this.a=e||pf,this.f=Cf(this.gb,this),this.g=Af()}function Gp(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function zp(t,e,n){if("function"==vf(t))n&&(t=Cf(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Cf(t.handleEvent,t)}return 2147483647<Number(e)?-1:pf.setTimeout(t,e||0)}function Yp(t,e,n){Df.call(this),this.f=null!=n?Cf(t,n):t,this.c=e,this.b=Cf(this.ab,this),this.a=[]}function Xp(t){t.U=zp(t.b,t.c),t.f.apply(null,t.a)}function Jp(t){Df.call(this),this.b=t,this.a={}}kf(Hp,Pp),(hf=Hp.prototype).ba=!1,hf.L=null,hf.gb=function(){if(this.ba){var t=Af()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Gp(this),this.start()))}},hf.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=Af())},hf.G=function(){Hp.N.G.call(this),Gp(this),delete this.a},kf(Yp,Df),(hf=Yp.prototype).ea=!1,hf.U=null,hf.Ua=function(t){this.a=arguments,this.U?this.ea=!0:Xp(this)},hf.G=function(){Yp.N.G.call(this),this.U&&(pf.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},hf.ab=function(){this.U=null,this.ea&&(this.ea=!1,Xp(this))},kf(Jp,Df);var $p=[];function Zp(t,e,n,r){bf(n)||(n&&($p[0]=n.toString()),n=$p);for(var i=0;i<n.length;i++){var o=Sp(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function td(t){jf(t.a,function(t,e){this.a.hasOwnProperty(e)&&Cp(t)},t),t.a={}}function ed(){}Jp.prototype.G=function(){Jp.N.G.call(this),td(this)},Jp.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var nd=new Pp;function rd(t){fp.call(this,"serverreachability",t)}function id(t){nd.dispatchEvent(new rd(nd,t))}function od(t){fp.call(this,"statevent",t)}function ad(t){nd.dispatchEvent(new od(nd,t))}function sd(t){fp.call(this,"timingevent",t)}function ud(t,e){if("function"!=vf(t))throw Error("Fn must not be null and must be a function");return pf.setTimeout(function(){t()},e)}kf(rd,fp),kf(od,fp),kf(sd,fp);var cd={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},hd={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function ld(){}function fd(t){var e;return(e=t.a)||(e=t.a={}),e}function pd(){}ld.prototype.a=null;var dd,yd={OPEN:"a",ib:"b",Na:"c",rb:"d"};function md(){fp.call(this,"d")}function gd(){fp.call(this,"c")}function vd(){}function bd(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new Jp(this),this.O=wd,t=$f?125:void 0,this.P=new Hp(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}kf(md,fp),kf(gd,fp),kf(vd,ld),dd=new vd;var wd=45e3,_d={},Td={};function Ed(t,e,n){t.F=1,t.f=zd(Bd(e)),t.l=n,t.H=!0,Id(t,null)}function Sd(t,e,n,r){t.F=1,t.f=zd(Bd(e)),t.l=null,t.H=n,Id(t,r)}function Id(t,e){t.v=Af(),Ad(t),t.D=Bd(t.f),Gd(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new Yp(Cf(t.Ka,t,t.a),t.J)),Zp(t.I,t.a,"readystatechange",t.eb),e=t.h?Wf(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),id(1)}function Cd(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Nd(t,n);if(i==Td){4==e&&(t.c=4,ad(14),r=!1);break}if(i==_d){t.c=4,ad(15),r=!1;break}Pd(t,i)}4==e&&0==n.length&&(t.c=1,ad(16),r=!1),t.b=t.b&&r,r||(Od(t),Rd(t))}function Nd(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Td:(n=Number(e.substring(n,r)),isNaN(n)?_d:(r+=1)+n>e.length?Td:(e=e.substr(r,n),t.A=r+n,e))}function Ad(t){t.R=Af()+t.O,kd(t,t.O)}function kd(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=ud(Cf(t.bb,t),e)}function Dd(t){t.i&&(pf.clearTimeout(t.i),t.i=null)}function Rd(t){t.g.Da()||t.m||t.g.na(t)}function Od(t){Dd(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,Gp(t.P),td(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Pd(t,e){try{t.g.Ga(t,e),id(4)}catch(t){}}function Md(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(wf(t)||df(t))Of(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(wf(t)||df(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(df(t))return t.split("");if(wf(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ld(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ld)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function xd(t,e){Ud(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Fd(t))}function Fd(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ud(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Ud(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Ud(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(hf=bd.prototype).setTimeout=function(t){this.O=t},hf.eb=function(t){t=t.target;var e=this.B;e&&3==qy(t)?e.Ua():this.Ka(t)},hf.Ka=function(t){try{if(t==this.a)t:{var e=qy(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!$f&&!this.a.aa())){this.m||4!=e||7==n||id(8==n||r<=0?3:2),Dd(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=By(this.a,"X-HTTP-Initial-Response");if(a&&!Lf(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,ad(12),Od(this),Rd(this);break t}this.s=!0,Pd(this,s)}this.H?(Cd(this,e,o),$f&&this.b&&3==e&&(Zp(this.I,this.P,"tick",this.cb),this.P.start())):Pd(this,o),4==e&&Od(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Ad(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,ad(12)):(this.c=0,ad(13)),Od(this),Rd(this)}}}catch(t){}},hf.cb=function(){if(this.a){var t=qy(this.a),e=this.a.aa();this.A<e.length&&(Dd(this),Cd(this,t,e),this.b&&4!=t&&Ad(this))}},hf.cancel=function(){this.m=!0,Od(this)},hf.bb=function(){this.i=null;var t=Af();0<=t-this.R?(2!=this.F&&(id(3),ad(17)),Od(this),this.c=2,Rd(this)):kd(this,this.R-t)},(hf=Ld.prototype).C=function(){Fd(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},hf.K=function(){return Fd(this),this.a.concat()},hf.get=function(t,e){return Ud(this.b,t)?this.b[t]:e},hf.set=function(t,e){Ud(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},hf.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Vd=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function qd(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof qd?(this.h=void 0!==e?e:t.h,jd(this,t.f),this.j=t.j,Wd(this,t.b),Kd(this,t.i),this.a=t.a,Qd(this,uy(t.c)),this.g=t.g):t&&(n=String(t).match(Vd))?(this.h=!!e,jd(this,n[1]||"",!0),this.j=Yd(n[2]||""),Wd(this,n[3]||"",!0),Kd(this,n[4]),this.a=Yd(n[5]||"",!0),Qd(this,n[6]||"",!0),this.g=Yd(n[7]||"")):(this.h=!!e,this.c=new ry(null,this.h))}function Bd(t){return new qd(t)}function jd(t,e,n){t.f=n?Yd(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Wd(t,e,n){t.b=n?Yd(e,!0):e}function Kd(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Qd(t,e,n){e instanceof ry?(t.c=e,function(t,e){e&&!t.f&&(iy(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(oy(this,e),sy(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=Xd(e,ey)),t.c=new ry(e,t.h))}function Hd(t,e,n){t.c.set(e,n)}function Gd(t,e,n){bf(n)||(n=[String(n)]),sy(t.c,e,n)}function zd(t){return Hd(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Af()).toString(36)),t}function Yd(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Xd(t,e,n){return df(t)?(t=encodeURI(t).replace(e,Jd),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Jd(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}qd.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Xd(e,$d,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(Xd(e,$d,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Xd(n,"/"==n.charAt(0)?ty:Zd,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Xd(n,ny)),t.join("")},qd.prototype.resolve=function(t){var e=Bd(this),n=!!t.f;n?jd(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?Wd(e,t.b):n=null!=t.i;var r=t.a;if(n)Kd(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(Uf(i,"./")||Uf(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?Qd(e,uy(t.c)):n=!!t.g,n&&(e.g=t.g),e};var $d=/[#\/\?@]/g,Zd=/[#\?:]/g,ty=/[#\?]/g,ey=/[#\?@]/g,ny=/#/g;function ry(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function iy(n){n.a||(n.a=new Ld,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function oy(t,e){iy(t),e=cy(t,e),Ud(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,xd(t.a,e))}function ay(t,e){return iy(t),e=cy(t,e),Ud(t.a.b,e)}function sy(t,e,n){oy(t,e),0<n.length&&(t.c=null,t.a.set(cy(t,e),Mf(n)),t.b+=n.length)}function uy(t){var e=new ry;return e.c=t.c,t.a&&(e.a=new Ld(t.a),e.b=t.b),e}function cy(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function hy(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function ly(t){var e=t.a.F.a;if(null!=e)ad(4),e?(ad(10),Zy(t.a,t,!1)):(ad(11),Zy(t.a,t,!0));else{t.b=new bd(t,void 0,void 0),t.b.h=t.h,e=im(e=t.a,e.Y()?t.f:null,t.i),ad(4),Gd(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&Hd(e,n,r),Sd(t.b,e,!1,t.f)}}function fy(){this.a=this.b=null}function py(){this.a=new Ld}function dy(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[Tf]||(t[Tf]=++Ef)):e.charAt(0)+t}function yy(t,e){this.b=t,this.a=e}function my(t){this.g=t||gy,t=pf.PerformanceNavigationTiming?0<(t=pf.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(pf.ka&&pf.ka.Ea&&pf.ka.Ea()&&pf.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new py),this.b=null,this.c=[]}(hf=ry.prototype).add=function(t,e){iy(this),this.c=null,t=cy(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},hf.forEach=function(n,r){iy(this),this.a.forEach(function(t,e){Of(t,function(t){n.call(r,t,e,this)},this)},this)},hf.K=function(){iy(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},hf.C=function(t){iy(this);var e=[];if(df(t))ay(this,t)&&(e=Pf(e,this.a.get(cy(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=Pf(e,t[n])}return e},hf.set=function(t,e){return iy(this),this.c=null,ay(this,t=cy(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},hf.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},hf.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},kf(function(){},function(){}),(hf=hy.prototype).M=null,hf.$=function(t){return this.a.$(t)},hf.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},hf.Da=function(){return!1},hf.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=By(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=By(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void nm(e,2)}this.f=r[0]}else(e=this.a).m=this.c,nm(e,2)}else 1==this.M&&(this.g?ad(6):"11111"==e?(ad(5),this.g=!0,(!Xf||10<=Number(op))&&(this.c=200,this.b.cancel(),ad(11),Zy(this.a,this,!0))):(ad(7),this.g=!1))},hf.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,ly(this)):1==this.M&&(this.g?(ad(11),Zy(this.a,this,!0)):(ad(10),Zy(this.a,this,!1)));else{0==this.M?ad(8):1==this.M&&ad(9);var t=this.a;t.m=this.c,nm(t,2)}},hf.Y=function(){return this.a.Y()},hf.ma=function(){return this.a.ma()},py.prototype.add=function(t){this.a.set(dy(t),t)},py.prototype.C=function(){return this.a.C()};var gy=10;function vy(t,e){!t.a&&(Uf(e,"spdy")||Uf(e,"quic")||Uf(e,"h2"))&&(t.f=t.g,t.a=new py,t.b&&(Ty(t,t.b),t.b=null))}function by(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function wy(t){return t.b?1:t.a?t.a.a.c:0}function _y(t,e){return t=t.b?t.b==e:!!t.a&&(e=dy(e),Ud(t.a.a.b,e))}function Ty(t,e){t.a?t.a.add(e):t.b=e}function Ey(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=dy(e),n=Ud(t.a.a.b,n)),n&&xd(t.a.a,dy(e)))}function Sy(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return Mf(t.c);var e=t.c;return Of(t.a.C(),function(t){e=e.concat(t.j)}),e}function Iy(){}function Cy(){this.a=new Iy}function Ny(t,r,e){var i=e||"";try{Md(t,function(t,e){var n=t;_f(t)&&(n=Lp(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function Ay(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}my.prototype.cancel=function(){this.c=Sy(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(Of(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},Iy.prototype.stringify=function(t){return pf.JSON.stringify(t,void 0)},Iy.prototype.parse=function(t){return pf.JSON.parse(t,void 0)};var ky=pf.JSON.parse;function Dy(t){Pp.call(this),this.headers=new Ld,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Ry,this.D=this.F=!1}kf(Dy,Pp);var Ry="",Oy=/^https?$/i,Py=["POST","PUT"];function My(t){return"content-type"==t.toLowerCase()}function Ly(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,xy(t),Uy(t)}function xy(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Fy(t){if(t.b&&void 0!==ff&&(!t.s[1]||4!=qy(t)||2!=t.T()))if(t.l&&4==qy(t))zp(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==qy(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Vd)[1]||null;if(!o&&pf.self&&pf.self.location){var a=pf.self.location.protocol;o=a.substr(0,a.length-1)}i=!Oy.test(o?o.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",xy(t))}finally{Uy(t)}}}function Uy(t,e){if(t.a){Vy(t);var n=t.a,r=t.s[0]?gf:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Vy(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(pf.clearTimeout(t.m),t.m=null)}function qy(t){return t.a?t.a.readyState:0}function By(t,e){return t.a?t.a.getResponseHeader(e):null}function jy(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var n="";return jf(t,function(t,e){n+=e,n+=":",n+=t,n+="\r\n"}),n}(n),df(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return Hd(t,e,n),t}function Wy(t){this.f=[],this.F=new fy,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!mf("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=mf("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=mf("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=mf("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=mf("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new my(t&&t.concurrentRequestLimit),this.ja=new Cy,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Ky(t){if(Qy(t),3==t.u){var e=t.P++,n=Bd(t.B);Hd(n,"SID",t.H),Hd(n,"RID",e),Hd(n,"TYPE","terminate"),Yy(t,n),(e=new bd(t,e,void 0)).F=2,e.f=zd(Bd(n)),n=!1,pf.navigator&&pf.navigator.sendBeacon&&(n=pf.navigator.sendBeacon(e.f.toString(),"")),!n&&pf.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=Af(),Ad(e)}rm(t)}function Qy(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(pf.clearTimeout(t.l),t.l=null),tm(t),t.b.cancel(),t.h&&(yf(t.h)&&pf.clearTimeout(t.h),t.h=null)}function Hy(t,e){t.f.push(new yy(t.Ra++,e)),3==t.u&&Gy(t)}function Gy(t){by(t.b)||t.h||(t.h=!0,jp(t.Ia,t),t.A=0)}function zy(t,e){var n;n=e?e.W:t.P++;var r=Bd(t.B);Hd(r,"SID",t.H),Hd(r,"RID",n),Hd(r,"AID",t.O),Yy(t,r),t.g&&t.i&&jy(r,t.g,t.i),n=new bd(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=Xy(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Ty(t.b,n),Ed(n,r,e)}function Yy(t,n){t.c&&Md({},function(t,e){Hd(n,e,t)})}function Xy(t,e,n){n=Math.min(t.f.length,n);var r=t.c?Cf(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{Ny(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function Jy(t){t.a||t.l||(t.S=1,jp(t.Ha,t),t.v=0)}function $y(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=ud(Cf(t.Ha,t),em(t,t.v)),t.v++,!0)}function Zy(t,e,n){var r=e.l;r&&vy(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=im(t,null,t.ha),Gy(t)}function tm(t){null!=t.s&&(pf.clearTimeout(t.s),t.s=null)}function em(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function nm(t,e){if(2==e){var n=null;t.c&&(n=null);var r=Cf(t.fb,t);n||(n=new qd("//www.google.com/images/cleardot.gif"),pf.location&&"http"==pf.location.protocol||jd(n,"https"),zd(n)),function(t,e){var n=new ed;if(pf.Image){var r=new Image;r.onload=Nf(Ay,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Nf(Ay,n,r,"TestLoadImage: error",!1,e),r.onabort=Nf(Ay,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Nf(Ay,n,r,"TestLoadImage: timeout",!1,e),pf.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ad(2);t.u=0,t.c&&t.c.ta(e),rm(t),Qy(t)}function rm(t){t.u=0,t.m=-1,t.c&&(0==Sy(t.b).length&&0==t.f.length||(t.b.c.length=0,Mf(t.f),t.f.length=0),t.c.sa())}function im(t,e,n){var r=function(t){return t instanceof qd?Bd(t):new qd(t,void 0)}(n);if(""!=r.b)e&&Wd(r,e+"."+r.b),Kd(r,r.i);else{var i,o=pf.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new qd(null,void 0);return t&&jd(i,t),e&&Wd(i,e),n&&Kd(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&jf(t.V,function(t,e){Hd(r,e,t)}),e=t.j,n=t.I,e&&n&&Hd(r,e,n),Hd(r,"VER",t.wa),Yy(t,r),r}function om(){}function am(){if(Xf&&!(10<=Number(op)))throw Error("Environmental error: no available transport.")}function sm(t,e){Pp.call(this),this.a=new Wy(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!Lf(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Lf(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new hm(this)}function um(t){md.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function cm(){gd.call(this),this.status=1}function hm(t){this.a=t}(hf=Dy.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?fd(this.H):fd(dd),this.a.onreadystatechange=Cf(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Ly(this,t)}t=n||"";var i=new Ld(this.headers);r&&Md(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=My,n=t.length,r=df(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:df(t)?t.charAt(e):t[e]}(i.K()),n=pf.FormData&&t instanceof pf.FormData,0<=Rf(Py,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Vy(this),0<this.o&&((this.D=function(t){return Xf&&sp(9)&&yf(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=Cf(this.Ca,this)):this.m=zp(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Ly(this,t)}},hf.Ca=function(){void 0!==ff&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},hf.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Uy(this))},hf.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Uy(this,!0)),Dy.N.G.call(this)},hf.Fa=function(){this.j||(this.w||this.l||this.g?Fy(this):this.$a())},hf.$a=function(){Fy(this)},hf.T=function(){try{return 2<qy(this)?this.a.status:-1}catch(t){return-1}},hf.za=function(){try{return 2<qy(this)?this.a.statusText:""}catch(t){return""}},hf.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},hf.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),ky(e)}},hf.ya=function(){return this.h},hf.Ya=function(){return df(this.f)?this.f:String(this.f)},(hf=Wy.prototype).wa=8,hf.u=1,hf.Da=function(){return 0==this.u},hf.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new bd(this,t,void 0),r=this.i;if(this.J&&(r?Qf(r=Wf(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&df(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Xy(this,n,e),Hd(i=Bd(this.B),"RID",t),Hd(i,"CVER",22),this.o&&this.j&&Hd(i,"X-HTTP-Session-Id",this.j),Yy(this,i),this.g&&r&&jy(i,this.g,r),Ty(this.b,n),this.W?(Hd(i,"$req",e),Hd(i,"SID","null"),n.S=!0,Ed(n,i,null)):Ed(n,i,e),this.u=2}}else 3==this.u&&(t?zy(this,t):0==this.f.length||by(this.b)||zy(this))},hf.Ha=function(){this.l=null,this.a=new bd(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Bd(this.pa);Hd(t,"RID","rpc"),Hd(t,"SID",this.H),Hd(t,"CI",this.ia?"0":"1"),Hd(t,"AID",this.O),Yy(this,t),Hd(t,"TYPE","xmlhttp"),this.g&&this.i&&jy(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Sd(this.a,t,!0,this.ga)},hf.Ga=function(t,e){if(0!=this.u&&(this.a==t||_y(this.b,t)))if(this.m=t.o,!t.s&&_y(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(bf(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;tm(this),this.a.cancel(),this.a=null}$y(this),ad(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=ud(Cf(this.Za,this),6e3));if(wy(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else nm(this,11)}else if(!t.s&&this.a!=t||tm(this),!Lf(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&yf(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=By(r,"X-Client-Wire-Protocol"))&&vy(this.b,i),this.j&&(r=By(r,"X-HTTP-Session-Id")))&&(this.I=r,Hd(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=im(this,this.Y()?this.ga:null,this.ha),r.s?(Ey(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Dd(r),Ad(r)),this.a=r):Jy(this),0<this.f.length&&Gy(this)}else"stop"!=r[0]&&"close"!=r[0]||nm(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?nm(this,7):Ky(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},hf.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,$y(this),ad(19))},hf.na=function(t){var e=null;if(this.a==t){tm(this),this.a=null;var n=2}else{if(!_y(this.b,t))return;e=t.j,Ey(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=Af()-t.v,nd.dispatchEvent(new sd(nd,t.l?t.l.length:0,e,this.A)),Gy(this)):Jy(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(wy(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Pa?0:t.Qa))&&(t.h=ud(Cf(t.Ia,t,e),em(t,t.A)),t.A++,!0))}(this,t)||2==n&&$y(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:nm(this,5);break;case 4:nm(this,10);break;case 3:nm(this,6);break;default:nm(this,2)}}},hf.fb=function(t){ad(t?2:1)},hf.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Dy(this.La)).F=this.R,t},hf.ma=function(){return!!this.c&&!0},hf.Y=function(){return this.R},(hf=om.prototype).va=function(){},hf.ua=function(){},hf.ta=function(){},hf.sa=function(){},hf.Ta=function(){},am.prototype.a=function(t,e){return new sm(t,e)},kf(sm,Pp),(hf=sm.prototype).addEventListener=function(t,e,n,r){sm.N.addEventListener.call(this,t,e,n,r)},hf.removeEventListener=function(t,e,n,r){sm.N.removeEventListener.call(this,t,e,n,r)},hf.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;ad(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new hy(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=jy(e,t.g,t.i)),(t=t.w).i=n,e=im(t.a,null,t.i),ad(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,ly(t)):(Gd(e,"MODE","init"),!t.a.o&&t.a.j&&Gd(e,"X-HTTP-Session-Id",t.a.j),t.b=new bd(t,void 0,void 0),t.b.h=t.h,Sd(t.b,e,!1,null),t.M=0)},hf.close=function(){Ky(this.a)},hf.Xa=function(t){if(df(t)){var e={};e.__data__=t,Hy(this.a,e)}else this.h?((e={}).__data__=Lp(t),Hy(this.a,e)):Hy(this.a,t)},hf.G=function(){this.a.c=null,delete this.f,Ky(this.a),delete this.a,sm.N.G.call(this)},kf(um,md),kf(cm,gd),kf(hm,om),hm.prototype.va=function(){this.a.dispatchEvent("a")},hm.prototype.ua=function(t){this.a.dispatchEvent(new um(t))},hm.prototype.ta=function(t){this.a.dispatchEvent(new cm(t))},hm.prototype.sa=function(){this.a.dispatchEvent("b")};var lm=Nf(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},am);am.prototype.createWebChannel=am.prototype.a,sm.prototype.send=sm.prototype.Xa,sm.prototype.open=sm.prototype.Wa,sm.prototype.close=sm.prototype.close,cd.NO_ERROR=0,cd.TIMEOUT=8,cd.HTTP_ERROR=6,hd.COMPLETE="complete",(pd.EventType=yd).OPEN="a",yd.CLOSE="b",yd.ERROR="c",yd.MESSAGE="d",Pp.prototype.listen=Pp.prototype.Aa,Dy.prototype.listenOnce=Dy.prototype.Ba,Dy.prototype.getLastError=Dy.prototype.Ya,Dy.prototype.getLastErrorCode=Dy.prototype.ya,Dy.prototype.getStatus=Dy.prototype.T,Dy.prototype.getStatusText=Dy.prototype.za,Dy.prototype.getResponseJson=Dy.prototype.Va,Dy.prototype.getResponseText=Dy.prototype.aa,Dy.prototype.send=Dy.prototype.ca;var fm,pm,dm={createWebChannelTransport:lm,ErrorCode:cd,EventType:hd,WebChannel:pd,XhrIo:Dy},ym=dm.createWebChannelTransport,mm=dm.ErrorCode,gm=dm.EventType,vm=dm.WebChannel,bm=dm.XhrIo,wm=fl.SDK_VERSION,_m=new ns("@firebase/firestore");function Tm(){return _m.logLevel===Xa.DEBUG?fm.DEBUG:_m.logLevel===Xa.SILENT?fm.SILENT:fm.ERROR}function Em(t){switch(t){case fm.DEBUG:_m.logLevel=Xa.DEBUG;break;case fm.ERROR:_m.logLevel=Xa.ERROR;break;case fm.SILENT:_m.logLevel=Xa.SILENT;break;default:_m.error("Firestore ("+wm+"): Invalid value passed to `setLogLevel`")}}function Sm(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(_m.logLevel<=Xa.DEBUG){var i=n.map(Cm);_m.debug.apply(_m,la(["Firestore ("+wm+") ["+t+"]: "+e],i))}}function Im(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(_m.logLevel<=Xa.ERROR){var r=e.map(Cm);_m.error.apply(_m,la(["Firestore ("+wm+"): "+t],r))}}function Cm(e){if("string"==typeof e)return e;var t=km.getPlatform();try{return t.formatJSON(e)}catch(t){return e}}function Nm(t){var e="FIRESTORE ("+wm+") INTERNAL ASSERTION FAILED: "+t;throw Im(e),new Error(e)}function Am(t,e){t||Nm(e)}(pm=fm=fm||{})[pm.DEBUG=0]="DEBUG",pm[pm.ERROR=1]="ERROR",pm[pm.SILENT=2]="SILENT";var km=(Dm.setPlatform=function(t){Dm.platform&&Nm("Platform already defined"),Dm.platform=t},Dm.getPlatform=function(){return Dm.platform||Nm("Platform not set"),Dm.platform},Dm);function Dm(){}function Rm(){return km.getPlatform().emptyByteString}var Om,Pm={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Mm=(ia(Lm,Om=Error),Lm);function Lm(t,e){var n=Om.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function xm(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Mm(Pm.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Fm(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Um(t,e){return void 0!==t?t:e}function Vm(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function qm(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Bm(t){for(var e in Am(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function jm(t,e){if(0!==e.length)throw new Mm(Pm.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+ag(e.length,"argument")+".")}function Wm(t,e,n){if(e.length!==n)throw new Mm(Pm.INVALID_ARGUMENT,"Function "+t+"() requires "+ag(n,"argument")+", but was called with "+ag(e.length,"argument")+".")}function Km(t,e,n){if(e.length<n)throw new Mm(Pm.INVALID_ARGUMENT,"Function "+t+"() requires at least "+ag(n,"argument")+", but was called with "+ag(e.length,"argument")+".")}function Qm(t,e,n,r){if(e.length<n||e.length>r)throw new Mm(Pm.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+ag(e.length,"argument")+".")}function Hm(t,e,n,r){$m(t,e,og(n)+" argument",r)}function Gm(t,e,n,r){void 0!==r&&Hm(t,e,n,r)}function zm(t,e,n,r){$m(t,e,n+" option",r)}function Ym(t,e,n,r){void 0!==r&&zm(t,e,n,r)}function Xm(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new Mm(Pm.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+tg(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new Mm(Pm.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+tg(r[o]))}(t,e,n,r,i)}function Jm(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(tg(u))}var c=tg(r);throw new Mm(Pm.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function $m(t,e,n,r){if(!("object"===e?Zm(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=tg(r);throw new Mm(Pm.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Zm(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function tg(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Nm("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function eg(t,e,n){if(void 0===n)throw new Mm(Pm.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+og(e)+" argument, but it was undefined.")}function ng(n,t,r){qm(t,function(t,e){if(r.indexOf(t)<0)throw new Mm(Pm.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function rg(t,e,n,r){var i=tg(r);return new Mm(Pm.INVALID_ARGUMENT,"Function "+t+"() requires its "+og(n)+" argument to be a "+e+", but it was: "+i)}function ig(t,e,n){if(n<=0)throw new Mm(Pm.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+og(e)+" argument to be a positive number, but it was: "+n+".")}function og(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function ag(t,e){return t+" "+e+(1===t?"":"s")}var sg=(ug.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Am(20===e.length,"Invalid auto ID: "+e),e},ug);function ug(){}function cg(t,e){return t<e?-1:e<t?1:0}function hg(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function lg(t){return t+"\0"}function fg(){if("undefined"==typeof Uint8Array)throw new Mm(Pm.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function pg(){if(!km.getPlatform().base64Available)throw new Mm(Pm.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var dg=(yg.fromBase64String=function(t){Wm("Blob.fromBase64String",arguments,1),Hm("Blob.fromBase64String","string",1,t),pg();try{return new yg(km.getPlatform().atob(t))}catch(t){throw new Mm(Pm.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},yg.fromUint8Array=function(t){if(Wm("Blob.fromUint8Array",arguments,1),fg(),!(t instanceof Uint8Array))throw rg("Blob.fromUint8Array","Uint8Array",1,t);return new yg(Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""))},yg.prototype.toBase64=function(){return Wm("Blob.toBase64",arguments,0),pg(),km.getPlatform().btoa(this._binaryString)},yg.prototype.toUint8Array=function(){Wm("Blob.toUint8Array",arguments,0),fg();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},yg.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},yg.prototype.isEqual=function(t){return this._binaryString===t._binaryString},yg.prototype._compareTo=function(t){return cg(this._binaryString,t._binaryString)},yg);function yg(t){pg(),this._binaryString=t}var mg=xm(dg,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),gg=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},vg="(default)",bg=(Object.defineProperty(wg.prototype,"isDefaultDatabase",{get:function(){return this.database===vg},enumerable:!0,configurable:!0}),wg.prototype.isEqual=function(t){return t instanceof wg&&t.projectId===this.projectId&&t.database===this.database},wg.prototype.compareTo=function(t){return cg(this.projectId,t.projectId)||cg(this.database,t.database)},wg);function wg(t,e){this.projectId=t,this.database=e||vg}var _g=(Tg.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Tg.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},Tg.INVALID=-1,Tg);function Tg(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}var Eg="__name__",Sg=(Object.defineProperty(Ig.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),Ig.prototype.isEqual=function(t){return 0===Ig.comparator(this,t)},Ig.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Ig?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},Ig.prototype.limit=function(){return this.offset+this.length},Ig.prototype.popFirst=function(t){return t=void 0===t?1:t,Am(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},Ig.prototype.popLast=function(){return Am(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},Ig.prototype.firstSegment=function(){return Am(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},Ig.prototype.lastSegment=function(){return this.get(this.length-1)},Ig.prototype.get=function(t){return Am(t<this.length,"Index out of range"),this.segments[this.offset+t]},Ig.prototype.isEmpty=function(){return 0===this.length},Ig.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Ig.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Ig.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Ig.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},Ig.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Ig);function Ig(t,e,n){void 0===e?e=0:e>t.length&&Nm("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Nm("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}var Cg,Ng=(ia(Ag,Cg=Sg),Ag.prototype.construct=function(t,e,n){return new Ag(t,e,n)},Ag.prototype.canonicalString=function(){return this.toArray().join("/")},Ag.prototype.toString=function(){return this.canonicalString()},Ag.fromString=function(t){if(0<=t.indexOf("//"))throw new Mm(Pm.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Ag(t.split("/").filter(function(t){return 0<t.length}))},Ag.EMPTY_PATH=new Ag([]),Ag);function Ag(){return null!==Cg&&Cg.apply(this,arguments)||this}var kg,Dg=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Rg=(ia(Og,kg=Sg),Og.prototype.construct=function(t,e,n){return new Og(t,e,n)},Og.isValidIdentifier=function(t){return Dg.test(t)},Og.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Og.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},Og.prototype.toString=function(){return this.canonicalString()},Og.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===Eg},Og.keyField=function(){return new Og([Eg])},Og.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Mm(Pm.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new Mm(Pm.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new Mm(Pm.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new Mm(Pm.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Og(e)},Og.EMPTY_PATH=new Og([]),Og);function Og(){return null!==kg&&kg.apply(this,arguments)||this}var Pg=(Mg.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Mg.prototype.isEqual=function(t){return null!==t&&0===Ng.comparator(this.path,t.path)},Mg.prototype.toString=function(){return this.path.toString()},Mg.comparator=function(t,e){return Ng.comparator(t.path,e.path)},Mg.isDocumentKey=function(t){return t.length%2==0},Mg.fromSegments=function(t){return new Mg(new Ng(t.slice()))},Mg.fromPathString=function(t){return new Mg(Ng.fromString(t))},Mg.EMPTY=new Mg(new Ng([])),Mg);function Mg(t){this.path=t,Am(Mg.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}var Lg,xg,Fg=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})};(xg=Lg=Lg||{}).All="all",xg.ListenStreamIdle="listen_stream_idle",xg.ListenStreamConnectionBackoff="listen_stream_connection_backoff",xg.WriteStreamIdle="write_stream_idle",xg.WriteStreamConnectionBackoff="write_stream_connection_backoff",xg.OnlineStateTimeout="online_state_timeout",xg.ClientMetadataRefresh="client_metadata_refresh",xg.LruGarbageCollection="lru_garbage_collection",xg.RetryTransaction="retry_transaction";var Ug=(Vg.createAndSchedule=function(t,e,n,r,i){var o=new Vg(t,e,Date.now()+n,r,i);return o.start(n),o},Vg.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},Vg.prototype.skipDelay=function(){return this.handleDelayElapsed()},Vg.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Mm(Pm.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Vg.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},Vg.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},Vg);function Vg(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Fg,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}var qg=(Object.defineProperty(Bg.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),Bg.prototype.enqueueAndForget=function(t){this.enqueue(t)},Bg.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},Bg.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},Bg.prototype.enqueueAndInitiateShutdown=function(e){return aa(this,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(e)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Bg.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(t){}):this.enqueueInternal(t)},Bg.prototype.enqueueInternal=function(t){var n=this,e=this.tail.then(function(){return n.operationInProgress=!0,t().catch(function(t){n.failure=t,n.operationInProgress=!1;var e=t.stack||t.message||"";throw Im("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.operationInProgress=!1,t})});return this.tail=e},Bg.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Am(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.timerIdsToSkip.indexOf(t)&&(e=0);var i=Ug.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},Bg.prototype.verifyNotFailed=function(){this.failure&&Nm("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},Bg.prototype.verifyOperationInProgress=function(){Am(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},Bg.prototype.drain=function(){return this.enqueueEvenAfterShutdown(function(){return Promise.resolve()})},Bg.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},Bg.prototype.runDelayedOperationsEarly=function(r){var i=this;return this.drain().then(function(){Am(r===Lg.All||i.containsDelayedOperation(r),"Attempted to drain to missing operation "+r),i.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.delayedOperations;t<e.length;t++){var n=e[t];if(n.skipDelay(),r!==Lg.All&&n.timerId===r)break}return i.drain()})},Bg.prototype.skipDelaysForTimerId=function(t){this.timerIdsToSkip.push(t)},Bg.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Am(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},Bg);function Bg(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[]}var jg="",Wg="",Kg="",Qg="";function Hg(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=zg(e)),e=Gg(t.get(n),e);return zg(e)}function Gg(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=jg+Kg;break;case jg:n+=jg+Qg;break;default:n+=o}}return n}function zg(t){return t+jg+Wg}function Yg(t){var e=t.length;if(Am(2<=e,"Invalid path "+t),2===e)return Am(t.charAt(0)===jg&&t.charAt(1)===Wg,"Non-empty path "+t+" had length 2"),Ng.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(jg,o);switch((a<0||n<a)&&Nm('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case Wg:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case Kg:i+=t.substring(o,a),i+="\0";break;case Qg:i+=t.substring(o,a+1);break;default:Nm('Invalid encoded resource path: "'+t+'"')}o=a+2}return new Ng(r)}var Xg=(Jg.now=function(){return Jg.fromMillis(Date.now())},Jg.fromDate=function(t){return Jg.fromMillis(t.getTime())},Jg.fromMillis=function(t){var e=Math.floor(t/1e3);return new Jg(e,1e6*(t-1e3*e))},Jg.prototype.toDate=function(){return new Date(this.toMillis())},Jg.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Jg.prototype._compareTo=function(t){return this.seconds===t.seconds?cg(this.nanoseconds,t.nanoseconds):cg(this.seconds,t.seconds)},Jg.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Jg.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Jg);function Jg(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Mm(Pm.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Mm(Pm.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Mm(Pm.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Mm(Pm.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}var $g=(Zg.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new Zg(new Xg(e,t%1e6*1e3))},Zg.fromTimestamp=function(t){return new Zg(t)},Zg.forDeletedDoc=function(){return Zg.MIN},Zg.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},Zg.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Zg.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Zg.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Zg.prototype.toTimestamp=function(){return this.timestamp},Zg.MIN=new Zg(new Xg(0,0)),Zg);function Zg(t){this.timestamp=t}var tv=(ev.prototype.insert=function(t,e){return new ev(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,iv.BLACK,null,null))},ev.prototype.remove=function(t){return new ev(this.comparator,this.root.remove(t,this.comparator).copy(null,null,iv.BLACK,null,null))},ev.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},ev.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},ev.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(ev.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),ev.prototype.minKey=function(){return this.root.minKey()},ev.prototype.maxKey=function(){return this.root.maxKey()},ev.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},ev.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},ev.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},ev.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},ev.prototype.getIterator=function(){return new nv(this.root,null,this.comparator,!1)},ev.prototype.getIteratorFrom=function(t){return new nv(this.root,t,this.comparator,!1)},ev.prototype.getReverseIterator=function(){return new nv(this.root,null,this.comparator,!0)},ev.prototype.getReverseIteratorFrom=function(t){return new nv(this.root,t,this.comparator,!0)},ev);function ev(t,e){this.comparator=t,this.root=e||iv.EMPTY}var nv=(rv.prototype.getNext=function(){Am(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},rv.prototype.hasNext=function(){return 0<this.nodeStack.length},rv.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},rv);function rv(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}var iv=(ov.prototype.copy=function(t,e,n,r,i){return new ov(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},ov.prototype.isEmpty=function(){return!1},ov.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},ov.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},ov.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},ov.prototype.minKey=function(){return this.min().key},ov.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},ov.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},ov.prototype.removeMin=function(){if(this.left.isEmpty())return ov.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},ov.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return ov.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},ov.prototype.isRed=function(){return this.color},ov.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},ov.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},ov.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},ov.prototype.rotateLeft=function(){var t=this.copy(null,null,ov.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},ov.prototype.rotateRight=function(){var t=this.copy(null,null,ov.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},ov.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},ov.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},ov.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Nm("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Nm("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Nm("Black depths differ");return t+(this.isRed()?0:1)},ov.EMPTY=null,ov.RED=!0,ov.BLACK=!1,ov);function ov(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:ov.RED,this.left=null!=r?r:ov.EMPTY,this.right=null!=i?i:ov.EMPTY,this.size=this.left.size+1+this.right.size}var av=(Object.defineProperty(sv.prototype,"key",{get:function(){throw Nm("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(sv.prototype,"value",{get:function(){throw Nm("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(sv.prototype,"color",{get:function(){throw Nm("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(sv.prototype,"left",{get:function(){throw Nm("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(sv.prototype,"right",{get:function(){throw Nm("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),sv.prototype.copy=function(t,e,n,r,i){return this},sv.prototype.insert=function(t,e,n){return new iv(t,e)},sv.prototype.remove=function(t,e){return this},sv.prototype.isEmpty=function(){return!0},sv.prototype.inorderTraversal=function(t){return!1},sv.prototype.reverseTraversal=function(t){return!1},sv.prototype.minKey=function(){return null},sv.prototype.maxKey=function(){return null},sv.prototype.isRed=function(){return!1},sv.prototype.checkMaxDepth=function(){return!0},sv.prototype.check=function(){return 0},sv);function sv(){this.size=0}iv.EMPTY=new av;var uv=(cv.fromMapKeys=function(t){var e=new cv(t.comparator);return t.forEach(function(t){e=e.add(t)}),e},cv.prototype.has=function(t){return null!==this.data.get(t)},cv.prototype.first=function(){return this.data.minKey()},cv.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(cv.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),cv.prototype.indexOf=function(t){return this.data.indexOf(t)},cv.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},cv.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},cv.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},cv.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},cv.prototype.getIterator=function(){return new hv(this.data.getIterator())},cv.prototype.getIteratorFrom=function(t){return new hv(this.data.getIteratorFrom(t))},cv.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},cv.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},cv.prototype.isEmpty=function(){return this.data.isEmpty()},cv.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},cv.prototype.isEqual=function(t){if(!(t instanceof cv))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},cv.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},cv.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},cv.prototype.copy=function(t){var e=new cv(this.comparator);return e.data=t,e},cv);function cv(t){this.comparator=t,this.data=new tv(this.comparator)}var hv=(lv.prototype.getNext=function(){return this.iter.getNext().key},lv.prototype.hasNext=function(){return this.iter.hasNext()},lv);function lv(t){this.iter=t}var fv=new tv(Pg.comparator);function pv(){return fv}function dv(){return pv()}var yv=new tv(Pg.comparator);function mv(){return yv}var gv=new tv(Pg.comparator);function vv(){return gv}var bv=new uv(Pg.comparator);function wv(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=bv,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var _v=new uv(cg);function Tv(){return _v}var Ev=(Sv.prototype.applyToRemoteDocument=function(t,e,n){e&&Am(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Am(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},Sv.prototype.applyToLocalView=function(t,e){e&&Am(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},Sv.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.applyToLocalView(t.key,n.get(t.key));e&&(i=i.insert(t.key,e))}),i},Sv.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},wv())},Sv.prototype.isEqual=function(t){return this.batchId===t.batchId&&hg(this.mutations,t.mutations)&&hg(this.baseMutations,t.baseMutations)},Sv);function Sv(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,Am(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var Iv=(Cv.from=function(t,e,n,r){Am(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=vv(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new Cv(t,e,n,r,i)},Cv);function Cv(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}var Nv=(Av.prototype.catch=function(t){return this.next(void 0,t)},Av.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Nm("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new Av(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},Av.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Av.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof Av?e:Av.resolve(e)}catch(t){return Av.reject(t)}},Av.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Av.resolve(e)},Av.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Av.reject(e)},Av.resolve=function(n){return new Av(function(t,e){t(n)})},Av.reject=function(n){return new Av(function(t,e){e(n)})},Av.waitFor=function(t){return new Av(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Av.or=function(t){for(var n=Av.resolve(!1),e=function(e){n=n.next(function(t){return t?Av.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},Av.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},Av);function Av(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}var kv="SimpleDb",Dv=(Rv.openOrCreate=function(o,t,a){return Am(Rv.isAvailable(),"IndexedDB not supported in current environment."),Sm(kv,"Opening database:",o),new Nv(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Rv(e))},i.onblocked=function(){r(new Mm(Pm.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Mm(Pm.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Sm(kv,'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;a.createOrUpgrade(e,i.transaction,t.oldVersion,Yw).next(function(){Sm(kv,"Database upgrade to version "+Yw+" complete")})}}).toPromise()},Rv.delete=function(t){return Sm(kv,"Removing database:",t),Uv(window.indexedDB.deleteDatabase(t)).toPromise()},Rv.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(Rv.isMockPersistence())return!0;if(void 0===window.navigator)return!1;var t=Ta(),e=Rv.getIOSVersion(t),n=0<e&&e<10,r=Rv.getAndroidVersion(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Rv.isMockPersistence=function(){return"undefined"!=typeof process&&"YES"===process.env.USE_MOCK_PERSISTENCE},Rv.getStore=function(t,e){return t.store(e)},Rv.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Rv.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Rv.prototype.setVersionChangeListener=function(e){this.db.onversionchange=function(t){return e(t)}},Rv.prototype.runTransaction=function(r,c,h){return aa(this,void 0,void 0,function(){var o,a,s,e,u,n;return sa(this,function(t){switch(t.label){case 0:o=r.startsWith("readonly"),a=r.endsWith("idempotent"),s=0,e=function(){var e,n,r,i;return sa(this,function(t){switch(t.label){case 0:++s,e=Mv.open(u.db,o?"readonly":"readwrite",c),t.label=1;case 1:return t.trys.push([1,3,,4]),(n=h(e).catch(function(t){return e.abort(t),Nv.reject(t)}).toPromise()).catch(function(){}),[4,e.completionPromise];case 2:return t.sent(),[2,{value:n}];case 3:return r=t.sent(),i=a&&"FirebaseError"!==r.name&&s<3,Sm(kv,"Transaction failed with error: %s. Retrying: %s.",r.message,i),i?[3,4]:[2,{value:Promise.reject(r)}];case 4:return[2]}})},u=this,t.label=1;case 1:return[5,e()];case 2:return"object"==typeof(n=t.sent())?[2,n.value]:[3,1];case 3:return[2]}})})},Rv.prototype.close=function(){this.db.close()},Rv);function Rv(t){this.db=t,12.2===Rv.getIOSVersion(Ta())&&Im("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var Ov=(Object.defineProperty(Pv.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(Pv.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(Pv.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),Pv.prototype.done=function(){this.shouldStop=!0},Pv.prototype.skip=function(t){this.nextKey=t},Pv.prototype.delete=function(){return Uv(this.dbCursor.delete())},Pv);function Pv(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}var Mv=(Lv.open=function(t,e,n){return new Lv(t.transaction(n,e))},Object.defineProperty(Lv.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),Lv.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(Sm(kv,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Lv.prototype.store=function(t){var e=this.transaction.objectStore(t);return Am(!!e,"Object store not part of transaction: "+t),new xv(e)},Lv);function Lv(t){var n=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Fg,this.transaction.oncomplete=function(){n.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?n.completionDeferred.reject(t.error):n.completionDeferred.resolve()},this.transaction.onerror=function(t){var e=qv(t.target.error);n.completionDeferred.reject(e)}}var xv=(Fv.prototype.put=function(t,e){return Uv(void 0!==e?(Sm(kv,"PUT",this.store.name,t,e),this.store.put(e,t)):(Sm(kv,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Fv.prototype.add=function(t){return Sm(kv,"ADD",this.store.name,t,t),Uv(this.store.add(t))},Fv.prototype.get=function(e){var n=this;return Uv(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Sm(kv,"GET",n.store.name,e,t),t})},Fv.prototype.delete=function(t){return Sm(kv,"DELETE",this.store.name,t),Uv(this.store.delete(t))},Fv.prototype.count=function(){return Sm(kv,"COUNT",this.store.name),Uv(this.store.count())},Fv.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},Fv.prototype.deleteAll=function(t,e){Sm(kv,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},Fv.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},Fv.prototype.iterateSerial=function(i){var t=this.cursor({});return new Nv(function(n,r){t.onerror=function(t){var e=qv(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Fv.prototype.iterateCursor=function(t,a){var s=[];return new Nv(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new Ov(e),r=a(e.primaryKey,e.value,n);if(r instanceof Nv){var i=r.catch(function(t){return n.done(),Nv.reject(t)});s.push(i)}n.isDone?o():null===n.skipToKey?e.continue():e.continue(n.skipToKey)}else o()}}).next(function(){return Nv.waitFor(s)})},Fv.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Am(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},Fv.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Fv);function Fv(t){this.store=t}function Uv(t){return new Nv(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=qv(t.target.error);r(e)}})}var Vv=!1;function qv(t){var e=Dv.getIOSVersion(Ta());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Mm("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Vv||(Vv=!0,setTimeout(function(){throw r},0)),r}}return t}var Bv=(jv.forUser=function(t,e,n,r){return Am(""!==t.uid,"UserID must not be an empty string."),new jv(t.isAuthenticated()?t.uid:"",e,n,r)},jv.prototype.checkEmpty=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Hv(t).iterate({index:r_.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},jv.prototype.acknowledgeBatch=function(e,t,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=Qv(n),zv(e).put(t)})},jv.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},jv.prototype.setLastStreamToken=function(e,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=Qv(n),zv(e).put(t)})},jv.prototype.addMutationBatch=function(c,h,l,f){var p=this,d=Gv(c),y=Hv(c);return y.add({}).next(function(t){Am("number"==typeof t,"Auto-generated key is not a number");for(var e=new Ev(t,h,l,f),n=p.serializer.toDbMutationBatch(p.userId,e),r=[],i=new uv(function(t,e){return cg(t.canonicalString(),e.canonicalString())}),o=0,a=f;o<a.length;o++){var s=a[o],u=o_.key(p.userId,s.key.path,t);i=i.add(s.key.path.popLast()),r.push(y.put(n)),r.push(d.put(u,o_.PLACEHOLDER))}return i.forEach(function(t){r.push(p.indexManager.addToCollectionParentIndex(c,t))}),c.addOnCommittedListener(function(){p.documentKeysByBatchId[t]=e.keys()}),Nv.waitFor(r).next(function(){return e})})},jv.prototype.lookupMutationBatch=function(t,e){var n=this;return Hv(t).get(e).next(function(t){return t?(Am(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},jv.prototype.lookupMutationKeys=function(t,n){var r=this;return this.documentKeysByBatchId[n]?Nv.resolve(this.documentKeysByBatchId[n]):this.lookupMutationBatch(t,n).next(function(t){if(t){var e=t.keys();return r.documentKeysByBatchId[n]=e}return null})},jv.prototype.getNextMutationBatchAfterBatchId=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Hv(t).iterate({index:r_.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Am(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.fromDbMutationBatch(e)),n.done()}).next(function(){return o})},jv.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Hv(t).iterate({index:r_.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},jv.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Hv(t).loadAll(r_.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},jv.prototype.getAllMutationBatchesAffectingDocumentKey=function(s,u){var c=this,t=o_.prefixForPath(this.userId,u.path),e=IDBKeyRange.lowerBound(t),h=[];return Gv(s).iterate({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],a=Yg(i);if(r===c.userId&&u.path.isEqual(a))return Hv(s).get(o).next(function(t){if(!t)throw Nm("Dangling document-mutation reference found: "+e+" which points to "+o);Am(t.userId===c.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),h.push(c.serializer.fromDbMutationBatch(t))});n.done()}).next(function(){return h})},jv.prototype.getAllMutationBatchesAffectingDocumentKeys=function(r,t){var u=this,c=new uv(cg),i=[];return t.forEach(function(s){var t=o_.prefixForPath(u.userId,s.path),e=IDBKeyRange.lowerBound(t),n=Gv(r).iterate({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=Yg(i);r===u.userId&&s.path.isEqual(a)?c=c.add(o):n.done()});i.push(n)}),Nv.waitFor(i).next(function(){return u.lookupMutationBatches(r,c)})},jv.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var s=this;Am(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Am(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=e.path,c=u.length+1,n=o_.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),h=new uv(cg);return Gv(t).iterate({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=Yg(i);r===s.userId&&u.isPrefixOf(a)?a.length===c&&(h=h.add(o)):n.done()}).next(function(){return s.lookupMutationBatches(t,h)})},jv.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Hv(t).get(e).next(function(t){if(null===t)throw Nm("Dangling document-mutation reference found, which points to "+e);Am(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),Nv.waitFor(i).next(function(){return r})},jv.prototype.removeMutationBatch=function(e,n){var r=this;return Kv(e.simpleDbTransaction,this.userId,n).next(function(t){return e.addOnCommittedListener(function(){r.removeCachedMutationKeys(n.batchId)}),Nv.forEach(t,function(t){return r.referenceDelegate.removeMutationReference(e,t)})})},jv.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},jv.prototype.performConsistencyCheck=function(n){var o=this;return this.checkEmpty(n).next(function(t){if(!t)return Nv.resolve();var e=IDBKeyRange.lowerBound(o_.prefixForUser(o.userId)),i=[];return Gv(n).iterate({range:e},function(t,e,n){if(t[0]===o.userId){var r=Yg(t[1]);i.push(r)}else n.done()}).next(function(){Am(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},jv.prototype.containsKey=function(t,e){return Wv(t,this.userId,e)},jv.prototype.getMutationQueueMetadata=function(t){var e=this;return zv(t).get(this.userId).next(function(t){return t||new e_(e.userId,-1,"")})},jv);function jv(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}function Wv(t,o,e){var n=o_.prefixForPath(o,e.path),a=n[1],r=IDBKeyRange.lowerBound(n),s=!1;return Gv(t).iterate({range:r,keysOnly:!0},function(t,e,n){var r=t[0],i=t[1];t[2];r===o&&i===a&&(s=!0),n.done()}).next(function(){return s})}function Kv(t,e,n){var r=t.store(r_.store),i=t.store(o_.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){Am(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=o_.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return Nv.waitFor(o).next(function(){return c})}function Qv(t){return t instanceof Uint8Array?(Am(Dv.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function Hv(t){return $_.getStore(t,r_.store)}function Gv(t){return $_.getStore(t,o_.store)}function zv(t){return $_.getStore(t,e_.store)}var Yv,Xv;(Xv=Yv=Yv||{})[Xv.QueryCache=0]="QueryCache",Xv[Xv.SyncEngine=1]="SyncEngine";var Jv=($v.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},$v.prototype.after=function(t){return this.seek(t+2),this.next()},$v.prototype.seek=function(t){Am((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},$v.forTargetCache=function(){return new $v(Yv.QueryCache,2)},$v.forSyncEngine=function(){return new $v(Yv.SyncEngine)},$v);function $v(t,e){Am((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}var Zv=(tb.prototype.allocateTargetId=function(e){var n=this;return this.retrieveMetadata(e).next(function(t){return t.highestTargetId=n.targetIdGenerator.after(t.highestTargetId),n.saveMetadata(e,t).next(function(){return t.highestTargetId})})},tb.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return $g.fromTimestamp(new Xg(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},tb.prototype.getHighestSequenceNumber=function(t){return rb(t.simpleDbTransaction)},tb.prototype.setTargetsMetadata=function(e,n,r){var i=this;return this.retrieveMetadata(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.saveMetadata(e,t)})},tb.prototype.addTargetData=function(e,n){var r=this;return this.saveTargetData(e,n).next(function(){return r.retrieveMetadata(e).next(function(t){return t.targetCount+=1,r.updateMetadataFromTargetData(n,t),r.saveMetadata(e,t)})})},tb.prototype.updateTargetData=function(t,e){return this.saveTargetData(t,e)},tb.prototype.removeTargetData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return eb(e).delete(t.targetId)}).next(function(){return n.retrieveMetadata(e)}).next(function(t){return Am(0<t.targetCount,"Removing from an empty target cache"),t.targetCount-=1,n.saveMetadata(e,t)})},tb.prototype.removeTargets=function(r,i,o){var a=this,s=0,u=[];return eb(r).iterate(function(t,e){var n=a.serializer.fromDbTarget(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(s++,u.push(a.removeTargetData(r,n)))}).next(function(){return Nv.waitFor(u)}).next(function(){return s})},tb.prototype.forEachTarget=function(t,r){var i=this;return eb(t).iterate(function(t,e){var n=i.serializer.fromDbTarget(e);r(n)})},tb.prototype.retrieveMetadata=function(t){return nb(t.simpleDbTransaction)},tb.prototype.saveMetadata=function(t,e){return function(t){return $_.getStore(t,g_.store)}(t).put(g_.key,e)},tb.prototype.saveTargetData=function(t,e){return eb(t).put(this.serializer.toDbTarget(e))},tb.prototype.updateMetadataFromTargetData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},tb.prototype.getTargetCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},tb.prototype.getTargetData=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),a=null;return eb(t).iterate({range:n,index:p_.queryTargetsIndexName},function(t,e,n){var r=o.serializer.fromDbTarget(e);i.isEqual(r.target)&&(a=r,n.done())}).next(function(){return a})},tb.prototype.addMatchingKeys=function(n,t,r){var i=this,o=[],a=ib(n);return t.forEach(function(t){var e=Hg(t.path);o.push(a.put(new y_(r,e))),o.push(i.referenceDelegate.addReference(n,t))}),Nv.waitFor(o)},tb.prototype.removeMatchingKeys=function(n,t,r){var i=this,o=ib(n);return Nv.forEach(t,function(t){var e=Hg(t.path);return Nv.waitFor([o.delete([r,e]),i.referenceDelegate.removeReference(n,t)])})},tb.prototype.removeMatchingKeysForTargetId=function(t,e){var n=ib(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},tb.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ib(t),o=wv();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=Yg(t[1]),i=new Pg(r);o=o.add(i)}).next(function(){return o})},tb.prototype.containsKey=function(t,e){var n=Hg(e.path),r=IDBKeyRange.bound([n],[lg(n)],!1,!0),i=0;return ib(t).iterate({index:y_.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},tb.prototype.getTargetDataForTarget=function(t,e){var n=this;return eb(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},tb);function tb(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=Jv.forTargetCache()}function eb(t){return $_.getStore(t,p_.store)}function nb(t){return Dv.getStore(t,g_.store).get(g_.key).next(function(t){return Am(null!==t,"Missing metadata row."),t})}function rb(t){return nb(t).next(function(t){return t.highestListenSequenceNumber})}function ib(t){return $_.getStore(t,y_.store)}var ob=(ab.fromSet=function(t){return new ab(t)},ab.fromArray=function(t){var e=new uv(Rg.comparator);return t.forEach(function(t){return e=e.add(t)}),new ab(e)},ab.prototype.covers=function(e){var n=!1;return this.fields.forEach(function(t){t.isPrefixOf(e)&&(n=!0)}),n},ab.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},ab);function ab(t){this.fields=t}var sb=(ub.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},ub);function ub(t,e){this.field=t,this.transform=e}var cb,hb,lb=function(t,e){this.version=t,this.transformResults=e};(hb=cb=cb||{})[hb.Set=0]="Set",hb[hb.Patch=1]="Patch",hb[hb.Transform=2]="Transform",hb[hb.Delete=3]="Delete";var fb=(pb.exists=function(t){return new pb(void 0,t)},pb.updateTime=function(t){return new pb(t)},Object.defineProperty(pb.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),pb.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof Iw&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Iw:(Am(this.isNone,"Precondition should be empty"),!0)},pb.prototype.isEqual=function(t){return function(t,e){return null!=t?!(!e||!t.isEqual(e)):t===e}(this.updateTime,t.updateTime)&&this.exists===t.exists},pb.NONE=new pb,pb);function pb(t,e){this.updateTime=t,this.exists=e,Am(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}var db=(yb.prototype.verifyKeyMatches=function(t){null!=t&&Am(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},yb.getPostMutationVersion=function(t){return t instanceof Iw?t.version:$g.MIN},yb);function yb(){}var mb,gb=(ia(vb,mb=db),vb.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Am(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Iw(this.key,n,{hasCommittedMutations:!0},this.value)},vb.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=db.getPostMutationVersion(t);return new Iw(this.key,r,{hasLocalMutations:!0},this.value)},vb.prototype.extractBaseValue=function(t){return null},vb.prototype.isEqual=function(t){return t instanceof vb&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},vb);function vb(t,e,n){var r=mb.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=cb.Set,r}var bb,wb=(ia(_b,bb=db),_b.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Am(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new Rw(this.key,e.version);var n=this.patchDocument(t);return new Iw(this.key,e.version,{hasCommittedMutations:!0},n)},_b.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=db.getPostMutationVersion(t),i=this.patchDocument(t);return new Iw(this.key,r,{hasLocalMutations:!0},i)},_b.prototype.extractBaseValue=function(t){return null},_b.prototype.isEqual=function(t){return t instanceof _b&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},_b.prototype.patchDocument=function(t){var e;return e=t instanceof Iw?t.data():gw.EMPTY,this.patchObject(e)},_b.prototype.patchObject=function(n){var r=this;return this.fieldMask.fields.forEach(function(t){if(!t.isEmpty()){var e=r.data.field(t);n=null!==e?n.set(t,e):n.delete(t)}}),n},_b);function _b(t,e,n,r){var i=bb.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=cb.Patch,i}var Tb,Eb=(ia(Sb,Tb=db),Sb.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Am(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new Rw(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data(),r);return new Iw(this.key,i,{hasCommittedMutations:!0},o)},Sb.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data(),i);return new Iw(this.key,r.version,{hasLocalMutations:!0},o)},Sb.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Iw?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?gw.EMPTY.set(i.field,a):e.set(i.field,a))}return e},Sb.prototype.isEqual=function(t){return t instanceof Sb&&this.key.isEqual(t.key)&&hg(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},Sb.prototype.requireDocument=function(t){Am(t instanceof Iw,"Unknown MaybeDocument type "+t);var e=t;return Am(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},Sb.prototype.serverTransformResults=function(t,e){var n=[];Am(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof Iw&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},Sb.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof Iw&&(u=e.field(a.field)),null===u&&n instanceof Iw&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},Sb.prototype.transformObject=function(t,e){Am(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},Sb);function Sb(t,e){var n=Tb.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=cb.Transform,n.precondition=fb.exists(!0),n}var Ib,Cb,Nb,Ab,kb,Db=(ia(Rb,Ib=db),Rb.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Am(null==e.transformResults,"Transform results received by DeleteMutation."),new Aw(this.key,e.version,{hasCommittedMutations:!0})},Rb.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Am(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Aw(this.key,$g.forDeletedDoc())):t},Rb.prototype.extractBaseValue=function(t){return null},Rb.prototype.isEqual=function(t){return t instanceof Rb&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},Rb);function Rb(t,e){var n=Ib.call(this)||this;return n.key=t,n.precondition=e,n.type=cb.Delete,n}(Nb=Cb=Cb||{})[Nb.NullValue=0]="NullValue",Nb[Nb.BooleanValue=1]="BooleanValue",Nb[Nb.NumberValue=2]="NumberValue",Nb[Nb.TimestampValue=3]="TimestampValue",Nb[Nb.StringValue=4]="StringValue",Nb[Nb.BlobValue=5]="BlobValue",Nb[Nb.RefValue=6]="RefValue",Nb[Nb.GeoPointValue=7]="GeoPointValue",Nb[Nb.ArrayValue=8]="ArrayValue",Nb[Nb.ObjectValue=9]="ObjectValue",(kb=Ab=Ab||{})[kb.Default=0]="Default",kb[kb.Estimate=1]="Estimate",kb[kb.Previous=2]="Previous";var Ob=(Pb.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new Pb(Ab.Estimate,e);case"previous":return new Pb(Ab.Previous,e);case"none":case void 0:return new Pb(Ab.Default,e);default:return Nm("fromSnapshotOptions() called with invalid options.")}},Pb);function Pb(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}var Mb=(Lb.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},Lb.prototype.defaultCompareTo=function(t){return Am(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),cg(this.typeOrder,t.typeOrder)},Lb);function Lb(){}var xb,Fb=(ia(Ub,xb=Mb),Ub.prototype.value=function(t){return null},Ub.prototype.isEqual=function(t){return t instanceof Ub},Ub.prototype.compareTo=function(t){return t instanceof Ub?0:this.defaultCompareTo(t)},Ub.INSTANCE=new Ub,Ub);function Ub(){var t=xb.call(this)||this;return t.typeOrder=Cb.NullValue,t.internalValue=null,t}var Vb,qb=(ia(Bb,Vb=Mb),Bb.prototype.value=function(t){return this.internalValue},Bb.prototype.isEqual=function(t){return t instanceof Bb&&this.internalValue===t.internalValue},Bb.prototype.compareTo=function(t){return t instanceof Bb?cg(this,t):this.defaultCompareTo(t)},Bb.of=function(t){return t?Bb.TRUE:Bb.FALSE},Bb.TRUE=new Bb(!0),Bb.FALSE=new Bb(!1),Bb);function Bb(t){var e=Vb.call(this)||this;return e.internalValue=t,e.typeOrder=Cb.BooleanValue,e}var jb,Wb=(ia(Kb,jb=Mb),Kb.prototype.value=function(t){return this.internalValue},Kb.prototype.compareTo=function(t){return t instanceof Kb?function(t,e){return t<e?-1:e<t?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}(this.internalValue,t.internalValue):this.defaultCompareTo(t)},Kb);function Kb(t){var e=jb.call(this)||this;return e.internalValue=t,e.typeOrder=Cb.NumberValue,e}function Qb(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var Hb,Gb=(ia(zb,Hb=Wb),zb.prototype.isEqual=function(t){return t instanceof zb&&Qb(this.internalValue,t.internalValue)},zb);function zb(){return null!==Hb&&Hb.apply(this,arguments)||this}var Yb,Xb=(ia(Jb,Yb=Wb),Jb.prototype.isEqual=function(t){return t instanceof Jb&&Qb(this.internalValue,t.internalValue)},Jb.NAN=new Jb(NaN),Jb.POSITIVE_INFINITY=new Jb(1/0),Jb.NEGATIVE_INFINITY=new Jb(-1/0),Jb);function Jb(){return null!==Yb&&Yb.apply(this,arguments)||this}var $b,Zb=(ia(tw,$b=Mb),tw.prototype.value=function(t){return this.internalValue},tw.prototype.isEqual=function(t){return t instanceof tw&&this.internalValue===t.internalValue},tw.prototype.compareTo=function(t){return t instanceof tw?cg(this.internalValue,t.internalValue):this.defaultCompareTo(t)},tw);function tw(t){var e=$b.call(this)||this;return e.internalValue=t,e.typeOrder=Cb.StringValue,e}var ew,nw=(ia(rw,ew=Mb),rw.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},rw.prototype.isEqual=function(t){return t instanceof rw&&this.internalValue.isEqual(t.internalValue)},rw.prototype.compareTo=function(t){return t instanceof rw?this.internalValue._compareTo(t.internalValue):t instanceof ow?-1:this.defaultCompareTo(t)},rw);function rw(t){var e=ew.call(this)||this;return e.internalValue=t,e.typeOrder=Cb.TimestampValue,e}var iw,ow=(ia(aw,iw=Mb),aw.prototype.value=function(t){return t&&t.serverTimestampBehavior===Ab.Estimate?new nw(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===Ab.Previous&&this.previousValue?this.previousValue.value(t):null},aw.prototype.isEqual=function(t){return t instanceof aw&&this.localWriteTime.isEqual(t.localWriteTime)},aw.prototype.compareTo=function(t){return t instanceof aw?this.localWriteTime._compareTo(t.localWriteTime):t instanceof nw?1:this.defaultCompareTo(t)},aw.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},aw);function aw(t,e){var n=iw.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=Cb.TimestampValue,n}var sw,uw=(ia(cw,sw=Mb),cw.prototype.value=function(t){return this.internalValue},cw.prototype.isEqual=function(t){return t instanceof cw&&this.internalValue.isEqual(t.internalValue)},cw.prototype.compareTo=function(t){return t instanceof cw?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},cw);function cw(t){var e=sw.call(this)||this;return e.internalValue=t,e.typeOrder=Cb.BlobValue,e}var hw,lw=(ia(fw,hw=Mb),fw.prototype.value=function(t){return this.key},fw.prototype.isEqual=function(t){return t instanceof fw&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},fw.prototype.compareTo=function(t){if(t instanceof fw){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:Pg.comparator(this.key,t.key)}return this.defaultCompareTo(t)},fw);function fw(t,e){var n=hw.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=Cb.RefValue,n}var pw,dw=(ia(yw,pw=Mb),yw.prototype.value=function(t){return this.internalValue},yw.prototype.isEqual=function(t){return t instanceof yw&&this.internalValue.isEqual(t.internalValue)},yw.prototype.compareTo=function(t){return t instanceof yw?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},yw);function yw(t){var e=pw.call(this)||this;return e.internalValue=t,e.typeOrder=Cb.GeoPointValue,e}var mw,gw=(ia(vw,mw=Mb),vw.prototype.value=function(n){var r={};return this.internalValue.inorderTraversal(function(t,e){r[t]=e.value(n)}),r},vw.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},vw.prototype.isEqual=function(t){if(t instanceof vw){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},vw.prototype.compareTo=function(t){if(t instanceof vw){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=cg(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return cg(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},vw.prototype.set=function(t,e){if(Am(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof vw||(n=vw.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},vw.prototype.delete=function(t){if(Am(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new vw(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof vw){var n=e.delete(t.popFirst());return new vw(this.internalValue.insert(t.firstSegment(),n))}return this},vw.prototype.contains=function(t){return null!==this.field(t)},vw.prototype.field=function(t){Am(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof vw?e.internalValue.get(t):null}),e},vw.prototype.fieldMask=function(){var i=new uv(Rg.comparator);return this.internalValue.forEach(function(t,e){var n=new Rg([t]);if(e instanceof vw){var r=e.fieldMask().fields;r.isEmpty()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),ob.fromSet(i)},vw.prototype.toString=function(){return this.internalValue.toString()},vw.prototype.child=function(t){return this.internalValue.get(t)||void 0},vw.prototype.setChild=function(t,e){return new vw(this.internalValue.insert(t,e))},vw.EMPTY=new vw(new tv(cg)),vw);function vw(t){var e=mw.call(this)||this;return e.internalValue=t,e.typeOrder=Cb.ObjectValue,e}var bw,ww=(ia(_w,bw=Mb),_w.prototype.value=function(e){return this.internalValue.map(function(t){return t.value(e)})},_w.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},_w.prototype.forEach=function(t){this.internalValue.forEach(t)},_w.prototype.isEqual=function(t){if(t instanceof _w){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},_w.prototype.compareTo=function(t){if(t instanceof _w){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return cg(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},_w.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},_w);function _w(t){var e=bw.call(this)||this;return e.internalValue=t,e.typeOrder=Cb.ArrayValue,e}var Tw=(Ew.compareByKey=function(t,e){return Pg.comparator(t.key,e.key)},Ew);function Ew(t,e){this.key=t,this.version=e}var Sw,Iw=(ia(Cw,Sw=Tw),Cw.prototype.field=function(t){if(this.objectValue)return this.objectValue.field(t);this.fieldValueCache||(this.fieldValueCache=new Map);var e=t.canonicalString(),n=this.fieldValueCache.get(e);if(void 0===n){var r=this.getProtoField(t);n=void 0===r?null:this.converter(r),this.fieldValueCache.set(e,n)}return n},Cw.prototype.data=function(){var n=this;if(!this.objectValue){var r=gw.EMPTY;qm(this.proto.fields||{},function(t,e){r=r.set(new Rg([t]),n.converter(e))}),this.objectValue=r,this.fieldValueCache=void 0}return this.objectValue},Cw.prototype.value=function(){return this.data().value()},Cw.prototype.isEqual=function(t){return t instanceof Cw&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},Cw.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Cw.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Cw.prototype.getProtoField=function(t){Am(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.firstSegment()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},Cw.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Nm("Trying to compare documents on fields that don't exist")},Cw);function Cw(t,e,n,r,i,o){var a=Sw.call(this,t,e)||this;return a.objectValue=r,a.proto=i,a.converter=o,Am(void 0!==a.objectValue||void 0!==a.proto&&void 0!==a.converter,"If objectValue is not defined, proto and converter need to be set."),a.hasLocalMutations=!!n.hasLocalMutations,a.hasCommittedMutations=!!n.hasCommittedMutations,a}var Nw,Aw=(ia(kw,Nw=Tw),kw.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(kw.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),kw.prototype.isEqual=function(t){return t instanceof kw&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},kw);function kw(t,e,n){var r=Nw.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}var Dw,Rw=(ia(Ow,Dw=Tw),Ow.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ow.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),Ow.prototype.isEqual=function(t){return t instanceof Ow&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ow);function Ow(){return null!==Dw&&Dw.apply(this,arguments)||this}var Pw=(Mw.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},Mw.prototype.has=function(t){return void 0!==this.get(t)},Mw.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},Mw.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},Mw.prototype.forEach=function(s){qm(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],a=i[1];s(o,a)}})},Mw.prototype.isEmpty=function(){return Bm(this.inner)},Mw);function Mw(t){this.mapKeyFn=t,this.inner={}}var Lw=(Object.defineProperty(xw.prototype,"readTime",{get:function(){return Am(void 0!==this._readTime,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this._readTime},set:function(t){Am(void 0===this._readTime||this._readTime.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this._readTime=t},enumerable:!0,configurable:!0}),xw.prototype.addEntry=function(t,e){this.assertNotApplied(),this.readTime=e,this.changes.set(t.key,t)},xw.prototype.removeEntry=function(t,e){this.assertNotApplied(),e&&(this.readTime=e),this.changes.set(t,null)},xw.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Nv.resolve(n):this.getFromCache(t,e)},xw.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},xw.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},xw.prototype.assertNotApplied=function(){Am(!this.changesApplied,"Changes have already been applied.")},xw);function xw(){this.changes=new Pw(function(t){return t.toString()}),this.changesApplied=!1}var Fw,Uw=(Vw.prototype.addEntry=function(t,e,n){return jw(t).put(Ww(e),n)},Vw.prototype.removeEntry=function(t,e){var n=jw(t),r=Ww(e);return n.delete(r)},Vw.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.setMetadata(e,t)})},Vw.prototype.getEntry=function(t,e){var n=this;return jw(t).get(Ww(e)).next(function(t){return n.maybeDecodeDocument(t)})},Vw.prototype.getSizedEntry=function(t,e){var n=this;return jw(t).get(Ww(e)).next(function(t){var e=n.maybeDecodeDocument(t);return e?{maybeDocument:e,size:Kw(t)}:null})},Vw.prototype.getEntries=function(t,e){var r=this,i=dv();return this.forEachDbEntry(t,e,function(t,e){var n=r.maybeDecodeDocument(e);i=i.insert(t,n)}).next(function(){return i})},Vw.prototype.getSizedEntries=function(t,e){var r=this,i=dv(),o=new tv(Pg.comparator);return this.forEachDbEntry(t,e,function(t,e){var n=r.maybeDecodeDocument(e);o=n?(i=i.insert(t,n),o.insert(t,Kw(e))):(i=i.insert(t,null),o.insert(t,0))}).next(function(){return{maybeDocuments:i,sizeMap:o}})},Vw.prototype.forEachDbEntry=function(t,e,i){if(e.isEmpty())return Nv.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),o=e.getIterator(),a=o.getNext();return jw(t).iterate({range:n},function(t,e,n){for(var r=Pg.fromSegments(t);a&&Pg.comparator(a,r)<0;)i(a,null),a=o.getNext();a&&a.isEqual(r)&&(i(a,e),a=o.hasNext()?o.getNext():null),a?n.skip(a.path.toArray()):n.done()}).next(function(){for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})},Vw.prototype.getDocumentsMatchingQuery=function(t,i,e){var o=this;Am(!i.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var a=mv(),s=i.path.length+1,n={};if(e.isEqual($g.MIN)){var r=i.path.toArray();n.range=IDBKeyRange.lowerBound(r)}else{var u=i.path.toArray(),c=this.serializer.toDbTimestampKey(e);n.range=IDBKeyRange.lowerBound([u,c],!0),n.index=c_.collectionReadTimeIndex}return jw(t).iterate(n,function(t,e,n){if(t.length===s){var r=o.serializer.fromDbRemoteDocument(e);i.path.isPrefixOf(r.key.path)?r instanceof Iw&&i.matches(r)&&(a=a.insert(r.key,r)):n.done()}}).next(function(){return a})},Vw.prototype.getNewDocumentChanges=function(t,e){var r=this,i=pv(),o=this.serializer.toDbTimestampKey(e),n=jw(t),a=IDBKeyRange.lowerBound(o,!0);return n.iterate({index:c_.readTimeIndex,range:a},function(t,e){var n=r.serializer.fromDbRemoteDocument(e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{changedDocs:i,readTime:r.serializer.fromDbTimestampKey(o)}})},Vw.prototype.getLastDocumentChange=function(t){var r,i=this,e=jw(t),o=$g.MIN;return e.iterate({index:c_.readTimeIndex,reverse:!0},function(t,e,n){r=i.serializer.fromDbRemoteDocument(e),e.readTime&&(o=i.serializer.fromDbTimestampKey(e.readTime)),n.done()}).next(function(){return{changedDoc:r,readTime:o}})},Vw.prototype.newChangeBuffer=function(t){return new Vw.RemoteDocumentChangeBuffer(this,!!t&&t.trackRemovals)},Vw.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Vw.prototype.getMetadata=function(t){return Bw(t).get(l_.key).next(function(t){return Am(!!t,"Missing document cache metadata"),t})},Vw.prototype.setMetadata=function(t,e){return Bw(t).put(l_.key,e)},Vw.prototype.maybeDecodeDocument=function(t){if(t){var e=this.serializer.fromDbRemoteDocument(t);return e instanceof Aw&&e.version.isEqual($g.forDeletedDoc())?null:e}return null},Vw.RemoteDocumentChangeBuffer=(ia(qw,Fw=Lw),qw.prototype.applyChanges=function(a){var s=this,u=[],c=0,h=new uv(function(t,e){return cg(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(t,e){var n=s.documentSizes.get(t);if(Am(void 0!==n,"Cannot modify a document that wasn't read (for "+t+")"),e){Am(!s.readTime.isEqual($g.MIN),"Cannot add a document with a read time of zero");var r=s.documentCache.serializer.toDbRemoteDocument(e,s.readTime);h=h.add(t.path.popLast());var i=Kw(r);c+=i-n,u.push(s.documentCache.addEntry(a,t,r))}else if(c-=n,s.trackRemovals){var o=s.documentCache.serializer.toDbRemoteDocument(new Aw(t,$g.forDeletedDoc()),s.readTime);u.push(s.documentCache.addEntry(a,t,o))}else u.push(s.documentCache.removeEntry(a,t))}),h.forEach(function(t){u.push(s.documentCache.indexManager.addToCollectionParentIndex(a,t))}),u.push(this.documentCache.updateMetadata(a,c)),Nv.waitFor(u)},qw.prototype.getFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntry(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},qw.prototype.getAllFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntries(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},qw),Vw);function Vw(t,e){this.serializer=t,this.indexManager=e}function qw(t,e){var n=Fw.call(this)||this;return n.documentCache=t,n.trackRemovals=e,n.documentSizes=new Pw(function(t){return t.toString()}),n}function Bw(t){return $_.getStore(t,l_.store)}function jw(t){return $_.getStore(t,c_.store)}function Ww(t){return t.path.toArray()}function Kw(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Nm("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Qw=(Hw.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),Nv.resolve()},Hw.prototype.getCollectionParents=function(t,e){return Nv.resolve(this.collectionParentIndex.getEntries(e))},Hw);function Hw(){this.collectionParentIndex=new Gw}var Gw=(zw.prototype.add=function(t){Am(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new uv(Ng.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},zw.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},zw.prototype.getEntries=function(t){return(this.index[t]||new uv(Ng.comparator)).toArray()},zw);function zw(){this.index={}}var Yw=9,Xw=(Jw.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Am(n<r&&0<=n&&r<=Yw,"Unexpected schema upgrade from v"+n+" to v{toVersion}.");var o=new Mv(e);n<1&&1<=r&&(function(t){t.createObjectStore(Zw.store)}(t),function(t){t.createObjectStore(e_.store,{keyPath:e_.keyPath}),t.createObjectStore(r_.store,{keyPath:r_.keyPath,autoIncrement:!0}).createIndex(r_.userMutationsIndex,r_.userMutationsKeyPath,{unique:!0}),t.createObjectStore(o_.store)}(t),__(t),function(t){t.createObjectStore(c_.store)}(t));var a=Nv.resolve();return n<3&&3<=r&&(0!==n&&(function(t){t.deleteObjectStore(y_.store),t.deleteObjectStore(p_.store),t.deleteObjectStore(g_.store)}(t),__(t)),a=a.next(function(){return function(t){var e=t.store(g_.store),n=new g_(0,0,$g.MIN.toTimestamp(),0);return e.put(g_.key,n)}(o)})),n<4&&4<=r&&(0!==n&&(a=a.next(function(){return function(r,i){return i.store(r_.store).loadAll().next(function(t){r.deleteObjectStore(r_.store),r.createObjectStore(r_.store,{keyPath:r_.keyPath,autoIncrement:!0}).createIndex(r_.userMutationsIndex,r_.userMutationsKeyPath,{unique:!0});var e=i.store(r_.store),n=t.map(function(t){return e.put(t)});return Nv.waitFor(n)})}(t,o)})),a=a.next(function(){!function(t){t.createObjectStore(T_.store,{keyPath:T_.keyPath})}(t)})),n<5&&5<=r&&(a=a.next(function(){return i.removeAcknowledgedMutations(o)})),n<6&&6<=r&&(a=a.next(function(){return function(t){t.createObjectStore(l_.store)}(t),i.addDocumentGlobal(o)})),n<7&&7<=r&&(a=a.next(function(){return i.ensureSequenceNumbers(o)})),n<8&&8<=r&&(a=a.next(function(){return i.createCollectionParentIndex(t,o)})),n<9&&9<=r&&(a=a.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(c_.store);e.createIndex(c_.readTimeIndex,c_.readTimeIndexPath,{unique:!1}),e.createIndex(c_.collectionReadTimeIndex,c_.collectionReadTimeIndexPath,{unique:!1})}(e)})),a},Jw.prototype.addDocumentGlobal=function(e){var n=0;return e.store(c_.store).iterate(function(t,e){n+=Kw(e)}).next(function(){var t=new l_(n);return e.store(l_.store).put(l_.key,t)})},Jw.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(e_.store),e=r.store(r_.store);return t.loadAll().next(function(t){return Nv.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.loadAll(r_.userMutationsIndex,t).next(function(t){return Nv.forEach(t,function(t){Am(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.fromDbMutationBatch(t);return Kv(r,n.userId,e).next(function(){})})})})})},Jw.prototype.ensureSequenceNumbers=function(t){var a=t.store(y_.store),e=t.store(c_.store);return rb(t).next(function(i){var o=[];return e.iterate(function(t,e){var n=new Ng(t),r=function(t){return[0,Hg(t)]}(n);o.push(a.get(r).next(function(t){return t?Nv.resolve():function(t){return a.put(new y_(0,Hg(t),i))}(n)}))}).next(function(){return Nv.waitFor(o)})})},Jw.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:Hg(n)})}}t.createObjectStore(b_.store,{keyPath:b_.keyPath});var r=e.store(b_.store),o=new Gw;return e.store(c_.store).iterate({keysOnly:!0},function(t,e){var n=new Ng(t);return i(n.popLast())}).next(function(){return e.store(o_.store).iterate({keysOnly:!0},function(t,e){t[0];var n=t[1],r=(t[2],Yg(n));return i(r.popLast())})})},Jw);function Jw(t){this.serializer=t}var $w=function(t,e){this.seconds=t,this.nanoseconds=e},Zw=(t_.store="owner",t_.key="owner",t_);function t_(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var e_=(n_.store="mutationQueues",n_.keyPath="userId",n_);function n_(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var r_=(i_.store="mutations",i_.keyPath="batchId",i_.userMutationsIndex="userMutationsIndex",i_.userMutationsKeyPath=["userId","batchId"],i_);function i_(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}var o_=(a_.prefixForUser=function(t){return[t]},a_.prefixForPath=function(t,e){return[t,Hg(e)]},a_.key=function(t,e,n){return[t,Hg(e),n]},a_.store="documentMutations",a_.PLACEHOLDER=new a_,a_);function a_(){}var s_=function(t,e){this.path=t,this.readTime=e},u_=function(t,e){this.path=t,this.version=e},c_=(h_.store="remoteDocuments",h_.readTimeIndex="readTimeIndex",h_.readTimeIndexPath="readTime",h_.collectionReadTimeIndex="collectionReadTimeIndex",h_.collectionReadTimeIndexPath=["parentPath","readTime"],h_);function h_(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}var l_=(f_.store="remoteDocumentGlobal",f_.key="remoteDocumentGlobalKey",f_);function f_(t){this.byteSize=t}var p_=(d_.store="targets",d_.keyPath="targetId",d_.queryTargetsIndexName="queryTargetsIndex",d_.queryTargetsKeyPath=["canonicalId","targetId"],d_);function d_(t,e,n,r,i,o,a){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}var y_=(m_.store="targetDocuments",m_.keyPath=["targetId","path"],m_.documentTargetsIndex="documentTargetsIndex",m_.documentTargetsKeyPath=["path","targetId"],m_);function m_(t,e,n){this.targetId=t,this.path=e,Am(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}var g_=(v_.key="targetGlobalKey",v_.store="targetGlobal",v_);function v_(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}var b_=(w_.store="collectionParents",w_.keyPath=["collectionId","parent"],w_);function w_(t,e){this.collectionId=t,this.parent=e}function __(t){t.createObjectStore(y_.store,{keyPath:y_.keyPath}).createIndex(y_.documentTargetsIndex,y_.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(p_.store,{keyPath:p_.keyPath}).createIndex(p_.queryTargetsIndexName,p_.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(g_.store)}var T_=(E_.store="clientMetadata",E_.keyPath="clientId",E_);function E_(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}var S_,I_,C_=la(la(la([e_.store,r_.store,o_.store,c_.store,p_.store,Zw.store,g_.store,y_.store],[T_.store]),[l_.store]),[b_.store]),N_=(A_.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(Am(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.has(e))return Nv.resolve();var r=e.lastSegment(),i=e.popLast();return t.addOnCommittedListener(function(){n.collectionParentsCache.add(e)}),k_(t).put({collectionId:r,parent:Hg(i)})},A_.prototype.getCollectionParents=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[lg(i),""],!1,!0);return k_(t).loadAll(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Yg(r.parent))}return o})},A_);function A_(){this.collectionParentsCache=new Gw}function k_(t){return $_.getStore(t,b_.store)}(I_=S_=S_||{})[I_.Listen=0]="Listen",I_[I_.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",I_[I_.LimboResolution=2]="LimboResolution";var D_=(R_.prototype.withSequenceNumber=function(t){return new R_(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},R_.prototype.withResumeToken=function(t,e){return new R_(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},R_.prototype.withLastLimboFreeSnapshotVersion=function(t){return new R_(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},R_.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken===t.resumeToken&&this.target.isEqual(t.target)},R_);function R_(t,e,n,r,i,o,a){void 0===i&&(i=$g.MIN),void 0===o&&(o=$g.MIN),void 0===a&&(a=Rm()),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}var O_=(P_.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Pg.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new Aw(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=Pg.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new Rw(e,n)):Nm("Unexpected DbRemoteDocument")},P_.prototype.toDbRemoteDocument=function(t,e){var n=this.toDbTimestampKey(e),r=t.key.path.popLast().toArray();if(t instanceof Iw){var i=t.proto?t.proto:this.remoteSerializer.toDocument(t),o=t.hasCommittedMutations;return new c_(null,null,i,o,n,r)}if(t instanceof Aw){var a=t.key.path.toArray(),s=this.toDbTimestamp(t.version);return o=t.hasCommittedMutations,new c_(null,new s_(a,s),null,o,n,r)}if(t instanceof Rw){a=t.key.path.toArray();var u=this.toDbTimestamp(t.version);return new c_(new u_(a,u),null,null,!0,n,r)}return Nm("Unexpected MaybeDocument")},P_.prototype.toDbTimestampKey=function(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]},P_.prototype.fromDbTimestampKey=function(t){var e=new Xg(t[0],t[1]);return $g.fromTimestamp(e)},P_.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new $w(e.seconds,e.nanoseconds)},P_.prototype.fromDbTimestamp=function(t){var e=new Xg(t.seconds,t.nanoseconds);return $g.fromTimestamp(e)},P_.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new r_(t,e.batchId,e.localWriteTime.toMillis(),r,i)},P_.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=Xg.fromMillis(t.localWriteTimeMs);return new Ev(t.batchId,i,n,r)},P_.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(Hg(t.path))}),e},P_.prototype.fromDbResourcePaths=function(t){for(var e=wv(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Pg(Yg(i)))}return e},P_.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.fromDbTimestamp(t.lastLimboFreeSnapshotVersion):$g.MIN,i=t.resumeToken;return e=function(t){return void 0!==t.documents}(t.query)?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new D_(e,t.targetId,S_.Listen,t.lastListenSequenceNumber,n,r,i)},P_.prototype.toDbTarget=function(t){Am(S_.Listen===t.purpose,"Only queries with purpose "+S_.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion),i=this.toDbTimestamp(t.lastLimboFreeSnapshotVersion);return e=t.target.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.target):this.remoteSerializer.toQueryTarget(t.target),n=t.resumeToken instanceof Uint8Array?(Am(Dv.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new p_(t.targetId,t.target.canonicalId(),r,n,t.sequenceNumber,i,e)},P_);function P_(t){this.remoteSerializer=t}function M_(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=cg(n,i);return 0===a?cg(r,o):a}var L_=(x_.prototype.nextIndex=function(){return++this.previousIndex},x_.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();M_(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(x_.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),x_);function x_(t){this.maxElements=t,this.buffer=new uv(M_),this.previousIndex=0}var F_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},U_=(V_.withCacheSize=function(t){return new V_(t,V_.DEFAULT_COLLECTION_PERCENTILE,V_.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},V_.COLLECTION_DISABLED=-1,V_.MINIMUM_CACHE_SIZE_BYTES=1048576,V_.DEFAULT=new V_(V_.DEFAULT_CACHE_SIZE_BYTES=41943040,V_.DEFAULT_COLLECTION_PERCENTILE=10,V_.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),V_.DISABLED=new V_(V_.COLLECTION_DISABLED,0,0),V_);function V_(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}var q_=(B_.prototype.start=function(){Am(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==U_.COLLECTION_DISABLED&&this.scheduleGC()},B_.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(B_.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),B_.prototype.scheduleGC=function(){var t=this;Am(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;Sm("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(Lg.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(tT)})},B_);function B_(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}var j_=(W_.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},W_.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Nv.resolve(_g.INVALID);var r=new L_(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},W_.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},W_.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},W_.prototype.collect=function(e,n){var r=this;return this.params.cacheSizeCollectionThreshold===U_.COLLECTION_DISABLED?(Sm("LruGarbageCollector","Garbage collection skipped; disabled"),Nv.resolve(F_)):this.getCacheSize(e).next(function(t){return t<r.params.cacheSizeCollectionThreshold?(Sm("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),F_):r.runGarbageCollection(e,n)})},W_.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},W_.prototype.runGarbageCollection=function(e,n){var r,i,o,a,s,u,c,h=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return i=t>h.params.maximumSequenceNumbersToCollect?(Sm("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+t),h.params.maximumSequenceNumbersToCollect):t,a=Date.now(),h.nthSequenceNumber(e,i)}).next(function(t){return r=t,s=Date.now(),h.removeTargets(e,r,n)}).next(function(t){return o=t,u=Date.now(),h.removeOrphanedDocuments(e,r)}).next(function(t){return c=Date.now(),Tm()<=fm.DEBUG&&Sm("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-l)+"ms\n\tDetermined least recently used "+i+" in "+(s-a)+"ms\n\tRemoved "+o+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),Nv.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},W_);function W_(t,e){this.delegate=t,this.params=e}var K_=(Q_.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},Q_.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},Q_);function Q_(){this.onCommittedListeners=[]}var H_,G_="IndexedDbPersistence",z_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Y_="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",X_=(ia(J_,H_=K_),J_);function J_(t,e){var n=H_.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}var $_=(Z_.getStore=function(t,e){if(t instanceof X_)return Dv.getStore(t.simpleDbTransaction,e);throw Nm("IndexedDbPersistence must use instances of IndexedDbTransaction")},Z_.createIndexedDbPersistence=function(n){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:if(!Z_.isAvailable())throw new Mm(Pm.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new Z_(n.allowTabSynchronization,n.persistenceKey,n.clientId,n.platform,n.lruParams,n.queue,n.serializer,n.sequenceNumberSyncer)).start()];case 1:return t.sent(),[2,e]}})})},Z_.prototype.start=function(){var e=this;return Am(!this.started,"IndexedDbPersistence double-started!"),Am(null!==this.window,"Expected 'window' to be defined"),Dv.openOrCreate(this.dbName,Yw,new Xw(this.serializer)).then(function(t){return e.simpleDb=t,e.updateClientMetadataAndTryBecomePrimary()}).then(function(){return e.attachVisibilityHandler(),e.attachWindowUnloadHook(),e.scheduleClientMetadataAndPrimaryLeaseRefreshes(),e.simpleDb.runTransaction("readonly-idempotent",[g_.store],function(t){return rb(t)})}).then(function(t){e.listenSequence=new _g(t,e.sequenceNumberSyncer)}).then(function(){e._started=!0}).catch(function(t){return e.simpleDb&&e.simpleDb.close(),Promise.reject(t)})},Z_.prototype.setPrimaryStateListener=function(n){var t=this;return this.primaryStateListener=function(e){return aa(t,void 0,void 0,function(){return sa(this,function(t){return this.started?[2,n(e)]:[2]})})},n(this.isPrimary)},Z_.prototype.setDatabaseDeletedListener=function(n){var t=this;this.simpleDb.setVersionChangeListener(function(e){return aa(t,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Z_.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return aa(e,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Z_.prototype.updateClientMetadataAndTryBecomePrimary=function(){var n=this;return this.simpleDb.runTransaction("readwrite-idempotent",C_,function(e){return nT(e).put(new T_(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.verifyPrimaryLease(e).next(function(t){t||(n.isPrimary=!1,n.queue.enqueueAndForget(function(){return n.primaryStateListener(!1)}))})}).next(function(){return n.canActAsPrimary(e)}).next(function(t){return n.isPrimary&&!t?n.releasePrimaryLeaseIfHeld(e).next(function(){return!1}):!!t&&n.acquireOrExtendPrimaryLease(e).next(function(){return!0})})}).catch(function(t){if(!n.allowTabSynchronization)throw t;return Sm(G_,"Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.queue.enqueueAndForget(function(){return n.primaryStateListener(t)}),n.isPrimary=t})},Z_.prototype.verifyPrimaryLease=function(t){var e=this;return eT(t).get(Zw.key).next(function(t){return Nv.resolve(e.isLocalClient(t))})},Z_.prototype.removeClientMetadata=function(t){return nT(t).delete(this.clientId)},Z_.prototype.maybeGarbageCollectMultiClientState=function(){return aa(this,void 0,void 0,function(){var i=this;return sa(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",function(t){var r=Z_.getStore(t,T_.store);return r.loadAll().next(function(t){var e=i.filterActiveClients(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Nv.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.zombiedClientLocalStorageKey(t.clientId))}),t.label=2;case 2:return[2]}})})},Z_.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Lg.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},Z_.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},Z_.prototype.canActAsPrimary=function(e){var i=this;return eT(e).get(Zw.key).next(function(t){if(null!==t&&i.isWithinAge(t.leaseTimestampMs,5e3)&&!i.isClientZombied(t.ownerId)){if(i.isLocalClient(t)&&i.networkEnabled)return!0;if(!i.isLocalClient(t)){if(!t.allowTabSynchronization)throw new Mm(Pm.FAILED_PRECONDITION,Y_);return!1}}return!(!i.networkEnabled||!i.inForeground)||nT(e).loadAll().next(function(t){return void 0===i.filterActiveClients(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Sm(G_,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Z_.prototype.shutdown=function(){return aa(this,void 0,void 0,function(){var e=this;return sa(this,function(t){switch(t.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite-idempotent",[Zw.store,T_.store],function(t){return e.releasePrimaryLeaseIfHeld(t).next(function(){return e.removeClientMetadata(t)})})];case 1:return t.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},Z_.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},Z_.prototype.getActiveClients=function(){var e=this;return this.simpleDb.runTransaction("readonly-idempotent",[T_.store],function(t){return nT(t).loadAll().next(function(t){return e.filterActiveClients(t,18e5).map(function(t){return t.clientId})})})},Z_.clearPersistence=function(n){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return Z_.isAvailable()?(e=n+Z_.MAIN_DATABASE,[4,Dv.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(Z_.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Z_.prototype.getMutationQueue=function(t){return Am(this.started,"Cannot initialize MutationQueue before persistence is started."),Bv.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},Z_.prototype.getTargetCache=function(){return Am(this.started,"Cannot initialize TargetCache before persistence is started."),this.targetCache},Z_.prototype.getRemoteDocumentCache=function(){return Am(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},Z_.prototype.getIndexManager=function(){return Am(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},Z_.prototype.runTransaction=function(n,t,r){var i=this;Sm(G_,"Starting transaction:",n);var o,e=t.endsWith("idempotent"),a=t.startsWith("readonly")?e?"readonly-idempotent":"readonly":e?"readwrite-idempotent":"readwrite";return this.simpleDb.runTransaction(a,C_,function(e){return o=new X_(e,i.listenSequence.next()),"readwrite-primary"===t||"readwrite-primary-idempotent"===t?i.verifyPrimaryLease(e).next(function(t){return!!t||i.canActAsPrimary(e)}).next(function(t){if(!t)throw Im("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.queue.enqueueAndForget(function(){return i.primaryStateListener(!1)}),new Mm(Pm.FAILED_PRECONDITION,z_);return r(o)}).next(function(t){return i.acquireOrExtendPrimaryLease(e).next(function(){return t})}):i.verifyAllowTabSynchronization(e).next(function(){return r(o)})}).then(function(t){return o.raiseOnCommittedEvent(),t})},Z_.prototype.verifyAllowTabSynchronization=function(t){var e=this;return eT(t).get(Zw.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new Mm(Pm.FAILED_PRECONDITION,Y_)})},Z_.prototype.acquireOrExtendPrimaryLease=function(t){var e=new Zw(this.clientId,this.allowTabSynchronization,Date.now());return eT(t).put(Zw.key,e)},Z_.isAvailable=function(){return Dv.isAvailable()},Z_.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},Z_.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=eT(t);return n.get(Zw.key).next(function(t){return e.isLocalClient(t)?(Sm(G_,"Releasing primary lease."),n.delete(Zw.key)):Nv.resolve()})},Z_.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Im("Detected an update time that is in the future: "+t+" > "+n),1))},Z_.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},Z_.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Am(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},Z_.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},Z_.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Am("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},Z_.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return Sm(G_,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Im(G_,"Failed to get zombied client id.",t),!1}},Z_.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Im("Failed to set zombie client id.",t)}},Z_.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},Z_.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Z_.MAIN_DATABASE="main",Z_);function Z_(t,e,n,r,i,o,a,s){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.queue=o,this.sequenceNumberSyncer=s,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},this.referenceDelegate=new rT(this,i),this.dbName=e+Z_.MAIN_DATABASE,this.serializer=new O_(a),this.document=r.document,this.targetCache=new Zv(this.referenceDelegate,this.serializer),this.indexManager=new N_,this.remoteDocumentCache=new Uw(this.serializer,this.indexManager),!r.window||!r.window.localStorage)throw new Mm(Pm.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}function tT(e){return aa(this,void 0,void 0,function(){return sa(this,function(t){if(!function(t){return t.code===Pm.FAILED_PRECONDITION&&t.message===z_}(e))throw e;return Sm(G_,"Unexpectedly lost primary lease"),[2]})})}function eT(t){return t.store(Zw.store)}function nT(t){return t.store(T_.store)}var rT=(iT.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocmentCount(t);return this.db.getTargetCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},iT.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},iT.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},iT.prototype.forEachOrphanedDocumentSequenceNumber=function(t,n){return this.forEachOrphanedDocument(t,function(t,e){return n(e)})},iT.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},iT.prototype.addReference=function(t,e){return oT(t,e)},iT.prototype.removeReference=function(t,e){return oT(t,e)},iT.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},iT.prototype.removeMutationReference=function(t,e){return oT(t,e)},iT.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?Nv.resolve(!0):function(e,n){var r=!1;return zv(e).iterateSerial(function(t){return Wv(e,t,n).next(function(t){return t&&(r=!0),Nv.resolve(!t)})}).next(function(){return r})}(t,e)},iT.prototype.removeOrphanedDocuments=function(r,i){var o=this,a=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],u=0;return this.forEachOrphanedDocument(r,function(e,t){if(t<=i){var n=o.isPinned(r,e).next(function(t){if(!t)return u++,a.getEntry(r,e).next(function(){return a.removeEntry(e),ib(r).delete(function(t){return[0,Hg(t.path)]}(e))})});s.push(n)}}).next(function(){return Nv.waitFor(s)}).next(function(){return a.apply(r)}).next(function(){return u})},iT.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},iT.prototype.updateLimboDocument=function(t,e){return oT(t,e)},iT.prototype.forEachOrphanedDocument=function(t,o){var a,e=ib(t),s=_g.INVALID;return e.iterate({index:y_.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(s!==_g.INVALID&&o(new Pg(Yg(a)),s),s=i,a=r):s=_g.INVALID}).next(function(){s!==_g.INVALID&&o(new Pg(Yg(a)),s)})},iT.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},iT);function iT(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new j_(this,e)}function oT(t,e){return ib(t).put(function(t,e){return new y_(0,Hg(t.path),e)}(e,t.currentSequenceNumber))}var aT=(sT.prototype.getDocument=function(e,n){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.getDocumentInternal(e,n,t)})},sT.prototype.getDocumentInternal=function(t,r,i){return this.remoteDocumentCache.getEntry(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].applyToLocalView(r,t);return t})},sT.prototype.applyLocalMutationsToDocuments=function(t,e,i){var o=dv();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].applyToLocalView(t,e);o=o.insert(t,e)}),o},sT.prototype.getDocuments=function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t)})},sT.prototype.getLocalViewOfDocuments=function(r,i){var o=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(r,i).next(function(t){var e=o.applyLocalMutationsToDocuments(r,i,t),n=pv();return e.forEach(function(t,e){e=e||new Aw(t,$g.forDeletedDoc()),n=n.insert(t,e)}),n})},sT.prototype.getDocumentsMatchingQuery=function(t,e,n){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)},sT.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new Pg(e)).next(function(t){var e=mv();return t instanceof Iw&&(e=e.insert(t.key,t)),e})},sT.prototype.getDocumentsMatchingCollectionGroupQuery=function(n,r,i){var o=this;Am(r.path.isEmpty(),"Currently we only support collection group queries at the root.");var a=r.collectionGroup,s=mv();return this.indexManager.getCollectionParents(n,a).next(function(t){return Nv.forEach(t,function(t){var e=r.asCollectionQueryAtPath(t.child(a));return o.getDocumentsMatchingCollectionQuery(n,e,i).next(function(t){t.forEach(function(t,e){s=s.insert(t,e)})})}).next(function(){return s})})},sT.prototype.getDocumentsMatchingCollectionQuery=function(e,n,t){var h,l,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,t).next(function(t){return h=t,r.mutationQueue.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return l=t,r.addMissingBaseDocuments(e,l,h).next(function(t){h=t;for(var e=0,n=l;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var a=o[i],s=a.key,u=h.get(s),c=a.applyToLocalView(u,u,r.localWriteTime);h=c instanceof Iw?h.insert(s,c):h.remove(s)}})}).next(function(){return h.forEach(function(t,e){n.matches(e)||(h=h.remove(t))}),h})},sT.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=wv(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof wb&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Iw&&(c=c.insert(t,e))}),c})},sT);function sT(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}var uT=(cT.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},cT.prototype.addReference=function(t,e){var n=new hT(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},cT.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},cT.prototype.removeReference=function(t,e){this.removeRef(new hT(t,e))},cT.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},cT.prototype.removeReferencesForId=function(t){var e=this,n=Pg.EMPTY,r=new hT(n,t),i=new hT(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},cT.prototype.removeAllReferences=function(){var e=this;this.refsByKey.forEach(function(t){return e.removeRef(t)})},cT.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},cT.prototype.referencesForId=function(t){var e=Pg.EMPTY,n=new hT(e,t),r=new hT(e,t+1),i=wv();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},cT.prototype.containsKey=function(t){var e=new hT(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},cT);function cT(){this.refsByKey=new uv(hT.compareByKey),this.refsByTarget=new uv(hT.compareByTargetId)}var hT=(lT.compareByKey=function(t,e){return Pg.comparator(t.key,e.key)||cg(t.targetOrBatchId,e.targetOrBatchId)},lT.compareByTargetId=function(t,e){return cg(t.targetOrBatchId,e.targetOrBatchId)||Pg.comparator(t.key,e.key)},lT);function lT(t,e){this.key=t,this.targetOrBatchId=e}var fT="LocalStore",pT=(dT.prototype.start=function(){return this.synchronizeLastDocumentChangeReadTime()},dT.prototype.handleUserChange=function(i){return aa(this,void 0,void 0,function(){var e,m,n,r=this;return sa(this,function(t){switch(t.label){case 0:return e=this.mutationQueue,m=this.localDocuments,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",function(d){var y;return r.mutationQueue.getAllMutationBatches(d).next(function(t){return y=t,e=r.persistence.getMutationQueue(i),m=new aT(r.remoteDocuments,e,r.persistence.getIndexManager()),e.getAllMutationBatches(d)}).next(function(t){for(var e=[],n=[],r=wv(),i=0,o=y;i<o.length;i++){var a=o[i];e.push(a.batchId);for(var s=0,u=a.mutations;s<u.length;s++){var c=u[s];r=r.add(c.key)}}for(var h=0,l=t;h<l.length;h++){a=l[h],n.push(a.batchId);for(var f=0,p=a.mutations;f<p.length;f++)c=p[f],r=r.add(c.key)}return m.getDocuments(d,r).next(function(t){return{affectedDocuments:t,removedBatchIds:e,addedBatchIds:n}})})})];case 1:return n=t.sent(),this.mutationQueue=e,this.localDocuments=m,this.queryEngine.setLocalDocumentsView(this.localDocuments),[2,n]}})})},dT.prototype.localWrite=function(s){var u,c=this,h=Xg.now(),t=s.reduce(function(t,e){return t.add(e.key)},wv());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",function(a){return c.localDocuments.getDocuments(a,t).next(function(t){u=t;for(var e=[],n=0,r=s;n<r.length;n++){var i=r[n],o=i.extractBaseValue(u.get(i.key));null!=o&&e.push(new wb(i.key,o,o.fieldMask(),fb.exists(!0)))}return c.mutationQueue.addMutationBatch(a,h,e,s)})}).then(function(t){var e=t.applyToLocalDocumentSet(u);return{batchId:t.batchId,changes:e}})},dT.prototype.lookupMutationDocuments=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",function(e){return n.mutationQueue.lookupMutationKeys(e,t).next(function(t){return t?n.localDocuments.getDocuments(e,t):Nv.resolve(null)})})},dT.prototype.acknowledgeBatch=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",function(t){var e=r.batch.keys(),n=i.remoteDocuments.newChangeBuffer({trackRemovals:!0});return i.mutationQueue.acknowledgeBatch(t,r.batch,r.streamToken).next(function(){return i.applyWriteToRemoteDocuments(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.mutationQueue.performConsistencyCheck(t)}).next(function(){return i.localDocuments.getDocuments(t,e)})})},dT.prototype.rejectBatch=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",function(e){var n;return r.mutationQueue.lookupMutationBatch(e,t).next(function(t){return Am(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t)}).next(function(){return r.mutationQueue.performConsistencyCheck(e)}).next(function(){return r.localDocuments.getDocuments(e,n)})})},dT.prototype.getHighestUnacknowledgedBatchId=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",function(t){return e.mutationQueue.getHighestUnacknowledgedBatchId(t)})},dT.prototype.getLastStreamToken=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",function(t){return e.mutationQueue.getLastStreamToken(t)})},dT.prototype.setLastStreamToken=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",function(t){return n.mutationQueue.setLastStreamToken(t,e)})},dT.prototype.getLastRemoteSnapshotVersion=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",function(t){return e.targetCache.getLastRemoteSnapshotVersion(t)})},dT.prototype.applyRemoteEvent=function(u){var c=this,h=u.snapshotVersion,l=this.targetDataByTarget;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",function(o){var i=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});l=c.targetDataByTarget;var a=[];Vm(u.targetChanges,function(t,e){var n=l.get(t);if(n){a.push(c.targetCache.removeMatchingKeys(o,e.removedDocuments,t).next(function(){return c.targetCache.addMatchingKeys(o,e.addedDocuments,t)}));var r=e.resumeToken;if(0<r.length){var i=n.withResumeToken(r,h).withSequenceNumber(o.currentSequenceNumber);l=l.insert(t,i),dT.shouldPersistTargetData(n,i,e)&&a.push(c.targetCache.updateTargetData(o,i))}}});var s=pv(),n=wv();if(u.documentUpdates.forEach(function(t,e){n=n.add(t)}),a.push(i.getEntries(o,n).next(function(r){u.documentUpdates.forEach(function(t,e){var n=r.get(t);e instanceof Aw&&e.version.isEqual($g.MIN)?(i.removeEntry(t,h),s=s.insert(t,e)):null==n||0<e.version.compareTo(n.version)||0===e.version.compareTo(n.version)&&n.hasPendingWrites?($g.MIN.isEqual(h)&&Im(fT,"Cannot add a document when the remote version is zero"),i.addEntry(e,h),s=s.insert(t,e)):Sm(fT,"Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),u.resolvedLimboDocuments.has(t)&&a.push(c.persistence.referenceDelegate.updateLimboDocument(o,t))})})),!h.isEqual($g.MIN)){var t=c.targetCache.getLastRemoteSnapshotVersion(o).next(function(t){return Am(0<=h.compareTo(t),"Watch stream reverted to previous snapshot?? "+h+" < "+t),c.targetCache.setTargetsMetadata(o,o.currentSequenceNumber,h)});a.push(t)}return Nv.waitFor(a).next(function(){return i.apply(o)}).next(function(){return c.localDocuments.getLocalViewOfDocuments(o,s)})}).then(function(t){return c.targetDataByTarget=l,t})},dT.shouldPersistTargetData=function(t,e,n){return Am(0<e.resumeToken.length,"Attempted to persist target data with no resume token"),0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size},dT.prototype.notifyLocalViewChanges=function(t){for(var n=this,e=0,r=t;e<r.length;e++){var i=r[e],o=i.targetId;if(this.localViewReferences.addReferences(i.addedKeys,o),this.localViewReferences.removeReferences(i.removedKeys,o),!i.fromCache){var a=this.targetDataByTarget.get(o);Am(null!==a,"Can't set limbo-free snapshot version for unknown target: "+o);var s=a.snapshotVersion,u=a.withLastLimboFreeSnapshotVersion(s);this.targetDataByTarget=this.targetDataByTarget.insert(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",function(e){return Nv.forEach(t,function(t){return Nv.forEach(t.removedKeys,function(t){return n.persistence.referenceDelegate.removeReference(e,t)})})})},dT.prototype.nextMutationBatch=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",function(t){return void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)})},dT.prototype.readDocument=function(e){var n=this;return this.persistence.runTransaction("read document","readonly-idempotent",function(t){return n.localDocuments.getDocument(t,e)})},dT.prototype.allocateTarget=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",function(e){var n;return i.targetCache.getTargetData(e,r).next(function(t){return t?(n=t,Nv.resolve(n)):i.targetCache.allocateTargetId(e).next(function(t){return n=new D_(r,t,S_.Listen,e.currentSequenceNumber),i.targetCache.addTargetData(e,n).next(function(){return n})})})}).then(function(t){return null===i.targetDataByTarget.get(t.targetId)&&(i.targetDataByTarget=i.targetDataByTarget.insert(t.targetId,t),i.targetIdByTarget.set(r,t.targetId)),t})},dT.prototype.getTargetData=function(t,e){var n=this.targetIdByTarget.get(e);return void 0!==n?Nv.resolve(this.targetDataByTarget.get(n)):this.targetCache.getTargetData(t,e)},dT.prototype.releaseTarget=function(n,r){var i=this,o=this.targetDataByTarget.get(n);if(!o)return Promise.resolve();var t=r?"readwrite-idempotent":"readwrite-primary-idempotent";return this.persistence.runTransaction("Release target",t,function(e){var t=i.localViewReferences.removeReferencesForId(n);return r?Nv.resolve():Nv.forEach(t,function(t){return i.persistence.referenceDelegate.removeReference(e,t)}).next(function(){i.persistence.referenceDelegate.removeTarget(e,o)})}).then(function(){i.targetDataByTarget=i.targetDataByTarget.remove(n),i.targetIdByTarget.delete(o.target)})},dT.prototype.executeQuery=function(t,n){var r=this,i=$g.MIN,o=wv();return this.persistence.runTransaction("Execute query","readonly-idempotent",function(e){return r.getTargetData(e,t.toTarget()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(function(t){o=t})}).next(function(){return r.queryEngine.getDocumentsMatchingQuery(e,t,n?i:$g.MIN,n?o:wv())}).next(function(t){return{documents:t,remoteKeys:o}})})},dT.prototype.remoteDocumentKeys=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",function(t){return n.targetCache.getMatchingKeysForTargetId(t,e)})},dT.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},dT.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},dT.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},dT.prototype.applyWriteToRemoteDocuments=function(t,i,o){var e=this,a=i.batch,n=a.keys(),s=Nv.resolve();return n.forEach(function(r){s=s.next(function(){return o.getEntry(t,r)}).next(function(t){var e=t,n=i.docVersions.get(r);Am(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.compareTo(n)<0)&&((e=a.applyToRemoteDocument(r,e,i))?o.addEntry(e,i.commitVersion):Am(!t,"Mutation batch "+a+" applied to document "+t+" resulted in null"))})}),s.next(function(){return e.mutationQueue.removeMutationBatch(t,a)})},dT.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",function(t){return e.collect(t,n.targetDataByTarget)})},dT.prototype.getTarget=function(e){var n=this,t=this.targetDataByTarget.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly-idempotent",function(t){return n.targetCache.getTargetDataForTarget(t,e).next(function(t){return t?t.target:null})})},dT.prototype.getNewDocumentChanges=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",function(t){return r.remoteDocuments.getNewDocumentChanges(t,r.lastDocumentChangeReadTime)}).then(function(t){var e=t.changedDocs,n=t.readTime;return r.lastDocumentChangeReadTime=n,e})},dT.prototype.synchronizeLastDocumentChangeReadTime=function(){return aa(this,void 0,void 0,function(){var e,n=this;return sa(this,function(t){return this.remoteDocuments instanceof Uw?(e=this.remoteDocuments,[2,this.persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",function(t){return e.getLastDocumentChange(t)}).then(function(t){var e=t.readTime;n.lastDocumentChangeReadTime=e})]):[2]})})},dT.RESUME_TOKEN_MAX_AGE_MICROS=3e8,dT);function dT(t,e,n){this.persistence=t,this.queryEngine=e,this.localViewReferences=new uT,this.targetDataByTarget=new tv(cg),this.targetIdByTarget=new Pw(function(t){return t.canonicalId()}),this.lastDocumentChangeReadTime=$g.MIN,Am(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(n),this.remoteDocuments=t.getRemoteDocumentCache(),this.targetCache=t.getTargetCache(),this.localDocuments=new aT(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager()),this.queryEngine.setLocalDocumentsView(this.localDocuments)}var yT=(mT.prototype.checkEmpty=function(t){return Nv.resolve(0===this.mutationQueue.length)},mT.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Am(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Am(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Nv.resolve()},mT.prototype.getLastStreamToken=function(t){return Nv.resolve(this.lastStreamToken)},mT.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,Nv.resolve()},mT.prototype.addMutationBatch=function(t,e,n,r){Am(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&Am(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Ev(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new hT(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return Nv.resolve(o)},mT.prototype.lookupMutationBatch=function(t,e){return Nv.resolve(this.findMutationBatch(e))},mT.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Am(null!=n,"Failed to find local mutation batch."),Nv.resolve(n.keys())},mT.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return Nv.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},mT.prototype.getHighestUnacknowledgedBatchId=function(){return Nv.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)},mT.prototype.getAllMutationBatches=function(t){return Nv.resolve(this.mutationQueue.slice())},mT.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,e=new hT(n,0),i=new hT(n,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([e,i],function(t){Am(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.findMutationBatch(t.targetOrBatchId);Am(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),Nv.resolve(o)},mT.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var r=this,i=new uv(cg);return e.forEach(function(e){var t=new hT(e,0),n=new hT(e,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([t,n],function(t){Am(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t.targetOrBatchId)})}),Nv.resolve(this.findMutationBatches(i))},mT.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Am(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Pg.isDocumentKey(i)||(i=i.child(""));var o=new hT(new Pg(i),0),a=new uv(cg);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),Nv.resolve(this.findMutationBatches(a))},mT.prototype.findMutationBatches=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.findMutationBatch(t);null!==e&&r.push(e)}),r},mT.prototype.removeMutationBatch=function(n,r){var i=this;Am(0===this.indexOfExistingBatchId(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var o=this.batchesByDocumentKey;return Nv.forEach(r.mutations,function(t){var e=new hT(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.removeMutationReference(n,t.key)}).next(function(){i.batchesByDocumentKey=o})},mT.prototype.removeCachedMutationKeys=function(t){},mT.prototype.containsKey=function(t,e){var n=new hT(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return Nv.resolve(e.isEqual(r&&r.key))},mT.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Am(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),Nv.resolve()},mT.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Am(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},mT.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},mT.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Am(n.batchId===t,"If found batch must match"),n},mT);function mT(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Rm(),this.batchesByDocumentKey=new uv(hT.compareByKey)}var gT,vT=(bT.prototype.addEntry=function(t,e,n){Am(!n.isEqual($g.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,a=this.sizer(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:a,readTime:n}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())},bT.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},bT.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Nv.resolve(n?n.maybeDocument:null)},bT.prototype.getEntries=function(t,e){var n=this,r=dv();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),Nv.resolve(r)},bT.prototype.getDocumentsMatchingQuery=function(t,e,n){Am(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=mv(),i=new Pg(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=o.getNext(),s=a.key,u=a.value,c=u.maybeDocument,h=u.readTime;if(!e.path.isPrefixOf(s.path))break;h.compareTo(n)<=0||c instanceof Iw&&e.matches(c)&&(r=r.insert(c.key,c))}return Nv.resolve(r)},bT.prototype.forEachDocumentKey=function(t,e){return Nv.forEach(this.docs,function(t){return e(t)})},bT.prototype.getNewDocumentChanges=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},bT.prototype.newChangeBuffer=function(t){return new bT.RemoteDocumentChangeBuffer(this)},bT.prototype.getSize=function(t){return Nv.resolve(this.size)},bT.RemoteDocumentChangeBuffer=(ia(wT,gT=Lw),wT.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(t,e){e?i.push(r.documentCache.addEntry(n,e,r.readTime)):r.documentCache.removeEntry(t)}),Nv.waitFor(i)},wT.prototype.getFromCache=function(t,e){return this.documentCache.getEntry(t,e)},wT.prototype.getAllFromCache=function(t,e){return this.documentCache.getEntries(t,e)},wT),bT);function bT(t,e){this.indexManager=t,this.sizer=e,this.docs=new tv(Pg.comparator),this.size=0}function wT(t){var e=gT.call(this)||this;return e.documentCache=t,e}var _T=(TT.prototype.forEachTarget=function(t,n){return this.targets.forEach(function(t,e){return n(e)}),Nv.resolve()},TT.prototype.getLastRemoteSnapshotVersion=function(t){return Nv.resolve(this.lastRemoteSnapshotVersion)},TT.prototype.getHighestSequenceNumber=function(t){return Nv.resolve(this.highestSequenceNumber)},TT.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,Nv.resolve(e)},TT.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),Nv.resolve()},TT.prototype.saveTargetData=function(t){this.targets.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},TT.prototype.addTargetData=function(t,e){return Am(!this.targets.has(e.target),"Adding a target that already exists"),this.saveTargetData(e),this.targetCount+=1,Nv.resolve()},TT.prototype.updateTargetData=function(t,e){return Am(this.targets.has(e.target),"Updating a non-existent target"),this.saveTargetData(e),Nv.resolve()},TT.prototype.removeTargetData=function(t,e){return Am(0<this.targetCount,"Removing a target from an empty cache"),Am(this.targets.has(e.target),"Removing a non-existent target from the cache"),this.targets.delete(e.target),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,Nv.resolve()},TT.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return this.targets.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.targets.delete(t),s.push(o.removeMatchingKeysForTargetId(n,e.targetId)),a++)}),Nv.waitFor(s).next(function(){return a})},TT.prototype.getTargetCount=function(t){return Nv.resolve(this.targetCount)},TT.prototype.getTargetData=function(t,e){var n=this.targets.get(e)||null;return Nv.resolve(n)},TT.prototype.getTargetDataForTarget=function(t,e){return Nm("Not yet implemented.")},TT.prototype.addMatchingKeys=function(e,t,n){this.references.addReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.addReference(e,t))}),Nv.waitFor(i)},TT.prototype.removeMatchingKeys=function(e,t,n){this.references.removeReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.removeReference(e,t))}),Nv.waitFor(i)},TT.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),Nv.resolve()},TT.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return Nv.resolve(n)},TT.prototype.containsKey=function(t,e){return Nv.resolve(this.references.containsKey(e))},TT);function TT(t){this.persistence=t,this.targets=new Pw(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=$g.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new uT,this.targetCount=0,this.targetIdGenerator=Jv.forTargetCache()}var ET=(ST.createLruPersistence=function(t,e,n){return new ST(t,function(t){return new DT(t,new O_(e),n)})},ST.createEagerPersistence=function(t){return new ST(t,function(t){return new AT(t)})},ST.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(ST.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),ST.prototype.getActiveClients=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){return[2,[this.clientId]]})})},ST.prototype.setPrimaryStateListener=function(t){return t(!0)},ST.prototype.setDatabaseDeletedListener=function(){},ST.prototype.setNetworkEnabled=function(t){},ST.prototype.getIndexManager=function(){return this.indexManager},ST.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new yT(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},ST.prototype.getTargetCache=function(){return this.targetCache},ST.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},ST.prototype.runTransaction=function(t,e,n){var r=this;Sm("MemoryPersistence","Starting transaction:",t);var i=new CT(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},ST.prototype.mutationQueuesContainKey=function(e,n){return Nv.or(function(t){var n=[];return qm(t,function(t,e){return n.push(e)}),n}(this.mutationQueues).map(function(t){return function(){return t.containsKey(e,n)}}))},ST);function ST(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new _g(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new _T(this);this.indexManager=new Qw,this.remoteDocumentCache=new vT(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}var IT,CT=(ia(NT,IT=K_),NT);function NT(t){var e=IT.call(this)||this;return e.currentSequenceNumber=t,e}var AT=(Object.defineProperty(kT.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Nm("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),kT.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},kT.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),Nv.resolve()},kT.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),Nv.resolve()},kT.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),Nv.resolve()},kT.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeTargetData(t,e)})},kT.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},kT.prototype.onTransactionCommitted=function(t){var n=this,r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Nv.forEach(this.orphanedDocuments,function(e){return n.isReferenced(t,e).next(function(t){t||r.removeEntry(e)})}).next(function(){return n._orphanedDocuments=null,r.apply(t)})},kT.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},kT.prototype.documentSize=function(t){return 0},kT.prototype.isReferenced=function(t,e){var n=this;return Nv.or([function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return Nv.resolve(n.inMemoryPins.containsKey(e))}])},kT);function kT(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}var DT=(RT.prototype.onTransactionStarted=function(){},RT.prototype.onTransactionCommitted=function(t){return Nv.resolve()},RT.prototype.forEachTarget=function(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)},RT.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocumentCount(t);return this.persistence.getTargetCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},RT.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},RT.prototype.forEachOrphanedDocumentSequenceNumber=function(n,r){var i=this;return Nv.forEach(this.orphanedSequenceNumbers,function(t,e){return i.isPinned(n,t,e).next(function(t){return t?Nv.resolve():r(e)})})},RT.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},RT.prototype.removeTargets=function(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)},RT.prototype.removeOrphanedDocuments=function(t,n){var r=this,i=0,e=this.persistence.getRemoteDocumentCache(),o=e.newChangeBuffer();return e.forEachDocumentKey(t,function(e){return r.isPinned(t,e,n).next(function(t){t||(i++,o.removeEntry(e))})}).next(function(){return o.apply(t)}).next(function(){return i})},RT.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Nv.resolve()},RT.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)},RT.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Nv.resolve()},RT.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Nv.resolve()},RT.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Nv.resolve()},RT.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t,t.version);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Nm("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},RT.prototype.isPinned=function(t,e,n){var r=this;return Nv.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return Nv.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getTargetCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return Nv.resolve(void 0!==t&&n<t)}])},RT.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},RT);function RT(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new Pw(function(t){return Hg(t.path)}),this.garbageCollector=new j_(this,n)}var OT=(PT.prototype.setLocalDocumentsView=function(t){this.localDocumentsView=t},PT.prototype.getDocumentsMatchingQuery=function(t,e,n,r){return Am(void 0!==this.localDocumentsView,"setLocalDocumentsView() not called"),this.localDocumentsView.getDocumentsMatchingQuery(t,e,$g.MIN)},PT);function PT(){}var MT=Number,LT=MT.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),xT=MT.MAX_SAFE_INTEGER||Math.pow(2,53)-1,FT=MT.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function UT(t){return null==t}function VT(t){return FT(t)&&t<=xT&&LT<=t}var qT=(BT.prototype.reset=function(){this.currentBaseMs=0},BT.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},BT.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&Sm("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},BT.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},BT.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},BT);function BT(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var jT,WT,KT="PersistentStream";(WT=jT=jT||{})[WT.Initial=0]="Initial",WT[WT.Starting=1]="Starting",WT[WT.Open=2]="Open",WT[WT.Error=3]="Error",WT[WT.Backoff=4]="Backoff";var QT=(HT.prototype.isStarted=function(){return this.state===jT.Starting||this.state===jT.Open||this.state===jT.Backoff},HT.prototype.isOpen=function(){return this.state===jT.Open},HT.prototype.start=function(){this.state!==jT.Error?(Am(this.state===jT.Initial,"Already started"),this.auth()):this.performBackoff()},HT.prototype.stop=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(jT.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},HT.prototype.inhibitBackoff=function(){Am(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=jT.Initial,this.backoff.reset()},HT.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},HT.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},HT.prototype.handleIdleCloseTimer=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){return this.isOpen()?[2,this.close(jT.Initial)]:[2]})})},HT.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},HT.prototype.close=function(e,n){return aa(this,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return Am(this.isStarted(),"Only started streams should be closed."),Am(e===jT.Error||UT(n),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,e!==jT.Error?this.backoff.reset():n&&n.code===Pm.RESOURCE_EXHAUSTED?(Im(n.toString()),Im("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):n&&n.code===Pm.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.onClose(n)];case 1:return t.sent(),[2]}})})},HT.prototype.tearDown=function(){},HT.prototype.auth=function(){var n=this;Am(this.state===jT.Initial,"Must be in initial state to auth"),this.state=jT.Starting;var t=this.getCloseGuardedDispatcher(this.closeCount),e=this.closeCount;this.credentialsProvider.getToken().then(function(t){n.closeCount===e&&n.startStream(t)},function(e){t(function(){var t=new Mm(Pm.UNKNOWN,"Fetching auth token failed: "+e.message);return n.handleStreamClose(t)})})},HT.prototype.startStream=function(t){var e=this;Am(this.state===jT.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return Am(e.state===jT.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=jT.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},HT.prototype.performBackoff=function(){var t=this;Am(this.state===jT.Error,"Should only perform backoff when in Error state"),this.state=jT.Backoff,this.backoff.backoffAndRun(function(){return aa(t,void 0,void 0,function(){return sa(this,function(t){return Am(this.state===jT.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=jT.Initial,this.start(),Am(this.isStarted(),"PersistentStream should have started"),[2]})})})},HT.prototype.handleStreamClose=function(t){return Am(this.isStarted(),"Can't handle server close on non-started stream"),Sm(KT,"close with error: "+t),this.stream=null,this.close(jT.Error,t)},HT.prototype.getCloseGuardedDispatcher=function(e){var n=this;return function(t){n.queue.enqueueAndForget(function(){return n.closeCount===e?t():(Sm(KT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},HT);function HT(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=jT.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new qT(t,e)}var GT,zT=(ia(YT,GT=QT),YT.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},YT.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},YT.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},YT.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},YT);function YT(t,e,n,r,i){var o=GT.call(this,t,Lg.ListenStreamConnectionBackoff,Lg.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}var XT,JT=(ia($T,XT=QT),Object.defineProperty($T.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),$T.prototype.start=function(){this.handshakeComplete_=!1,XT.prototype.start.call(this)},$T.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},$T.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},$T.prototype.onMessage=function(t){if(Am(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Am(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},$T.prototype.writeHandshake=function(){Am(this.isOpen(),"Writing handshake requires an opened stream"),Am(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},$T.prototype.writeMutations=function(t){var e=this;Am(this.isOpen(),"Writing mutations requires an opened stream"),Am(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Am(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},$T);function $T(t,e,n,r,i){var o=XT.call(this,t,Lg.WriteStreamConnectionBackoff,Lg.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o.lastStreamToken=Rm(),o}var ZT=(tE.prototype.newPersistentWriteStream=function(t){return new JT(this.queue,this.connection,this.credentials,this.serializer,t)},tE.prototype.newPersistentWatchStream=function(t){return new zT(this.queue,this.connection,this.credentials,this.serializer,t)},tE.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},tE.prototype.lookup=function(e){var i=this,t={database:this.serializer.encodedDatabaseId,documents:e.map(function(t){return i.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",t).then(function(t){var n=pv();t.forEach(function(t){var e=i.serializer.fromMaybeDocument(t);n=n.insert(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);Am(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},tE.prototype.invokeRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeRPC(e,n,t)}).catch(function(t){throw t.code===Pm.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},tE.prototype.invokeStreamingRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeStreamingRPC(e,n,t)}).catch(function(t){throw t.code===Pm.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},tE);function tE(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}var eE,nE,rE,iE,oE=(aE.prototype.lookup=function(r){return aa(this,void 0,void 0,function(){var e,n=this;return sa(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Mm(Pm.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(r)];case 1:return(e=t.sent()).forEach(function(t){t instanceof Aw||t instanceof Iw?n.recordVersion(t):Nm("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},aE.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},aE.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},aE.prototype.delete=function(t){this.write([new Db(t,this.precondition(t))]),this.writtenDocs.add(t)},aE.prototype.commit=function(){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(e=this.readVersions,this.mutations.forEach(function(t){e=e.remove(t.key)}),!e.isEmpty())throw new Mm(Pm.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},aE.prototype.recordVersion=function(t){var e;if(t instanceof Iw)e=t.version;else{if(!(t instanceof Aw))throw Nm("Document in a transaction was a "+t.constructor.name);e=$g.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Mm(Pm.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},aE.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?fb.updateTime(e):fb.NONE},aE.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(this.writtenDocs.has(t)||!e)return fb.exists(!0);if(e.isEqual($g.forDeletedDoc()))throw new Mm(Pm.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return fb.updateTime(e)},aE.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},aE.prototype.ensureCommitNotCalled=function(){Am(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},aE);function aE(t){this.datastore=t,this.readVersions=vv(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}(nE=eE=eE||{})[nE.Unknown=0]="Unknown",nE[nE.Online=1]="Online",nE[nE.Offline=2]="Offline",(iE=rE=rE||{})[iE.RemoteStore=0]="RemoteStore",iE[iE.SharedClientState=1]="SharedClientState";var sE,uE,cE=(hE.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(eE.Unknown),Am(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Lg.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,Am(t.state===eE.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(eE.Offline),Promise.resolve()}))},hE.prototype.handleWatchStreamFailure=function(t){this.state===eE.Online?(this.setAndBroadcast(eE.Unknown),Am(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Am(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(eE.Offline)))},hE.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===eE.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},hE.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},hE.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Im(e),this.shouldWarnClientIsOffline=!1):Sm("OnlineStateTracker",e)},hE.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},hE);function hE(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=eE.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}function lE(t){switch(t){case Pm.OK:return Nm("Treated status OK as error");case Pm.CANCELLED:case Pm.UNKNOWN:case Pm.DEADLINE_EXCEEDED:case Pm.RESOURCE_EXHAUSTED:case Pm.INTERNAL:case Pm.UNAVAILABLE:case Pm.UNAUTHENTICATED:return!1;case Pm.INVALID_ARGUMENT:case Pm.NOT_FOUND:case Pm.ALREADY_EXISTS:case Pm.PERMISSION_DENIED:case Pm.FAILED_PRECONDITION:case Pm.ABORTED:case Pm.OUT_OF_RANGE:case Pm.UNIMPLEMENTED:case Pm.DATA_LOSS:return!0;default:return Nm("Unknown status code: "+t)}}function fE(t){if(void 0===t)return Im("GRPC error has no .code"),Pm.UNKNOWN;switch(t){case sE.OK:return Pm.OK;case sE.CANCELLED:return Pm.CANCELLED;case sE.UNKNOWN:return Pm.UNKNOWN;case sE.DEADLINE_EXCEEDED:return Pm.DEADLINE_EXCEEDED;case sE.RESOURCE_EXHAUSTED:return Pm.RESOURCE_EXHAUSTED;case sE.INTERNAL:return Pm.INTERNAL;case sE.UNAVAILABLE:return Pm.UNAVAILABLE;case sE.UNAUTHENTICATED:return Pm.UNAUTHENTICATED;case sE.INVALID_ARGUMENT:return Pm.INVALID_ARGUMENT;case sE.NOT_FOUND:return Pm.NOT_FOUND;case sE.ALREADY_EXISTS:return Pm.ALREADY_EXISTS;case sE.PERMISSION_DENIED:return Pm.PERMISSION_DENIED;case sE.FAILED_PRECONDITION:return Pm.FAILED_PRECONDITION;case sE.ABORTED:return Pm.ABORTED;case sE.OUT_OF_RANGE:return Pm.OUT_OF_RANGE;case sE.UNIMPLEMENTED:return Pm.UNIMPLEMENTED;case sE.DATA_LOSS:return Pm.DATA_LOSS;default:return Nm("Unknown status code: "+t)}}(uE=sE=sE||{})[uE.OK=0]="OK",uE[uE.CANCELLED=1]="CANCELLED",uE[uE.UNKNOWN=2]="UNKNOWN",uE[uE.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",uE[uE.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",uE[uE.NOT_FOUND=5]="NOT_FOUND",uE[uE.ALREADY_EXISTS=6]="ALREADY_EXISTS",uE[uE.PERMISSION_DENIED=7]="PERMISSION_DENIED",uE[uE.UNAUTHENTICATED=16]="UNAUTHENTICATED",uE[uE.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",uE[uE.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",uE[uE.ABORTED=10]="ABORTED",uE[uE.OUT_OF_RANGE=11]="OUT_OF_RANGE",uE[uE.UNIMPLEMENTED=12]="UNIMPLEMENTED",uE[uE.INTERNAL=13]="INTERNAL",uE[uE.UNAVAILABLE=14]="UNAVAILABLE",uE[uE.DATA_LOSS=15]="DATA_LOSS";var pE,dE,yE,mE,gE=(vE.emptySet=function(t){return new vE(t.comparator)},vE.prototype.has=function(t){return null!=this.keyedMap.get(t)},vE.prototype.get=function(t){return this.keyedMap.get(t)},vE.prototype.first=function(){return this.sortedSet.minKey()},vE.prototype.last=function(){return this.sortedSet.maxKey()},vE.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},vE.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(vE.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),vE.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},vE.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},vE.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},vE.prototype.isEqual=function(t){if(!(t instanceof vE))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},vE.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},vE.prototype.copy=function(t,e){var n=new vE;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},vE);function vE(n){this.comparator=n?function(t,e){return n(t,e)||Pg.comparator(t.key,e.key)}:function(t,e){return Pg.comparator(t.key,e.key)},this.keyedMap=mv(),this.sortedSet=new tv(this.comparator)}(dE=pE=pE||{})[dE.Added=0]="Added",dE[dE.Removed=1]="Removed",dE[dE.Modified=2]="Modified",dE[dE.Metadata=3]="Metadata",(mE=yE=yE||{})[mE.Local=0]="Local",mE[mE.Synced=1]="Synced";var bE=(wE.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==pE.Added&&n.type===pE.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===pE.Metadata&&n.type!==pE.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===pE.Modified&&n.type===pE.Modified?this.changeMap=this.changeMap.insert(e,{type:pE.Modified,doc:t.doc}):t.type===pE.Modified&&n.type===pE.Added?this.changeMap=this.changeMap.insert(e,{type:pE.Added,doc:t.doc}):t.type===pE.Removed&&n.type===pE.Added?this.changeMap=this.changeMap.remove(e):t.type===pE.Removed&&n.type===pE.Modified?this.changeMap=this.changeMap.insert(e,{type:pE.Removed,doc:n.doc}):t.type===pE.Added&&n.type===pE.Removed?this.changeMap=this.changeMap.insert(e,{type:pE.Modified,doc:t.doc}):Nm("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},wE.prototype.getChanges=function(){var n=[];return this.changeMap.inorderTraversal(function(t,e){n.push(e)}),n},wE);function wE(){this.changeMap=new tv(Pg.comparator)}var _E=(TE.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:pE.Added,doc:t})}),new TE(t,e,gE.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(TE.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),TE.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},TE);function TE(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var EE=(SE.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=IE.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new SE($g.MIN,r,Tv(),pv(),wv())},SE);function SE(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var IE=(CE.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new CE(Rm(),e,wv(),wv(),wv())},CE);function CE(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var NE,AE,kE=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},DE=function(t,e){this.targetId=t,this.existenceFilter=e};(AE=NE=NE||{})[AE.NoChange=0]="NoChange",AE[AE.Added=1]="Added",AE[AE.Removed=2]="Removed",AE[AE.Current=3]="Current",AE[AE.Reset=4]="Reset";var RE=function(t,e,n,r){void 0===n&&(n=Rm()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},OE=(Object.defineProperty(PE.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(PE.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(PE.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(PE.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),PE.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},PE.prototype.toTargetChange=function(){var n=wv(),r=wv(),i=wv();return this.documentChanges.forEach(function(t,e){switch(e){case pE.Added:n=n.add(t);break;case pE.Modified:r=r.add(t);break;case pE.Removed:i=i.add(t);break;default:Nm("Encountered invalid change type: "+e)}}),new IE(this._resumeToken,this._current,n,r,i)},PE.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=FE()},PE.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},PE.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},PE.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},PE.prototype.recordTargetResponse=function(){this.pendingResponses-=1},PE.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},PE);function PE(){this.pendingResponses=0,this.documentChanges=FE(),this._resumeToken=Rm(),this._current=!1,this._hasPendingChanges=!0}var ME=(LE.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof Iw?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof Aw&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,t.key,t.newDoc)},LE.prototype.handleTargetChange=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.ensureTargetState(t);switch(n.state){case NE.NoChange:r.isActiveTarget(t)&&e.updateResumeToken(n.resumeToken);break;case NE.Added:e.recordTargetResponse(),e.isPending||e.clearPendingChanges(),e.updateResumeToken(n.resumeToken);break;case NE.Removed:e.recordTargetResponse(),e.isPending||r.removeTarget(t),Am(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case NE.Current:r.isActiveTarget(t)&&(e.markCurrent(),e.updateResumeToken(n.resumeToken));break;case NE.Reset:r.isActiveTarget(t)&&(r.resetTarget(t),e.updateResumeToken(n.resumeToken));break;default:Nm("Unknown target watch change state: "+n.state)}})},LE.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):Vm(this.targetStates,e)},LE.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.targetDataForActiveTarget(e);if(r){var i=r.target;if(i.isDocumentQuery())if(0===n){var o=new Pg(i.path);this.removeDocumentFromTarget(e,o,new Aw(o,$g.forDeletedDoc()))}else Am(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},LE.prototype.createRemoteEvent=function(i){var o=this,a={};Vm(this.targetStates,function(t,e){var n=o.targetDataForActiveTarget(t);if(n){if(e.current&&n.target.isDocumentQuery()){var r=new Pg(n.target.path);null!==o.pendingDocumentUpdates.get(r)||o.targetContainsDocument(t,r)||o.removeDocumentFromTarget(t,r,new Aw(r,i))}e.hasPendingChanges&&(a[t]=e.toTargetChange(),e.clearPendingChanges())}});var r=wv();this.pendingDocumentTargetMapping.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){var e=o.targetDataForActiveTarget(t);return!e||e.purpose===S_.LimboResolution||(n=!1)}),n&&(r=r.add(t))});var t=new EE(i,a,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=pv(),this.pendingDocumentTargetMapping=xE(),this.pendingTargetResets=new uv(cg),t},LE.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?pE.Modified:pE.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},LE.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,pE.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},LE.prototype.removeTarget=function(t){delete this.targetStates[t]},LE.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},LE.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},LE.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new OE),this.targetStates[t]},LE.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new uv(cg),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},LE.prototype.isActiveTarget=function(t){var e=null!==this.targetDataForActiveTarget(t);return e||Sm("WatchChangeAggregator","Detected inactive target",t),e},LE.prototype.targetDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getTargetDataForTarget(t)},LE.prototype.resetTarget=function(e){var n=this;Am(!this.targetStates[e].isPending,"Should only reset active targets"),this.targetStates[e]=new OE,this.metadataProvider.getRemoteKeysForTarget(e).forEach(function(t){n.removeDocumentFromTarget(e,t,null)})},LE.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},LE);function LE(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=pv(),this.pendingDocumentTargetMapping=xE(),this.pendingTargetResets=new uv(cg)}function xE(){return new tv(Pg.comparator)}function FE(){return new tv(Pg.comparator)}var UE="RemoteStore",VE=(qE.prototype.start=function(){return this.enableNetwork()},qE.prototype.enableNetwork=function(){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(e=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(eE.Unknown),[4,this.fillWritePipeline()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},qE.prototype.disableNetwork=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(eE.Offline),[2]}})})},qE.prototype.disableNetworkInternal=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(Sm(UE,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},qE.prototype.shutdown=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return Sm(UE,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(eE.Unknown),[2]}})})},qE.prototype.listen=function(t){Fm(this.listenTargets,t.targetId)||(this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t))},qE.prototype.unlisten=function(t){Fm(this.listenTargets,t)&&(delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),Bm(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(eE.Unknown)))},qE.prototype.getTargetDataForTarget=function(t){return this.listenTargets[t]||null},qE.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},qE.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},qE.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},qE.prototype.startWatchStream=function(){Am(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new ME(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},qE.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!Bm(this.listenTargets)},qE.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},qE.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},qE.prototype.onWatchStreamOpen=function(){return aa(this,void 0,void 0,function(){var n=this;return sa(this,function(t){return Vm(this.listenTargets,function(t,e){n.sendWatchRequest(e)}),[2]})})},qE.prototype.onWatchStreamClose=function(e){return aa(this,void 0,void 0,function(){return sa(this,function(t){return void 0===e&&Am(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(e),this.startWatchStream()):this.onlineStateTracker.set(eE.Unknown),[2]})})},qE.prototype.onWatchStreamChange=function(n,r){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return this.onlineStateTracker.set(eE.Online),n instanceof RE&&n.state===NE.Removed&&n.cause?[2,this.handleTargetError(n)]:(n instanceof kE?this.watchChangeAggregator.handleDocumentChange(n):n instanceof DE?this.watchChangeAggregator.handleExistenceFilter(n):(Am(n instanceof RE,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(n)),r.isEqual($g.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return e=t.sent(),0<=r.compareTo(e)?[4,this.raiseWatchSnapshot(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},qE.prototype.raiseWatchSnapshot=function(r){var i=this;Am(!r.isEqual($g.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.watchChangeAggregator.createRemoteEvent(r);return Vm(t.targetChanges,function(t,e){if(0<e.resumeToken.length){var n=i.listenTargets[t];n&&(i.listenTargets[t]=n.withResumeToken(e.resumeToken,r))}}),t.targetMismatches.forEach(function(t){var e=i.listenTargets[t];if(e){i.listenTargets[t]=e.withResumeToken(Rm(),e.snapshotVersion),i.sendUnwatchRequest(t);var n=new D_(e.target,t,S_.ExistenceFilterMismatch,e.sequenceNumber);i.sendWatchRequest(n)}}),this.syncEngine.applyRemoteEvent(t)},qE.prototype.handleTargetError=function(t){var n=this;Am(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return aa(n,void 0,void 0,function(){return sa(this,function(t){return Fm(this.listenTargets,e)?(delete this.listenTargets[e],this.watchChangeAggregator.removeTarget(e),[2,this.syncEngine.rejectListen(e,r)]):[2]})})})}),i},qE.prototype.fillWritePipeline=function(){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:return this.canAddToWritePipeline()?(e=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(n),[4,this.fillWritePipeline()];case 3:t.sent(),t.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},qE.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},qE.prototype.outstandingWrites=function(){return this.writePipeline.length},qE.prototype.addToWritePipeline=function(t){Am(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},qE.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},qE.prototype.startWriteStream=function(){Am(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},qE.prototype.onWriteStreamOpen=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){return this.writeStream.writeHandshake(),[2]})})},qE.prototype.onWriteHandshakeComplete=function(){var r=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var t=0,e=r.writePipeline;t<e.length;t++){var n=e[t];r.writeStream.writeMutations(n.mutations)}}).catch(tT)},qE.prototype.onMutationResult=function(t,e){var n=this;Am(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Iv.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},qE.prototype.onWriteStreamClose=function(n){return aa(this,void 0,void 0,function(){var e=this;return sa(this,function(t){return void 0===n&&Am(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),n&&0<this.writePipeline.length?[2,(this.writeStream.handshakeComplete?this.handleWriteError(n):this.handleHandshakeError(n)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]:[2]})})},qE.prototype.handleHandshakeError=function(e){return aa(this,void 0,void 0,function(){return sa(this,function(t){return lE(e.code)?(Sm(UE,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Rm(),[2,this.localStore.setLastStreamToken(Rm()).catch(tT)]):[2]})})},qE.prototype.handleWriteError=function(r){return aa(this,void 0,void 0,function(){var e,n=this;return sa(this,function(t){return function(t){return lE(t)&&t!==Pm.ABORTED}(r.code)?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,r).then(function(){return n.fillWritePipeline()})]):[2]})})},qE.prototype.createTransaction=function(){return new oE(this.datastore)},qE.prototype.restartNetwork=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(eE.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},qE.prototype.handleCredentialChange=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Sm(UE,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},qE.prototype.applyPrimaryState=function(e){return aa(this,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.disableNetworkInternal()];case 3:t.sent(),this.onlineStateTracker.set(eE.Unknown),t.label=4;case 4:return[2]}})})},qE);function qE(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return aa(o,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Sm(UE,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new cE(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}var BE=(Object.defineProperty(jE.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(jE.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),jE.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},jE.prototype._compareTo=function(t){return cg(this._lat,t._lat)||cg(this._long,t._long)},jE);function jE(t,e){if(Wm("GeoPoint",arguments,2),Hm("GeoPoint","number",1,t),Hm("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Mm(Pm.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Mm(Pm.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}var WE,KE,QE=(HE.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";UT(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},HE.prototype.toString=function(){var t=this.path.canonicalString();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),UT(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},HE.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},HE.prototype.isDocumentQuery=function(){return Pg.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},HE);function HE(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}(KE=WE=WE||{}).First="F",KE.Last="L";var GE=(zE.atPath=function(t){return new zE(t)},Object.defineProperty(zE.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[TS]:this.memoizedOrderBy=[new wS(t),TS];else{Am(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:mS.ASCENDING;this.memoizedOrderBy.push(a===mS.ASCENDING?TS:ES)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),zE.prototype.addFilter=function(t){Am(null==this.getInequalityFilterField()||!(t instanceof ZE)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Am(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new zE(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.limitType,this.startAt,this.endAt)},zE.prototype.addOrderBy=function(t){Am(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new zE(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},zE.prototype.withLimitToFirst=function(t){return new zE(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,WE.First,this.startAt,this.endAt)},zE.prototype.withLimitToLast=function(t){return new zE(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,WE.Last,this.startAt,this.endAt)},zE.prototype.withStartAt=function(t){return new zE(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,t,this.endAt)},zE.prototype.withEndAt=function(t){return new zE(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,t)},zE.prototype.asCollectionQueryAtPath=function(t){return new zE(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},zE.prototype.matchesAllDocuments=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.explicitOrderBy.length||1===this.explicitOrderBy.length&&this.explicitOrderBy[0].field.isKeyField())},zE.prototype.canonicalId=function(){return this.toTarget().canonicalId()+"|lt:"+this.limitType},zE.prototype.toString=function(){return"Query(target="+this.toTarget().toString()+"; limitType="+this.limitType+")"},zE.prototype.isEqual=function(t){return this.toTarget().isEqual(t.toTarget())&&this.limitType===t.limitType},zE.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return Am(n,"orderBy used that doesn't compare on key field"),0},zE.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},zE.prototype.hasLimitToFirst=function(){return!UT(this.limit)&&this.limitType===WE.First},zE.prototype.hasLimitToLast=function(){return!UT(this.limit)&&this.limitType===WE.Last},zE.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},zE.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof ZE&&n.isInequality())return n.field}return null},zE.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof ZE&&0<=t.indexOf(r.op))return r.op}return null},zE.prototype.isDocumentQuery=function(){return this.toTarget().isDocumentQuery()},zE.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},zE.prototype.toTarget=function(){if(!this.memorizedTarget)if(this.limitType===WE.First)this.memorizedTarget=new QE(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===mS.DESCENDING?mS.ASCENDING:mS.DESCENDING;t.push(new wS(r.field,i))}var o=this.endAt?new vS(this.endAt.position,!this.endAt.before):null,a=this.startAt?new vS(this.startAt.position,!this.startAt.before):null;this.memorizedTarget=new QE(this.path,this.collectionGroup,t,this.filters,this.limit,o,a)}return this.memorizedTarget},zE.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):Pg.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},zE.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},zE.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},zE.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},zE.prototype.assertValidBound=function(t){Am(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},zE);function zE(t,e,n,r,i,o,a,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=WE.First),void 0===a&&(a=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.memoizedOrderBy=null,this.memorizedTarget=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}function YE(){}var XE=(JE.fromString=function(t){switch(t){case"<":return JE.LESS_THAN;case"<=":return JE.LESS_THAN_OR_EQUAL;case"==":return JE.EQUAL;case">=":return JE.GREATER_THAN_OR_EQUAL;case">":return JE.GREATER_THAN;case"array-contains":return JE.ARRAY_CONTAINS;case"in":return JE.IN;case"array-contains-any":return JE.ARRAY_CONTAINS_ANY;default:return Nm("Unknown FieldFilter operator: "+t)}},JE.prototype.toString=function(){return this.name},JE.prototype.isEqual=function(t){return this.name===t.name},JE.LESS_THAN=new JE("<"),JE.LESS_THAN_OR_EQUAL=new JE("<="),JE.EQUAL=new JE("=="),JE.GREATER_THAN=new JE(">"),JE.GREATER_THAN_OR_EQUAL=new JE(">="),JE.ARRAY_CONTAINS=new JE("array-contains"),JE.IN=new JE("in"),JE.ARRAY_CONTAINS_ANY=new JE("array-contains-any"),JE);function JE(t){this.name=t}var $E,ZE=(ia(tS,$E=YE),tS.create=function(t,e,n){if(t.isKeyField())return e===XE.IN?(Am(n instanceof ww,"Comparing on key with IN, but filter value not an ArrayValue"),Am(n.internalValue.every(function(t){return t instanceof lw}),"Comparing on key with IN, but an array value was not a RefValue"),new oS(t,n)):(Am(n instanceof lw,"Comparing on key, but filter value not a RefValue"),Am(e!==XE.ARRAY_CONTAINS&&e!==XE.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new nS(t,e,n));if(n.isEqual(Fb.INSTANCE)){if(e!==XE.EQUAL)throw new Mm(Pm.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new tS(t,e,n)}if(n.isEqual(Xb.NAN)){if(e!==XE.EQUAL)throw new Mm(Pm.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new tS(t,e,n)}return e===XE.ARRAY_CONTAINS?new uS(t,n):e===XE.IN?(Am(n instanceof ww,"IN filter has invalid value: "+n.toString()),new lS(t,n)):e===XE.ARRAY_CONTAINS_ANY?(Am(n instanceof ww,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new dS(t,n)):new tS(t,e,n)},tS.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},tS.prototype.matchesComparison=function(t){switch(this.op){case XE.LESS_THAN:return t<0;case XE.LESS_THAN_OR_EQUAL:return t<=0;case XE.EQUAL:return 0===t;case XE.GREATER_THAN:return 0<t;case XE.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Nm("Unknown FieldFilter operator: "+this.op)}},tS.prototype.isInequality=function(){return 0<=[XE.LESS_THAN,XE.LESS_THAN_OR_EQUAL,XE.GREATER_THAN,XE.GREATER_THAN_OR_EQUAL].indexOf(this.op)},tS.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},tS.prototype.isEqual=function(t){return t instanceof tS&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},tS.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},tS);function tS(t,e,n){var r=$E.call(this)||this;return r.field=t,r.op=e,r.value=n,r}var eS,nS=(ia(rS,eS=ZE),rS.prototype.matches=function(t){var e=this.value,n=Pg.comparator(t.key,e.key);return this.matchesComparison(n)},rS);function rS(){return null!==eS&&eS.apply(this,arguments)||this}var iS,oS=(ia(aS,iS=ZE),aS.prototype.matches=function(e){return this.value.internalValue.some(function(t){return e.key.isEqual(t.key)})},aS);function aS(t,e){var n=iS.call(this,t,XE.IN,e)||this;return n.value=e,n}var sS,uS=(ia(cS,sS=ZE),cS.prototype.matches=function(t){var e=t.field(this.field);return e instanceof ww&&e.contains(this.value)},cS);function cS(t,e){return sS.call(this,t,XE.ARRAY_CONTAINS,e)||this}var hS,lS=(ia(fS,hS=ZE),fS.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},fS);function fS(t,e){var n=hS.call(this,t,XE.IN,e)||this;return n.value=e,n}var pS,dS=(ia(yS,pS=ZE),yS.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof ww&&n.internalValue.some(function(t){return e.value.contains(t)})},yS);function yS(t,e){var n=pS.call(this,t,XE.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}var mS=(gS.prototype.toString=function(){return this.name},gS.ASCENDING=new gS("asc"),gS.DESCENDING=new gS("desc"),gS);function gS(t){this.name=t}var vS=(bS.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},bS.prototype.sortsBeforeDocument=function(t,e){Am(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Am(o instanceof lw,"Bound has a non-key value where the key path is being used."),n=Pg.comparator(o.key,e.key);else{var a=e.field(i.field);Am(null!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===mS.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},bS.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},bS);function bS(t,e){this.position=t,this.before=e}var wS=(_S.prototype.compare=function(t,e){var n=this.isKeyOrderBy?Iw.compareByKey(t,e):Iw.compareByField(this.field,t,e);switch(this.dir){case mS.ASCENDING:return n;case mS.DESCENDING:return-1*n;default:return Nm("Unknown direction: "+this.dir)}},_S.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},_S.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},_S.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},_S);function _S(t,e){this.field=t,void 0===e&&(e=mS.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}var TS=new wS(Rg.keyField(),mS.ASCENDING),ES=new wS(Rg.keyField(),mS.DESCENDING),SS=(IS.prototype.applyToLocalView=function(t,e){return new ow(e,t)},IS.prototype.applyToRemoteDocument=function(t,e){return e},IS.prototype.computeBaseValue=function(t){return null},IS.prototype.isEqual=function(t){return t instanceof IS},IS.instance=new IS,IS);function IS(){}var CS=(NS.prototype.applyToLocalView=function(t,e){return this.apply(t)},NS.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},NS.prototype.apply=function(t){for(var n=OS(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new ww(n)},NS.prototype.computeBaseValue=function(t){return null},NS.prototype.isEqual=function(t){return t instanceof NS&&hg(t.elements,this.elements)},NS);function NS(t){this.elements=t}var AS=(kS.prototype.applyToLocalView=function(t,e){return this.apply(t)},kS.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},kS.prototype.apply=function(t){for(var n=OS(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new ww(n)},kS.prototype.computeBaseValue=function(t){return null},kS.prototype.isEqual=function(t){return t instanceof kS&&hg(t.elements,this.elements)},kS);function kS(t){this.elements=t}var DS=(RS.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof Gb&&this.operand instanceof Gb){var r=n.internalValue+this.operand.internalValue;return new Gb(r)}return r=n.internalValue+this.operand.internalValue,new Xb(r)},RS.prototype.applyToRemoteDocument=function(t,e){return Am(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},RS.prototype.computeBaseValue=function(t){return t instanceof Wb?t:new Gb(0)},RS.prototype.isEqual=function(t){return t instanceof RS&&this.operand.isEqual(t.operand)},RS);function RS(t){this.operand=t}function OS(t){return t instanceof ww?t.internalValue.slice():[]}var PS=(MS.prototype.isEqual=function(t){return t&&t.count===this.count},MS);function MS(t){this.count=t}var LS,xS,FS=((LS={})[mS.ASCENDING.name]="ASCENDING",LS[mS.DESCENDING.name]="DESCENDING",LS),US=((xS={})[XE.LESS_THAN.name]="LESS_THAN",xS[XE.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",xS[XE.GREATER_THAN.name]="GREATER_THAN",xS[XE.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",xS[XE.EQUAL.name]="EQUAL",xS[XE.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",xS[XE.IN.name]="IN",xS[XE.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",xS),VS=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qS(t,e){Am(!UT(t),e+" is missing")}function BS(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Nm("can't parse "+t)}var jS=(WS.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},WS.prototype.unsafeCastProtoByteString=function(t){return t},WS.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Pm.UNKNOWN:fE(t.code);return new Mm(e,t.message||"")},WS.prototype.toInt32Value=function(t){return this.options.useProto3Json||UT(t)?t:{value:t}},WS.prototype.fromInt32Value=function(t){var e;return UT(e="object"==typeof t?t.value:t)?null:e},WS.prototype.toTimestamp=function(t){return this.options.useProto3Json?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},WS.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Am(!!t,"Cannot deserialize null or undefined timestamp.");var e=BS(t.seconds||"0"),n=t.nanos||0;return new Xg(e,n)},WS.prototype.fromIso8601String=function(t){var e=0,n=VS.exec(t);if(Am(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new Xg(o,e)},WS.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},WS.prototype.fromBlob=function(t){return"string"==typeof t?(Am(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),dg.fromBase64String(t)):(Am(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),dg.fromUint8Array(t))},WS.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},WS.prototype.fromVersion=function(t){return Am(!!t,"Trying to deserialize version that isn't set"),$g.fromTimestamp(this.fromTimestamp(t))},WS.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},WS.prototype.fromResourceName=function(t){var e=Ng.fromString(t);return Am(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},WS.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},WS.prototype.fromName=function(t){var e=this.fromResourceName(t);return Am(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Am(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new Pg(this.extractLocalPathFromResourceName(e))},WS.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},WS.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?Ng.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(WS.prototype,"encodedDatabaseId",{get:function(){return new Ng(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),WS.prototype.fullyQualifiedPrefixPath=function(t){return new Ng(["projects",t.projectId,"databases",t.database])},WS.prototype.extractLocalPathFromResourceName=function(t){return Am(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},WS.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},WS.prototype.toValue=function(t){if(t instanceof Fb)return{nullValue:"NULL_VALUE"};if(t instanceof qb)return{booleanValue:t.value()};if(t instanceof Gb)return{integerValue:""+t.value()};if(t instanceof Xb){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof Zb?{stringValue:t.value()}:t instanceof gw?{mapValue:this.toMapValue(t)}:t instanceof ww?{arrayValue:this.toArrayValue(t)}:t instanceof nw?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof dw?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof uw?{bytesValue:this.toBytes(t.value())}:t instanceof lw?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Nm("Unknown FieldValue "+JSON.stringify(t))},WS.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return Fb.INSTANCE;if("booleanValue"in t)return qb.of(t.booleanValue);if("integerValue"in t)return new Gb(BS(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return Xb.NAN;if("Infinity"===t.doubleValue)return Xb.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return Xb.NEGATIVE_INFINITY}return new Xb(t.doubleValue)}if("stringValue"in t)return new Zb(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){qS(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new ww(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return qS(t.timestampValue,"timestampValue"),new nw(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){qS(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new dw(new BE(r,i))}if("bytesValue"in t){qS(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new uw(o)}if("referenceValue"in t){qS(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new bg(a.get(1),a.get(3)),u=new Pg(this.extractLocalPathFromResourceName(a));return new lw(s,u)}return Nm("Unknown Value proto "+JSON.stringify(t))},WS.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},WS.prototype.toDocument=function(t){return Am(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data()),updateTime:this.toTimestamp(t.version.toTimestamp())}},WS.prototype.fromDocument=function(t,e){var n=this,r=this.fromName(t.name),i=this.fromVersion(t.updateTime);return new Iw(r,i,{hasCommittedMutations:!!e},void 0,t,function(t){return n.fromValue(t)})},WS.prototype.toFields=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.toValue(e)}),r},WS.prototype.fromFields=function(t){var n=this,e=t,r=gw.EMPTY;return qm(e,function(t,e){r=r.set(new Rg([t]),n.fromValue(e))}),r},WS.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},WS.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},WS.prototype.fromFound=function(t){var e=this;Am(!!t.found,"Tried to deserialize a found document from a missing document."),qS(t.found.name,"doc.found.name"),qS(t.found.updateTime,"doc.found.updateTime");var n=this.fromName(t.found.name),r=this.fromVersion(t.found.updateTime);return new Iw(n,r,{},void 0,t.found,function(t){return e.fromValue(t)})},WS.prototype.fromMissing=function(t){Am(!!t.missing,"Tried to deserialize a missing document from a found document."),Am(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new Aw(e,n)},WS.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Nm("invalid batch get response: "+JSON.stringify(t))},WS.prototype.toWatchTargetChangeState=function(t){switch(t){case NE.Added:return"ADD";case NE.Current:return"CURRENT";case NE.NoChange:return"NO_CHANGE";case NE.Removed:return"REMOVE";case NE.Reset:return"RESET";default:return Nm("Unknown WatchTargetChangeState: "+t)}},WS.prototype.toTestWatchChange=function(t){if(t instanceof DE)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof kE){if(t.newDoc instanceof Iw){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof Aw)return e=t.newDoc,{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof RE){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return sE.OK;switch(t){case Pm.OK:return sE.OK;case Pm.CANCELLED:return sE.CANCELLED;case Pm.UNKNOWN:return sE.UNKNOWN;case Pm.DEADLINE_EXCEEDED:return sE.DEADLINE_EXCEEDED;case Pm.RESOURCE_EXHAUSTED:return sE.RESOURCE_EXHAUSTED;case Pm.INTERNAL:return sE.INTERNAL;case Pm.UNAVAILABLE:return sE.UNAVAILABLE;case Pm.UNAUTHENTICATED:return sE.UNAUTHENTICATED;case Pm.INVALID_ARGUMENT:return sE.INVALID_ARGUMENT;case Pm.NOT_FOUND:return sE.NOT_FOUND;case Pm.ALREADY_EXISTS:return sE.ALREADY_EXISTS;case Pm.PERMISSION_DENIED:return sE.PERMISSION_DENIED;case Pm.FAILED_PRECONDITION:return sE.FAILED_PRECONDITION;case Pm.ABORTED:return sE.ABORTED;case Pm.OUT_OF_RANGE:return sE.OUT_OF_RANGE;case Pm.UNIMPLEMENTED:return sE.UNIMPLEMENTED;case Pm.DATA_LOSS:return sE.DATA_LOSS;default:return Nm("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Nm("Unrecognized watch change: "+JSON.stringify(t))},WS.prototype.fromWatchChange=function(t){var e,n=this;if("targetChange"in t){qS(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new RE(r,i,o,s||null)}else if("documentChange"in t){qS(t.documentChange,"documentChange"),qS(t.documentChange.document,"documentChange.name"),qS(t.documentChange.document.name,"documentChange.document.name"),qS(t.documentChange.document.updateTime,"documentChange.document.updateTime");var u=t.documentChange,c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=new Iw(c,h,{},void 0,u.document,function(t){return n.fromValue(t)}),f=u.targetIds||[],p=u.removedTargetIds||[];e=new kE(f,p,l.key,l)}else if("documentDelete"in t){qS(t.documentDelete,"documentDelete"),qS(t.documentDelete.document,"documentDelete.document");var d=t.documentDelete;c=this.fromName(d.document),h=d.readTime?this.fromVersion(d.readTime):$g.forDeletedDoc(),l=new Aw(c,h),p=d.removedTargetIds||[],e=new kE([],p,l.key,l)}else if("documentRemove"in t){qS(t.documentRemove,"documentRemove"),qS(t.documentRemove.document,"documentRemove");var y=t.documentRemove;c=this.fromName(y.document),p=y.removedTargetIds||[],e=new kE([],p,c,null)}else{if(!("filter"in t))return Nm("Unknown change type "+JSON.stringify(t));qS(t.filter,"filter"),qS(t.filter.targetId,"filter.targetId");var m=t.filter,g=m.count||0,v=new PS(g),b=m.targetId;e=new DE(b,v)}return e},WS.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?NE.NoChange:"ADD"===t?NE.Added:"REMOVE"===t?NE.Removed:"CURRENT"===t?NE.Current:"RESET"===t?NE.Reset:Nm("Got unexpected TargetChange.state: "+t)},WS.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return $g.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?$g.MIN:e.readTime?this.fromVersion(e.readTime):$g.MIN},WS.prototype.toMutation=function(t){var e,n=this;if(t instanceof gb)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof Db)e={delete:this.toName(t.key)};else if(t instanceof wb)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof Eb))return Nm("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},WS.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):fb.NONE;if(t.update){qS(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new wb(r,i,o,n)}return new gb(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new Db(r,n);if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return Am(!0===n.exists,'Transforms only support precondition "exists == true"'),new Eb(r,a)}return Nm("unknown mutation proto: "+JSON.stringify(t))},WS.prototype.toPrecondition=function(t){return Am(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Nm("Unknown precondition")},WS.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?fb.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?fb.exists(t.exists):fb.NONE},WS.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual($g.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new lb(r,i)},WS.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(Am(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},WS.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof SS)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof CS)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof AS)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof DS)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Nm("Unknown transform: "+t.transform)},WS.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)Am("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=SS.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new CS(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new AS(r.map(function(t){return e.fromValue(t)}));else if("increment"in t){var i=this.fromValue(t.increment);Am(i instanceof Wb,"NUMERIC_ADD transform requires a NumberValue"),n=new DS(i)}else Nm("Unknown transform proto: "+JSON.stringify(t));var o=Rg.fromServerFormat(t.fieldPath);return new sb(o,n)},WS.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},WS.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Am(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return GE.atPath(this.fromQueryPath(n)).toTarget()},WS.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Am(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Am(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},WS.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Am(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new GE(e,i,s,a,u,WE.First,c,h).toTarget()},WS.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},WS.prototype.toLabel=function(t){switch(t){case S_.Listen:return null;case S_.ExistenceFilterMismatch:return"existence-filter-mismatch";case S_.LimboResolution:return"limbo-document";default:return Nm("Unrecognized query purpose: "+t)}},WS.prototype.toTarget=function(t){var e,n=t.target;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},WS.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof ZE?e.toUnaryOrFieldFilter(t):Nm("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},WS.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Nm("Unknown filter: "+JSON.stringify(t)):[]},WS.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},WS.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},WS.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},WS.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new vS(r,n)},WS.prototype.toDirection=function(t){return FS[t.name]},WS.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return mS.ASCENDING;case"DESCENDING":return mS.DESCENDING;default:return}},WS.prototype.toOperatorName=function(t){return US[t.name]},WS.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return XE.EQUAL;case"GREATER_THAN":return XE.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return XE.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return XE.LESS_THAN;case"LESS_THAN_OR_EQUAL":return XE.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return XE.ARRAY_CONTAINS;case"IN":return XE.IN;case"ARRAY_CONTAINS_ANY":return XE.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Nm("Unspecified operator");default:return Nm("Unknown operator")}},WS.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},WS.prototype.fromFieldPathReference=function(t){return Rg.fromServerFormat(t.fieldPath)},WS.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},WS.prototype.fromPropertyOrder=function(t){return new wS(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},WS.prototype.fromFieldFilter=function(t){return ZE.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},WS.prototype.toUnaryOrFieldFilter=function(t){if(t.op===XE.EQUAL){if(t.value.isEqual(Xb.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(Fb.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},WS.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return ZE.create(e,XE.EQUAL,Xb.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return ZE.create(n,XE.EQUAL,Fb.INSTANCE);case"OPERATOR_UNSPECIFIED":return Nm("Unspecified filter");default:return Nm("Unknown filter")}},WS.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},WS.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return Rg.fromServerFormat(t)});return ob.fromArray(e)},WS);function WS(t,e){this.databaseId=t,this.options=e}var KS=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},QS=(HS.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new KS,this.queries.set(e,r)),r.listeners.push(t),Am(!t.applyOnlineStateChange(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),!r.viewSnap||t.onViewSnapshot(r.viewSnap)&&this.raiseSnapshotsInSyncEvent(),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},HS.prototype.unlisten=function(o){return aa(this,void 0,void 0,function(){var e,n,r,i;return sa(this,function(t){return e=o.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},HS.prototype.onWatchChange=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,a=this.queries.get(o);if(a){for(var s=0,u=a.listeners;s<u.length;s++)u[s].onViewSnapshot(i)&&(e=!0);a.viewSnap=i}}e&&this.raiseSnapshotsInSyncEvent()},HS.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},HS.prototype.onOnlineStateChange=function(i){this.onlineState=i;var o=!1;this.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].applyOnlineStateChange(i)&&(o=!0)}),o&&this.raiseSnapshotsInSyncEvent()},HS.prototype.addSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.add(t),t.next()},HS.prototype.removeSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.delete(t)},HS.prototype.raiseSnapshotsInSyncEvent=function(){this.snapshotsInSyncListeners.forEach(function(t){t.next()})},HS);function HS(t){this.syncEngine=t,this.queries=new Pw(function(t){return t.canonicalId()}),this.onlineState=eE.Unknown,this.snapshotsInSyncListeners=new Set,this.syncEngine.subscribe(this)}var GS=(zS.prototype.onViewSnapshot=function(t){if(Am(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==pE.Metadata&&e.push(i)}t=new _E(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(t)&&(this.queryObserver.next(t),o=!0):this.shouldRaiseInitialEvent(t,this.onlineState)&&(this.raiseInitialEvent(t),o=!0),this.snap=t,o},zS.prototype.onError=function(t){this.queryObserver.error(t)},zS.prototype.applyOnlineStateChange=function(t){this.onlineState=t;var e=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&(this.raiseInitialEvent(this.snap),e=!0),e},zS.prototype.shouldRaiseInitialEvent=function(t,e){if(Am(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==eE.Offline;return this.options.waitForSyncWhenOnline&&n?(Am(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===eE.Offline},zS.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},zS.prototype.raiseInitialEvent=function(t){Am(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=_E.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},zS);function zS(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=eE.Unknown,this.options=n||{}}var YS=(XS.fromSnapshot=function(t,e){for(var n=wv(),r=wv(),i=0,o=e.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case pE.Added:n=n.add(a.doc.key);break;case pE.Removed:r=r.add(a.doc.key)}}return new XS(t,e.fromCache,n,r)},XS);function XS(t,e,n,r){this.targetId=t,this.fromCache=e,this.addedKeys=n,this.removedKeys=r}var JS=function(t){this.key=t},$S=function(t){this.key=t},ZS=(Object.defineProperty(tI.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),tI.prototype.computeDocChanges=function(t,e){var s=this,u=e?e.changeSet:new bE,c=e?e.documentSet:this.documentSet,h=e?e.mutatedKeys:this.mutatedKeys,l=c,f=!1,p=this.query.hasLimitToFirst()&&c.size===this.query.limit?c.last():null,d=this.query.hasLimitToLast()&&c.size===this.query.limit?c.first():null;if(t.inorderTraversal(function(t,e){var n=c.get(t),r=e instanceof Iw?e:null;r&&(Am(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=s.query.matches(r)?r:null);var i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),a=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:pE.Metadata,doc:r}),a=!0):s.shouldWaitForSyncedDocument(n,r)||(u.track({type:pE.Modified,doc:r}),a=!0,(p&&0<s.query.docComparator(r,p)||d&&s.query.docComparator(r,d)<0)&&(f=!0)):!n&&r?(u.track({type:pE.Added,doc:r}),a=!0):n&&!r&&(u.track({type:pE.Removed,doc:n}),a=!0,(p||d)&&(f=!0)),a&&(h=r?(l=l.add(r),o?h.add(t):h.delete(t)):(l=l.delete(t),h.delete(t)))}),this.query.hasLimitToFirst()||this.query.hasLimitToLast())for(;l.size>this.query.limit;){var n=this.query.hasLimitToFirst()?l.last():l.first();l=l.delete(n.key),h=h.delete(n.key),u.track({type:pE.Removed,doc:n})}return Am(!f||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:l,changeSet:u,needsRefill:f,mutatedKeys:h}},tI.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},tI.prototype.applyChanges=function(t,e,n){var r=this;Am(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){function n(t){switch(t){case pE.Added:return 1;case pE.Modified:case pE.Metadata:return 2;case pE.Removed:return 0;default:return Nm("Unknown ChangeType: "+t)}}return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?yE.Synced:yE.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new _E(this.query,t.documentSet,i,o,t.mutatedKeys,s===yE.Local,u,!1),limboChanges:a}:{limboChanges:a}},tI.prototype.applyOnlineStateChange=function(t){return this.current&&t===eE.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new bE,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},tI.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},tI.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return Am(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},tI.prototype.updateLimboDocuments=function(){var e=this;if(!this.current)return[];var n=this.limboDocuments;this.limboDocuments=wv(),this.documentSet.forEach(function(t){e.shouldBeInLimbo(t.key)&&(e.limboDocuments=e.limboDocuments.add(t.key))});var r=[];return n.forEach(function(t){e.limboDocuments.has(t)||r.push(new $S(t))}),this.limboDocuments.forEach(function(t){n.has(t)||r.push(new JS(t))}),r},tI.prototype.synchronizeWithPersistedState=function(t){this._syncedDocuments=t.remoteKeys,this.limboDocuments=wv();var e=this.computeDocChanges(t.documents);return this.applyChanges(e,!0)},tI.prototype.computeInitialSnapshot=function(){return _E.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===yE.Local)},tI);function tI(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=wv(),this.mutatedKeys=wv(),this.documentSet=new gE(t.docComparator.bind(t))}var eI=(nI.prototype.run=function(){this.runWithBackOff()},nI.prototype.runWithBackOff=function(){var t=this;this.backoff.backoffAndRun(function(){return aa(t,void 0,void 0,function(){var e,n,r=this;return sa(this,function(t){return e=this.remoteStore.createTransaction(),(n=this.tryRunUpdateFunction(e))&&n.then(function(t){r.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){r.deferred.resolve(t)}).catch(function(t){r.handleTransactionError(t)})})}).catch(function(t){r.handleTransactionError(t)}),[2]})})})},nI.prototype.tryRunUpdateFunction=function(t){try{var e=this.updateFunction(t);return!UT(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},nI.prototype.handleTransactionError=function(t){var e=this;0<this.retries&&this.isRetryableTransactionError(t)?(this.retries-=1,this.asyncQueue.enqueueAndForget(function(){return e.runWithBackOff(),Promise.resolve()})):this.deferred.reject(t)},nI.prototype.isRetryableTransactionError=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!lE(e)},nI);function nI(t,e,n,r){this.asyncQueue=t,this.remoteStore=e,this.updateFunction=n,this.deferred=r,this.retries=5,this.backoff=new qT(this.asyncQueue,Lg.RetryTransaction)}var rI="SyncEngine",iI=function(t,e,n){this.query=t,this.targetId=e,this.view=n},oI=function(t){this.key=t,this.receivedDocument=!1},aI=(Object.defineProperty(sI.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),sI.prototype.subscribe=function(t){Am(null!==t,"SyncEngine listener cannot be null"),Am(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},sI.prototype.listen=function(a){return aa(this,void 0,void 0,function(){var e,n,r,i,o;return sa(this,function(t){switch(t.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(a))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateTarget(a.toTarget())];case 2:return i=t.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(a,e,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.remoteStore.listen(i),t.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},sI.prototype.initializeViewAndComputeSnapshot=function(s,u,c){return aa(this,void 0,void 0,function(){var e,n,r,i,o,a;return sa(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(s,!0)];case 1:return e=t.sent(),n=new ZS(s,e.remoteKeys),r=n.computeDocChanges(e.documents),i=IE.createSynthesizedTargetChangeForCurrentChange(u,c&&this.onlineState!==eE.Offline),Am(0===(o=n.applyChanges(r,!0===this.isPrimary,i)).limboChanges.length,"View returned limbo docs before target ack from the server."),Am(!!o.snapshot,"applyChanges for new view should always return a snapshot"),a=new iI(s,u,n),this.queryViewsByQuery.set(s,a),this.queriesByTarget[u]||(this.queriesByTarget[u]=[]),this.queriesByTarget[u].push(s),[2,o.snapshot]}})})},sI.prototype.synchronizeViewAndComputeSnapshot=function(r){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(r.query,!0)];case 1:return e=t.sent(),n=r.view.synchronizeWithPersistedState(e),this.isPrimary&&this.updateTrackedLimbos(r.targetId,n.limboChanges),[2,n]}})})},sI.prototype.unlisten=function(i){return aa(this,void 0,void 0,function(){var e,n,r=this;return sa(this,function(t){switch(t.label){case 0:return this.assertSubscribed("unlisten()"),Am(!!(e=this.queryViewsByQuery.get(i)),"Trying to unlisten on query not found:"+i),1<(n=this.queriesByTarget[e.targetId]).length?(this.queriesByTarget[e.targetId]=n.filter(function(t){return!t.isEqual(i)}),this.queryViewsByQuery.delete(i),[2]):this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseTarget(e.targetId,!1).then(function(){r.sharedClientState.clearQueryState(e.targetId),r.remoteStore.unlisten(e.targetId),r.removeAndCleanupTarget(e.targetId)}).catch(tT)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupTarget(e.targetId),[4,this.localStore.releaseTarget(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},sI.prototype.write=function(n,r){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(n)];case 1:return e=t.sent(),this.sharedClientState.addPendingMutation(e.batchId),this.addMutationCallback(e.batchId,r),[4,this.emitNewSnapsAndNotifyLocalStore(e.changes)];case 2:return t.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return t.sent(),[2]}})})},sI.prototype.runTransaction=function(t,e,n){new eI(t,this.remoteStore,e,n).run()},sI.prototype.applyRemoteEvent=function(n){return aa(this,void 0,void 0,function(){var e,r=this;return sa(this,function(t){switch(t.label){case 0:this.assertSubscribed("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(n)];case 2:return e=t.sent(),qm(n.targetChanges,function(t,e){var n=r.limboResolutionsByTarget[Number(t)];n&&(Am(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?n.receivedDocument=!0:0<e.modifiedDocuments.size?Am(n.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(Am(n.receivedDocument,"Received remove for limbo target document without add."),n.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,tT(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},sI.prototype.applyOnlineStateChange=function(r,t){if(this.isPrimary&&t===rE.RemoteStore||!this.isPrimary&&t===rE.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var i=[];this.queryViewsByQuery.forEach(function(t,e){var n=e.view.applyOnlineStateChange(r);Am(0===n.limboChanges.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.syncEngineListener.onOnlineStateChange(r),this.syncEngineListener.onWatchChange(i),this.onlineState=r,this.isPrimary&&this.sharedClientState.setOnlineState(r)}},sI.prototype.rejectListen=function(s,u){return aa(this,void 0,void 0,function(){var e,n,r,i,o,a=this;return sa(this,function(t){switch(t.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(s,"rejected",u),e=this.limboResolutionsByTarget[s],(n=e&&e.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(n),delete this.limboResolutionsByTarget[s],r=(r=new tv(Pg.comparator)).insert(n,new Aw(n,$g.forDeletedDoc())),i=wv().add(n),o=new EE($g.MIN,{},new uv(cg),r,i),[2,this.applyRemoteEvent(o)]):[3,1];case 1:return[4,this.localStore.releaseTarget(s,!1).then(function(){return a.removeAndCleanupTarget(s,u)}).catch(tT)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},sI.prototype.applyBatchState=function(n,r,i){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(n)];case 1:return null===(e=t.sent())?(Sm(rI,"Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.processUserCallback(n,i||null),this.localStore.removeCachedMutationBatchMetadata(n)):Nm("Unknown batchState: "+r),t.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 5:return t.sent(),[2]}})})},sI.prototype.applySuccessfulWrite=function(r){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=r.batch.batchId,this.processUserCallback(e,null),this.triggerPendingWritesCallbacks(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(r)];case 2:return n=t.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return t.sent(),[3,6];case 4:return[4,tT(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},sI.prototype.rejectFailedWrite=function(n,r){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(n,r),this.triggerPendingWritesCallbacks(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(n)];case 2:return e=t.sent(),this.sharedClientState.updateMutationState(n,"rejected",r),[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 3:return t.sent(),[3,6];case 4:return[4,tT(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},sI.prototype.registerPendingWritesCallback=function(r){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:return this.remoteStore.canUseNetwork()||Sm(rI,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:return-1===(e=t.sent())?r.resolve():((n=this.pendingWritesCallbacks.get(e)||[]).push(r),this.pendingWritesCallbacks.set(e,n)),[2]}})})},sI.prototype.triggerPendingWritesCallbacks=function(t){(this.pendingWritesCallbacks.get(t)||[]).forEach(function(t){t.resolve()}),this.pendingWritesCallbacks.delete(t)},sI.prototype.rejectOutstandingPendingWritesCallbacks=function(e){this.pendingWritesCallbacks.forEach(function(t){t.forEach(function(t){t.reject(new Mm(Pm.CANCELLED,e))})}),this.pendingWritesCallbacks.clear()},sI.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n=(n=n||new tv(cg)).insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},sI.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Am(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},sI.prototype.removeAndCleanupTarget=function(t,e){var n=this;void 0===e&&(e=null),this.sharedClientState.removeLocalQueryTarget(t),Am(this.queriesByTarget[t]&&0!==this.queriesByTarget[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.queriesByTarget[t];r<i.length;r++){var o=i[r];this.queryViewsByQuery.delete(o),e&&this.syncEngineListener.onWatchError(o,e)}if(delete this.queriesByTarget[t],this.isPrimary){var a=this.limboDocumentRefs.referencesForId(t);this.limboDocumentRefs.removeReferencesForId(t),a.forEach(function(t){n.limboDocumentRefs.containsKey(t)||n.removeLimboTarget(t)})}},sI.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},sI.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof JS?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof $S?(Sm(rI,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):Nm("Unknown limbo change: "+JSON.stringify(i))}},sI.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){Sm(rI,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=GE.atPath(e.path);this.limboResolutionsByTarget[n]=new oI(e),this.remoteStore.listen(new D_(r.toTarget(),n,S_.LimboResolution,_g.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},sI.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},sI.prototype.emitNewSnapsAndNotifyLocalStore=function(r,u){return aa(this,void 0,void 0,function(){var o,a,e,s=this;return sa(this,function(t){switch(t.label){case 0:return o=[],a=[],e=[],this.queryViewsByQuery.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.computeDocChanges(r);return n.needsRefill?s.localStore.executeQuery(i.query,!1).then(function(t){var e=t.documents;return i.view.computeDocChanges(e,n)}):n}).then(function(t){var e=u&&u.targetChanges[i.targetId],n=i.view.applyChanges(t,!0===s.isPrimary,e);if(s.updateTrackedLimbos(i.targetId,n.limboChanges),n.snapshot){s.isPrimary&&s.sharedClientState.updateQueryState(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=YS.fromSnapshot(i.targetId,n.snapshot);a.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.syncEngineListener.onWatchChange(o),[4,this.localStore.notifyLocalViewChanges(a)];case 2:return t.sent(),[2]}})})},sI.prototype.assertSubscribed=function(t){Am(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},sI.prototype.handleCredentialChange=function(r){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.localStore.handleUserChange(r)]):[3,3];case 1:return n=t.sent(),this.sharedClientState.handleUserChange(r,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:t.sent(),t.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return t.sent(),[2]}})})},sI.prototype.applyPrimaryState=function(c){return aa(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u=this;return sa(this,function(t){switch(t.label){case 0:return!0!==c||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return t.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==c||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),Vm(this.queriesByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return u.removeAndCleanupTarget(t),u.localStore.releaseTarget(t,!0)}),u.remoteStore.unlisten(t)}),[4,s]);case 4:return t.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return t.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},sI.prototype.resetLimboDocuments=function(){var e=this;Vm(this.limboResolutionsByTarget,function(t){e.remoteStore.unlisten(t)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new tv(Pg.comparator)},sI.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(d){return aa(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f,p;return sa(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],a=void 0,(s=this.queriesByTarget[o])&&0!==s.length?[4,this.localStore.releaseTarget(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.localStore.allocateTarget(s[0].toTarget())];case 3:a=t.sent(),u=0,c=s,t.label=4;case 4:return u<c.length?(h=c[u],Am(!!(l=this.queryViewsByQuery.get(h)),"No query view found for "+h),[4,this.synchronizeViewAndComputeSnapshot(l)]):[3,7];case 5:(f=t.sent()).snapshot&&n.push(f.snapshot),t.label=6;case 6:return u++,[3,4];case 7:return[3,12];case 8:return Am(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.localStore.getTarget(o)];case 9:return Am(!!(p=t.sent()),"Target for id "+o+" not found"),[4,this.localStore.allocateTarget(p)];case 10:return a=t.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(a),t.label=13;case 13:return r++,[3,1];case 14:return this.syncEngineListener.onWatchChange(n),[2,e]}})})},sI.prototype.synthesizeTargetToQuery=function(t){return new GE(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,WE.First,t.startAt,t.endAt)},sI.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},sI.prototype.applyTargetState=function(r,i,o){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:if(this.isPrimary)return Sm(rI,"Ignoring unexpected query state notification."),[2];if(!this.queriesByTarget[r])return[3,7];switch(i){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.localStore.getNewDocumentChanges()];case 2:return e=t.sent(),n=EE.createSynthesizedRemoteEventForCurrentChange(r,"current"===i),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,7];case 4:return[4,this.localStore.releaseTarget(r,!0)];case 5:return t.sent(),this.removeAndCleanupTarget(r,o),[3,7];case 6:Nm("Unexpected target state: "+i),t.label=7;case 7:return[2]}})})},sI.prototype.applyActiveTargetsChange=function(l,f){return aa(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h=this;return sa(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=l,t.label=1;case 1:return e<n.length?(c=n[e],Am(!this.queriesByTarget[c],"Trying to add an already active target"),[4,this.localStore.getTarget(c)]):[3,6];case 2:return Am(!!(r=t.sent()),"Query data for active target "+c+" not found"),[4,this.localStore.allocateTarget(r)];case 3:return i=t.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(r),i.targetId,!1)];case 4:t.sent(),this.remoteStore.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){return sa(this,function(t){switch(t.label){case 0:return a.queriesByTarget[e]?[4,a.localStore.releaseTarget(e,!1).then(function(){h.remoteStore.unlisten(e),h.removeAndCleanupTarget(e)}).catch(tT)]:[2,"continue"];case 1:return t.sent(),[2]}})},a=this,s=0,u=f,t.label=7;case 7:return s<u.length?(c=u[s],[5,o(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return s++,[3,7];case 10:return[2]}})})},sI.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},sI.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},sI.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];if(e&&e.receivedDocument)return wv().add(e.key);var n=wv(),r=this.queriesByTarget[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var a=o[i],s=this.queryViewsByQuery.get(a);Am(!!s,"No query view found for "+a),n=n.unionWith(s.view.syncedDocuments)}return n},sI);function sI(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new Pw(function(t){return t.canonicalId()}),this.queriesByTarget={},this.limboTargetsByKey=new tv(Pg.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new uT,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=Jv.forSyncEngine(),this.isPrimary=void 0,this.onlineState=eE.Unknown}var uI=(cI.prototype.isAuthenticated=function(){return null!=this.uid},cI.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},cI.prototype.isEqual=function(t){return t.uid===this.uid},cI.UNAUTHENTICATED=new cI(null),cI.GOOGLE_CREDENTIALS=new cI("google-credentials-uid"),cI.FIRST_PARTY=new cI("first-party-uid"),cI);function cI(t){this.uid=t}var hI="SharedClientState",lI="firestore_clients",fI="firestore_mutations",pI="firestore_targets",dI=(yI.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Mm(r.error.code,r.error.message)),i?new yI(t,e,r.state,o):(Im(hI,"Failed to parse mutation state for ID '"+e+"': "+n),null)},yI.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},yI);function yI(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Am(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var mI=(gI.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Mm(n.error.code,n.error.message)),r?new gI(t,n.state,i):(Im(hI,"Failed to parse target state for ID '"+t+"': "+e),null)},gI.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},gI);function gI(t,e,n){this.targetId=t,this.state=e,Am(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}var vI=(bI.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Tv(),o=0;r&&o<n.activeTargetIds.length;++o)r=VT(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new bI(t,i):(Im(hI,"Failed to parse client data for instance '"+t+"': "+e),null)},bI);function bI(t,e){this.clientId=t,this.activeTargetIds=e}var wI=(_I.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in eE&&"string"==typeof e.clientId?new _I(e.clientId,eE[e.onlineState]):(Im(hI,"Failed to parse online state: "+t),null)},_I);function _I(t,e){this.clientId=t,this.onlineState=e}var TI=(EI.prototype.addQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},EI.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},EI.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},EI);function EI(){this.activeTargetIds=Tv()}var SI=(II.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},II.prototype.start=function(){return aa(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f=this;return sa(this,function(t){switch(t.label){case 0:return Am(!this.started,"WebStorageSharedClientState already started"),Am(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Am(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.localClientId&&(o=this.getItem(this.toWebStorageClientStateKey(i)))&&(a=vI.fromWebStorageEntry(i,o))&&(this.activeClients[a.clientId]=a);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)l=h[c],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return f.shutdown()}),this.started=!0,[2]}})})},II.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},II.prototype.getAllActiveQueryTargets=function(){var n=Tv();return qm(this.activeClients,function(t,e){n=n.unionWith(e.activeTargetIds)}),n},II.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},II.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},II.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},II.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=mI.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},II.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},II.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},II.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},II.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},II.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},II.prototype.setOnlineState=function(t){this.persistOnlineState(t)},II.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},II.prototype.getItem=function(t){var e=this.storage.getItem(t);return Sm(hI,"READ",t,e),e},II.prototype.setItem=function(t,e){Sm(hI,"SET",t,e),this.storage.setItem(t,e)},II.prototype.removeItem=function(t){Sm(hI,"REMOVE",t),this.storage.removeItem(t)},II.prototype.handleWebStorageEvent=function(s){var t=this;if(s.storageArea===this.storage){if(Sm(hI,"EVENT",s.key,s.newValue),s.key===this.localClientStorageKey)return void Im("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return aa(t,void 0,void 0,function(){var e,n,r,i,o,a;return sa(this,function(t){if(!this.started)return this.earlyEvents.push(s),[2];if(null===s.key)return[2];if(this.clientStateKeyRe.test(s.key)){if(null==s.newValue)return n=this.fromWebStorageClientStateKey(s.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(s.key,s.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(s.key)){if(null!==s.newValue&&(r=this.fromWebStorageMutationMetadata(s.key,s.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(s.key)){if(null!==s.newValue&&(i=this.fromWebStorageQueryTargetMetadata(s.key,s.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(s.key===this.onlineStateKey){if(null!==s.newValue&&(o=this.fromWebStorageOnlineState(s.newValue)))return[2,this.handleOnlineStateEvent(o)]}else s.key===this.sequenceNumberKey&&(Am(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=_g.INVALID;if(null!=t)try{var n=JSON.parse(t);Am("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Im(hI,"Failed to read sequence number from WebStorage",t)}return e}(s.newValue))!==_g.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(II.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),II.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},II.prototype.persistMutationState=function(t,e,n){var r=new dI(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},II.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},II.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:eE[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},II.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new mI(t,e,n);this.setItem(r,i.toWebStorageJSON())},II.prototype.toWebStorageClientStateKey=function(t){return Am(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),lI+"_"+this.persistenceKey+"_"+t},II.prototype.toWebStorageQueryTargetMetadataKey=function(t){return pI+"_"+this.persistenceKey+"_"+t},II.prototype.toWebStorageMutationBatchKey=function(t){var e=fI+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},II.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},II.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Am(null!==n,"Cannot parse client state key '"+t+"'"),vI.fromWebStorageEntry(n,e)},II.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Am(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return dI.fromWebStorageEntry(new uI(i),r,e)},II.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Am(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return mI.fromWebStorageEntry(r,e)},II.prototype.fromWebStorageOnlineState=function(t){return wI.fromWebStorageEntry(t)},II.prototype.handleMutationBatchEvent=function(e){return aa(this,void 0,void 0,function(){return sa(this,function(t){return e.user.uid!==this.currentUser.uid?(Sm(hI,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.syncEngine.applyBatchState(e.batchId,e.state,e.error)]})})},II.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},II.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(e){return aa(n,void 0,void 0,function(){return sa(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return aa(n,void 0,void 0,function(){return sa(this,function(t){return i.has(e)||a.push(e),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},II.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},II);function II(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!II.isAvailable(this.platform))throw new Mm(Pm.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey="firestore_sequence_number_"+n,this.activeClients[this.localClientId]=new TI,this.clientStateKeyRe=new RegExp("^"+lI+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+fI+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+pI+"_"+o+"_(\\d+)$"),this.onlineStateKey="firestore_online_state_"+n,this.platform.window.addEventListener("storage",this.storageListener)}var CI=(NI.prototype.addPendingMutation=function(t){},NI.prototype.updateMutationState=function(t,e,n){},NI.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},NI.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},NI.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},NI.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},NI.prototype.clearQueryState=function(t){delete this.queryState[t]},NI.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},NI.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},NI.prototype.start=function(){return this.localState=new TI,Promise.resolve()},NI.prototype.handleUserChange=function(t,e,n){},NI.prototype.setOnlineState=function(t){},NI.prototype.shutdown=function(){},NI.prototype.writeSequenceNumber=function(t){},NI);function NI(){this.localState=new TI,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}var AI="FirestoreClient",kI=(DI.prototype.lruParams=function(){return U_.withCacheSize(this.cacheSizeBytes)},DI);function DI(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}var RI=function(){},OI=(PI.prototype.start=function(t){var n=this;this.verifyNotTerminated();var r=new Fg,i=new Fg,o=!1;return this.credentials.setChangeListener(function(e){o?n.asyncQueue.enqueueAndForget(function(){return n.handleCredentialChange(e)}):(o=!0,n.initializePersistence(t,i,e).then(function(t){return n.initializeRest(e,t)}).then(r.resolve,r.reject))}),this.asyncQueue.enqueueAndForget(function(){return r.promise}),i.promise},PI.prototype.enableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},PI.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof kI?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},PI.prototype.canFallback=function(t){return t instanceof Mm?t.code===Pm.FAILED_PRECONDITION||t.code===Pm.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},PI.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Mm(Pm.FAILED_PRECONDITION,"The client has already been terminated.")},PI.prototype.startIndexedDbPersistence=function(r,i){var t=this,o=$_.buildStoragePrefix(this.databaseInfo),a=new jS(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return aa(t,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!SI.isAvailable(this.platform))throw new Mm(Pm.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return e=i.lruParams(),this.sharedClientState=i.synchronizeTabs?new SI(this.asyncQueue,this.platform,o,this.clientId,r):new CI,[4,$_.createIndexedDbPersistence({allowTabSynchronization:i.synchronizeTabs,persistenceKey:o,clientId:this.clientId,platform:this.platform,queue:this.asyncQueue,serializer:a,lruParams:e,sequenceNumberSyncer:this.sharedClientState})];case 1:return n=t.sent(),[2,(this.persistence=n).referenceDelegate.garbageCollector]}})})})},PI.prototype.startMemoryPersistence=function(){return this.persistence=ET.createEagerPersistence(this.clientId),this.sharedClientState=new CI,Promise.resolve(null)},PI.prototype.initializeRest=function(c,h){var t=this;return Sm(AI,"Initializing. user=",c.uid),this.platform.loadConnection(this.databaseInfo).then(function(u){return aa(t,void 0,void 0,function(){var e,n,r,i,o,a,s=this;return sa(this,function(t){switch(t.label){case 0:return e=new OT,this.localStore=new pT(this.persistence,e,c),[4,this.localStore.start()];case 1:return t.sent(),h&&(this.lruScheduler=new q_(h,this.asyncQueue,this.localStore)),n=this.platform.newConnectivityMonitor(),r=this.platform.newSerializer(this.databaseInfo.databaseId),i=new ZT(this.asyncQueue,u,this.credentials,r),o=function(t){return s.syncEngine.applyOnlineStateChange(t,rE.RemoteStore)},a=function(t){return s.syncEngine.applyOnlineStateChange(t,rE.SharedClientState)},this.remoteStore=new VE(this.localStore,i,this.asyncQueue,o,n),this.syncEngine=new aI(this.localStore,this.remoteStore,this.sharedClientState,c),this.sharedClientState.onlineStateHandler=a,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new QS(this.syncEngine),[4,this.sharedClientState.start()];case 2:return t.sent(),[4,this.remoteStore.start()];case 3:return t.sent(),[4,this.persistence.setPrimaryStateListener(function(e){return aa(s,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.applyPrimaryState(e)];case 1:return t.sent(),this.lruScheduler&&(e&&!this.lruScheduler.started?this.lruScheduler.start():e||this.lruScheduler.stop()),[2]}})})})];case 4:return t.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return aa(s,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})})];case 5:return t.sent(),[2]}})})})},PI.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),Sm(AI,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},PI.prototype.disableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},PI.prototype.terminate=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown(function(){return aa(t,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}})})})},PI.prototype.waitForPendingWrites=function(){var t=this;this.verifyNotTerminated();var e=new Fg;return this.asyncQueue.enqueueAndForget(function(){return t.syncEngine.registerPendingWritesCallback(e)}),e.promise},PI.prototype.listen=function(t,e,n){var r=this;this.verifyNotTerminated();var i=new GS(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},PI.prototype.unlisten=function(t){var e=this;this.clientTerminated||this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},PI.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof Iw)return t;if(t instanceof Aw)return null;throw new Mm(Pm.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},PI.prototype.getDocumentsFromLocalCache=function(i){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return aa(t,void 0,void 0,function(){var e,n,r;return sa(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(i,!0)];case 1:return e=t.sent(),n=new ZS(i,e.remoteKeys),r=n.computeDocChanges(e.documents),[2,n.applyChanges(r,!1).snapshot]}})})})},PI.prototype.write=function(t){var e=this;this.verifyNotTerminated();var n=new Fg;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},PI.prototype.databaseId=function(){return this.databaseInfo.databaseId},PI.prototype.addSnapshotsInSyncListener=function(t){var e=this;this.verifyNotTerminated(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.addSnapshotsInSyncListener(t),Promise.resolve()})},PI.prototype.removeSnapshotsInSyncListener=function(t){this.clientTerminated||this.eventMgr.removeSnapshotsInSyncListener(t)},Object.defineProperty(PI.prototype,"clientTerminated",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),PI.prototype.transaction=function(t){var e=this;this.verifyNotTerminated();var n=new Fg;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.runTransaction(e.asyncQueue,t,n),Promise.resolve()}),n.promise},PI);function PI(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=sg.newId()}var MI=(LI.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},LI.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},LI.prototype.mute=function(){this.muted=!0},LI.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},LI);function LI(t){this.observer=t,this.muted=!1}var xI=(FI.documentId=function(){return FI._DOCUMENT_ID},FI.prototype.isEqual=function(t){if(!(t instanceof FI))throw rg("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},FI._DOCUMENT_ID=new FI(Rg.keyField().canonicalString()),FI);function FI(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new Mm(Pm.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+ag(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(Hm("FieldPath","string",n,t[n]),0===t[n].length)throw new Mm(Pm.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Rg(t)}var UI=new RegExp("[~\\*/\\[\\]]");var VI=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}},qI=(BI.prototype.getToken=function(){return Promise.resolve(null)},BI.prototype.invalidateToken=function(){},BI.prototype.setChangeListener=function(t){Am(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(uI.UNAUTHENTICATED)},BI.prototype.removeChangeListener=function(){Am(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},BI);function BI(){this.changeListener=null}var jI=(WI.prototype.getToken=function(){var e=this;Am(null!=this.tokenListener,"getToken cannot be called after listener removed.");var n=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(t).then(function(t){if(e.tokenCounter!==n)throw new Mm(Pm.ABORTED,"getToken aborted due to token change.");return t?(Am("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new VI(t.accessToken,e.currentUser)):null})},WI.prototype.invalidateToken=function(){this.forceRefresh=!0},WI.prototype.setChangeListener=function(t){Am(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},WI.prototype.removeChangeListener=function(){Am(null!=this.tokenListener,"removeChangeListener() called twice"),Am(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},WI.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return Am(null===t||"string"==typeof t,"Received invalid UID: "+t),new uI(t)},WI);function WI(t){var e=this;this.app=t,this.tokenListener=null,this.currentUser=uI.UNAUTHENTICATED,this.receivedInitialUser=!1,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}var KI=(Object.defineProperty(QI.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),QI);function QI(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=uI.FIRST_PARTY}var HI=(GI.prototype.getToken=function(){return Promise.resolve(new KI(this.gapi,this.sessionIndex))},GI.prototype.setChangeListener=function(t){t(uI.FIRST_PARTY)},GI.prototype.removeChangeListener=function(){},GI.prototype.invalidateToken=function(){},GI);function GI(t,e){this.gapi=t,this.sessionIndex=e}function zI(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t,["next","error","complete"])}var YI=(XI.delete=function(){return jm("FieldValue.delete",arguments),$I.instance},XI.serverTimestamp=function(){return jm("FieldValue.serverTimestamp",arguments),eC.instance},XI.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Km("FieldValue.arrayUnion",arguments,1),new iC(t)},XI.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Km("FieldValue.arrayRemove",arguments,1),new sC(t)},XI.increment=function(t){return Hm("FieldValue.increment","number",1,t),Wm("FieldValue.increment",arguments,1),new hC(t)},XI.prototype.isEqual=function(t){return this===t},XI);function XI(t){this._methodName=t}var JI,$I=(ia(ZI,JI=YI),ZI.instance=new ZI,ZI);function ZI(){return JI.call(this,"FieldValue.delete")||this}var tC,eC=(ia(nC,tC=YI),nC.instance=new nC,nC);function nC(){return tC.call(this,"FieldValue.serverTimestamp")||this}var rC,iC=(ia(oC,rC=YI),oC);function oC(t){var e=rC.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}var aC,sC=(ia(uC,aC=YI),uC);function uC(t){var e=aC.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}var cC,hC=(ia(lC,cC=YI),lC);function lC(t){var e=cC.call(this,"FieldValue.increment")||this;return e._operand=t,e}var fC=xm(YI,"Use FieldValue.<field>() instead."),pC=/^__.*__$/,dC=(yC.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new wb(t,this.data,this.fieldMask,e)):n.push(new gb(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Eb(t,this.fieldTransforms)),n},yC);function yC(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}var mC,gC,vC=(bC.prototype.toMutations=function(t,e){var n=[new wb(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new Eb(t,this.fieldTransforms)),n},bC);function bC(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function wC(t){switch(t){case mC.Set:case mC.MergeSet:case mC.Update:return!0;case mC.Argument:return!1;default:throw Nm("Unexpected case for UserDataSource: "+t)}}(gC=mC=mC||{})[gC.Set=0]="Set",gC[gC.Update=1]="Update",gC[gC.MergeSet=2]="MergeSet",gC[gC.Argument=3]="Argument";var _C=(TC.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new TC(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},TC.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new TC(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},TC.prototype.childContextForArray=function(t){return new TC(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},TC.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new Mm(Pm.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},TC.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},TC.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},TC.prototype.validatePathSegment=function(t){if(0===t.length)throw this.createError("Document fields must not be empty");if(wC(this.dataSource)&&pC.test(t))throw this.createError('Document fields cannot begin and end with "__"')},TC);function TC(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}var EC=function(t,e){this.databaseId=t,this.key=e},SC=(IC.prototype.parseSetData=function(t,e){var n=new _C(mC.Set,t,Rg.EMPTY_PATH);NC("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new dC(r,null,n.fieldTransforms)},IC.prototype.parseMergeData=function(t,e,n){var r=new _C(mC.MergeSet,t,Rg.EMPTY_PATH);NC("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new uv(Rg.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof xI)l=h._internalPath;else{if("string"!=typeof h)throw Nm("Expected stringOrFieldPath to be a string or a FieldPath");l=kC(t,h)}if(!r.contains(l))throw new Mm(Pm.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=ob.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=ob.fromArray(r.fieldMask),o=r.fieldTransforms;return new dC(a,i,o)},IC.prototype.parseUpdateData=function(o,t){var a=this,s=new _C(mC.Update,o,Rg.EMPTY_PATH);NC("Data must be an object, but it was:",s,t);var u=new uv(Rg.comparator),c=gw.EMPTY;qm(t,function(t,e){var n=kC(o,t),r=s.childContextForFieldPath(n);if((e=a.runPreConverter(e,r))instanceof $I)u=u.add(n);else{var i=a.parseData(e,r);null!=i&&(u=u.add(n),c=c.set(n,i))}});var e=ob.fromSet(u);return new vC(c,e,s.fieldTransforms)},IC.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new _C(mC.Update,t,Rg.EMPTY_PATH),o=[AC(t,e)],a=[n];if(r.length%2!=0)throw new Mm(Pm.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(AC(t,r[s])),a.push(r[s+1]);var u=new uv(Rg.comparator),c=gw.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof $I)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=ob.fromSet(u);return new vC(c,d,i.fieldTransforms)},IC.prototype.parseQueryValue=function(t,e){var n=new _C(mC.Argument,t,Rg.EMPTY_PATH),r=this.parseData(e,n);return Am(null!=r,"Parsed data should not be null."),Am(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},IC.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=DC(t);throw e.createError(n)}},IC.prototype.parseData=function(t,e){if(CC(t=this.runPreConverter(t,e)))return NC("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof YI)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},IC.prototype.parseObject=function(t,r){var i=this,o=new tv(cg);return Bm(t)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):qm(t,function(t,e){var n=i.parseData(e,r.childContextForField(t));null!=n&&(o=o.insert(t,n))}),new gw(o)},IC.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=Fb.INSTANCE),n.push(s),r++}return new ww(n)},IC.prototype.parseSentinelFieldValue=function(t,e){if(!wC(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof $I){if(e.dataSource!==mC.MergeSet)throw e.dataSource===mC.Update?(Am(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof eC)e.fieldTransforms.push(new sb(e.path,SS.instance));else if(t instanceof iC){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new CS(n);e.fieldTransforms.push(new sb(e.path,r))}else if(t instanceof sC){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new AS(n);e.fieldTransforms.push(new sb(e.path,i))}else if(t instanceof hC){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new DS(o);e.fieldTransforms.push(new sb(e.path,a))}else Nm("Unknown FieldValue type: "+t)},IC.prototype.parseScalarValue=function(t,e){if(null===t)return Fb.INSTANCE;if("number"==typeof t)return VT(t)?new Gb(t):new Xb(t);if("boolean"==typeof t)return qb.of(t);if("string"==typeof t)return new Zb(t);if(t instanceof Date)return new nw(Xg.fromDate(t));if(t instanceof Xg)return new nw(new Xg(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof BE)return new dw(t);if(t instanceof dg)return new uw(t);if(t instanceof EC)return new lw(t.databaseId,t.key);throw e.createError("Unsupported field value: "+tg(t))},IC.prototype.parseArrayTransformElements=function(r,t){var i=this;return t.map(function(t,e){var n=new _C(mC.Argument,r,Rg.EMPTY_PATH);return i.parseData(t,n.childContextForArray(e))})},IC);function IC(t){this.preConverter=t}function CC(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Xg||t instanceof BE||t instanceof dg||t instanceof EC||t instanceof YI)}function NC(t,e,n){if(!CC(n)||!Zm(n)){var r=tg(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function AC(t,e){if(e instanceof xI)return e._internalPath;if("string"==typeof e)return kC(t,e);throw new Mm(Pm.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function kC(e,t){try{return function(e){if(0<=e.search(UI))throw new Mm(Pm.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(xI.bind.apply(xI,la([void 0],e.split("."))))}catch(t){throw new Mm(Pm.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t)._internalPath}catch(t){var n=DC(t);throw new Mm(Pm.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function DC(t){return t instanceof Error?t.message:t.toString()}var RC=U_.COLLECTION_DISABLED,OC=(PC.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},PC);function PC(t){if(void 0===t.host){if(void 0!==t.ssl)throw new Mm(Pm.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else zm("settings","non-empty string","host",t.host),this.host=t.host,Ym("settings","boolean","ssl",t.ssl),this.ssl=Um(t.ssl,!0);if(ng("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Ym("settings","object","credentials",t.credentials),this.credentials=t.credentials,Ym("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Im("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Im("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=Um(t.timestampsInSnapshots,!0),Ym("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=U_.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==RC&&t.cacheSizeBytes<U_.MINIMUM_CACHE_SIZE_BYTES)throw new Mm(Pm.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+U_.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}Ym("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}var MC=(LC.prototype.settings=function(t){if(Wm("Firestore.settings",arguments,1),Hm("Firestore.settings","object",1,t),Fm(t,"persistence"))throw new Mm(Pm.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new OC(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new Mm(Pm.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._settings=e).credentials&&(this._credentials=function(t){if(!t)return new qI;switch(t.type){case"gapi":var e=t.client;return Am(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new HI(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Mm(Pm.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},LC.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},LC.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},LC.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new Mm(Pm.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Im("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=Um(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new kI(this._settings.cacheSizeBytes,e))},LC.prototype.clearPersistence=function(){var t=this,n=$_.buildStoragePrefix(this.makeDatabaseInfo()),r=new Fg;return this._queue.enqueueAndForgetEvenAfterShutdown(function(){return aa(t,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientTerminated)throw new Mm(Pm.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,$_.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},LC.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(LC.prototype,"_isTerminated",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientTerminated},enumerable:!0,configurable:!0}),LC.prototype.waitForPendingWrites=function(){return this.ensureClientConfigured(),this._firestoreClient.waitForPendingWrites()},LC.prototype.onSnapshotsInSync=function(t){if(this.ensureClientConfigured(),zI(t))return this.onSnapshotsInSyncInternal(t);Hm("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.onSnapshotsInSyncInternal(e)},LC.prototype.onSnapshotsInSyncInternal=function(t){var e=this,n=new MI({next:function(){t.next&&t.next()},error:function(t){throw Nm("Uncaught Error in onSnapshotsInSync")}});return this._firestoreClient.addSnapshotsInSyncListener(n),function(){n.mute(),e._firestoreClient.removeSnapshotsInSyncListener(n)}},LC.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new RI),this._firestoreClient},LC.prototype.makeDatabaseInfo=function(){return new gg(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},LC.prototype.configureClient=function(t){Am(!!this._settings.host,"FirestoreSettings.host is not set"),Am(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new OI(km.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},LC.prototype.createDataConverter=function(r){return new SC(function(t){if(t instanceof qC){var e=r,n=t.firestore._databaseId;if(!n.isEqual(e))throw new Mm(Pm.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new EC(r,t._key)}return t})},LC.databaseIdFromApp=function(t){var e=t.options;if(!Fm(e,"projectId"))throw new Mm(Pm.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new Mm(Pm.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new bg(n)},Object.defineProperty(LC.prototype,"app",{get:function(){if(!this._firebaseApp)throw new Mm(Pm.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),LC.prototype.collection=function(t){return Wm("Firestore.collection",arguments,1),Hm("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new tN(Ng.fromString(t),this)},LC.prototype.doc=function(t){return Wm("Firestore.doc",arguments,1),Hm("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),qC.forPath(Ng.fromString(t),this)},LC.prototype.collectionGroup=function(t){if(Wm("Firestore.collectionGroup",arguments,1),Hm("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Mm(Pm.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new YC(new GE(Ng.EMPTY_PATH,t),this)},LC.prototype.runTransaction=function(e){var n=this;return Wm("Firestore.runTransaction",arguments,1),Hm("Firestore.runTransaction","function",1,e),this.ensureClientConfigured().transaction(function(t){return e(new xC(n,t))})},LC.prototype.batch=function(){return this.ensureClientConfigured(),new UC(this)},Object.defineProperty(LC,"logLevel",{get:function(){switch(Tm()){case fm.DEBUG:return"debug";case fm.ERROR:return"error";case fm.SILENT:return"silent";default:return Nm("Unknown log level: "+Tm())}},enumerable:!0,configurable:!0}),LC.setLogLevel=function(t){switch(Wm("Firestore.setLogLevel",arguments,1),Hm("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Em(fm.DEBUG);break;case"error":Em(fm.ERROR);break;case"silent":Em(fm.SILENT);break;default:throw new Mm(Pm.INVALID_ARGUMENT,"Invalid log level: "+t)}},LC.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},LC);function LC(t){var e=this;if(this._firebaseApp=null,this._queue=new qg,this.INTERNAL={delete:function(){return aa(e,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var n=t;this._firebaseApp=n,this._databaseId=LC.databaseIdFromApp(n),this._persistenceKey=n.name,this._credentials=new jI(n)}else{var r=t;if(!r.projectId)throw new Mm(Pm.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new bg(r.projectId,r.database),this._persistenceKey="[DEFAULT]",this._credentials=new qI}this._settings=new OC({}),this._dataConverter=this.createDataConverter(this._databaseId)}var xC=(FC.prototype.get=function(t){var n=this;Wm("Transaction.get",arguments,1);var r=oN("Transaction.get",t,this._firestore);return this._transaction.lookup([r._key]).then(function(t){if(!t||1!==t.length)return Nm("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof Aw)return new KC(n._firestore,r._key,null,!1,!1);if(e instanceof Iw)return new KC(n._firestore,r._key,e,!1,!1);throw Nm("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},FC.prototype.set=function(t,e,n){Qm("Transaction.set",arguments,2,3);var r=oN("Transaction.set",t,this._firestore),i=(n=nN("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},FC.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof xI?(Km("Transaction.update",arguments,3),r=oN("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(Wm("Transaction.update",arguments,2),r=oN("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},FC.prototype.delete=function(t){Wm("Transaction.delete",arguments,1);var e=oN("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},FC);function FC(t,e){this._firestore=t,this._transaction=e}var UC=(VC.prototype.set=function(t,e,n){Qm("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=oN("WriteBatch.set",t,this._firestore),i=(n=nN("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,fb.NONE)),this},VC.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof xI?(Km("WriteBatch.update",arguments,3),r=oN("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(Wm("WriteBatch.update",arguments,2),r=oN("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,fb.exists(!0))),this},VC.prototype.delete=function(t){Wm("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=oN("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new Db(e._key,fb.NONE)),this},VC.prototype.commit=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},VC.prototype.verifyNotCommitted=function(){if(this._committed)throw new Mm(Pm.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},VC);function VC(t){this._firestore=t,this._mutations=[],this._committed=!1}var qC=(BC.forPath=function(t,e){if(t.length%2!=0)throw new Mm(Pm.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new BC(new Pg(t),e)},Object.defineProperty(BC.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(BC.prototype,"parent",{get:function(){return new tN(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(BC.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),BC.prototype.collection=function(t){if(Wm("DocumentReference.collection",arguments,1),Hm("DocumentReference.collection","non-empty string",1,t),!t)throw new Mm(Pm.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Ng.fromString(t);return new tN(this._key.path.child(e),this.firestore)},BC.prototype.isEqual=function(t){if(!(t instanceof BC))throw rg("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)},BC.prototype.set=function(t,e){Qm("DocumentReference.set",arguments,1,2);var n=(e=nN("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,fb.NONE))},BC.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof xI?(Km("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(Wm("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,fb.exists(!0)))},BC.prototype.delete=function(){return Wm("DocumentReference.delete",arguments,0),this._firestoreClient.write([new Db(this._key,fb.NONE)])},BC.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Qm("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||zI(t[i])||(ng("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Ym("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=zI(t[i])?t[i]:(Hm("DocumentReference.onSnapshot","function",i,t[i]),Gm("DocumentReference.onSnapshot","function",i+1,t[i+1]),Gm("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},BC.prototype.onSnapshotInternal=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new MI({next:function(t){if(n.next){Am(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r._key);n.next(new KC(r.firestore,r._key,e,t.fromCache,t.hasPendingWrites))}},error:e}),o=this._firestoreClient.listen(GE.atPath(this._key.path),i,t);return function(){i.mute(),r._firestoreClient.unlisten(o)}},BC.prototype.get=function(n){var r=this;return Qm("DocumentReference.get",arguments,0,1),iN("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentFromLocalCache(r._key).then(function(t){e(new KC(r.firestore,r._key,t,!0,t instanceof Iw&&t.hasLocalMutations))},t):r.getViaSnapshotListener(e,t,n)})},BC.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new Mm(Pm.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new Mm(Pm.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},BC);function BC(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}var jC=(WC.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},WC);function WC(t,e){this.hasPendingWrites=t,this.fromCache=e}var KC=(QC.prototype.data=function(t){return Qm("DocumentSnapshot.data",arguments,0,1),t=rN("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data(),Ob.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},QC.prototype.get=function(t,e){if(Qm("DocumentSnapshot.get",arguments,1,2),e=rN("DocumentSnapshot.get",e),this._document){var n=this._document.data().field(AC("DocumentSnapshot.get",t));if(null!==n)return this.convertValue(n,Ob.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(QC.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(QC.prototype,"ref",{get:function(){return new qC(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(QC.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(QC.prototype,"metadata",{get:function(){return new jC(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),QC.prototype.isEqual=function(t){if(!(t instanceof QC))throw rg("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))},QC.prototype.convertObject=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.convertValue(e,n)}),i},QC.prototype.convertValue=function(t,e){if(t instanceof gw)return this.convertObject(t,e);if(t instanceof ww)return this.convertArray(t,e);if(t instanceof lw){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Im("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new qC(n,this._firestore)}return t.value(e)},QC.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},QC);function QC(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}var HC,GC=(ia(zC,HC=KC),zC.prototype.data=function(t){var e=HC.prototype.data.call(this,t);return Am("object"==typeof e,"Document in a QueryDocumentSnapshot should exist"),e},zC);function zC(){return null!==HC&&HC.apply(this,arguments)||this}var YC=(XC.prototype.where=function(t,e,n){var r;Wm("Query.where",arguments,3),eg("Query.where",3,n),function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Mm(Pm.INVALID_ARGUMENT,"Invalid value "+tg(r)+" provided to function "+t+"() for its "+og(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e);var i=AC("Query.where",t),o=XE.fromString(e);if(i.isKeyField()){if(o===XE.ARRAY_CONTAINS||o===XE.ARRAY_CONTAINS_ANY)throw new Mm(Pm.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===XE.IN){this.validateDisjunctiveFilterElements(n,o);for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push(this.parseDocumentIdValue(c))}r=new ww(a)}else r=this.parseDocumentIdValue(n)}else o!==XE.IN&&o!==XE.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,o),r=this.firestore._dataConverter.parseQueryValue("Query.where",n);var h=ZE.create(i,o,r);return this.validateNewFilter(h),new XC(this._query.addFilter(h),this.firestore)},XC.prototype.orderBy=function(t,e){var n;if(Qm("Query.orderBy",arguments,1,2),Gm("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=mS.ASCENDING;else{if("desc"!==e)throw new Mm(Pm.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=mS.DESCENDING}if(null!==this._query.startAt)throw new Mm(Pm.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new Mm(Pm.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=AC("Query.orderBy",t),i=new wS(r,n);return this.validateNewOrderBy(i),new XC(this._query.addOrderBy(i),this.firestore)},XC.prototype.limit=function(t){return Wm("Query.limit",arguments,1),Hm("Query.limit","number",1,t),ig("Query.limit",1,t),new XC(this._query.withLimitToFirst(t),this.firestore)},XC.prototype.limitToLast=function(t){return Wm("Query.limitToLast",arguments,1),Hm("Query.limitToLast","number",1,t),ig("Query.limitToLast",1,t),new XC(this._query.withLimitToLast(t),this.firestore)},XC.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Km("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new XC(this._query.withStartAt(r),this.firestore)},XC.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Km("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new XC(this._query.withStartAt(r),this.firestore)},XC.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Km("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new XC(this._query.withEndAt(r),this.firestore)},XC.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Km("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new XC(this._query.withEndAt(r),this.firestore)},XC.prototype.isEqual=function(t){if(!(t instanceof XC))throw rg("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},XC.prototype.boundFromDocOrFields=function(t,e,n,r){if(eg(t,1,e),e instanceof KC){if(0<n.length)throw new Mm(Pm.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Mm(Pm.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},XC.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new lw(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof ow)throw new Mm(Pm.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new Mm(Pm.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new vS(r,n)},XC.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new Mm(Pm.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new Mm(Pm.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new Mm(Pm.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(Ng.fromString(a));if(!Pg.isDocumentKey(s))throw new Mm(Pm.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new Pg(s);i.push(new lw(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new vS(i,n)},XC.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Qm("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||zI(t[i])||(ng("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Ym("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=zI(t[i])?t[i]:(Hm("Query.onSnapshot","function",i,t[i]),Gm("Query.onSnapshot","function",i+1,t[i+1]),Gm("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.validateHasExplicitOrderByForLimitToLast(this._query),this.onSnapshotInternal(r,n)},XC.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new MI({next:function(t){e.next&&e.next(new JC(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},XC.prototype.validateHasExplicitOrderByForLimitToLast=function(t){if(t.hasLimitToLast()&&0===t.explicitOrderBy.length)throw new Mm(Pm.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},XC.prototype.get=function(n){var r=this;return Qm("Query.get",arguments,0,1),iN("Query.get",n),this.validateHasExplicitOrderByForLimitToLast(this._query),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentsFromLocalCache(r._query).then(function(t){e(new JC(r.firestore,r._query,t))},t):r.getViaSnapshotListener(e,t,n)})},XC.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new Mm(Pm.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},XC.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new Mm(Pm.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new Mm(Pm.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(Ng.fromString(t));if(!Pg.isDocumentKey(e))throw new Mm(Pm.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new lw(this.firestore._databaseId,new Pg(e))}if(t instanceof qC){var n=t;return new lw(this.firestore._databaseId,n._key)}throw new Mm(Pm.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+tg(t)+".")},XC.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Mm(Pm.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Mm(Pm.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Mm(Pm.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Mm(Pm.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},XC.prototype.validateNewFilter=function(t){if(t instanceof ZE){var e=[XE.ARRAY_CONTAINS,XE.ARRAY_CONTAINS_ANY],n=[XE.IN,XE.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new Mm(Pm.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new Mm(Pm.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Mm(Pm.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},XC.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},XC.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new Mm(Pm.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},XC);function XC(t,e){this._query=t,this.firestore=e}var JC=(Object.defineProperty($C.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty($C.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty($C.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),$C.prototype.forEach=function(e,n){var r=this;Qm("QuerySnapshot.forEach",arguments,1,2),Hm("QuerySnapshot.forEach","function",1,e),this._snapshot.docs.forEach(function(t){e.call(n,r.convertToDocumentImpl(t))})},Object.defineProperty($C.prototype,"query",{get:function(){return new YC(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),$C.prototype.docChanges=function(t){t&&(ng("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Ym("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new Mm(Pm.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,e,o){if(o.oldDocs.isEmpty()){var n,r=0;return o.docChanges.map(function(t){var e=new GC(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key));return Am(t.type===pE.Added,"Invalid event type for first snapshot"),Am(!n||o.query.docComparator(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var a=o.oldDocs;return o.docChanges.filter(function(t){return e||t.type!==pE.Metadata}).map(function(t){var e=new GC(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key)),n=-1,r=-1;return t.type!==pE.Added&&(Am(0<=(n=a.indexOf(t.doc.key)),"Index for document not found"),a=a.delete(t.doc.key)),t.type!==pE.Removed&&(r=(a=a.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case pE.Added:return"added";case pE.Modified:case pE.Metadata:return"modified";case pE.Removed:return"removed";default:return Nm("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},$C.prototype.isEqual=function(t){if(!(t instanceof $C))throw rg("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)},$C.prototype.convertToDocumentImpl=function(t){return new GC(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},$C);function $C(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new jC(n.hasPendingWrites,n.fromCache)}la(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(JC.prototype.docChanges,t,{get:function(){return function(){throw new Mm(Pm.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var ZC,tN=(ia(eN,ZC=YC),Object.defineProperty(eN.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(eN.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new qC(new Pg(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(eN.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),eN.prototype.doc=function(t){if(Qm("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=sg.newId()),Hm("CollectionReference.doc","non-empty string",1,t),""===t)throw new Mm(Pm.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Ng.fromString(t);return qC.forPath(this._query.path.child(e),this.firestore)},eN.prototype.add=function(t){Wm("CollectionReference.add",arguments,1),Hm("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},eN);function eN(t,e){var n=ZC.call(this,GE.atPath(t),e)||this;if(t.length%2!=1)throw new Mm(Pm.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return n}function nN(t,e){if(void 0===e)return{merge:!1};if(ng(t,e,["merge","mergeFields"]),Ym(t,"boolean","merge",e.merge),Xm(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof xI}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Mm(Pm.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function rN(t,e){return void 0===e?{}:(ng(t,e,["serverTimestamps"]),Jm(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function iN(t,e){Gm(t,"object",1,e),e&&(ng(t,e,["source"]),Jm(t,0,"source",e.source,["default","server","cache"]))}function oN(t,e,n){if(e instanceof qC){if(e.firestore!==n)throw new Mm(Pm.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw rg(t,"DocumentReference",1,e)}var aN=xm(MC,"Use firebase.firestore() instead."),sN=xm(xC,"Use firebase.firestore().runTransaction() instead."),uN=xm(UC,"Use firebase.firestore().batch() instead."),cN=xm(qC,"Use firebase.firestore().doc() instead."),hN=xm(KC),lN=xm(GC),fN=xm(YC),pN=xm(JC),dN=xm(tN,"Use firebase.firestore().collection() instead."),yN={Firestore:aN,GeoPoint:BE,Timestamp:Xg,Blob:mg,Transaction:sN,WriteBatch:uN,DocumentReference:cN,DocumentSnapshot:hN,Query:fN,QueryDocumentSnapshot:lN,QuerySnapshot:pN,CollectionReference:dN,FieldPath:xI,FieldValue:fC,setLogLevel:MC.setLogLevel,CACHE_SIZE_UNLIMITED:RC};function mN(t){t.INTERNAL.registerService("firestore",function(t){return new MC(t)},function(t){Am(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(yN))}var gN=(vN.prototype.addCallback=function(t){},vN.prototype.shutdown=function(){},vN);function vN(){}var bN="ConnectivityMonitor",wN=(_N.prototype.addCallback=function(t){this.callbacks.push(t)},_N.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},_N.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},_N.prototype.onNetworkAvailable=function(){Sm(bN,"Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(0)},_N.prototype.onNetworkUnavailable=function(){Sm(bN,"Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(1)},_N.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},_N);function _N(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var TN=(EN.prototype.onOpen=function(t){Am(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},EN.prototype.onClose=function(t){Am(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},EN.prototype.onMessage=function(t){Am(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},EN.prototype.close=function(){this.closeFn()},EN.prototype.send=function(t){this.sendFn(t)},EN.prototype.callOnOpen=function(){Am(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},EN.prototype.callOnClose=function(t){Am(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},EN.prototype.callOnMessage=function(t){Am(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},EN);function EN(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}var SN="Connection",IN={BatchGetDocuments:"batchGet",Commit:"commit"},CN="gl-js/ fire/"+wm,NN=(AN.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=CN},AN.prototype.invokeRPC=function(s,r,u){var c=this,h=this.makeUrl(s);return new Promise(function(i,o){var a=new bm;a.listenOnce(gm.COMPLETE,function(){try{switch(a.getLastErrorCode()){case mm.NO_ERROR:var t=a.getResponseJson();Sm(SN,"XHR received:",JSON.stringify(t)),i(t);break;case mm.TIMEOUT:Sm(SN,'RPC "'+s+'" timed out'),o(new Mm(Pm.DEADLINE_EXCEEDED,"Request time out"));break;case mm.HTTP_ERROR:var e=a.getStatus();if(Sm(SN,'RPC "'+s+'" failed with status:',e,"response text:",a.getResponseText()),0<e){var n=a.getResponseJson().error;if(n&&n.status&&n.message){var r=function(t){var e=t.toLowerCase().replace("_","-");return 0<=Object.values(Pm).indexOf(e)?e:Pm.UNKNOWN}(n.status);o(new Mm(r,n.message))}else o(new Mm(Pm.UNKNOWN,"Server responded with status "+a.getStatus()))}else Sm(SN,'RPC "'+s+'" failed'),o(new Mm(Pm.UNAVAILABLE,"Connection failed."));break;default:Nm('RPC "'+s+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{Sm(SN,'RPC "'+s+'" completed.')}});var t=oa({},r);delete t.database;var e=JSON.stringify(t);Sm(SN,"XHR sending: ",h+" "+e);var n={"Content-Type":"text/plain"};c.modifyHeadersForRequest(n,u),a.send(h,"POST",e,n,15)})},AN.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},AN.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=ym(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),Sa()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function a(t,e){s.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Sm(SN,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),u=!1,c=!1,h=new TN({sendFn:function(t){c?Sm(SN,"Not sending because WebChannel is closed:",t):(u||(Sm(SN,"Opening WebChannel transport."),s.open(),u=!0),Sm(SN,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}});return a(vm.EventType.OPEN,function(){c||Sm(SN,"WebChannel transport opened.")}),a(vm.EventType.CLOSE,function(){c||(c=!0,Sm(SN,"WebChannel transport closed"),h.callOnClose())}),a(vm.EventType.ERROR,function(t){c||(c=!0,Sm(SN,"WebChannel transport errored:",t),h.callOnClose(new Mm(Pm.UNAVAILABLE,"The operation could not be completed")))}),a(vm.EventType.MESSAGE,function(t){if(!c){var e=t.data[0];Am(!!e,"Got a webchannel message without data.");var n=e,r=n.error||n[0]&&n[0].error;if(r){Sm(SN,"WebChannel received error:",r);var i=r.status,o=function(t){var e=sE[t];if(void 0!==e)return fE(e)}(i),a=r.message;void 0===o&&(o=Pm.INTERNAL,a="Unknown error status: "+i+" with message "+r.message),c=!0,h.callOnClose(new Mm(o,a)),s.close()}else Sm(SN,"WebChannel received:",e),h.callOnMessage(e)}}),setTimeout(function(){h.callOnOpen()},0),h},AN.prototype.makeUrl=function(t){var e=IN[t];return Am(void 0!==e,"Unknown REST mapping for: "+t),this.baseUrl+"/v1/projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents:"+e},AN);function AN(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}var kN=(Object.defineProperty(DN.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(DN.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),DN.prototype.loadConnection=function(t){return Promise.resolve(new NN(t))},DN.prototype.newConnectivityMonitor=function(){return wN.isAvailable()?new wN:new gN},DN.prototype.newSerializer=function(t){return new jS(t,{useProto3Json:!0})},DN.prototype.formatJSON=function(t){return JSON.stringify(t)},DN.prototype.atob=function(t){return atob(t)},DN.prototype.btoa=function(t){return btoa(t)},DN);function DN(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}km.setPlatform(new kN),mN(fl);var RN,ON={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},PN=(ia(MN,RN=Error),MN);function MN(t,e,n){var r=RN.call(this,e)||this;return Object.setPrototypeOf(r,MN.prototype),r.code=t,r.details=n,r}function LN(t,e,n){var r=function(t){if(200<=t&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}}(t),i=r,o=void 0;try{var a=e&&e.error;if(a){var s=a.status;if("string"==typeof s){if(!ON[s])return new PN("internal","internal");r=ON[s],i=s}var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new PN(r,i,o)}var xN=(FN.prototype.getAuthToken=function(){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.app.INTERNAL.getToken()];case 1:return(e=t.sent())?[2,e.accessToken]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},FN.prototype.getInstanceIdToken=function(){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this.app.messaging?[4,this.app.messaging().getToken()]:[2,void 0];case 1:return(e=t.sent())?[2,e]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},FN.prototype.getContext=function(){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:return[4,this.getAuthToken()];case 1:return e=t.sent(),[4,this.getInstanceIdToken()];case 2:return n=t.sent(),[2,{authToken:e,instanceIdToken:n}]}})})},FN);function FN(t){this.app=t}function UN(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var VN=(qN.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return UN(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},qN.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?UN(t,function(t){return e.decode(t)}):t},qN);function qN(){}var BN=(Object.defineProperty(jN.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),jN.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+e+".cloudfunctions.net/"+t:this.emulatorOrigin+"/"+e+"/"+n+"/"+t},jN.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},jN.prototype.httpsCallable=function(e,n){var r=this;return function(t){return r.call(e,t,n||{})}},jN.prototype.postJSON=function(r,i,o){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:o.append("Content-Type","application/json"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,fetch(r,{method:"POST",body:JSON.stringify(i),headers:o})];case 2:return e=t.sent(),[3,4];case 3:return t.sent(),[2,{status:0,json:null}];case 4:n=null,t.label=5;case 5:return t.trys.push([5,7,,8]),[4,e.json()];case 6:return n=t.sent(),[3,8];case 7:return t.sent(),[3,8];case 8:return[2,{status:e.status,json:n}]}})})},jN.prototype.call=function(c,h,l){return aa(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u;return sa(this,function(t){switch(t.label){case 0:return e=this._url(c),h=this.serializer.encode(h),n={data:h},r=new Headers,[4,this.contextProvider.getContext()];case 1:return(i=t.sent()).authToken&&r.append("Authorization","Bearer "+i.authToken),i.instanceIdToken&&r.append("Firebase-Instance-ID-Token",i.instanceIdToken),o=l.timeout||7e4,[4,Promise.race([this.postJSON(e,n,r),function(n){return new Promise(function(t,e){setTimeout(function(){e(new PN("deadline-exceeded","deadline-exceeded"))},n)})}(o),this.cancelAllRequests])];case 2:if(!(a=t.sent()))throw new PN("cancelled","Firebase Functions instance was deleted.");if(s=LN(a.status,a.json,this.serializer))throw s;if(!a.json)throw new PN("internal","Response is not valid JSON object.");if(void 0===(u=a.json.data)&&(u=a.json.result),void 0===u)throw new PN("internal","Response is missing data field.");return[2,{data:this.serializer.decode(u)}]}})})},jN);function jN(t,e){var n=this;void 0===e&&(e="us-central1"),this.app_=t,this.region_=e,this.serializer=new VN,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return n.deleteService()}},this.contextProvider=new xN(t),this.cancelAllRequests=new Promise(function(t){n.deleteService=function(){return t()}})}var WN;function KN(t,e,n){return new BN(t,n)}function QN(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function HN(n,r,i){var o,t=new Promise(function(t,e){QN(o=n[r].apply(n,i)).then(t,e)});return t.request=o,t}function GN(t,n,e){e.forEach(function(e){Object.defineProperty(t.prototype,e,{get:function(){return this[n][e]},set:function(t){this[n][e]=t}})})}function zN(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return HN(this[n],t,arguments)})})}function YN(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return this[n][t].apply(this[n],arguments)})})}function XN(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return function(t,e,n){var r=HN(t,e,n);return r.then(function(t){if(t)return new $N(t,r.request)})}(this[n],t,arguments)})})}function JN(t){this._index=t}function $N(t,e){this._cursor=t,this._request=e}function ZN(t){this._store=t}function tA(n){this._tx=n,this.complete=new Promise(function(t,e){n.oncomplete=function(){t()},n.onerror=function(){e(n.error)},n.onabort=function(){e(n.error)}})}function eA(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new tA(n)}function nA(t){this._db=t}WN={Functions:BN},fl.INTERNAL.registerService("functions",KN,WN,void 0,!0),GN(JN,"_index",["name","keyPath","multiEntry","unique"]),zN(JN,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),XN(JN,"_index",IDBIndex,["openCursor","openKeyCursor"]),GN($N,"_cursor",["direction","key","primaryKey","value"]),zN($N,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&($N.prototype[n]=function(){var e=this,t=arguments;return Promise.resolve().then(function(){return e._cursor[n].apply(e._cursor,t),QN(e._request).then(function(t){if(t)return new $N(t,e._request)})})})}),ZN.prototype.createIndex=function(){return new JN(this._store.createIndex.apply(this._store,arguments))},ZN.prototype.index=function(){return new JN(this._store.index.apply(this._store,arguments))},GN(ZN,"_store",["name","keyPath","indexNames","autoIncrement"]),zN(ZN,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),XN(ZN,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),YN(ZN,"_store",IDBObjectStore,["deleteIndex"]),tA.prototype.objectStore=function(){return new ZN(this._tx.objectStore.apply(this._tx,arguments))},GN(tA,"_tx",["objectStoreNames","mode"]),YN(tA,"_tx",IDBTransaction,["abort"]),eA.prototype.createObjectStore=function(){return new ZN(this._db.createObjectStore.apply(this._db,arguments))},GN(eA,"_db",["name","version","objectStoreNames"]),YN(eA,"_db",IDBDatabase,["deleteObjectStore","close"]),nA.prototype.transaction=function(){return new tA(this._db.transaction.apply(this._db,arguments))},GN(nA,"_db",["name","version","objectStoreNames"]),YN(nA,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(i){[ZN,JN].forEach(function(t){i in t.prototype&&(t.prototype[i.replace("open","iterate")]=function(){var t=function(t){return Array.prototype.slice.call(t)}(arguments),e=t[t.length-1],n=this._store||this._index,r=n[i].apply(n,t.slice(0,-1));r.onsuccess=function(){e(r.result)}})})}),[JN,ZN].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,n){var r=this,i=[];return new Promise(function(e){r.iterateCursor(t,function(t){t?(i.push(t.value),void 0===n||i.length!=n?t.continue():e(i)):e(i)})})})});var rA,iA=1e4,oA="w:0.3.4",aA="FIS_v2",sA="https://firebaseinstallations.googleapis.com/v1",uA=36e5,cA=((rA={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',rA["not-registered"]="Firebase Installation is not registered.",rA["installation-not-found"]="Firebase Installation not found.",rA["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',rA["app-offline"]="Could not process request. Application offline.",rA["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",rA),hA=new ka("installations","Installations",cA);function lA(t){return t instanceof Na&&t.code.includes("request-failed")}function fA(t){var e,n;if(!t||!t.options)throw pA("App Configuration");if(!t.name)throw pA("App Name");try{for(var r=ua(["projectId","apiKey","appId"]),i=r.next();!i.done;i=r.next()){var o=i.value;if(!t.options[o])throw pA(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function pA(t){return hA.create("missing-app-config-values",{valueName:t})}function dA(t){var e=t.projectId;return sA+"/projects/"+e+"/installations"}function yA(t){return{token:t.token,requestStatus:2,expiresIn:function(t){return Number(t.replace("s","000"))}(t.expiresIn),creationTime:Date.now()}}function mA(r,i){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:return[4,i.json()];case 1:return e=t.sent(),n=e.error,[2,hA.create("request-failed",{requestName:r,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})]}})})}function gA(t){var e=t.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function vA(t,e){var n=e.refreshToken,r=gA(t);return r.append("Authorization",function(t){return aA+" "+t}(n)),r}function bA(n){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return[4,n()];case 1:return 500<=(e=t.sent()).status&&e.status<600?[2,n()]:[2,e]}})})}function wA(e){return new Promise(function(t){setTimeout(t,e)})}var _A=/^[cdef][\w-]{21}$/,TA="";function EA(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return function(t){return btoa(String.fromCharCode.apply(String,ha(t))).replace(/\+/g,"-").replace(/\//g,"_")}(t).substr(0,22)}(t);return _A.test(e)?e:TA}catch(t){return TA}}var SA,IA="firebase-installations-database",CA=1,NA="firebase-installations-store",AA=null;function kA(){return AA=AA||function(t,e,n){var r=HN(indexedDB,"open",[t,e]),i=r.request;return i&&(i.onupgradeneeded=function(t){n&&n(new eA(i.result,t.oldVersion,i.transaction))}),r.then(function(t){return new nA(t)})}(IA,CA,function(t){switch(t.oldVersion){case 0:t.createObjectStore(NA)}})}function DA(i,o){return aa(this,void 0,void 0,function(){var e,n,r;return sa(this,function(t){switch(t.label){case 0:return e=PA(i),[4,kA()];case 1:return n=t.sent(),[4,(r=n.transaction(NA,"readwrite")).objectStore(NA).put(o,e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2,o]}})})}function RA(i){return aa(this,void 0,void 0,function(){var e,n,r;return sa(this,function(t){switch(t.label){case 0:return e=PA(i),[4,kA()];case 1:return n=t.sent(),[4,(r=n.transaction(NA,"readwrite")).objectStore(NA).delete(e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2]}})})}function OA(s,u){return aa(this,void 0,void 0,function(){var e,n,r,i,o,a;return sa(this,function(t){switch(t.label){case 0:return e=PA(s),[4,kA()];case 1:return n=t.sent(),r=n.transaction(NA,"readwrite"),[4,(i=r.objectStore(NA)).get(e)];case 2:return o=t.sent(),void 0!==(a=u(o))?[3,4]:[4,i.delete(e)];case 3:return t.sent(),[3,6];case 4:return[4,i.put(a,e)];case 5:t.sent(),t.label=6;case 6:return[4,r.complete];case 7:return t.sent(),[2,a]}})})}function PA(t){return t.appName+"!"+t.appId}function MA(i){return aa(this,void 0,void 0,function(){var r,e,n;return sa(this,function(t){switch(t.label){case 0:return[4,OA(i,function(t){var e=function(t){return xA(t||{fid:EA(),registrationStatus:0})}(t),n=function(t,e){{if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:function(o){return aa(this,void 0,void 0,function(){var e,n,r,i;return sa(this,function(t){switch(t.label){case 0:return[4,LA(o)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,wA(100)];case 3:return t.sent(),[4,LA(o)];case 4:return e=t.sent(),[3,2];case 5:return 0!==e.registrationStatus?[3,7]:[4,MA(o)];case 6:return n=t.sent(),r=n.installationEntry,(i=n.registrationPromise)?[2,i]:[2,r];case 7:return[2,e]}})})}(t)}:{installationEntry:e};if(!navigator.onLine){var n=Promise.reject(hA.create("app-offline"));return{installationEntry:e,registrationPromise:n}}var r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=function(r,i){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,7]),[4,function(s,t){var u=t.fid;return aa(this,void 0,void 0,function(){var e,n,r,i,o,a;return sa(this,function(t){switch(t.label){case 0:return e=dA(s),n=gA(s),r={fid:u,authVersion:aA,appId:s.appId,sdkVersion:oA},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,bA(function(){return fetch(e,i)})];case 1:return(o=t.sent()).ok?[4,o.json()]:[3,3];case 2:return a=t.sent(),[2,{fid:a.fid||u,registrationStatus:2,refreshToken:a.refreshToken,authToken:yA(a.authToken)}];case 3:return[4,mA("Create Installation",o)];case 4:throw t.sent()}})})}(r,i)];case 1:return e=t.sent(),[2,DA(r,e)];case 2:return lA(n=t.sent())&&409===n.serverCode?[4,RA(r)]:[3,4];case 3:return t.sent(),[3,6];case 4:return[4,DA(r,{fid:i.fid,registrationStatus:0})];case 5:t.sent(),t.label=6;case 6:throw n;case 7:return[2]}})})}(t,r);return{installationEntry:r,registrationPromise:i}}}(i,e);return r=n.registrationPromise,n.installationEntry})];case 1:return(e=t.sent()).fid!==TA?[3,3]:(n={},[4,r]);case 2:return[2,(n.installationEntry=t.sent(),n)];case 3:return[2,{installationEntry:e,registrationPromise:r}]}})})}function LA(t){return OA(t,function(t){if(!t)throw hA.create("installation-not-found");return xA(t)})}function xA(t){return function(t){return 1===t.registrationStatus&&t.registrationTime+iA<Date.now()}(t)?{fid:t.fid,registrationStatus:0}:t}function FA(s,u){return aa(this,void 0,void 0,function(){var e,n,r,i,o,a;return sa(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=e.fid;return dA(t)+"/"+n+"/authTokens:generate"}(s,u),n=vA(s,u),r={installation:{sdkVersion:oA}},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,bA(function(){return fetch(e,i)})];case 1:return(o=t.sent()).ok?[4,o.json()]:[3,3];case 2:return a=t.sent(),[2,yA(a)];case 3:return[4,mA("Generate Auth Token",o)];case 4:throw t.sent()}})})}function UA(i,o){return void 0===o&&(o=!1),aa(this,void 0,void 0,function(){var r,e,n;return sa(this,function(t){switch(t.label){case 0:return[4,OA(i,function(t){if(!qA(t))throw hA.create("not-registered");var e=t.authToken;if(!o&&function(t){return 2===t.requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+uA}(t)}(e))return t;if(1===e.requestStatus)return r=function(r,i){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:return[4,VA(r)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.authToken.requestStatus?[3,5]:[4,wA(100)];case 3:return t.sent(),[4,VA(r)];case 4:return e=t.sent(),[3,2];case 5:return 0===(n=e.authToken).requestStatus?[2,UA(r,i)]:[2,n]}})})}(i,o),t;if(!navigator.onLine)throw hA.create("app-offline");var n=function(t){var e={requestStatus:1,requestTime:Date.now()};return oa(oa({},t),{authToken:e})}(t);return r=function(i,o){return aa(this,void 0,void 0,function(){var e,n,r;return sa(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,8]),[4,FA(i,o)];case 1:return e=t.sent(),r=oa(oa({},o),{authToken:e}),[4,DA(i,r)];case 2:return t.sent(),[2,e];case 3:return!lA(n=t.sent())||401!==n.serverCode&&404!==n.serverCode?[3,5]:[4,RA(i)];case 4:return t.sent(),[3,7];case 5:return r=oa(oa({},o),{authToken:{requestStatus:0}}),[4,DA(i,r)];case 6:t.sent(),t.label=7;case 7:throw n;case 8:return[2]}})})}(i,n),n})];case 1:return e=t.sent(),r?[4,r]:[3,3];case 2:return n=t.sent(),[3,4];case 3:n=e.authToken,t.label=4;case 4:return[2,n]}})})}function VA(t){return OA(t,function(t){if(!qA(t))throw hA.create("not-registered");return function(t){return 1===t.requestStatus&&t.requestTime+iA<Date.now()}(t.authToken)?oa(oa({},t),{authToken:{requestStatus:0}}):t})}function qA(t){return void 0!==t&&2===t.registrationStatus}function BA(n,r){return void 0===r&&(r=!1),aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return[4,function(n){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return[4,MA(n)];case 1:return(e=t.sent().registrationPromise)?[4,e]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e=fA(n))];case 1:return t.sent(),[4,UA(e,r)];case 2:return[2,t.sent().token]}})})}function jA(o,a){return aa(this,void 0,void 0,function(){var e,n,r,i;return sa(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=e.fid;return dA(t)+"/"+n}(o,a),n=vA(o,a),r={method:"DELETE",headers:n},[4,bA(function(){return fetch(e,r)})];case 1:return(i=t.sent()).ok?[3,3]:[4,mA("Delete Installation",i)];case 2:throw t.sent();case 3:return[2]}})})}fl.INTERNAL.registerService("installations",function(e){return fA(e),{app:e,getId:function(){return function(o){return aa(this,void 0,void 0,function(){var e,n,r,i;return sa(this,function(t){switch(t.label){case 0:return[4,MA(e=fA(o))];case 1:return n=t.sent(),r=n.installationEntry,(i=n.registrationPromise)?i.catch(console.error):UA(e).catch(console.error),[2,r.fid]}})})}(e)},getToken:function(t){return BA(e,t)},delete:function(){return function(r){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:return[4,OA(e=fA(r),function(t){if(!t||0!==t.registrationStatus)return t})];case 1:if(!(n=t.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw hA.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw hA.create("app-offline");case 3:return[4,jA(e,n)];case 4:return t.sent(),[4,RA(e)];case 5:t.sent(),t.label=6;case 6:return[2]}})})}(e)}}});var WA,KA,QA=((SA={})["only-available-in-window"]="This method is available in a Window context.",SA["only-available-in-sw"]="This method is available in a service worker context.",SA["should-be-overriden"]="This method should be overriden by extended classes.",SA["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",SA["permission-default"]="The required permissions were not granted and dismissed instead.",SA["permission-blocked"]="The required permissions were not granted and blocked instead.",SA["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",SA["notifications-blocked"]="Notifications have been blocked.",SA["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",SA["sw-registration-expected"]="A service worker registration was the expected input.",SA["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",SA["invalid-saved-token"]="Unable to access details of the saved token.",SA["sw-reg-redundant"]="The service worker being used for push was made redundant.",SA["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",SA["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",SA["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",SA["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",SA["token-update-no-token"]="FCM returned no token when updating the user to push.",SA["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",SA["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",SA["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",SA["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",SA["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",SA["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",SA["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",SA["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",SA["failed-to-delete-token"]="Unable to delete the currently saved token.",SA["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",SA["bad-scope"]="The service worker scope must be a string with at least one character.",SA["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",SA["bad-subscription"]="The subscription must be a valid PushSubscription.",SA["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",SA["failed-delete-vapid-key"]="The VAPID key could not be deleted.",SA["invalid-public-vapid-key"]="The public VAPID key must be a string.",SA["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",SA["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",SA),HA=new ka("messaging","Messaging",QA),GA=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),zA="google.c.a.c_id";function YA(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function XA(t){return function(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,ha(e)))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(KA=WA=WA||{}).PUSH_MSG_RECEIVED="push-msg-received",KA.NOTIFICATION_CLICKED="notification-clicked";var JA=($A.prototype.getToken=function(s,u,c){return aa(this,void 0,void 0,function(){var e,n,r,i,o,a;return sa(this,function(t){switch(t.label){case 0:return[4,tk(s)];case 1:e=t.sent(),n=ek(u,c),r={method:"POST",headers:e,body:JSON.stringify(n)},t.label=2;case 2:return t.trys.push([2,5,,6]),[4,fetch(ZA(s),r)];case 3:return[4,t.sent().json()];case 4:return i=t.sent(),[3,6];case 5:throw o=t.sent(),HA.create("token-subscribe-failed",{errorInfo:o});case 6:if(i.error)throw a=i.error.message,HA.create("token-subscribe-failed",{errorInfo:a});if(!i.token)throw HA.create("token-subscribe-no-token");return[2,i.token]}})})},$A.prototype.updateToken=function(s,u,c,h){return aa(this,void 0,void 0,function(){var e,n,r,i,o,a;return sa(this,function(t){switch(t.label){case 0:return[4,tk(u)];case 1:e=t.sent(),n=ek(c,h),r={method:"PATCH",headers:e,body:JSON.stringify(n)},t.label=2;case 2:return t.trys.push([2,5,,6]),[4,fetch(ZA(u)+"/"+s.fcmToken,r)];case 3:return[4,t.sent().json()];case 4:return i=t.sent(),[3,6];case 5:throw o=t.sent(),HA.create("token-update-failed",{errorInfo:o});case 6:if(i.error)throw a=i.error.message,HA.create("token-update-failed",{errorInfo:a});if(!i.token)throw HA.create("token-update-no-token");return[2,i.token]}})})},$A.prototype.deleteToken=function(a,s){return aa(this,void 0,void 0,function(){var e,n,r,i,o;return sa(this,function(t){switch(t.label){case 0:return[4,tk(a)];case 1:e=t.sent(),n={method:"DELETE",headers:e},t.label=2;case 2:return t.trys.push([2,5,,6]),[4,fetch(ZA(a)+"/"+s.fcmToken,n)];case 3:return[4,t.sent().json()];case 4:if((r=t.sent()).error)throw i=r.error.message,HA.create("token-unsubscribe-failed",{errorInfo:i});return[3,6];case 5:throw o=t.sent(),HA.create("token-unsubscribe-failed",{errorInfo:o});case 6:return[2]}})})},$A);function $A(){}function ZA(t){return"https://fcmregistrations.googleapis.com/v1/projects/"+t.options.projectId+"/registrations"}function tk(n){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return[4,n.installations().getToken()];case 1:return e=t.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.options.apiKey,"x-goog-firebase-installations-auth":"FIS "+e})]}})})}function ek(t,e){var n=XA(t.getKey("p256dh")),r=XA(t.getKey("auth")),i={web:{endpoint:t.endpoint,p256dh:n,auth:r}};return YA(e.buffer,GA.buffer)||(i.web.applicationPubKey=XA(e)),i}function nk(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var rk="undefined",ik="fcm_token_object_Store";function ok(e){var n=indexedDB.open(rk);n.onerror=function(t){},n.onsuccess=function(t){!function(n,r){if(n.objectStoreNames.contains(ik)){var t=n.transaction(ik).objectStore(ik),i=new JA,o=t.openCursor();o.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},o.onsuccess=function(){var t=o.result;if(t){var e=t.value;i.deleteToken(r,e),t.continue()}else n.close(),indexedDB.deleteDatabase(rk)}}}(n.result,e)}}var ak=(sk.prototype.get=function(e){return this.createTransaction(function(t){return t.get(e)})},sk.prototype.getIndex=function(e,n){return this.createTransaction(function(t){return t.index(e).get(n)})},sk.prototype.put=function(e){return this.createTransaction(function(t){return t.put(e)},"readwrite")},sk.prototype.delete=function(e){return this.createTransaction(function(t){return t.delete(e)},"readwrite")},sk.prototype.closeDatabase=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},sk.prototype.createTransaction=function(o,a){return void 0===a&&(a="readonly"),aa(this,void 0,void 0,function(){var e,n,r,i;return sa(this,function(t){switch(t.label){case 0:return[4,this.getDb()];case 1:return e=t.sent(),n=e.transaction(this.objectStoreName,a),r=n.objectStore(this.objectStoreName),[4,function(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}(o(r))];case 2:return i=t.sent(),[2,new Promise(function(t,e){n.oncomplete=function(){t(i)},n.onerror=function(){e(n.error)}})]}})})},sk.prototype.getDb=function(){var r=this;return this.dbPromise||(this.dbPromise=new Promise(function(t,e){var n=indexedDB.open(r.dbName,r.dbVersion);n.onsuccess=function(){t(n.result)},n.onerror=function(){r.dbPromise=null,e(n.error)},n.onupgradeneeded=function(t){return r.onDbUpgrade(n,t)}})),this.dbPromise},sk);function sk(){this.dbPromise=null}var uk,ck=(ia(hk,uk=ak),hk.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(i=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),i.createIndex("fcmToken","fcmToken",{unique:!0});case 1:ok(this.app);case 2:var r=(i=t.transaction.objectStore(this.objectStoreName)).openCursor();r.onsuccess=function(){var t=r.result;if(t){var e=t.value,n=oa({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=nk(e.vapidKey)),"string"==typeof e.auth&&(n.auth=nk(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=nk(e.p256dh).buffer),"string"==typeof e.fcmPushSet&&delete n.fcmPushSet,t.update(n),t.continue()}};break;case 3:var i,o=(i=t.transaction.objectStore(this.objectStoreName)).openCursor();o.onsuccess=function(){var t=o.result;if(t){var e=t.value,n=oa({},e);"string"==typeof e.fcmPushSet&&delete n.fcmPushSet,t.update(n),t.continue()}}}},hk.prototype.getTokenDetailsFromToken=function(e){return aa(this,void 0,void 0,function(){return sa(this,function(t){if(!e)throw HA.create("bad-token");return lk({fcmToken:e}),[2,this.getIndex("fcmToken",e)]})})},hk.prototype.getTokenDetailsFromSWScope=function(e){return aa(this,void 0,void 0,function(){return sa(this,function(t){if(!e)throw HA.create("bad-scope");return lk({swScope:e}),[2,this.get(e)]})})},hk.prototype.saveTokenDetails=function(e){return aa(this,void 0,void 0,function(){return sa(this,function(t){if(!e.swScope)throw HA.create("bad-scope");if(!e.vapidKey)throw HA.create("bad-vapid-key");if(!e.endpoint||!e.auth||!e.p256dh)throw HA.create("bad-subscription");if(!e.fcmSenderId)throw HA.create("bad-sender-id");if(!e.fcmToken)throw HA.create("bad-token");return lk(e),[2,this.put(e)]})})},hk.prototype.deleteToken=function(n){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return"string"!=typeof n||0===n.length?[2,Promise.reject(HA.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(n)];case 1:if(!(e=t.sent()))throw HA.create("delete-token-not-found");return[4,this.delete(e.swScope)];case 2:return t.sent(),[2,e]}})})},hk);function hk(t){var e=uk.call(this)||this;return e.app=t,e.dbName="fcm_token_details_db",e.dbVersion=4,e.objectStoreName="fcm_token_object_Store",e}function lk(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw HA.create("bad-token");if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw HA.create("bad-scope");if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw HA.create("bad-vapid-key");if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw HA.create("bad-subscription");if(t.auth&&!(t.auth instanceof ArrayBuffer))throw HA.create("bad-subscription");if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw HA.create("bad-subscription");if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw HA.create("bad-sender-id")}var fk,pk=(ia(dk,fk=ak),dk.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},dk.prototype.getVapidFromSWScope=function(n){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:if("string"!=typeof n||0===n.length)throw HA.create("bad-scope");return[4,this.get(n)];case 1:return[2,(e=t.sent())?e.vapidKey:void 0]}})})},dk.prototype.saveVapidDetails=function(n,r){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){if("string"!=typeof n||0===n.length)throw HA.create("bad-scope");if(null===r||65!==r.length)throw HA.create("bad-vapid-key");return e={swScope:n,vapidKey:r},[2,this.put(e)]})})},dk.prototype.deleteVapidDetails=function(n){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return[4,this.getVapidFromSWScope(n)];case 1:if(!(e=t.sent()))throw HA.create("delete-scope-not-found");return[4,this.delete(n)];case 2:return t.sent(),[2,e]}})})},dk);function dk(){var t=null!==fk&&fk.apply(this,arguments)||this;return t.dbName="fcm_vapid_details_db",t.dbVersion=1,t.objectStoreName="fcm_vapid_object_Store",t}var yk=(mk.prototype.getToken=function(){return aa(this,void 0,void 0,function(){var e,n,r,i,o;return sa(this,function(t){switch(t.label){case 0:if("denied"===(e=this.getNotificationPermission_()))throw HA.create("notifications-blocked");return"granted"!==e?[2,null]:[4,this.getSWRegistration_()];case 1:return n=t.sent(),[4,this.getPublicVapidKey_()];case 2:return r=t.sent(),[4,this.getPushSubscription(n,r)];case 3:return i=t.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(n.scope)];case 4:return(o=t.sent())?[2,this.manageExistingToken(n,i,r,o)]:[2,this.getNewToken(n,i,r)]}})})},mk.prototype.manageExistingToken=function(e,n,r,i){return aa(this,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return function(t,e,n){if(!n.vapidKey||!YA(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=YA(t.getKey("auth"),n.auth),o=YA(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(n,r,i)?Date.now()<i.createTime+6048e5?[2,i.fcmToken]:[2,this.updateToken(e,n,r,i)]:[3,1];case 1:return[4,this.deleteTokenFromDB(i.fcmToken)];case 2:return t.sent(),[2,this.getNewToken(e,n,r)];case 3:return[2]}})})},mk.prototype.updateToken=function(i,o,a,s){return aa(this,void 0,void 0,function(){var e,n,r;return sa(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,6]),[4,this.subscriptionManager.updateToken(s,this.app,o,a)];case 1:return e=t.sent(),n={swScope:i.scope,vapidKey:a,fcmSenderId:this.app.options.messagingSenderId,fcmToken:e,createTime:Date.now(),endpoint:o.endpoint,auth:o.getKey("auth"),p256dh:o.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(i.scope,a)];case 3:return t.sent(),[2,e];case 4:return r=t.sent(),[4,this.deleteToken(s.fcmToken)];case 5:throw t.sent(),r;case 6:return[2]}})})},mk.prototype.getNewToken=function(r,i,o){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:return[4,this.subscriptionManager.getToken(this.app,i,o)];case 1:return e=t.sent(),n={swScope:r.scope,vapidKey:o,fcmSenderId:this.app.options.messagingSenderId,fcmToken:e,createTime:Date.now(),endpoint:i.endpoint,auth:i.getKey("auth"),p256dh:i.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(r.scope,o)];case 3:return t.sent(),[2,e]}})})},mk.prototype.deleteToken=function(r){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:return[4,this.deleteTokenFromDB(r)];case 1:return t.sent(),[4,this.getSWRegistration_()];case 2:return(e=t.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=t.sent())return[2,n.unsubscribe()];t.label=4;case 4:return[2,!0]}})})},mk.prototype.deleteTokenFromDB=function(n){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return[4,this.tokenDetailsModel.deleteToken(n)];case 1:return e=t.sent(),[4,this.subscriptionManager.deleteToken(this.app,e)];case 2:return t.sent(),[2]}})})},mk.prototype.getPushSubscription=function(n,r){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return[4,n.pushManager.getSubscription()];case 1:return(e=t.sent())?[2,e]:[2,n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r})]}})})},mk.prototype.requestPermission=function(){throw HA.create("only-available-in-window")},mk.prototype.useServiceWorker=function(t){throw HA.create("only-available-in-window")},mk.prototype.usePublicVapidKey=function(t){throw HA.create("only-available-in-window")},mk.prototype.onMessage=function(t,e,n){throw HA.create("only-available-in-window")},mk.prototype.onTokenRefresh=function(t,e,n){throw HA.create("only-available-in-window")},mk.prototype.setBackgroundMessageHandler=function(t){throw HA.create("only-available-in-sw")},mk.prototype.delete=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},mk.prototype.getNotificationPermission_=function(){return Notification.permission},mk.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},mk.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},mk.prototype.getSubscriptionManager=function(){return this.subscriptionManager},mk);function mk(t){var e=this;if(this.app=t,this.vapidDetailsModel=new pk,this.subscriptionManager=new JA,!t.options.messagingSenderId||"string"!=typeof t.options.messagingSenderId)throw HA.create("bad-sender-id");this.INTERNAL={delete:function(){return e.delete()}},this.tokenDetailsModel=new ck(t)}var gk,vk="FCM_MSG",bk=(ia(wk,gk=yk),wk.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},wk.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},wk.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},wk.prototype.onPush_=function(s){return aa(this,void 0,void 0,function(){var e,n,r,i,o,a;return sa(this,function(t){switch(t.label){case 0:if(!s.data)return[2];try{e=s.data.json()}catch(t){return[2]}return[4,this.hasVisibleClients_()];case 1:return t.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=t.sent(),o=n.actions,a=Notification.maxActions,o&&a&&o.length>a&&console.warn("This browser only supports "+a+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return t.sent(),[2];case 5:return[2]}})})},wk.prototype.onSubChange_=function(t){return aa(this,void 0,void 0,function(){var e,n,r,i;return sa(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return e=t.sent(),[3,3];case 2:throw n=t.sent(),HA.create("unable-to-resubscribe",{errorInfo:n});case 3:return t.trys.push([3,5,,8]),[4,e.pushManager.getSubscription()];case 4:return t.sent(),[3,8];case 5:return r=t.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(e.scope)];case 6:if(!(i=t.sent()))throw r;return[4,this.deleteToken(i.fcmToken)];case 7:throw t.sent(),r;case 8:return[2]}})})},wk.prototype.onNotificationClick_=function(o){return aa(this,void 0,void 0,function(){var e,n,r,i;return sa(this,function(t){switch(t.label){case 0:if(!(o.notification&&o.notification.data&&o.notification.data[vk]))return[2];if(o.action)return[2];if(o.stopImmediatePropagation(),o.notification.close(),!(e=o.notification.data[vk]).notification)return[2];if(!(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)){if(!(e.data&&zA in e.data))return[2];n=self.location.origin}return[4,this.getWindowClient_(n)];case 1:return(r=t.sent())?[3,4]:[4,self.clients.openWindow(n)];case 2:return r=t.sent(),[4,function(e){return new Promise(function(t){setTimeout(t,e)})}(3e3)];case 3:return t.sent(),[3,6];case 4:return[4,r.focus()];case 5:r=t.sent(),t.label=6;case 6:return r?(delete e.notification,delete e.fcmOptions,i=Tk(WA.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},wk.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=oa({},t.notification);return n.data=oa(oa({},t.notification.data),((e={})[vk]=t,e)),n}},wk.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw HA.create("bg-handler-function-expected");this.bgMessageHandler=t},wk.prototype.getWindowClient_=function(o){return aa(this,void 0,void 0,function(){var e,n,r,i;return sa(this,function(t){switch(t.label){case 0:return e=new URL(o,self.location.href).href,[4,_k()];case 1:for(n=t.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}})})},wk.prototype.attemptToMessageClient_=function(e,n){return aa(this,void 0,void 0,function(){return sa(this,function(t){if(!e)throw HA.create("no-window-client-to-msg");return e.postMessage(n),[2]})})},wk.prototype.hasVisibleClients_=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return[4,_k()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})]}})})},wk.prototype.sendMessageToWindowClients_=function(i){return aa(this,void 0,void 0,function(){var e,n,r=this;return sa(this,function(t){switch(t.label){case 0:return[4,_k()];case 1:return e=t.sent(),n=Tk(WA.PUSH_MSG_RECEIVED,i),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return t.sent(),[2]}})})},wk.prototype.getSWRegistration_=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){return[2,self.registration]})})},wk.prototype.getPublicVapidKey_=function(){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(e=t.sent()))throw HA.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(e.scope)];case 2:return null==(n=t.sent())?[2,GA]:[2,n]}})})},wk);function wk(t){var e=gk.call(this,t)||this;return e.bgMessageHandler=null,self.addEventListener("push",function(t){e.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){e.onSubChange(t)}),self.addEventListener("notificationclick",function(t){e.onNotificationClick(t)}),e}function _k(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function Tk(t,e){return{firebaseMessagingType:t,firebaseMessagingData:e}}var Ek,Sk,Ik=(ia(Ck,Ek=yk),Ck.prototype.requestPermission=function(){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(e=t.sent()))return[2];throw"denied"===e?HA.create("permission-blocked"):HA.create("permission-default")}})})},Ck.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw HA.create("sw-registration-expected");if(null!=this.registrationToUse)throw HA.create("use-sw-before-get-token");this.registrationToUse=t},Ck.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw HA.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw HA.create("use-public-key-before-get-token");var e=nk(t);if(65!==e.length)throw HA.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},Ck.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},Ck.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},Ck.prototype.waitForRegistrationToActivate_=function(r){var i=r.installing||r.waiting||r.active;return new Promise(function(t,e){if(i)if("activated"!==i.state)if("redundant"!==i.state){var n=function(){if("activated"===i.state)t(r);else{if("redundant"!==i.state)return;e(HA.create("sw-reg-redundant"))}i.removeEventListener("statechange",n)};i.addEventListener("statechange",n)}else e(HA.create("sw-reg-redundant"));else t(r);else e(HA.create("no-sw-in-reg"))})},Ck.prototype.getSWRegistration_=function(){var e=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw HA.create("failed-serviceworker-registration",{browserErrorMessage:t.message})}).then(function(t){return e.waitForRegistrationToActivate_(t).then(function(){return(e.registrationToUse=t).update(),t})}))},Ck.prototype.getPublicVapidKey_=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,GA]})})},Ck.prototype.setupSWMessageListener_=function(){var a=this;navigator.serviceWorker.addEventListener("message",function(t){if(t.data&&t.data.firebaseMessagingType&&t.data.firebaseMessagingData){var e=t.data,n=e.firebaseMessagingType,r=e.firebaseMessagingData;a.messageObserver&&a.messageObserver.next(r);var i=r.data;if(i&&zA in i&&"1"===i["google.c.a.e"]){var o=function(t){switch(t){case WA.NOTIFICATION_CLICKED:return"notification_open";case WA.PUSH_MSG_RECEIVED:return"notification_foreground";default:throw new Error}}(n);a.app.INTERNAL.analytics.logEvent(o,{message_name:i["google.c.a.c_l"],message_id:i[zA],message_time:i["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}}},!1)},Ck);function Ck(t){var e=Ek.call(this,t)||this;return e.registrationToUse=null,e.publicVapidKeyToUse=null,e.messageObserver=null,e.tokenRefreshObserver=null,e.onMessageInternal=Ba(function(t){e.messageObserver=t}),e.onTokenRefreshInternal=Ba(function(t){e.tokenRefreshObserver=t}),e.setupSWMessageListener_(),e}function Nk(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}Sk={isSupported:Nk},fl.INTERNAL.registerService("messaging",function(t){if(!Nk())throw HA.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new bk(t):new Ik(t)},Sk);var Ak="firebasestorage.googleapis.com",kk="storageBucket",Dk=(Rk.prototype.codeProp=function(){return this.code},Rk.prototype.codeEquals=function(t){return Pk(t)===this.codeProp()},Rk.prototype.serverResponseProp=function(){return this.serverResponse_},Rk.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(Rk.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(Rk.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(Rk.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(Rk.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),Rk);function Rk(t,e){this.code_=Pk(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}var Ok={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function Pk(t){return"storage/"+t}function Mk(){return new Dk(Ok.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Lk(){return new Dk(Ok.CANCELED,"User canceled the upload/download.")}function xk(){return new Dk(Ok.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Fk(t,e,n){return new Dk(Ok.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function Uk(){return new Dk(Ok.APP_DELETED,"The Firebase app was deleted.")}function Vk(t,e){return new Dk(Ok.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function qk(t){throw new Dk(Ok.INTERNAL_ERROR,"Internal error: "+t)}var Bk={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function jk(t){switch(t){case Bk.RAW:case Bk.BASE64:case Bk.BASE64URL:case Bk.DATA_URL:return;default:throw"Expected one of the event types: ["+Bk.RAW+", "+Bk.BASE64+", "+Bk.BASE64URL+", "+Bk.DATA_URL+"]."}}var Wk=function(t,e){this.data=t,this.contentType=e||null};function Kk(t,e){switch(t){case Bk.RAW:return new Wk(Qk(e));case Bk.BASE64:case Bk.BASE64URL:return new Wk(Hk(t,e));case Bk.DATA_URL:return new Wk(function(t){var e=new Gk(t);return e.base64?Hk(Bk.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw Vk(Bk.DATA_URL,"Malformed data URL.")}return Qk(e)}(e.rest)}(e),function(t){return new Gk(t).contentType}(e))}throw Mk()}function Qk(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function Hk(e,t){switch(e){case Bk.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw Vk(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case Bk.BASE64URL:var i=-1!==t.indexOf("+"),o=-1!==t.indexOf("/");if(i||o)throw Vk(e,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(t)}catch(t){throw Vk(e,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var Gk=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw Vk(Bk.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=function(t,e){return t.length>=e.length&&t.substring(t.length-e.length)===e}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1)};var zk,Yk,Xk={STATE_CHANGED:"state_changed"},Jk="running",$k="pausing",Zk="paused",tD="success",eD="canceling",nD="canceled",rD="error",iD={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function oD(t){switch(t){case Jk:case $k:case eD:return iD.RUNNING;case Zk:return iD.PAUSED;case tD:return iD.SUCCESS;case nD:return iD.CANCELED;case rD:default:return iD.ERROR}}function aD(t){return null!=t}function sD(t){return void 0!==t}function uD(t){return"function"==typeof t}function cD(t){return"object"==typeof t}function hD(t){return"string"==typeof t||t instanceof String}function lD(t){return"number"==typeof t||t instanceof Number}function fD(t){return pD()&&t instanceof Blob}function pD(){return"undefined"!=typeof Blob}(Yk=zk=zk||{})[Yk.NO_ERROR=0]="NO_ERROR",Yk[Yk.NETWORK_ERROR=1]="NETWORK_ERROR",Yk[Yk.ABORT=2]="ABORT";var dD=(yD.prototype.send=function(t,e,n,r){if(this.sent_)throw qk("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),aD(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return aD(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},yD.prototype.getErrorCode=function(){if(!this.sent_)throw qk("cannot .getErrorCode() before sending");return this.errorCode_},yD.prototype.getStatus=function(){if(!this.sent_)throw qk("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},yD.prototype.getResponseText=function(){if(!this.sent_)throw qk("cannot .getResponseText() before sending");return this.xhr_.responseText},yD.prototype.abort=function(){this.xhr_.abort()},yD.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},yD.prototype.addUploadProgressListener=function(t){aD(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},yD.prototype.removeUploadProgressListener=function(t){aD(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},yD);function yD(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=zk.NO_ERROR,this.sendPromise_=new Promise(function(t){e.xhr_.addEventListener("abort",function(){e.errorCode_=zk.ABORT,t(e)}),e.xhr_.addEventListener("error",function(){e.errorCode_=zk.NETWORK_ERROR,t(e)}),e.xhr_.addEventListener("load",function(){t(e)})})}var mD=(gD.prototype.createXhrIo=function(){return new dD},gD);function gD(){}function vD(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(pD())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var bD=(wD.prototype.size=function(){return this.size_},wD.prototype.type=function(){return this.type_},wD.prototype.slice=function(t,e){if(fD(this.data_)){var n=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,t,e);return null===n?null:new wD(n)}return new wD(new Uint8Array(this.data_.buffer,t,e-t),!0)},wD.getBlob=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(pD()){var n=t.map(function(t){return t instanceof wD?t.data_:t});return new wD(vD.apply(null,n))}var r=t.map(function(t){return hD(t)?Kk(Bk.RAW,t).data:t.data_}),i=0;r.forEach(function(t){i+=t.byteLength});var o=new Uint8Array(i),a=0;return r.forEach(function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]}),new wD(o,!0)},wD.prototype.uploadData=function(){return this.data_},wD);function wD(t,e){var n=0,r="";fD(t)?(n=(this.data_=t).size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}var _D=(Object.defineProperty(TD.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(TD.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),TD.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},TD.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},TD.makeFromBucketSpec=function(e){var t;try{t=TD.makeFromUrl(e)}catch(t){return new TD(e,"")}if(""===t.path)return t;throw function(t){return new Dk(Ok.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}(e)},TD.makeFromUrl=function(t){for(var e=null,n="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+n+"(/(.*))?$","i"),i=Ak.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/"+n+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],a=0;a<o.length;a++){var s=o[a],u=s.regex.exec(t);if(u){var c=u[s.indices.bucket],h=u[s.indices.path];e=new TD(c,h=h||""),s.postModify(e);break}}if(null==e)throw function(t){return new Dk(Ok.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return e},TD);function TD(t,e){this.bucket=t,this.path_=e}function ED(t){var e;try{e=JSON.parse(t)}catch(t){return null}return function(t){return cD(t)&&!Array.isArray(t)}(e)?e:null}function SD(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function ID(t){return"https://"+Ak+"/v0"+t}function CD(t){var e=encodeURIComponent,n="?";for(var r in t){if(t.hasOwnProperty(r))n=n+(e(r)+"="+e(t[r]))+"&"}return n=n.slice(0,-1)}function ND(t,e){return e}var AD=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||ND},kD=null;function DD(){if(kD)return kD;var t=[];t.push(new AD("bucket")),t.push(new AD("generation")),t.push(new AD("metageneration")),t.push(new AD("name","fullPath",!0));var e=new AD("name");e.xform=function(t,e){return function(t){return!hD(t)||t.length<2?t:SD(t)}(e)},t.push(e);var n=new AD("size");return n.xform=function(t,e){return aD(e)?Number(e):e},t.push(n),t.push(new AD("timeCreated")),t.push(new AD("updated")),t.push(new AD("md5Hash",null,!0)),t.push(new AD("cacheControl",null,!0)),t.push(new AD("contentDisposition",null,!0)),t.push(new AD("contentEncoding",null,!0)),t.push(new AD("contentLanguage",null,!0)),t.push(new AD("contentType",null,!0)),t.push(new AD("metadata","customMetadata",!0)),kD=t}function RD(r,i){Object.defineProperty(r,"ref",{get:function(){var t=r.bucket,e=r.fullPath,n=new _D(t,e);return i.makeStorageReference(n)}})}function OD(t,e,n){var r=ED(e);return null===r?null:function(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return RD(r,t),r}(t,r,n)}function PD(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function MD(t){if(!cD(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!cD(n))throw"Expected object for 'customMetadata' mapping."}else if(cD(r=n)&&null!==r)throw"Mapping for '"+e+"' cannot be an object."}var r}var LD="maxResults",xD=1e3,FD="pageToken",UD="prefixes",VD="items";function qD(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new Dk(Ok.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+kk+"' property when initializing the app?");if(e[UD])for(var i=0,o=e[UD];i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new _D(r,a));n.prefixes.push(s)}if(e[VD])for(var u=0,c=e[VD];u<c.length;u++){var h=c[u];s=t.makeStorageReference(new _D(r,h.name));n.items.push(s)}return n}function BD(t){if(!cD(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===LD){if(!lD(n=t[LD])||!Number.isInteger(n)||t[LD]<=0)throw"Expected maxResults to be a positive number.";if(1e3<t[LD])throw"Expected maxResults to be less than or equal to "+xD+"."}else{if(e!==FD)throw"Unknown option: "+e;if(t[FD]&&!hD(t[FD]))throw"Expected pageToken to be string."}var n}var jD=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function WD(t){if(!t)throw Mk()}function KD(r,i){return function(t,e){var n=OD(r,e,i);return WD(null!==n),n}}function QD(r){return function(t,e){var n=function(t,e){var n=ED(e);return null===n?null:qD(t,n)}(r,e);return WD(null!==n),n}}function HD(r,i){return function(t,e){var n=OD(r,e,i);return WD(null!==n),function(r,t){var e=ED(t);if(null===e)return null;if(!hD(e.downloadTokens))return null;var n=e.downloadTokens;if(0===n.length)return null;var i=encodeURIComponent;return n.split(",").map(function(t){var e=r.bucket,n=r.fullPath;return ID("/b/"+i(e)+"/o/"+i(n))+CD({alt:"media",token:t})})[0]}(n,e)}}function GD(r){return function(t,e){var n;return(n=401===t.getStatus()?new Dk(Ok.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?function(t){return new Dk(Ok.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(r.bucket):403===t.getStatus()?function(t){return new Dk(Ok.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}(r.path):e).setServerResponseProp(e.serverResponseProp()),n}}function zD(r){var i=GD(r);return function(t,e){var n=i(t,e);return 404===t.getStatus()&&(n=function(t){return new Dk(Ok.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}(r.path)),n.setServerResponseProp(e.serverResponseProp()),n}}function YD(t,e,n){var r=ID(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new jD(r,"GET",KD(t,n),i);return o.errorHandler=zD(e),o}function XD(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}function JD(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};var s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=XD(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+PD(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=bD.getBlob(c,r,h);if(null===l)throw xk();var f={name:u.fullPath},p=ID(o),d=t.maxUploadRetryTime(),y=new jD(p,"POST",KD(t,n),d);return y.urlParams=f,y.headers=a,y.body=l.uploadData(),y.errorHandler=GD(e),y}var $D=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function ZD(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){WD(!1)}return WD(!!n&&-1!==(e||["active"]).indexOf(n)),n}function tR(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=XD(e,r,i),s={name:a.fullPath},u=ID(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},h=PD(a,n),l=t.maxUploadRetryTime();var f=new jD(u,"POST",function(t){var e;ZD(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){WD(!1)}return WD(hD(e)),e},l);return f.urlParams=s,f.headers=c,f.body=h,f.errorHandler=GD(e),f}function eR(t,e,n,i){var r=t.maxUploadRetryTime(),o=new jD(n,"POST",function(t){var e=ZD(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){WD(!1)}n||WD(!1);var r=Number(n);return WD(!isNaN(r)),new $D(r,i.size(),"final"===e)},r);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=GD(e),o}function nR(t,a,e,s,n,u,r,i){var c=new $D(0,0);if(r?(c.current=r.current,c.total=r.total):(c.current=0,c.total=s.size()),s.size()!==c.total)throw new Dk(Ok.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var o=c.total-c.current,h=o;0<n&&(h=Math.min(h,n));var l=c.current,f=l+h,p={"X-Goog-Upload-Command":h===o?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},d=s.slice(l,f);if(null===d)throw xk();var y=a.maxUploadRetryTime(),m=new jD(e,"POST",function(t,e){var n,r=ZD(t,["active","final"]),i=c.current+h,o=s.size();return n="final"===r?KD(a,u)(t,e):null,new $D(i,o,"final"===r,n)},y);return m.headers=p,m.body=d.uploadData(),m.progressCallback=i||null,m.errorHandler=GD(t),m}var rR=function(t,e,n){if(uD(t)||aD(e)||aD(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},iR=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function oR(e,t,n){for(var r=t.length,i=t.length,o=0;o<t.length;o++)if(t[o].optional){r=o;break}if(!(r<=n.length&&n.length<=i))throw function(t,e,n,r){var i,o;return o=t===e?1===(i=t)?"argument":"arguments":(i="between "+t+" and "+e,"arguments"),new Dk(Ok.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+n+"`: Expected "+i+" "+o+", received "+r+".")}(r,i,e,n.length);for(o=0;o<n.length;o++)try{t[o].validator(n[o])}catch(t){throw t instanceof Error?Fk(o,e,t.message):Fk(o,e,t)}}var aR=function(e,t){var n=this;this.validator=function(t){n.optional&&!sD(t)||e(t)},this.optional=!!t};function sR(t,e){function n(t){if(!hD(t))throw"Expected string."}var r;return r=t?function(e,n){return function(t){e(t),n(t)}}(n,t):n,new aR(r,e)}function uR(){return new aR(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||pD()&&t instanceof Blob))throw"Expected Blob or File."})}function cR(t){return new aR(MD,t)}function hR(){return new aR(function(t){if(!(lD(t)&&0<=t))throw"Expected a number 0 or greater."})}function lR(e,t){return new aR(function(t){if(!(null===t||aD(t)&&t instanceof Object))throw"Expected an Object.";null!=e&&e(t)},t)}function fR(t){return new aR(function(t){if(!(null===t||uD(t)))throw"Expected a Function."},t)}function pR(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Promise.resolve().then(function(){return n.apply(void 0,t)})}}var dR=(yR.prototype.makeProgressCallback_=function(){var e=this,n=this.transferred_;return function(t){return e.updateProgress_(n+t)}},yR.prototype.shouldDoResumable_=function(t){return 262144<t.size()},yR.prototype.start_=function(){this.state_===Jk&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},yR.prototype.resolveToken_=function(e){var n=this;this.authWrapper_.getAuthToken().then(function(t){switch(n.state_){case Jk:e(t);break;case eD:n.transition_(nD);break;case $k:n.transition_(Zk)}})},yR.prototype.createResumable_=function(){var r=this;this.resolveToken_(function(t){var e=tR(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.uploadUrl_=t,r.needToFetchStatus_=!1,r.completeTransitions_()},r.errorHandler_)})},yR.prototype.fetchStatus_=function(){var r=this,i=this.uploadUrl_;this.resolveToken_(function(t){var e=eR(r.authWrapper_,r.location_,i,r.blob_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){t=t,r.request_=null,r.updateProgress_(t.current),r.needToFetchStatus_=!1,t.finalized&&(r.needToFetchMetadata_=!0),r.completeTransitions_()},r.errorHandler_)})},yR.prototype.continueUpload_=function(){var r=this,i=262144*this.chunkMultiplier_,o=new $D(this.transferred_,this.blob_.size()),a=this.uploadUrl_;this.resolveToken_(function(t){var e;try{e=nR(r.location_,r.authWrapper_,a,r.blob_,i,r.mappings_,o,r.makeProgressCallback_())}catch(t){return r.error_=t,void r.transition_(rD)}var n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.increaseMultiplier_(),r.request_=null,r.updateProgress_(t.current),t.finalized?(r.metadata_=t.metadata,r.transition_(tD)):r.completeTransitions_()},r.errorHandler_)})},yR.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},yR.prototype.fetchMetadata_=function(){var r=this;this.resolveToken_(function(t){var e=YD(r.authWrapper_,r.location_,r.mappings_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.transition_(tD)},r.metadataErrorHandler_)})},yR.prototype.oneShotUpload_=function(){var r=this;this.resolveToken_(function(t){var e=JD(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.updateProgress_(r.blob_.size()),r.transition_(tD)},r.errorHandler_)})},yR.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},yR.prototype.transition_=function(t){if(this.state_!==t)switch(t){case eD:case $k:this.state_=t,null!==this.request_&&this.request_.cancel();break;case Jk:var e=this.state_===Zk;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case Zk:this.state_=t,this.notifyObservers_();break;case nD:this.error_=Lk(),this.state_=t,this.notifyObservers_();break;case rD:case tD:this.state_=t,this.notifyObservers_()}},yR.prototype.completeTransitions_=function(){switch(this.state_){case $k:this.transition_(Zk);break;case eD:this.transition_(nD);break;case Jk:this.start_()}},Object.defineProperty(yR.prototype,"snapshot",{get:function(){var t=oD(this.state_);return new iR(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),yR.prototype.on=function(t,e,n,o){var r="Expected a function or an Object with one of `next`, `error`, `complete` properties.",i=fR(!0).validator,a=lR(null,!0).validator;function s(t){try{return void i(t)}catch(t){}try{if(a(t),!(sD(t.next)||sD(t.error)||sD(t.complete)))throw"";return}catch(t){throw r}}oR("on",[sR(function(){if(t!==Xk.STATE_CHANGED)throw"Expected one of the event types: ["+Xk.STATE_CHANGED+"]."}),lR(s,!0),fR(!0),fR(!0)],arguments);var u=this;function c(i){return function(t,e,n){null!==i&&oR("on",i,arguments);var r=new rR(t,e,o);return u.addObserver_(r),function(){u.removeObserver_(r)}}}var h=[lR(function(t){if(null===t)throw r;s(t)}),fR(!0),fR(!0)];return sD(e)||sD(n)||sD(o)?c(null)(e,n,o):c(h)},yR.prototype.then=function(t,e){return this.promise_.then(t,e)},yR.prototype.catch=function(t){return this.then(null,t)},yR.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},yR.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},yR.prototype.notifyObservers_=function(){var e=this;this.finishPromise_(),this.observers_.slice().forEach(function(t){e.notifyObserver_(t)})},yR.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(oD(this.state_)){case iD.SUCCESS:pR(this.resolve_.bind(null,this.snapshot))();break;case iD.CANCELED:case iD.ERROR:pR(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},yR.prototype.notifyObserver_=function(t){switch(oD(this.state_)){case iD.RUNNING:case iD.PAUSED:t.next&&pR(t.next.bind(t,this.snapshot))();break;case iD.SUCCESS:t.complete&&pR(t.complete.bind(t))();break;case iD.CANCELED:case iD.ERROR:t.error&&pR(t.error.bind(t,this.error_))();break;default:t.error&&pR(t.error.bind(t,this.error_))()}},yR.prototype.resume=function(){oR("resume",[],arguments);var t=this.state_===Zk||this.state_===$k;return t&&this.transition_(Jk),t},yR.prototype.pause=function(){oR("pause",[],arguments);var t=this.state_===Jk;return t&&this.transition_($k),t},yR.prototype.cancel=function(){oR("cancel",[],arguments);var t=this.state_===Jk||this.state_===$k;return t&&this.transition_(eD),t},yR);function yR(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=Jk,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(Ok.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(rD))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(Ok.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(rD))},this.promise_=new Promise(function(t,e){a.resolve_=t,a.reject_=e,a.start_()}),this.promise_.then(null,function(){})}var mR=(gR.prototype.toString=function(){return oR("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},gR.prototype.newRef=function(t,e){return new gR(t,e)},gR.prototype.mappings=function(){return DD()},gR.prototype.child=function(t){oR("child",[sR()],arguments);var e=function(t,e){var n=e.split("/").filter(function(t){return 0<t.length}).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new _D(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(gR.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new _D(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(gR.prototype,"root",{get:function(){var t=new _D(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(gR.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(gR.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(gR.prototype,"name",{get:function(){return SD(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(gR.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),gR.prototype.put=function(t,e){return void 0===e&&(e=null),oR("put",[uR(),cR(!0)],arguments),this.throwIfRoot_("put"),new dR(this,this.authWrapper,this.location,this.mappings(),new bD(t),e)},gR.prototype.putString=function(t,e,n){void 0===e&&(e=Bk.RAW),oR("putString",[sR(),sR(jk,!0),cR(!0)],arguments),this.throwIfRoot_("putString");var r=Kk(e,t),i=Object.assign({},n);return!aD(i.contentType)&&aD(r.contentType)&&(i.contentType=r.contentType),new dR(this,this.authWrapper,this.location,this.mappings(),new bD(r.data,!0),i)},gR.prototype.delete=function(){var n=this;return oR("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e){var n=ID(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new jD(n,"DELETE",function(t,e){},r);return i.successCodes=[200,204],i.errorHandler=zD(e),i}(n.authWrapper,n.location);return n.authWrapper.makeRequest(e,t).getPromise()})},gR.prototype.listAll=function(){oR("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then(function(){return t})},gR.prototype.listAllHelper=function(o,a){return aa(this,void 0,void 0,function(){var e,n,r,i;return sa(this,function(t){switch(t.label){case 0:return e={pageToken:a},[4,this.list(e)];case 1:return n=t.sent(),(r=o.prefixes).push.apply(r,n.prefixes),(i=o.items).push.apply(i,n.items),null==n.nextPageToken?[3,3]:[4,this.listAllHelper(o,n.nextPageToken)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},gR.prototype.list=function(r){oR("list",[function(t){return new aR(BD,t)}(!0)],arguments);var i=this;return this.authWrapper.getAuthToken().then(function(t){var e=r||{},n=function(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",n&&0<n.length&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=ID(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new jD(a,"GET",QD(t),s);return u.urlParams=o,u.errorHandler=GD(e),u}(i.authWrapper,i.location,"/",e.pageToken,e.maxResults);return i.authWrapper.makeRequest(n,t).getPromise()})},gR.prototype.getMetadata=function(){var n=this;return oR("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=YD(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise()})},gR.prototype.updateMetadata=function(n){var r=this;return oR("updateMetadata",[cR()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e,n,r){var i=ID(e.fullServerUrl()),o=PD(n,r),a=t.maxOperationRetryTime(),s=new jD(i,"PATCH",KD(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=zD(e),s}(r.authWrapper,r.location,n,r.mappings());return r.authWrapper.makeRequest(e,t).getPromise()})},gR.prototype.getDownloadURL=function(){var n=this;return oR("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e,n){var r=ID(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new jD(r,"GET",HD(t,n),i);return o.errorHandler=zD(e),o}(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise().then(function(t){if(null===t)throw new Dk(Ok.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},gR.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new Dk(Ok.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},gR);function gR(t,e){this.authWrapper=t,this.location=e instanceof _D?e:_D.makeFromUrl(e)}var vR=(bR.prototype.getPromise=function(){return this.promise_},bR.prototype.cancel=function(t){},bR);function bR(t){this.promise_=Promise.reject(t)}var wR=(_R.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then(function(){return e.map.delete(n)},function(){return e.map.delete(n)})},_R.prototype.clear=function(){this.map.forEach(function(t){t&&t.cancel(!0)}),this.map.clear()},_R);function _R(){this.map=new Map,this.id=-9007199254740991}var TR=(ER.extractBucket_=function(t){var e=t[kk]||null;return null==e?null:_D.makeFromBucketSpec(e).bucket},ER.prototype.getAuthToken=function(){return null!==this.app_&&aD(this.app_.INTERNAL)&&aD(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(){return null}):Promise.resolve(null)},ER.prototype.bucket=function(){if(this.deleted_)throw Uk();return this.bucket_},ER.prototype.service=function(){return this.service_},ER.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},ER.prototype.makeRequest=function(t,e){if(this.deleted_)return new vR(Uk());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},ER.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},ER.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},ER.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},ER.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},ER.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},ER);function ER(t,e,n,r,i){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var o=this.app_.options;aD(o)&&(this.bucket_=ER.extractBucket_(o))}this.storageRefMaker_=e,this.requestMaker_=n,this.pool_=i,this.service_=r,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e5,this.requestMap_=new wR}var SR=(IR.prototype.start_=function(){var s=this;function t(t,e){var n,r=s.resolve_,i=s.reject_,o=e.xhr;if(e.wasSuccessCode)try{var a=s.callback_(o,o.getResponseText());sD(a)?r(a):r()}catch(t){i(t)}else null!==o?((n=Mk()).setServerResponseProp(o.getResponseText()),s.errorCallback_?i(s.errorCallback_(o,n)):i(n)):e.canceled?i(n=s.appDelete_?Uk():Lk()):i(n=new Dk(Ok.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?t(0,new CR(!1,null,!0)):this.backoffId_=function(e,n,t){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];u||(u=!0,n.apply(null,t))}function h(t){i=setTimeout(function(){i=null,e(l,s())},t)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];u||(t?c.call.apply(c,la([null,t],e)):s()||o?c.call.apply(c,la([null,t],e)):(r<64&&(r*=2),h(1===a?(a=2,0):1e3*(r+Math.random()))))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout(function(){p(o=!0)},t),p}(function(o,t){if(t)o(!1,new CR(!1,null,!0));else{var e=s.pool_.createXhrIo();s.pendingXhr_=e,null!==s.progressCallback_&&e.addUploadProgressListener(a),e.send(s.url_,s.method_,s.body_,s.headers_).then(function(t){null!==s.progressCallback_&&t.removeUploadProgressListener(a),s.pendingXhr_=null;var e=(t=t).getErrorCode()===zk.NO_ERROR,n=t.getStatus();if(e&&!s.isRetryStatusCode_(n)){var r=-1!==s.successCodes_.indexOf(n);o(!0,new CR(r,t))}else{var i=t.getErrorCode()===zk.ABORT;o(!1,new CR(!1,null,i))}})}function a(t){var e=t.loaded,n=t.lengthComputable?t.total:-1;null!==s.progressCallback_&&s.progressCallback_(e,n)}},t,this.timeout_)},IR.prototype.getPromise=function(){return this.promise_},IR.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingXhr_&&this.pendingXhr_.abort()},IR.prototype.isRetryStatusCode_=function(t){var e=500<=t&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},IR);function IR(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}var CR=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function NR(t,e,n){var r=CD(t.urlParams),i=t.url+r,o=Object.assign({},t.headers);return function(t,e){null!==e&&0<e.length&&(t.Authorization="Firebase "+e)}(o,e),function(t){var e=void 0!==fl?fl.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(o),new SR(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var AR=(kR.prototype.ref=function(t){if(oR("ref",[sR(function(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new mR(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},kR.prototype.refFromURL=function(t){return oR("refFromURL",[sR(function(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{_D.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new mR(this.authWrapper_,t)},Object.defineProperty(kR.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),kR.prototype.setMaxUploadRetryTime=function(t){oR("setMaxUploadRetryTime",[hR()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},kR.prototype.setMaxOperationRetryTime=function(t){oR("setMaxOperationRetryTime",[hR()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(kR.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(kR.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),kR);function kR(t,e,n){if(this.bucket_=null,this.authWrapper_=new TR(t,function(t,e){return new mR(t,e)},NR,this,e),this.app_=t,null!=n)this.bucket_=_D.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new _D(r,""))}this.internals_=new DR(this)}var DR=(RR.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},RR);function RR(t){this.service_=t}var OR;function PR(t,e,n){return new AR(t,new mD,n)}OR={TaskState:iD,TaskEvent:Xk,StringFormat:Bk,Storage:AR,Reference:mR},fl.INTERNAL.registerService("storage",PR,OR,void 0,!0);var MR,LR,xR,FR,UR="0.2.24",VR="FB-PERF-TRACE-MEASURE",qR="@firebase/performance/config",BR="@firebase/performance/configexpire",jR="Performance",WR=((MR={})["trace started"]="Trace {$traceName} was started before.",MR["trace stopped"]="Trace {$traceName} is not running.",MR["no window"]="Window is not available.",MR["no app id"]="App id is not available.",MR["no project id"]="Project id is not available.",MR["no api key"]="Api key is not available.",MR["invalid cc log"]="Attempted to queue invalid cc event",MR["FB not default"]="Performance can only start when Firebase app instance is the default one.",MR["RC response not ok"]="RC response is not ok",MR["invalid attribute name"]="Attribute name {$attributeName} is invalid.",MR["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",MR["invalide custom metric name"]="Custom metric name {$customMetricName} is invalid",MR),KR=new ka("performance",jR,WR),QR=(HR.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},HR.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},HR.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},HR.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},HR.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},HR.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},HR.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},HR.prototype.setupObserver=function(t,i){this.PerformanceObserver&&new this.PerformanceObserver(function(t){for(var e=0,n=t.getEntries();e<n.length;e++){var r=n[e];i(r)}}).observe({entryTypes:[t]})},HR.getInstance=function(){return void 0===LR&&(LR=new HR(xR)),LR},HR);function HR(t){if(!t)throw KR.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}var GR,zR,YR,XR=(JR.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw KR.create("no app id");return t},JR.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw KR.create("no project id");return t},JR.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw KR.create("no api key");return t},JR.getInstance=function(){return void 0===FR&&(FR=new JR),FR},JR);function JR(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}function $R(){return GR}(YR=zR=zR||{})[YR.UNKNOWN=0]="UNKNOWN",YR[YR.VISIBLE=1]="VISIBLE",YR[YR.HIDDEN=2]="HIDDEN",YR[YR.PRERENDER=3]="PRERENDER",YR[YR.UNLOADED=4]="UNLOADED";var ZR=["firebase_","google_","ga_"],tO=new RegExp("^[a-zA-Z]\\w*$");function eO(){switch(QR.getInstance().document.visibilityState){case"visible":return zR.VISIBLE;case"hidden":return zR.HIDDEN;case"prerender":return zR.PRERENDER;default:return zR.UNKNOWN}}var nO=new ns(jR);nO.logLevel=Xa.INFO;var rO="0.0.1",iO={loggingEnabled:!0},oO="FIREBASE_INSTALLATIONS_AUTH";function aO(t){var e=function(){var t=QR.getInstance().localStorage,e=t.getItem(BR);if(!e||!function(t){return Number(t)>Date.now()}(e))return;var n=t.getItem(qR);if(!n)return;try{return JSON.parse(n)}catch(t){return}}();return e?(uO(e),Promise.resolve()):function(r){return function(){var t=XR.getInstance().firebaseAppInstance.installations().getToken();return t.then(function(t){}),t}().then(function(t){var e="https://firebaseremoteconfig.googleapis.com/v1/projects/"+XR.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+XR.getInstance().getApiKey(),n=new Request(e,{method:"POST",headers:{Authorization:oO+" "+t},body:JSON.stringify({app_instance_id:r,app_instance_id_token:t,app_id:XR.getInstance().getAppId(),app_version:UR,sdk_version:rO})});return fetch(n).then(function(t){if(t.ok)return t.json();throw KR.create("RC response not ok")})}).catch(function(){nO.info(sO)})}(t).then(function(t){return uO(t)}).then(function(t){return function(t){if(!t)return;var e=QR.getInstance().localStorage;e.setItem(qR,JSON.stringify(t)),e.setItem(BR,String(Date.now()+60*XR.getInstance().configTimeToLive*60*1e3))}(t)},function(){})}var sO="Could not fetch config, will use default configs";function uO(t){if(!t)return t;var e=XR.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=iO.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=cO(e.tracesSamplingRate),e.logNetworkAfterSampling=cO(e.networkRequestsSamplingRate),t}function cO(t){return Math.random()<=t}var hO,lO=1;function fO(){return lO=2,hO=hO||function(){var n=QR.getInstance().document;return new Promise(function(t){if(n&&"complete"!==n.readyState){var e=function(){"complete"===n.readyState&&(n.removeEventListener("readystatechange",e),t())};n.addEventListener("readystatechange",e)}else t()})}().then(function(){return function(){var t=XR.getInstance().firebaseAppInstance.installations().getId();return t.then(function(t){GR=t}),t}()}).then(function(t){return aO(t)}).then(function(){return pO()},function(){return pO()})}function pO(){lO=3}var dO,yO=1e4,mO=3,gO=mO,vO=[];function bO(i){return function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];!function(t){if(!t.eventTime||!t.message)throw KR.create("invalid cc log");vO=la(vO,[t])}({message:i.apply(void 0,n),eventTime:Date.now()})}}function wO(){if(dO)return dO;var t=bO(EO);return(dO=new ns("@firebase/performance/cc")).logHandler=t,dO}function _O(t){var e=XR.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&QR.getInstance().requiredApisAvailable()&&(t.isAuto&&eO()!==zR.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===lO?TO(t):fO().then(function(){return TO(t)},function(){return TO(t)})))}function TO(t){$R()&&setTimeout(function(){return wO().log(t,1)},0)}function EO(t,e){return 0===e?function(t){var e={url:t.url,http_method:t.httpMethod||0,http_response_code:200,response_payload_bytes:t.responsePayloadBytes,client_start_time_us:t.startTimeUs,time_to_response_initiated_us:t.timeToResponseInitiatedUs,time_to_response_completed_us:t.timeToResponseCompletedUs},n={application_info:SO(),network_request_metric:e};return JSON.stringify(n)}(t):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=IO(t.counters));var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=IO(n));var r={application_info:SO(),trace_metric:e};return JSON.stringify(r)}(t)}function SO(){return{google_app_id:XR.getInstance().getAppId(),app_instance_id:$R(),web_app_info:{sdk_version:UR,page_url:QR.getInstance().getUrl(),service_worker_status:function(){var t=QR.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}(),visibility_state:eO(),effective_connection_type:function(){var t=QR.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}function IO(e){return Object.keys(e).map(function(t){return{key:t,value:e[t]}})}!function r(t){setTimeout(function(){if(0!==gO){if(!vO.length)return r(yO);var t=la(vO);vO=[];var e=t.map(function(t){return{source_extension_json:t.message,event_time_ms:String(t.eventTime)}}),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:XR.getInstance().logSource,log_event:e};fetch(XR.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(n)}).then(function(t){return t.ok||nO.info("Call to Firebase backend failed."),t.json()}).then(function(t){var e=Number(t.next_request_wait_millis),n=isNaN(e)?yO:Math.max(yO,e);gO=mO,r(n)}).catch(function(){vO=la(t,vO),gO--,nO.info("Tries left: "+gO+"."),r(yO)})}},t)}(5500);var CO=["_fp","_fcp","_fid"];var NO=(AO.prototype.start=function(){if(1!==this.state)throw KR.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},AO.prototype.stop=function(){if(2!==this.state)throw KR.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),_O(this)},AO.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=oa({},n.attributes)),n&&n.metrics)for(var r=0,i=Object.keys(n.metrics);r<i.length;r++){var o=i[r];isNaN(Number(n.metrics[o]))||(this.counters[o]=Number(Math.floor(n.metrics[o])))}_O(this)},AO.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&this.putMetric(t,0),this.counters[t]+=e},AO.prototype.putMetric=function(t,e){if(!function(t,e){return!(0===t.length||100<t.length)&&(e&&e.startsWith("_wt_")&&-1<CO.indexOf(t)||!t.startsWith("_"))}(t,this.name))throw KR.create("invalide custom metric name",{customMetricName:t});this.counters[t]=e},AO.prototype.getMetric=function(t){return this.counters[t]||0},AO.prototype.putAttribute=function(t,e){var n=function(e){return!(0===e.length||40<e.length||ZR.some(function(t){return e.startsWith(t)})||!e.match(tO))}(t),r=function(t){return 0!==t.length&&t.length<=100}(e);if(n&&r)this.customAttributes[t]=e;else{if(!n)throw KR.create("invalid attribute name",{attributeName:t});if(!r)throw KR.create("invalid attribute value",{attributeValue:e})}},AO.prototype.getAttribute=function(t){return this.customAttributes[t]},AO.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},AO.prototype.getAttributes=function(){return oa({},this.customAttributes)},AO.prototype.setStartTime=function(t){this.startTimeUs=t},AO.prototype.setDuration=function(t){this.durationUs=t},AO.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},AO.createOobTrace=function(t,e,n){var r=QR.getInstance().getUrl();if(r){var i=new AO("_wt_"+r,!0),o=Math.floor(1e3*QR.getInstance().getTimeOrigin());if(i.setStartTime(o),t&&t[0]&&(i.setDuration(Math.floor(1e3*t[0].duration)),i.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),i.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),i.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),e){var a=e.find(function(t){return"first-paint"===t.name});a&&a.startTime&&i.putMetric("_fp",Math.floor(1e3*a.startTime));var s=e.find(function(t){return"first-contentful-paint"===t.name});s&&s.startTime&&i.putMetric("_fcp",Math.floor(1e3*s.startTime)),n&&i.putMetric("_fid",Math.floor(1e3*n))}_O(i)}},AO.createUserTimingTrace=function(t){_O(new AO(t,!1,t))},AO);function AO(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=QR.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||VR+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}function kO(t){var e=t;if(e&&void 0!==e.responseStart){var n=QR.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=XR.getInstance();e.instrumentationEnabled&&t.url!==e.logEndPointUrl.split("?")[0]&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout(function(){return wO().log(t,0)},0)}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}var DO=5e3;function RO(){$R()&&(setTimeout(function(){return function(){var t=QR.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout(function(){NO.createOobTrace(e,n),r=void 0},DO);t.onFirstInputDelay(function(t){r&&(clearTimeout(r),NO.createOobTrace(e,n,t))})}else NO.createOobTrace(e,n)}()},0),setTimeout(function(){return function(){for(var t=QR.getInstance(),e=t.getEntriesByType("resource"),n=0,r=e;n<r.length;n++){kO(r[n])}t.setupObserver("resource",kO)}()},0),setTimeout(function(){return function(){for(var t=QR.getInstance(),e=t.getEntriesByType("measure"),n=0,r=e;n<r.length;n++){OO(r[n])}t.setupObserver("measure",OO)}()},0))}function OO(t){var e=t.name;e.substring(0,VR.length)!==VR&&NO.createUserTimingTrace(e)}var PO=(MO.prototype.trace=function(t){return new NO(t)},Object.defineProperty(MO.prototype,"instrumentationEnabled",{get:function(){return XR.getInstance().instrumentationEnabled},set:function(t){XR.getInstance().instrumentationEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(MO.prototype,"dataCollectionEnabled",{get:function(){return XR.getInstance().dataCollectionEnabled},set:function(t){XR.getInstance().dataCollectionEnabled=t},enumerable:!0,configurable:!0}),MO);function MO(t){this.app=t,QR.getInstance().requiredApisAvailable()?fO().then(RO,RO):nO.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}fl.INTERNAL.registerService("performance",function(t){if("[DEFAULT]"!==t.name)throw KR.create("FB not default");if("undefined"==typeof window)throw KR.create("no window");return function(t){xR=t}(window),XR.getInstance().firebaseAppInstance=t,new PO(t)},{});var LO,xO,FO,UO,VO,qO="measurementId",BO="firebase_id",jO="origin";function WO(t){return Array.isArray(window[t])}function KO(t,n,e){var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];window[n].push(arguments)};return window[e]&&"function"==typeof window[e]&&(r=window[e]),window[e]=function(f,p){return function(t,e,n){if(t===LO.EVENT){var r=[];if(n&&n.send_to){var i=n.send_to;Array.isArray(i)||(i=[i]);for(var o=0,a=i;o<a.length;o++){var s=a[o],u=p[s];if(!u){r=[];break}r.push(u)}}if(0===r.length)for(var c=0,h=Object.values(p);c<h.length;c++){var l=h[c];r.push(l)}Promise.all(r).then(function(){return f(LO.EVENT,e,n||{})}).catch(function(t){return console.error(t)})}else if(t===LO.CONFIG){(p[e]||Promise.resolve()).then(function(){f(LO.CONFIG,e,n)}).catch(function(t){return console.error(t)})}else f(LO.SET,e)}}(r,t),{gtagCore:r,wrappedGtag:window[e]}}(xO=LO=LO||{}).EVENT="event",xO.SET="set",xO.CONFIG="config",(UO=FO=FO||{}).ADD_PAYMENT_INFO="add_payment_info",UO.ADD_TO_CART="add_to_cart",UO.ADD_TO_WISHLIST="add_to_wishlist",UO.BEGIN_CHECKOUT="begin_checkout",UO.CHECKOUT_PROGRESS="checkout_progress",UO.EXCEPTION="exception",UO.GENERATE_LEAD="generate_lead",UO.LOGIN="login",UO.PAGE_VIEW="page_view",UO.PURCHASE="purchase",UO.REFUND="refund",UO.REMOVE_FROM_CART="remove_from_cart",UO.SCREEN_VIEW="screen_view",UO.SEARCH="search",UO.SELECT_CONTENT="select_content",UO.SET_CHECKOUT_OPTION="set_checkout_option",UO.SHARE="share",UO.SIGN_UP="sign_up",UO.TIMING_COMPLETE="timing_complete",UO.VIEW_ITEM="view_item",UO.VIEW_ITEM_LIST="view_item_list",UO.VIEW_PROMOTION="view_promotion",UO.VIEW_SEARCH_RESULTS="view_search_results";var QO,HO,GO=((VO={})["no-ga-id"]='"'+qO+'" field is empty in Firebase config. Firebase Analytics requires this field to contain a valid measurement ID.',VO["already-exists"]="A Firebase Analytics instance with the measurement ID ${id}  already exists. Only one Firebase Analytics instance can be created for each measurement ID.",VO["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",VO),zO=new ka("analytics","Analytics",GO),YO={},XO="dataLayer",JO="gtag",$O=!1;function ZO(t){if($O)throw zO.create("already-initialized");t.dataLayerName&&(XO=t.dataLayerName),t.gtagName&&(JO=t.gtagName)}function tP(t,e){var r=t.options[qO];if(!r)throw zO.create("no-ga-id");if(null!=YO[r])throw zO.create("already-exists",{id:r});if(!$O){WO(XO)||function(t){var e=document.createElement("script");e.src="https://www.googletagmanager.com/gtag/js?l="+t,e.async=!0,document.head.appendChild(e)}(XO),function(t){WO(t)?window[t]:window[t]=[]}(XO);var n=KO(YO,XO,JO),i=n.wrappedGtag,o=n.gtagCore;HO=i,QO=o,$O=!0}YO[r]=function(r,i){return aa(this,void 0,void 0,function(){var e,n;return sa(this,function(t){switch(t.label){case 0:return[4,r.installations().getId()];case 1:return e=t.sent(),i("js",new Date),i(LO.CONFIG,r.options[qO],((n={})[BO]=e,n[jO]="firebase",n.update=!0,n)),[2]}})})}(t,QO);var a={app:t,logEvent:function(t,e,n){return function(t,e,n,r,i){var o=r||{};i&&i.global||(o=oa(oa({},r),{send_to:e})),t(LO.EVENT,n,o||{})}(HO,r,t,e,n)},setCurrentScreen:function(t,e){return function(t,e,n,r){r&&r.global?t(LO.SET,{screen_name:n}):t(LO.CONFIG,e,{update:!0,screen_name:n})}(HO,r,t,e)},setUserId:function(t,e){return function(t,e,n,r){r&&r.global?t(LO.SET,{user_id:n}):t(LO.CONFIG,e,{update:!0,user_id:n})}(HO,r,t,e)},setUserProperties:function(t,e){return function(t,e,n,r){if(r&&r.global){for(var i={},o=0,a=Object.keys(n);o<a.length;o++){var s=a[o];i["user_properties."+s]=n[s]}t(LO.SET,i)}else t(LO.CONFIG,e,{update:!0,user_properties:n})}(HO,r,t,e)},setAnalyticsCollectionEnabled:function(t){return function(t,e){window["ga-disable-"+t]=!e}(r,t)}};return e({INTERNAL:{analytics:{logEvent:a.logEvent}}}),a}fl.INTERNAL.registerService("analytics",tP,{settings:ZO,EventName:FO},void 0,!1);var eP,nP=(rP.prototype.isCachedDataFresh=function(t,e){if(!e)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-e,r=n<=t;return this.logger.debug("Config fetch cache check. Cache age millis: "+n+". Cache max age millis (minimumFetchIntervalMillis setting): "+t+". Is cache hit: "+r+"."),r},rP.prototype.fetch=function(a){return aa(this,void 0,void 0,function(){var e,n,r,i,o;return sa(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()])];case 1:return e=t.sent(),n=e[0],(r=e[1])&&this.isCachedDataFresh(a.cacheMaxAgeMillis,n)?[2,r]:(a.eTag=r&&r.eTag,[4,this.client.fetch(a)]);case 2:return i=t.sent(),o=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())],200===i.status&&o.push(this.storage.setLastSuccessfulFetchResponse(i)),[4,Promise.all(o)];case 3:return t.sent(),[2,i]}})})},rP);function rP(t,e,n,r){this.client=t,this.storage=e,this.storageCache=n,this.logger=r}var iP=((eP={})["registration-window"]="Undefined window object. This SDK only supports usage in a browser environment.",eP["registration-project-id"]="Undefined project identifier. Check Firebase app initialization.",eP["registration-api-key"]="Undefined API key. Check Firebase app initialization.",eP["registration-app-id"]="Undefined app identifier. Check Firebase app initialization.",eP["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",eP["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",eP["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",eP["storage-delete"]="Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",eP["fetch-client-network"]="Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",eP["fetch-timeout"]='The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',eP["fetch-throttle"]='The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',eP["fetch-client-parse"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",eP["fetch-status"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",eP),oP=new ka("remoteconfig","Remote Config",iP);var aP=(sP.prototype.fetch=function(w){return aa(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f,p,d,y,m,g,v,b;return sa(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()])];case 1:e=t.sent(),n=e[0],r=e[1],i=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",o=i+"/v1/projects/"+this.projectId+"/namespaces/"+this.namespace+":fetch?key="+this.apiKey,a={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":w.eTag||"*"},s={sdk_version:this.sdkVersion,app_instance_id:n,app_instance_id_token:r,app_id:this.appId,language_code:function(t){return void 0===t&&(t=navigator),t.languages&&t.languages[0]||t.language}()},u={method:"POST",headers:a,body:JSON.stringify(s)},c=fetch(o,u),h=new Promise(function(t,e){w.signal.addEventListener(function(){var t=new Error("The operation was aborted.");t.name="AbortError",e(t)})}),t.label=2;case 2:return t.trys.push([2,5,,6]),[4,Promise.race([c,h])];case 3:return t.sent(),[4,c];case 4:return l=t.sent(),[3,6];case 5:throw f=t.sent(),p="fetch-client-network","AbortError"===f.name&&(p="fetch-timeout"),oP.create(p,{originalErrorMessage:f.message});case 6:if(d=l.status,y=l.headers.get("ETag")||void 0,200!==l.status)return[3,11];v=void 0,t.label=7;case 7:return t.trys.push([7,9,,10]),[4,l.json()];case 8:return v=t.sent(),[3,10];case 9:throw b=t.sent(),oP.create("fetch-client-parse",{originalErrorMessage:b.message});case 10:m=v.entries,g=v.state,t.label=11;case 11:if("INSTANCE_STATE_UNSPECIFIED"===g?d=500:"NO_CHANGE"===g?d=304:"NO_TEMPLATE"!==g&&"EMPTY_CONFIG"!==g||(m={}),304!==d&&200!==d)throw oP.create("fetch-status",{httpStatus:d});return[2,{status:d,eTag:y,config:m}]}})})},sP);function sP(t,e,n,r,i,o){this.firebaseInstallations=t,this.sdkVersion=e,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=o}var uP=(cP.prototype.addEventListener=function(t){this.listeners.push(t)},cP.prototype.abort=function(){this.listeners.forEach(function(t){return t()})},cP);function cP(){this.listeners=[]}var hP=["1","true","t","yes","y","on"],lP=(fP.prototype.asString=function(){return this._value},fP.prototype.asBoolean=function(){return"static"!==this._source&&0<=hP.indexOf(this._value.toLowerCase())},fP.prototype.asNumber=function(){if("static"===this._source)return 0;var t=Number(this._value);return isNaN(t)&&(t=0),t},fP.prototype.getSource=function(){return this._source},fP);function fP(t,e){void 0===e&&(e=""),this._source=t,this._value=e}var pP=(dP.prototype.setLogLevel=function(t){switch(t){case"debug":this._logger.logLevel=Xa.DEBUG;break;case"silent":this._logger.logLevel=Xa.SILENT;break;default:this._logger.logLevel=Xa.ERROR}},Object.defineProperty(dP.prototype,"fetchTimeMillis",{get:function(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1},enumerable:!0,configurable:!0}),Object.defineProperty(dP.prototype,"lastFetchStatus",{get:function(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"},enumerable:!0,configurable:!0}),dP.prototype.activate=function(){return aa(this,void 0,void 0,function(){var e,n,r;return sa(this,function(t){switch(t.label){case 0:return[4,Promise.all([this._storage.getLastSuccessfulFetchResponse(),this._storage.getActiveConfigEtag()])];case 1:return e=t.sent(),n=e[0],r=e[1],n&&n.config&&n.eTag&&n.eTag!==r?[4,Promise.all([this._storageCache.setActiveConfig(n.config),this._storage.setActiveConfigEtag(n.eTag)])]:[2,!1];case 2:return t.sent(),[2,!0]}})})},dP.prototype.ensureInitialized=function(){var t=this;return this._initializePromise||(this._initializePromise=this._storageCache.loadFromStorage().then(function(){t._isInitializationComplete=!0})),this._initializePromise},dP.prototype.fetch=function(){return aa(this,void 0,void 0,function(){var e=this;return sa(this,function(t){return[2,new Promise(function(o,a){return aa(e,void 0,void 0,function(){var e,n,r,i=this;return sa(this,function(t){switch(t.label){case 0:e=new uP,setTimeout(function(){return aa(i,void 0,void 0,function(){return sa(this,function(t){return e.abort(),[2]})})},this.settings.fetchTimeoutMillis),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this._client.fetch({cacheMaxAgeMillis:this.settings.minimumFetchIntervalMillis,signal:e})];case 2:return t.sent(),[4,this._storageCache.setLastFetchStatus("success")];case 3:return t.sent(),o(),[3,6];case 4:return n=t.sent(),r=function(t,e){return t instanceof Na&&-1!==t.code.indexOf(e)}(n,"fetch-throttle")?"throttle":"failure",[4,this._storageCache.setLastFetchStatus(r)];case 5:return t.sent(),a(n),[3,6];case 6:return[2]}})})})]})})},dP.prototype.fetchAndActivate=function(){return aa(this,void 0,void 0,function(){return sa(this,function(t){switch(t.label){case 0:return[4,this.fetch()];case 1:return t.sent(),[2,this.activate()]}})})},dP.prototype.getAll=function(){var n=this;return function(t,e){return void 0===t&&(t={}),void 0===e&&(e={}),Object.keys(oa(oa({},t),e))}(this._storageCache.getActiveConfig(),this.defaultConfig).reduce(function(t,e){return t[e]=n.getValue(e),t},{})},dP.prototype.getBoolean=function(t){return this.getValue(t).asBoolean()},dP.prototype.getNumber=function(t){return this.getValue(t).asNumber()},dP.prototype.getString=function(t){return this.getValue(t).asString()},dP.prototype.getValue=function(t){this._isInitializationComplete||this._logger.debug('A value was requested for key "'+t+'" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.');var e=this._storageCache.getActiveConfig();return e&&void 0!==e[t]?new lP("remote",e[t]):this.defaultConfig&&void 0!==this.defaultConfig[t]?new lP("default",String(this.defaultConfig[t])):(this._logger.debug('Returning static value for key "'+t+'". Define a default or remote value if this is unintentional.'),new lP("static"))},dP);function dP(t,e,n,r,i){this.app=t,this._client=e,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}function yP(t,e){var n=t.target.error||void 0;return oP.create(e,{originalErrorMessage:n&&n.message})}var mP="app_namespace_store",gP="firebase_remote_config",vP=1;var bP=(wP.prototype.getLastFetchStatus=function(){return this.get("last_fetch_status")},wP.prototype.setLastFetchStatus=function(t){return this.set("last_fetch_status",t)},wP.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.get("last_successful_fetch_timestamp_millis")},wP.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.set("last_successful_fetch_timestamp_millis",t)},wP.prototype.getLastSuccessfulFetchResponse=function(){return this.get("last_successful_fetch_response")},wP.prototype.setLastSuccessfulFetchResponse=function(t){return this.set("last_successful_fetch_response",t)},wP.prototype.getActiveConfig=function(){return this.get("active_config")},wP.prototype.setActiveConfig=function(t){return this.set("active_config",t)},wP.prototype.getActiveConfigEtag=function(){return this.get("active_config_etag")},wP.prototype.setActiveConfigEtag=function(t){return this.set("active_config_etag",t)},wP.prototype.getThrottleMetadata=function(){return this.get("throttle_metadata")},wP.prototype.setThrottleMetadata=function(t){return this.set("throttle_metadata",t)},wP.prototype.deleteThrottleMetadata=function(){return this.delete("throttle_metadata")},wP.prototype.get=function(s){return aa(this,void 0,void 0,function(){var o,a=this;return sa(this,function(t){switch(t.label){case 0:return[4,this.openDbPromise];case 1:return o=t.sent(),[2,new Promise(function(n,e){var t=o.transaction([mP],"readonly").objectStore(mP),r=a.createCompositeKey(s);try{var i=t.get(r);i.onerror=function(t){e(yP(t,"storage-get"))},i.onsuccess=function(t){var e=t.target.result;n(e?e.value:void 0)}}catch(t){e(oP.create("storage-get",{originalErrorMessage:t&&t.message}))}})]}})})},wP.prototype.set=function(s,u){return aa(this,void 0,void 0,function(){var o,a=this;return sa(this,function(t){switch(t.label){case 0:return[4,this.openDbPromise];case 1:return o=t.sent(),[2,new Promise(function(t,e){var n=o.transaction([mP],"readwrite").objectStore(mP),r=a.createCompositeKey(s);try{var i=n.put({compositeKey:r,value:u});i.onerror=function(t){e(yP(t,"storage-set"))},i.onsuccess=function(){t()}}catch(t){e(oP.create("storage-set",{originalErrorMessage:t&&t.message}))}})]}})})},wP.prototype.delete=function(s){return aa(this,void 0,void 0,function(){var o,a=this;return sa(this,function(t){switch(t.label){case 0:return[4,this.openDbPromise];case 1:return o=t.sent(),[2,new Promise(function(t,e){var n=o.transaction([mP],"readwrite").objectStore(mP),r=a.createCompositeKey(s);try{var i=n.delete(r);i.onerror=function(t){e(yP(t,"storage-delete"))},i.onsuccess=function(){t()}}catch(t){e(oP.create("storage-delete",{originalErrorMessage:t&&t.message}))}})]}})})},wP.prototype.createCompositeKey=function(t){return[this.appId,this.appName,this.namespace,t].join()},wP);function wP(t,e,n,r){void 0===r&&(r=new Promise(function(e,n){var t=indexedDB.open(gP,vP);t.onerror=function(t){n(yP(t,"storage-open"))},t.onsuccess=function(t){e(t.target.result)},t.onupgradeneeded=function(t){var e=t.target.result;switch(t.oldVersion){case 0:e.createObjectStore(mP,{keyPath:"compositeKey"})}}})),this.appId=t,this.appName=e,this.namespace=n,this.openDbPromise=r}var _P=(TP.prototype.getLastFetchStatus=function(){return this.lastFetchStatus},TP.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.lastSuccessfulFetchTimestampMillis},TP.prototype.getActiveConfig=function(){return this.activeConfig},TP.prototype.loadFromStorage=function(){return aa(this,void 0,void 0,function(){var e,n,r,i,o,a;return sa(this,function(t){switch(t.label){case 0:return e=this.storage.getLastFetchStatus(),n=this.storage.getLastSuccessfulFetchTimestampMillis(),r=this.storage.getActiveConfig(),[4,e];case 1:return(i=t.sent())&&(this.lastFetchStatus=i),[4,n];case 2:return(o=t.sent())&&(this.lastSuccessfulFetchTimestampMillis=o),[4,r];case 3:return(a=t.sent())&&(this.activeConfig=a),[2]}})})},TP.prototype.setLastFetchStatus=function(t){return this.lastFetchStatus=t,this.storage.setLastFetchStatus(t)},TP.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.lastSuccessfulFetchTimestampMillis=t,this.storage.setLastSuccessfulFetchTimestampMillis(t)},TP.prototype.setActiveConfig=function(t){return this.activeConfig=t,this.storage.setActiveConfig(t)},TP);function TP(t){this.storage=t}var EP=(SP.prototype.fetch=function(n){return aa(this,void 0,void 0,function(){var e;return sa(this,function(t){switch(t.label){case 0:return[4,this.storage.getThrottleMetadata()];case 1:return e=t.sent()||{backoffCount:0,throttleEndTimeMillis:Date.now()},[2,this.attemptFetch(n,e)]}})})},SP.prototype.attemptFetch=function(i,t){var o=t.throttleEndTimeMillis,a=t.backoffCount;return aa(this,void 0,void 0,function(){var e,n,r;return sa(this,function(t){switch(t.label){case 0:return[4,function(i,o){return new Promise(function(t,e){var n=Math.max(o-Date.now(),0),r=setTimeout(t,n);i.addEventListener(function(){clearTimeout(r),e(oP.create("fetch-throttle",{throttleEndTimeMillis:o}))})})}(i.signal,o)];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,5,,7]),[4,this.client.fetch(i)];case 3:return e=t.sent(),[4,this.storage.deleteThrottleMetadata()];case 4:return t.sent(),[2,e];case 5:if(!function(t){if(!(t instanceof Na))return!1;var e=Number(t.httpStatus);return 429===e||500===e||503===e||504===e}(n=t.sent()))throw n;return r={throttleEndTimeMillis:Date.now()+function(t){var e=1e3*Math.pow(2,t),n=Math.round(.5*e*(Math.random()-.5)*2);return Math.min(144e5,e+n)}(a),backoffCount:a+1},[4,this.storage.setThrottleMetadata(r)];case 6:return t.sent(),[2,this.attemptFetch(i,r)];case 7:return[2]}})})},SP);function SP(t,e){this.client=t,this.storage=e}var IP;return(IP=fl).INTERNAL.registerService("remoteConfig",function(t,e,n){if("undefined"==typeof window)throw oP.create("registration-window");var r=t.options,i=r.projectId,o=r.apiKey,a=r.appId;if(!i)throw oP.create("registration-project-id");if(!o)throw oP.create("registration-api-key");if(!a)throw oP.create("registration-app-id");n=n||"firebase";var s=new bP(a,t.name,n),u=new _P(s),c=new ns("@firebase/remote-config");c.logLevel=Xa.ERROR;var h=new aP(t.installations(),IP.SDK_VERSION,n,i,o,a),l=new EP(h,s),f=new nP(l,s,u,c),p=new pP(t,f,u,s,c);return p.ensureInitialized(),p},void 0,void 0,!0),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),fl});
//# sourceMappingURL=firebase.js.map
